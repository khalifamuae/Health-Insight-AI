{"file_contents":{"client/src/components/CategoryIcon.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport type { TestCategory } from \"@shared/schema\";\nimport { \n  Pill, \n  Gem, \n  Activity, \n  HeartPulse,\n  Droplets,\n  Shield,\n  TestTube,\n  Scissors,\n  Microscope\n} from \"lucide-react\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\ninterface CategoryIconProps {\n  category: TestCategory;\n}\n\nconst categoryConfig: Record<TestCategory, { icon: typeof Pill; colorClass: string }> = {\n  vitamins: { icon: Pill, colorClass: \"text-orange-600 dark:text-orange-400\" },\n  minerals: { icon: Gem, colorClass: \"text-cyan-600 dark:text-cyan-400\" },\n  hormones: { icon: Activity, colorClass: \"text-purple-600 dark:text-purple-400\" },\n  organ_functions: { icon: HeartPulse, colorClass: \"text-pink-600 dark:text-pink-400\" },\n  lipids: { icon: Droplets, colorClass: \"text-yellow-600 dark:text-yellow-400\" },\n  immunity: { icon: Shield, colorClass: \"text-green-600 dark:text-green-400\" },\n  blood: { icon: TestTube, colorClass: \"text-red-600 dark:text-red-400\" },\n  coagulation: { icon: Scissors, colorClass: \"text-indigo-600 dark:text-indigo-400\" },\n  special: { icon: Microscope, colorClass: \"text-slate-600 dark:text-slate-400\" },\n};\n\nexport function CategoryIcon({ category }: CategoryIconProps) {\n  const { t } = useTranslation();\n  const config = categoryConfig[category];\n  const Icon = config.icon;\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <span className=\"cursor-help\">\n          <Icon className={`h-4 w-4 ${config.colorClass}`} />\n        </span>\n      </TooltipTrigger>\n      <TooltipContent side=\"top\">\n        <p className=\"text-sm\">{t(category)}</p>\n      </TooltipContent>\n    </Tooltip>\n  );\n}\n\nexport function CategoryLegend() {\n  const { t } = useTranslation();\n  \n  const categories: TestCategory[] = [\n    \"vitamins\", \"minerals\", \"hormones\", \"organ_functions\", \n    \"lipids\", \"immunity\", \"blood\", \"coagulation\", \"special\"\n  ];\n\n  return (\n    <div className=\"flex flex-wrap gap-2 text-xs mb-2 p-2 bg-muted/50 rounded-lg\">\n      {categories.map(category => {\n        const config = categoryConfig[category];\n        const Icon = config.icon;\n        return (\n          <div key={category} className=\"flex items-center gap-1\">\n            <Icon className={`h-3 w-3 ${config.colorClass}`} />\n            <span className=\"text-muted-foreground\">{t(category)}</span>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","path":null,"size_bytes":2439,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/pages/Profile.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { ProfileForm } from \"@/components/ProfileForm\";\nimport { SubscriptionCard } from \"@/components/SubscriptionCard\";\nimport { useLocation } from \"wouter\";\nimport { Loader2 } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport type { UserProfile } from \"@shared/schema\";\n\nexport default function Profile() {\n  const [, setLocation] = useLocation();\n  const { user, isLoading: userLoading } = useAuth();\n\n  const { data: profile, isLoading: profileLoading } = useQuery<UserProfile>({\n    queryKey: [\"/api/profile\"],\n    enabled: !!user,\n  });\n\n  if (userLoading || profileLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-muted-foreground mb-4\">Please log in to view your profile</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n      <div className=\"lg:col-span-2\">\n        <ProfileForm \n          user={{\n            id: user.id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            profileImageUrl: user.profileImageUrl,\n          }} \n          profile={profile} \n        />\n      </div>\n      <div>\n        <SubscriptionCard \n          currentPlan={profile?.subscriptionPlan || \"free\"}\n          filesUsed={profile?.filesUploaded || 0}\n          onUpgrade={() => setLocation(\"/subscription\")}\n        />\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1654,"size_tokens":null},"mobile/index.ts":{"content":"import { registerRootComponent } from 'expo';\n\nimport App from './App';\n\n// registerRootComponent calls AppRegistry.registerComponent('main', () => App);\n// It also ensures that whether you load the app in Expo Go or in a native build,\n// the environment is set up appropriately\nregisterRootComponent(App);\n","path":null,"size_bytes":307,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport function ThemeToggle() {\n  const [isDark, setIsDark] = useState(false);\n\n  useEffect(() => {\n    const stored = localStorage.getItem(\"theme\");\n    const prefersDark = window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\n    const shouldBeDark = stored === \"dark\" || (!stored && prefersDark);\n    setIsDark(shouldBeDark);\n    document.documentElement.classList.toggle(\"dark\", shouldBeDark);\n  }, []);\n\n  const toggle = () => {\n    const newValue = !isDark;\n    setIsDark(newValue);\n    document.documentElement.classList.toggle(\"dark\", newValue);\n    localStorage.setItem(\"theme\", newValue ? \"dark\" : \"light\");\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggle}\n      data-testid=\"button-theme-toggle\"\n    >\n      {isDark ? <Sun className=\"h-5 w-5\" /> : <Moon className=\"h-5 w-5\" />}\n    </Button>\n  );\n}\n","path":null,"size_bytes":995,"size_tokens":null},"mobile/src/screens/RemindersScreen.tsx":{"content":"import React from 'react';\nimport {\n  View,\n  Text,\n  StyleSheet,\n  FlatList,\n  TouchableOpacity,\n  I18nManager\n} from 'react-native';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Ionicons } from '@expo/vector-icons';\nimport { queries, api } from '../lib/api';\n\ninterface Reminder {\n  id: number;\n  testName: string;\n  testNameAr: string;\n  dueDate: string;\n  isCompleted: boolean;\n}\n\nexport default function RemindersScreen() {\n  const { t, i18n } = useTranslation();\n  const queryClient = useQueryClient();\n  const isArabic = i18n.language === 'ar';\n\n  const { data: reminders, isLoading } = useQuery({\n    queryKey: ['reminders'],\n    queryFn: queries.reminders\n  });\n\n  const completeMutation = useMutation({\n    mutationFn: (id: number) => api.patch(`/api/reminders/${id}`, { isCompleted: true }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['reminders'] });\n    }\n  });\n\n  const remindersList = (reminders as Reminder[]) || [];\n  const pendingReminders = remindersList.filter(r => !r.isCompleted);\n  const completedReminders = remindersList.filter(r => r.isCompleted);\n\n  const getDaysUntilDue = (dueDate: string) => {\n    const due = new Date(dueDate);\n    const today = new Date();\n    const diffTime = due.getTime() - today.getTime();\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    return diffDays;\n  };\n\n  const renderReminder = ({ item }: { item: Reminder }) => {\n    const testName = isArabic ? item.testNameAr : item.testName;\n    const daysUntil = getDaysUntilDue(item.dueDate);\n    const isOverdue = daysUntil < 0;\n\n    return (\n      <View \n        style={[\n          styles.reminderCard,\n          item.isCompleted && styles.completedCard\n        ]} \n        testID={`card-reminder-${item.id}`}\n      >\n        <View style={styles.reminderContent}>\n          <View style={styles.reminderHeader}>\n            <Ionicons \n              name={item.isCompleted ? 'checkmark-circle' : 'notifications'} \n              size={24} \n              color={item.isCompleted ? '#22c55e' : isOverdue ? '#dc2626' : '#f59e0b'} \n            />\n            <Text style={styles.testName}>{testName}</Text>\n          </View>\n          <View style={styles.reminderDetails}>\n            <Text style={[\n              styles.dueText,\n              isOverdue && !item.isCompleted && styles.overdueText\n            ]}>\n              {item.isCompleted \n                ? t('normal')\n                : isOverdue \n                  ? t('reminders.overdue')\n                  : `${t('reminders.dueIn')} ${daysUntil} ${t('reminders.days')}`\n              }\n            </Text>\n          </View>\n        </View>\n        {!item.isCompleted && (\n          <TouchableOpacity\n            style={styles.completeButton}\n            onPress={() => completeMutation.mutate(item.id)}\n            testID={`button-complete-${item.id}`}\n          >\n            <Ionicons name=\"checkmark\" size={20} color=\"#fff\" />\n          </TouchableOpacity>\n        )}\n      </View>\n    );\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.header}>\n        <Text style={styles.title}>{t('reminders.title')}</Text>\n        <Text style={styles.count}>{pendingReminders.length}</Text>\n      </View>\n\n      {isLoading ? (\n        <View style={styles.loadingContainer}>\n          <Text style={styles.loadingText}>{t('analyzing')}</Text>\n        </View>\n      ) : (\n        <FlatList\n          data={[...pendingReminders, ...completedReminders]}\n          keyExtractor={item => item.id.toString()}\n          renderItem={renderReminder}\n          contentContainerStyle={styles.listContent}\n          ListEmptyComponent={\n            <View style={styles.emptyContainer}>\n              <Ionicons name=\"notifications-off\" size={64} color=\"#cbd5e1\" />\n              <Text style={styles.emptyText}>{t('reminders.title')}</Text>\n            </View>\n          }\n        />\n      )}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f8fafc'\n  },\n  header: {\n    padding: 16,\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center'\n  },\n  title: {\n    fontSize: 24,\n    fontWeight: 'bold',\n    color: '#1e293b'\n  },\n  count: {\n    fontSize: 18,\n    fontWeight: 'bold',\n    color: '#f59e0b',\n    backgroundColor: '#fef3c7',\n    paddingHorizontal: 12,\n    paddingVertical: 4,\n    borderRadius: 12\n  },\n  listContent: {\n    padding: 16\n  },\n  reminderCard: {\n    backgroundColor: '#fff',\n    borderRadius: 12,\n    padding: 16,\n    marginBottom: 12,\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.05,\n    shadowRadius: 4,\n    elevation: 2\n  },\n  completedCard: {\n    opacity: 0.6\n  },\n  reminderContent: {\n    flex: 1\n  },\n  reminderHeader: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    marginBottom: 8\n  },\n  testName: {\n    fontSize: 16,\n    fontWeight: '600',\n    color: '#1e293b',\n    marginHorizontal: 8,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  reminderDetails: {\n    marginLeft: I18nManager.isRTL ? 0 : 32,\n    marginRight: I18nManager.isRTL ? 32 : 0\n  },\n  dueText: {\n    fontSize: 14,\n    color: '#64748b',\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  overdueText: {\n    color: '#dc2626',\n    fontWeight: '600'\n  },\n  completeButton: {\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    backgroundColor: '#22c55e',\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  loadingContainer: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  loadingText: {\n    fontSize: 16,\n    color: '#64748b'\n  },\n  emptyContainer: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n    paddingTop: 60\n  },\n  emptyText: {\n    fontSize: 16,\n    color: '#94a3b8',\n    marginTop: 16\n  }\n});\n","path":null,"size_bytes":6119,"size_tokens":null},"server/replit_integrations/object_storage/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\n// The object storage client is used to interact with the object storage service.\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\n// The object storage service is used to interact with the object storage service.\nexport class ObjectStorageService {\n  constructor() {}\n\n  // Gets the public object search paths.\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  // Gets the private object directory.\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  // Search for a public object from the search paths.\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n\n      // Full path format: /<bucket_name>/<object_name>\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n\n      // Check if file exists\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n\n    return null;\n  }\n\n  // Downloads an object to the response.\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      // Get file metadata\n      const [metadata] = await file.getMetadata();\n      // Get the ACL policy for the object.\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      // Set appropriate headers\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${\n          isPublic ? \"public\" : \"private\"\n        }, max-age=${cacheTtlSec}`,\n      });\n\n      // Stream the file to the response\n      const stream = file.createReadStream();\n\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  // Gets the upload URL for an object entity.\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the object entity file from the object path.\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(\n    rawPath: string,\n  ): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    // Extract the path from the URL by removing query parameters and domain\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n  \n    // Extract the entity ID from the path\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  // Tries to set the ACL policy for the object entity and return the normalized path.\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  // Checks if the user can access the object entity.\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}\n\n","path":null,"size_bytes":8409,"size_tokens":null},"server/replit_integrations/auth/storage.ts":{"content":"import { users, type User, type UpsertUser } from \"@shared/models/auth\";\nimport { db } from \"../../db\";\nimport { eq } from \"drizzle-orm\";\n\n// Interface for auth storage operations\n// (IMPORTANT) These user operations are mandatory for Replit Auth.\nexport interface IAuthStorage {\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n}\n\nclass AuthStorage implements IAuthStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n}\n\nexport const authStorage = new AuthStorage();\n","path":null,"size_bytes":943,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/replit_integrations/audio/useAudioPlayback.ts":{"content":"/**\n * React hook for streaming audio playback using AudioWorklet.\n * Supports real-time PCM16 audio streaming from SSE responses.\n * Includes sequence buffer for reordering out-of-order chunks.\n */\nimport { useRef, useCallback, useState } from \"react\";\nimport { decodePCM16ToFloat32 } from \"./audio-utils\";\n\nexport type PlaybackState = \"idle\" | \"playing\" | \"ended\";\n\n/**\n * Reorders audio chunks that may arrive out of sequence.\n * Buffers chunks until they can be played in correct order.\n *\n * Example: If chunks arrive as seq 2, seq 0, seq 1:\n * - seq 2 arrives → buffered (waiting for seq 0)\n * - seq 0 arrives → played immediately, then check buffer\n * - seq 1 arrives → played immediately (seq 0 done), seq 2 now plays\n */\nclass SequenceBuffer {\n  private pending = new Map<number, string[]>();\n  private nextSeq = 0;\n\n  /** Add chunk with sequence number, returns chunks ready to play in order */\n  push(seq: number, data: string): string[] {\n    // Store the chunk under its sequence number\n    if (!this.pending.has(seq)) {\n      this.pending.set(seq, []);\n    }\n    this.pending.get(seq)!.push(data);\n\n    // Drain consecutive ready sequences\n    const ready: string[] = [];\n    while (this.pending.has(this.nextSeq)) {\n      ready.push(...this.pending.get(this.nextSeq)!);\n      this.pending.delete(this.nextSeq);\n      this.nextSeq++;\n    }\n    return ready;\n  }\n\n  reset() {\n    this.pending.clear();\n    this.nextSeq = 0;\n  }\n}\n\nexport function useAudioPlayback(workletPath = \"/audio-playback-worklet.js\") {\n  const [state, setState] = useState<PlaybackState>(\"idle\");\n  const ctxRef = useRef<AudioContext | null>(null);\n  const workletRef = useRef<AudioWorkletNode | null>(null);\n  const readyRef = useRef(false);\n  const seqBufferRef = useRef(new SequenceBuffer());\n\n  const init = useCallback(async () => {\n    if (readyRef.current) return;\n\n    const ctx = new AudioContext({ sampleRate: 24000 });\n    await ctx.audioWorklet.addModule(workletPath);\n    const worklet = new AudioWorkletNode(ctx, \"audio-playback-processor\");\n    worklet.connect(ctx.destination);\n\n    worklet.port.onmessage = (e) => {\n      if (e.data.type === \"ended\") setState(\"idle\");\n    };\n\n    ctxRef.current = ctx;\n    workletRef.current = worklet;\n    readyRef.current = true;\n  }, [workletPath]);\n\n  /** Push audio directly (no sequencing) - for simple streaming */\n  const pushAudio = useCallback((base64Audio: string) => {\n    if (!workletRef.current) return;\n    const samples = decodePCM16ToFloat32(base64Audio);\n    workletRef.current.port.postMessage({ type: \"audio\", samples });\n    setState(\"playing\");\n  }, []);\n\n  /** Push audio with sequence number - reorders before playback */\n  const pushSequencedAudio = useCallback((seq: number, base64Audio: string) => {\n    if (!workletRef.current) return;\n\n    const readyChunks = seqBufferRef.current.push(seq, base64Audio);\n    for (const chunk of readyChunks) {\n      const samples = decodePCM16ToFloat32(chunk);\n      workletRef.current.port.postMessage({ type: \"audio\", samples });\n    }\n    if (readyChunks.length > 0) {\n      setState(\"playing\");\n    }\n  }, []);\n\n  const signalComplete = useCallback(() => {\n    workletRef.current?.port.postMessage({ type: \"streamComplete\" });\n  }, []);\n\n  const clear = useCallback(() => {\n    workletRef.current?.port.postMessage({ type: \"clear\" });\n    seqBufferRef.current.reset();\n    setState(\"idle\");\n  }, []);\n\n  return { state, init, pushAudio, pushSequencedAudio, signalComplete, clear };\n}\n","path":null,"size_bytes":3495,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, RequestHandler } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport multer from \"multer\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated, registerAuthRoutes } from \"./replit_integrations/auth\";\nimport { analyzeLabPdf } from \"./pdfAnalyzer\";\nimport { generateDietPlan } from \"./dietPlanGenerator\";\nimport { dailyLearningJob, learnDomain } from \"./knowledgeEngine\";\nimport { desc, eq, and, gte, sql } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport type { KnowledgeDomain } from \"@shared/schema\";\n\nconst upload = multer({ \n  storage: multer.memoryStorage(),\n  limits: { fileSize: 10 * 1024 * 1024 } // 10MB limit\n});\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Setup Replit Auth\n  await setupAuth(app);\n  registerAuthRoutes(app);\n\n  // Clean up stale diet plan jobs from previous server instances\n  try {\n    const staleCount = await storage.failStaleJobs();\n    if (staleCount > 0) {\n      console.log(`Cleaned up ${staleCount} stale diet plan job(s)`);\n    }\n  } catch (e) {\n    console.error(\"Failed to clean up stale jobs:\", e);\n  }\n\n  // Profile routes\n  app.get(\"/api/profile\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      let profile = await storage.getUserProfile(userId);\n      \n      if (!profile) {\n        profile = await storage.upsertUserProfile({\n          id: userId,\n          subscriptionPlan: \"free\",\n          filesUploaded: 0,\n          language: \"ar\",\n        });\n      }\n      \n      res.json(profile);\n    } catch (error) {\n      console.error(\"Error fetching profile:\", error);\n      res.status(500).json({ error: \"Failed to fetch profile\" });\n    }\n  });\n\n  app.patch(\"/api/profile\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { phone, age, weight, height, gender, fitnessGoal, activityLevel, mealPreference, hasAllergies, allergies, proteinPreference, proteinPreferences, carbPreferences } = req.body;\n      \n      const profile = await storage.upsertUserProfile({\n        id: userId,\n        phone,\n        age,\n        weight,\n        height,\n        gender,\n        fitnessGoal,\n        activityLevel,\n        mealPreference,\n        hasAllergies,\n        allergies,\n        proteinPreference,\n        proteinPreferences,\n        carbPreferences,\n      });\n      \n      res.json(profile);\n    } catch (error) {\n      console.error(\"Error updating profile:\", error);\n      res.status(500).json({ error: \"Failed to update profile\" });\n    }\n  });\n\n  // Test results routes - returns only user's actual test results\n  app.get(\"/api/tests\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const tests = await storage.getTestResultsByUser(userId);\n      res.json(tests);\n    } catch (error) {\n      console.error(\"Error fetching tests:\", error);\n      res.status(500).json({ error: \"Failed to fetch tests\" });\n    }\n  });\n\n  // Get ALL 50 tests merged with user values (0 if missing)\n  // Ordered by importance level and category as defined in app\n  app.get(\"/api/tests/all\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Get all test definitions (ordered by importance and category)\n      const definitions = await storage.getTestDefinitions();\n      \n      // Get user's test results\n      const userTests = await storage.getTestResultsByUser(userId);\n      \n      // Create map of latest user test results by testId\n      const userTestMap = new Map<string, any>();\n      for (const test of userTests) {\n        const existing = userTestMap.get(test.testId);\n        if (!existing || (test.testDate && existing.testDate && new Date(test.testDate) > new Date(existing.testDate))) {\n          userTestMap.set(test.testId, test);\n        }\n      }\n      \n      // Merge all definitions with user values\n      const allTests = definitions.map((def, index) => {\n        const userTest = userTestMap.get(def.id);\n        return {\n          id: userTest?.id || `empty-${def.id}`,\n          testId: def.id,\n          nameEn: def.nameEn,\n          nameAr: def.nameAr,\n          shortName: def.shortName,\n          category: def.category,\n          importance: def.level,\n          unit: def.unit,\n          normalRangeMin: def.normalRangeMin,\n          normalRangeMax: def.normalRangeMax,\n          recheckMonths: def.recheckMonths,\n          descriptionEn: def.descriptionEn,\n          descriptionAr: def.descriptionAr,\n          value: userTest?.value ?? 0,\n          valueText: userTest?.valueText || null,\n          status: userTest?.status || \"pending\",\n          testDate: userTest?.testDate || null,\n          pdfFileName: userTest?.pdfFileName || null,\n          hasResult: !!userTest,\n          order: index,\n        };\n      });\n      \n      res.json(allTests);\n    } catch (error) {\n      console.error(\"Error fetching all tests:\", error);\n      res.status(500).json({ error: \"Failed to fetch all tests\" });\n    }\n  });\n\n  // Test definitions\n  app.get(\"/api/test-definitions\", async (req: Request, res: Response) => {\n    try {\n      const definitions = await storage.getTestDefinitions();\n      res.json(definitions);\n    } catch (error) {\n      console.error(\"Error fetching test definitions:\", error);\n      res.status(500).json({ error: \"Failed to fetch test definitions\" });\n    }\n  });\n\n  // Reminders routes\n  app.get(\"/api/reminders\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const userReminders = await storage.getRemindersByUser(userId);\n      res.json(userReminders);\n    } catch (error) {\n      console.error(\"Error fetching reminders:\", error);\n      res.status(500).json({ error: \"Failed to fetch reminders\" });\n    }\n  });\n\n  // Stats route\n  app.get(\"/api/stats\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const tests = await storage.getTestResultsByUser(userId);\n      const userReminders = await storage.getRemindersByUser(userId);\n      const pdfs = await storage.getUploadedPdfsByUser(userId);\n      \n      const thirtyDaysAgo = new Date();\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n      \n      const recentUploads = pdfs.filter(p => \n        p.createdAt && new Date(p.createdAt) > thirtyDaysAgo\n      ).length;\n\n      const normalTests = tests.filter(t => t.status === \"normal\").length;\n      const abnormalTests = tests.filter(t => t.status === \"low\" || t.status === \"high\").length;\n      const pendingReminders = userReminders.filter(r => !r.sent && new Date(r.dueDate) > new Date()).length;\n\n      res.json({\n        totalTests: tests.length,\n        normalTests,\n        abnormalTests,\n        pendingReminders,\n        recentUploads,\n      });\n    } catch (error) {\n      console.error(\"Error fetching stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Create test result manually\n  app.post(\"/api/tests\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { testId, value, valueText, testDate } = req.body;\n\n      const def = await storage.getTestDefinitionById(testId);\n      if (!def) {\n        return res.status(400).json({ error: \"Invalid test ID\" });\n      }\n\n      let status: \"normal\" | \"low\" | \"high\" = \"normal\";\n      if (def.normalRangeMin !== null && def.normalRangeMax !== null && value !== null) {\n        if (value < def.normalRangeMin) status = \"low\";\n        else if (value > def.normalRangeMax) status = \"high\";\n      }\n\n      const result = await storage.createTestResult({\n        userId,\n        testId,\n        value,\n        valueText,\n        status,\n        testDate: new Date(testDate),\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error creating test result:\", error);\n      res.status(500).json({ error: \"Failed to create test result\" });\n    }\n  });\n\n  // Delete test result\n  app.delete(\"/api/tests/:id\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const testResultId = req.params.id;\n      \n      await storage.deleteTestResult(testResultId, userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting test result:\", error);\n      res.status(500).json({ error: \"Failed to delete test result\" });\n    }\n  });\n\n  // Mark reminder as sent/acknowledged\n  app.patch(\"/api/reminders/:id\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const reminderId = req.params.id;\n      const { sent } = req.body;\n\n      await storage.updateReminder(reminderId, userId, { sent, sentAt: sent ? new Date() : null });\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating reminder:\", error);\n      res.status(500).json({ error: \"Failed to update reminder\" });\n    }\n  });\n\n  // Create or update reminder for a test\n  app.post(\"/api/reminders\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { testId, dueDate } = req.body;\n\n      if (!testId || !dueDate) {\n        return res.status(400).json({ error: \"testId and dueDate are required\" });\n      }\n\n      // Delete existing reminder for this test if any\n      await storage.deleteReminderByTest(userId, testId);\n\n      // Create new reminder\n      const reminder = await storage.createReminder({\n        userId,\n        testId,\n        dueDate: new Date(dueDate),\n      });\n\n      res.json(reminder);\n    } catch (error) {\n      console.error(\"Error creating reminder:\", error);\n      res.status(500).json({ error: \"Failed to create reminder\" });\n    }\n  });\n\n  // Delete reminder\n  app.delete(\"/api/reminders/:id\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const reminderId = req.params.id;\n\n      await storage.deleteReminder(reminderId, userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting reminder:\", error);\n      res.status(500).json({ error: \"Failed to delete reminder\" });\n    }\n  });\n\n  // Get uploaded PDFs list\n  app.get(\"/api/uploaded-pdfs\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const pdfs = await storage.getUploadedPdfsByUser(userId);\n      res.json(pdfs);\n    } catch (error) {\n      console.error(\"Error fetching uploaded PDFs:\", error);\n      res.status(500).json({ error: \"Failed to fetch uploaded PDFs\" });\n    }\n  });\n\n  // Delete uploaded PDF\n  app.delete(\"/api/uploaded-pdfs/:id\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { id } = req.params;\n      const deleted = await storage.deleteUploadedPdf(id, userId);\n      if (!deleted) {\n        return res.status(404).json({ error: \"PDF not found\" });\n      }\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting PDF:\", error);\n      res.status(500).json({ error: \"Failed to delete PDF\" });\n    }\n  });\n\n  // Helper function to process PDF with a given record\n  async function processPdfFromRecord(pdfId: string, userId: string, fileBuffer: Buffer, fileName: string) {\n    // Update status to processing\n    await storage.updateUploadedPdfStatus(pdfId, \"processing\");\n\n    try {\n      // Analyze PDF using AI\n      const extractedTests = await analyzeLabPdf(fileBuffer);\n\n      // Get test definitions for matching\n      const definitions = await storage.getTestDefinitions();\n      const defMap = new Map(definitions.map(d => [d.id, d]));\n\n      const defaultTestDate = new Date();\n      let testsCreated = 0;\n\n      // Create test results and reminders\n      for (const extracted of extractedTests) {\n        const def = defMap.get(extracted.testId);\n        if (!def) continue;\n\n        // Determine status\n        let status: \"normal\" | \"low\" | \"high\" = \"normal\";\n        if (def.normalRangeMin !== null && def.normalRangeMax !== null && extracted.value !== null) {\n          if (extracted.value < def.normalRangeMin) status = \"low\";\n          else if (extracted.value > def.normalRangeMax) status = \"high\";\n        }\n\n        // Use extracted date if available, otherwise use current date\n        const testDate = extracted.testDate ? new Date(extracted.testDate) : defaultTestDate;\n\n        // Create test result\n        await storage.createTestResult({\n          userId,\n          testId: extracted.testId,\n          value: extracted.value,\n          valueText: extracted.valueText,\n          status,\n          testDate,\n          pdfFileName: fileName,\n        });\n        testsCreated++;\n\n        // Create reminder based on recheck interval\n        if (def.recheckMonths) {\n          const dueDate = new Date(testDate);\n          dueDate.setMonth(dueDate.getMonth() + def.recheckMonths);\n          \n          await storage.createReminder({\n            userId,\n            testId: extracted.testId,\n            dueDate,\n          });\n        }\n      }\n\n      // Update status to success\n      await storage.updateUploadedPdfStatus(pdfId, \"success\", testsCreated);\n\n      return { success: true, testsExtracted: testsCreated };\n    } catch (error) {\n      // Update status to failed\n      const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n      await storage.updateUploadedPdfStatus(pdfId, \"failed\", undefined, errorMessage);\n      throw error;\n    }\n  }\n\n  // PDF upload and analysis\n  app.post(\"/api/analyze-pdf\", isAuthenticated, upload.single(\"pdf\"), async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const file = req.file;\n\n      if (!file) {\n        return res.status(400).json({ error: \"No PDF file uploaded\" });\n      }\n\n      // Check subscription limits\n      const profile = await storage.getUserProfile(userId);\n      const plan = profile?.subscriptionPlan || \"free\";\n      const filesUploaded = profile?.filesUploaded || 0;\n      \n      const limits: Record<string, number> = { free: 3, basic: 20, premium: Infinity };\n      if (filesUploaded >= limits[plan]) {\n        return res.status(403).json({ \n          error: \"Upload limit reached\", \n          message: \"Please upgrade your subscription to upload more files\"\n        });\n      }\n\n      // Create PDF record with processing status (analysis starts immediately)\n      const pdfRecord = await storage.createUploadedPdf({\n        userId,\n        fileName: file.originalname,\n        filePath: \"\",\n        status: \"processing\",\n      });\n\n      // Increment files uploaded\n      await storage.incrementFilesUploaded(userId);\n\n      try {\n        // Process the PDF\n        const result = await processPdfFromRecord(pdfRecord.id, userId, file.buffer, file.originalname);\n\n        res.json({ \n          success: true, \n          testsExtracted: result.testsExtracted,\n          pdfId: pdfRecord.id,\n          message: `Successfully extracted ${result.testsExtracted} test results`\n        });\n      } catch (error) {\n        console.error(\"Error analyzing PDF:\", error);\n        res.status(500).json({ \n          error: \"Failed to analyze PDF\",\n          pdfId: pdfRecord.id,\n          message: \"The file was saved but could not be processed. You can retry later.\"\n        });\n      }\n    } catch (error) {\n      console.error(\"Error uploading PDF:\", error);\n      res.status(500).json({ error: \"Failed to upload PDF\" });\n    }\n  });\n\n  // Retry processing a failed PDF (requires file to be re-uploaded)\n  app.post(\"/api/uploaded-pdfs/:id/retry\", isAuthenticated, upload.single(\"pdf\"), async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { id } = req.params;\n      const file = req.file;\n\n      if (!file) {\n        return res.status(400).json({ error: \"No PDF file uploaded for retry\" });\n      }\n\n      // Get the existing PDF record\n      const pdfRecord = await storage.getUploadedPdfById(id, userId);\n      if (!pdfRecord) {\n        return res.status(404).json({ error: \"PDF record not found\" });\n      }\n\n      // Reset the record and retry\n      await storage.updateUploadedPdfStatus(id, \"pending\", undefined, undefined);\n\n      try {\n        const result = await processPdfFromRecord(id, userId, file.buffer, pdfRecord.fileName);\n\n        res.json({ \n          success: true, \n          testsExtracted: result.testsExtracted,\n          message: `Successfully extracted ${result.testsExtracted} test results`\n        });\n      } catch (error) {\n        console.error(\"Error retrying PDF analysis:\", error);\n        res.status(500).json({ \n          error: \"Failed to analyze PDF\",\n          message: \"Retry failed. Please try again later.\"\n        });\n      }\n    } catch (error) {\n      console.error(\"Error in retry:\", error);\n      res.status(500).json({ error: \"Failed to retry PDF processing\" });\n    }\n  });\n\n  app.post(\"/api/diet-plan\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const language = req.body.language || \"ar\";\n\n      const job = await storage.createDietPlanJob(userId, language);\n\n      const profile = await storage.getUserProfile(userId);\n      \n      if (!profile?.weight || !profile?.height || !profile?.age || !profile?.gender) {\n        await storage.updateDietPlanJob(job.id, { status: \"failed\", error: \"MISSING_PROFILE_DATA\" });\n        return res.status(400).json({ error: \"MISSING_PROFILE_DATA\", message: language === \"ar\" ? \"يرجى إكمال بيانات الملف الشخصي (الوزن، الطول، العمر، الجنس) قبل إنشاء خطة غذائية\" : \"Please complete your profile data (weight, height, age, gender) before generating a diet plan\" });\n      }\n\n      const tests = await storage.getTestResultsByUser(userId);\n      const definitions = await storage.getTestDefinitions();\n      const defMap = new Map(definitions.map(d => [d.id, d]));\n\n      const latestByTest = new Map<string, any>();\n      for (const test of tests) {\n        const existing = latestByTest.get(test.testId);\n        if (!existing || (test.testDate && existing.testDate && new Date(test.testDate) > new Date(existing.testDate))) {\n          latestByTest.set(test.testId, test);\n        }\n      }\n\n      const testResultsData = Array.from(latestByTest.values()).map(t => {\n        const def = defMap.get(t.testId);\n        return {\n          testId: t.testId,\n          testName: language === \"ar\" ? (def?.nameAr || t.testId) : (def?.nameEn || t.testId),\n          value: t.value,\n          status: t.status || \"normal\",\n          normalRangeMin: def?.normalRangeMin ?? null,\n          normalRangeMax: def?.normalRangeMax ?? null,\n          unit: def?.unit ?? null,\n          category: def?.category || \"special\",\n        };\n      });\n\n      (async () => {\n        const startTime = Date.now();\n        try {\n          await storage.updateDietPlanJob(job.id, { status: \"processing\" });\n          console.log(`Diet plan job ${job.id} started processing...`);\n\n          const dietPlan = await generateDietPlan({\n            weight: profile?.weight ?? null,\n            height: profile?.height ?? null,\n            age: profile?.age ?? null,\n            gender: profile?.gender ?? null,\n            fitnessGoal: profile?.fitnessGoal ?? \"maintain\",\n            activityLevel: profile?.activityLevel ?? \"sedentary\",\n            mealPreference: profile?.mealPreference ?? \"balanced\",\n            hasAllergies: profile?.hasAllergies ?? false,\n            allergies: profile?.allergies ?? [],\n            proteinPreference: profile?.proteinPreference ?? \"mixed\",\n            proteinPreferences: profile?.proteinPreferences ?? [],\n            carbPreferences: profile?.carbPreferences ?? [],\n            language,\n            testResults: testResultsData,\n          });\n\n          const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);\n          await storage.updateDietPlanJob(job.id, {\n            status: \"completed\",\n            planData: JSON.stringify(dietPlan),\n          });\n          console.log(`Diet plan job ${job.id} completed in ${elapsed}s`);\n        } catch (error) {\n          const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);\n          console.error(`Diet plan job ${job.id} failed after ${elapsed}s:`, error);\n          await storage.updateDietPlanJob(job.id, {\n            status: \"failed\",\n            error: error instanceof Error ? error.message : \"Unknown error\",\n          });\n        }\n      })();\n\n      res.json({ jobId: job.id, status: \"pending\" });\n    } catch (error) {\n      console.error(\"Error starting diet plan job:\", error);\n      res.status(500).json({ error: \"Failed to start diet plan generation\" });\n    }\n  });\n\n  app.get(\"/api/diet-plan/job/:jobId\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { jobId } = req.params;\n      const job = await storage.getDietPlanJob(jobId, userId);\n      if (!job) {\n        return res.status(404).json({ error: \"Job not found\" });\n      }\n      if (job.status === \"completed\" && job.planData) {\n        res.json({ status: \"completed\", plan: JSON.parse(job.planData) });\n      } else if (job.status === \"failed\") {\n        res.json({ status: \"failed\", error: job.error });\n      } else if (job.status === \"processing\") {\n        const elapsed = job.createdAt ? Math.round((Date.now() - new Date(job.createdAt).getTime()) / 1000) : 0;\n        if (elapsed > 300) {\n          await storage.updateDietPlanJob(jobId, {\n            status: \"failed\",\n            error: \"Generation timed out after 5 minutes\",\n          });\n          res.json({ status: \"failed\", error: \"Generation timed out\" });\n        } else {\n          res.json({ status: \"processing\", elapsed });\n        }\n      } else {\n        res.json({ status: \"pending\" });\n      }\n    } catch (error) {\n      console.error(\"Error checking diet plan job:\", error);\n      res.status(500).json({ error: \"Failed to check job status\" });\n    }\n  });\n\n  app.get(\"/api/saved-diet-plans\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const plans = await storage.getSavedDietPlans(userId);\n      res.json(plans);\n    } catch (error) {\n      console.error(\"Error fetching saved diet plans:\", error);\n      res.status(500).json({ error: \"Failed to fetch saved diet plans\" });\n    }\n  });\n\n  app.post(\"/api/saved-diet-plans\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { planData } = req.body;\n      if (!planData) {\n        return res.status(400).json({ error: \"Plan data is required\" });\n      }\n      const saved = await storage.saveDietPlan(userId, typeof planData === \"string\" ? planData : JSON.stringify(planData));\n      res.json(saved);\n    } catch (error) {\n      console.error(\"Error saving diet plan:\", error);\n      res.status(500).json({ error: \"Failed to save diet plan\" });\n    }\n  });\n\n  app.delete(\"/api/saved-diet-plans/:id\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { id } = req.params;\n      await storage.deleteSavedDietPlan(id, userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting saved diet plan:\", error);\n      res.status(500).json({ error: \"Failed to delete saved diet plan\" });\n    }\n  });\n\n  app.get(\"/api/knowledge\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const domain = req.query.domain as KnowledgeDomain | undefined;\n      const entries = await storage.getAllKnowledge(domain || undefined);\n      res.json(entries);\n    } catch (error) {\n      console.error(\"Error fetching knowledge:\", error);\n      res.status(500).json({ error: \"Failed to fetch knowledge\" });\n    }\n  });\n\n  app.get(\"/api/knowledge/stats\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const counts = await storage.getKnowledgeCount();\n      const domains: KnowledgeDomain[] = [\"nutrition\", \"aerobic_training\", \"resistance_training\", \"vitamins_minerals\", \"hormones\"];\n      const lastLearned: Record<string, string | null> = {};\n      for (const d of domains) {\n        const log = await storage.getLastLearningLog(d);\n        lastLearned[d] = log?.createdAt ? new Date(log.createdAt).toISOString() : null;\n      }\n      res.json({ counts, lastLearned, totalEntries: Object.values(counts).reduce((a, b) => a + b, 0) });\n    } catch (error) {\n      console.error(\"Error fetching knowledge stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch knowledge stats\" });\n    }\n  });\n\n  app.post(\"/api/knowledge/learn\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const { domain } = req.body;\n      if (domain) {\n        const validDomains: KnowledgeDomain[] = [\"nutrition\", \"aerobic_training\", \"resistance_training\", \"vitamins_minerals\", \"hormones\"];\n        if (!validDomains.includes(domain)) {\n          return res.status(400).json({ error: \"Invalid domain\" });\n        }\n        const count = await learnDomain(domain);\n        res.json({ success: true, entriesAdded: count, domain });\n      } else {\n        dailyLearningJob().catch(err => console.error(\"Manual learning job failed:\", err));\n        res.json({ success: true, message: \"Learning job started for all domains\" });\n      }\n    } catch (error) {\n      console.error(\"Error triggering learning:\", error);\n      res.status(500).json({ error: \"Failed to trigger learning\" });\n    }\n  });\n\n  app.delete(\"/api/knowledge/:id\", isAuthenticated, async (req: any, res: Response) => {\n    try {\n      const { id } = req.params;\n      await storage.deleteKnowledgeEntry(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting knowledge entry:\", error);\n      res.status(500).json({ error: \"Failed to delete knowledge entry\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":26355,"size_tokens":null},"server/replit_integrations/image/client.ts":{"content":"import fs from \"node:fs\";\nimport OpenAI, { toFile } from \"openai\";\nimport { Buffer } from \"node:buffer\";\n\nexport const openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\n/**\n * Generate an image and return as Buffer.\n * Uses gpt-image-1 model via Replit AI Integrations.\n */\nexport async function generateImageBuffer(\n  prompt: string,\n  size: \"1024x1024\" | \"512x512\" | \"256x256\" = \"1024x1024\"\n): Promise<Buffer> {\n  const response = await openai.images.generate({\n    model: \"gpt-image-1\",\n    prompt,\n    size,\n  });\n  const base64 = response.data[0]?.b64_json ?? \"\";\n  return Buffer.from(base64, \"base64\");\n}\n\n/**\n * Edit/combine multiple images into a composite.\n * Uses gpt-image-1 model via Replit AI Integrations.\n */\nexport async function editImages(\n  imageFiles: string[],\n  prompt: string,\n  outputPath?: string\n): Promise<Buffer> {\n  const images = await Promise.all(\n    imageFiles.map((file) =>\n      toFile(fs.createReadStream(file), file, {\n        type: \"image/png\",\n      })\n    )\n  );\n\n  const response = await openai.images.edit({\n    model: \"gpt-image-1\",\n    image: images,\n    prompt,\n  });\n\n  const imageBase64 = response.data[0]?.b64_json ?? \"\";\n  const imageBytes = Buffer.from(imageBase64, \"base64\");\n\n  if (outputPath) {\n    fs.writeFileSync(outputPath, imageBytes);\n  }\n\n  return imageBytes;\n}\n\n","path":null,"size_bytes":1410,"size_tokens":null},"server/replit_integrations/audio/routes.ts":{"content":"import express, { type Express, type Request, type Response } from \"express\";\nimport { chatStorage } from \"../chat/storage\";\nimport { openai, speechToText, ensureCompatibleFormat } from \"./client\";\n\n// Body parser with 50MB limit for audio payloads\nconst audioBodyParser = express.json({ limit: \"50mb\" });\n\nexport function registerAudioRoutes(app: Express): void {\n  // Get all conversations\n  app.get(\"/api/conversations\", async (req: Request, res: Response) => {\n    try {\n      const conversations = await chatStorage.getAllConversations();\n      res.json(conversations);\n    } catch (error) {\n      console.error(\"Error fetching conversations:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversations\" });\n    }\n  });\n\n  // Get single conversation with messages\n  app.get(\"/api/conversations/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const conversation = await chatStorage.getConversation(id);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n      const messages = await chatStorage.getMessagesByConversation(id);\n      res.json({ ...conversation, messages });\n    } catch (error) {\n      console.error(\"Error fetching conversation:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversation\" });\n    }\n  });\n\n  // Create new conversation\n  app.post(\"/api/conversations\", async (req: Request, res: Response) => {\n    try {\n      const { title } = req.body;\n      const conversation = await chatStorage.createConversation(title || \"New Chat\");\n      res.status(201).json(conversation);\n    } catch (error) {\n      console.error(\"Error creating conversation:\", error);\n      res.status(500).json({ error: \"Failed to create conversation\" });\n    }\n  });\n\n  // Delete conversation\n  app.delete(\"/api/conversations/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await chatStorage.deleteConversation(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting conversation:\", error);\n      res.status(500).json({ error: \"Failed to delete conversation\" });\n    }\n  });\n\n  // Send voice message and get streaming audio response\n  // Auto-detects audio format and converts WebM/MP4/OGG to WAV\n  // Uses gpt-4o-mini-transcribe for STT, gpt-audio for voice response\n  app.post(\"/api/conversations/:id/messages\", audioBodyParser, async (req: Request, res: Response) => {\n    try {\n      const conversationId = parseInt(req.params.id);\n      const { audio, voice = \"alloy\" } = req.body;\n\n      if (!audio) {\n        return res.status(400).json({ error: \"Audio data (base64) is required\" });\n      }\n\n      // 1. Auto-detect format and convert to OpenAI-compatible format\n      const rawBuffer = Buffer.from(audio, \"base64\");\n      const { buffer: audioBuffer, format: inputFormat } = await ensureCompatibleFormat(rawBuffer);\n\n      // 2. Transcribe user audio\n      const userTranscript = await speechToText(audioBuffer, inputFormat);\n\n      // 3. Save user message\n      await chatStorage.createMessage(conversationId, \"user\", userTranscript);\n\n      // 4. Get conversation history\n      const existingMessages = await chatStorage.getMessagesByConversation(conversationId);\n      const chatHistory = existingMessages.map((m) => ({\n        role: m.role as \"user\" | \"assistant\",\n        content: m.content,\n      }));\n\n      // 5. Set up SSE\n      res.setHeader(\"Content-Type\", \"text/event-stream\");\n      res.setHeader(\"Cache-Control\", \"no-cache\");\n      res.setHeader(\"Connection\", \"keep-alive\");\n\n      res.write(`data: ${JSON.stringify({ type: \"user_transcript\", data: userTranscript })}\\n\\n`);\n\n      // 6. Stream audio response from gpt-audio\n      const stream = await openai.chat.completions.create({\n        model: \"gpt-audio\",\n        modalities: [\"text\", \"audio\"],\n        audio: { voice, format: \"pcm16\" },\n        messages: chatHistory,\n        stream: true,\n      });\n\n      let assistantTranscript = \"\";\n\n      for await (const chunk of stream) {\n        const delta = chunk.choices?.[0]?.delta as any;\n        if (!delta) continue;\n\n        if (delta?.audio?.transcript) {\n          assistantTranscript += delta.audio.transcript;\n          res.write(`data: ${JSON.stringify({ type: \"transcript\", data: delta.audio.transcript })}\\n\\n`);\n        }\n\n        if (delta?.audio?.data) {\n          res.write(`data: ${JSON.stringify({ type: \"audio\", data: delta.audio.data })}\\n\\n`);\n        }\n      }\n\n      // 7. Save assistant message\n      await chatStorage.createMessage(conversationId, \"assistant\", assistantTranscript);\n\n      res.write(`data: ${JSON.stringify({ type: \"done\", transcript: assistantTranscript })}\\n\\n`);\n      res.end();\n    } catch (error) {\n      console.error(\"Error processing voice message:\", error);\n      if (res.headersSent) {\n        res.write(`data: ${JSON.stringify({ type: \"error\", error: \"Failed to process voice message\" })}\\n\\n`);\n        res.end();\n      } else {\n        res.status(500).json({ error: \"Failed to process voice message\" });\n      }\n    }\n  });\n}\n","path":null,"size_bytes":5151,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, boolean, real, pgEnum } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Re-export auth models\nexport * from \"./models/auth\";\nexport * from \"./models/chat\";\n\n// Enums\nexport const testStatusEnum = pgEnum(\"test_status\", [\"normal\", \"low\", \"high\"]);\nexport const subscriptionPlanEnum = pgEnum(\"subscription_plan\", [\"free\", \"basic\", \"premium\"]);\nexport const testCategoryEnum = pgEnum(\"test_category\", [\n  \"vitamins\",\n  \"minerals\", \n  \"hormones\",\n  \"organ_functions\",\n  \"lipids\",\n  \"immunity\",\n  \"blood\",\n  \"coagulation\",\n  \"special\"\n]);\nexport const genderEnum = pgEnum(\"gender\", [\"male\", \"female\"]);\nexport const fitnessGoalEnum = pgEnum(\"fitness_goal\", [\"weight_loss\", \"maintain\", \"muscle_gain\"]);\nexport const activityLevelEnum = pgEnum(\"activity_level\", [\"sedentary\", \"lightly_active\", \"very_active\", \"extremely_active\"]);\nexport const mealPreferenceEnum = pgEnum(\"meal_preference\", [\"high_protein\", \"balanced\", \"low_carb\", \"vegetarian\", \"custom_macros\"]);\nexport const proteinPreferenceEnum = pgEnum(\"protein_preference\", [\"fish\", \"chicken\", \"meat\", \"mixed\"]); // kept for DB compatibility\nexport const pdfStatusEnum = pgEnum(\"pdf_status\", [\"pending\", \"processing\", \"success\", \"failed\"]);\n\n// User profiles - extends auth users with health data\nexport const userProfiles = pgTable(\"user_profiles\", {\n  id: varchar(\"id\").primaryKey(),\n  phone: varchar(\"phone\"),\n  age: integer(\"age\"),\n  weight: real(\"weight\"),\n  height: real(\"height\"),\n  gender: genderEnum(\"gender\"),\n  fitnessGoal: fitnessGoalEnum(\"fitness_goal\").default(\"maintain\"),\n  activityLevel: activityLevelEnum(\"activity_level\").default(\"sedentary\"),\n  mealPreference: mealPreferenceEnum(\"meal_preference\").default(\"balanced\"),\n  hasAllergies: boolean(\"has_allergies\").default(false),\n  allergies: text(\"allergies\").array(),\n  proteinPreference: proteinPreferenceEnum(\"protein_preference\").default(\"mixed\"),\n  proteinPreferences: text(\"protein_preferences\").array(),\n  carbPreferences: text(\"carb_preferences\").array(),\n  profileImagePath: text(\"profile_image_path\"),\n  language: varchar(\"language\", { length: 5 }).default(\"ar\"),\n  subscriptionPlan: subscriptionPlanEnum(\"subscription_plan\").default(\"free\"),\n  filesUploaded: integer(\"files_uploaded\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Test definitions - the 50 tests with their metadata\nexport const testDefinitions = pgTable(\"test_definitions\", {\n  id: varchar(\"id\").primaryKey(),\n  nameEn: text(\"name_en\").notNull(),\n  nameAr: text(\"name_ar\").notNull(),\n  shortName: varchar(\"short_name\", { length: 20 }), // Short English abbreviation\n  category: testCategoryEnum(\"category\").notNull(),\n  level: integer(\"level\").notNull(), // 1-7 importance level\n  unit: varchar(\"unit\", { length: 50 }),\n  normalRangeMin: real(\"normal_range_min\"),\n  normalRangeMax: real(\"normal_range_max\"),\n  normalRangeText: text(\"normal_range_text\"),\n  recheckMonths: integer(\"recheck_months\").default(6), // How often to recheck\n  descriptionEn: text(\"description_en\"),\n  descriptionAr: text(\"description_ar\"),\n});\n\n// User test results\nexport const testResults = pgTable(\"test_results\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  testId: varchar(\"test_id\").notNull(),\n  value: real(\"value\"),\n  valueText: text(\"value_text\"),\n  status: testStatusEnum(\"status\").default(\"normal\"),\n  testDate: timestamp(\"test_date\").notNull(),\n  pdfFileName: text(\"pdf_file_name\"),\n  pdfFilePath: text(\"pdf_file_path\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Reminders for re-testing\nexport const reminders = pgTable(\"reminders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  testId: varchar(\"test_id\").notNull(),\n  dueDate: timestamp(\"due_date\").notNull(),\n  sent: boolean(\"sent\").default(false),\n  sentAt: timestamp(\"sent_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Uploaded PDFs tracking\nexport const uploadedPdfs = pgTable(\"uploaded_pdfs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  fileName: text(\"file_name\").notNull(),\n  filePath: text(\"file_path\").notNull(),\n  status: pdfStatusEnum(\"status\").default(\"pending\"),\n  errorMessage: text(\"error_message\"),\n  processedAt: timestamp(\"processed_at\"),\n  testsExtracted: integer(\"tests_extracted\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Diet plan background jobs\nexport const dietPlanJobs = pgTable(\"diet_plan_jobs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  status: varchar(\"status\").notNull().default(\"pending\"), // pending, completed, failed\n  planData: text(\"plan_data\"),\n  error: text(\"error\"),\n  language: varchar(\"language\").default(\"ar\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\n// Saved diet plans\nexport const savedDietPlans = pgTable(\"saved_diet_plans\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  planData: text(\"plan_data\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Knowledge domains\nexport const knowledgeDomainEnum = pgEnum(\"knowledge_domain\", [\n  \"nutrition\",\n  \"aerobic_training\", \n  \"resistance_training\",\n  \"vitamins_minerals\",\n  \"hormones\"\n]);\n\n// Knowledge base - stores scientific knowledge from trusted sources\nexport const knowledgeBase = pgTable(\"knowledge_base\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  domain: knowledgeDomainEnum(\"domain\").notNull(),\n  topic: text(\"topic\").notNull(),\n  content: text(\"content\").notNull(),\n  contentAr: text(\"content_ar\"),\n  source: text(\"source\").notNull(),\n  sourceUrl: text(\"source_url\"),\n  tags: text(\"tags\").array(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Knowledge learning log - tracks when the system last learned\nexport const knowledgeLearningLog = pgTable(\"knowledge_learning_log\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  domain: knowledgeDomainEnum(\"domain\").notNull(),\n  topicsSearched: text(\"topics_searched\").array(),\n  entriesAdded: integer(\"entries_added\").default(0),\n  status: varchar(\"status\").notNull().default(\"completed\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Relations\nexport const userProfilesRelations = relations(userProfiles, ({ many }) => ({\n  testResults: many(testResults),\n  reminders: many(reminders),\n  uploadedPdfs: many(uploadedPdfs),\n  savedDietPlans: many(savedDietPlans),\n}));\n\nexport const testDefinitionsRelations = relations(testDefinitions, ({ many }) => ({\n  testResults: many(testResults),\n  reminders: many(reminders),\n}));\n\nexport const testResultsRelations = relations(testResults, ({ one }) => ({\n  user: one(userProfiles, {\n    fields: [testResults.userId],\n    references: [userProfiles.id],\n  }),\n  testDefinition: one(testDefinitions, {\n    fields: [testResults.testId],\n    references: [testDefinitions.id],\n  }),\n}));\n\nexport const remindersRelations = relations(reminders, ({ one }) => ({\n  user: one(userProfiles, {\n    fields: [reminders.userId],\n    references: [userProfiles.id],\n  }),\n  testDefinition: one(testDefinitions, {\n    fields: [reminders.testId],\n    references: [testDefinitions.id],\n  }),\n}));\n\nexport const uploadedPdfsRelations = relations(uploadedPdfs, ({ one }) => ({\n  user: one(userProfiles, {\n    fields: [uploadedPdfs.userId],\n    references: [userProfiles.id],\n  }),\n}));\n\nexport const savedDietPlansRelations = relations(savedDietPlans, ({ one }) => ({\n  user: one(userProfiles, {\n    fields: [savedDietPlans.userId],\n    references: [userProfiles.id],\n  }),\n}));\n\nexport const insertKnowledgeBaseSchema = createInsertSchema(knowledgeBase).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Insert schemas\nexport const insertUserProfileSchema = createInsertSchema(userProfiles).omit({\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTestResultSchema = createInsertSchema(testResults).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertReminderSchema = createInsertSchema(reminders).omit({\n  id: true,\n  sent: true,\n  sentAt: true,\n  createdAt: true,\n});\n\nexport const insertUploadedPdfSchema = createInsertSchema(uploadedPdfs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSavedDietPlanSchema = createInsertSchema(savedDietPlans).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type UserProfile = typeof userProfiles.$inferSelect;\nexport type InsertUserProfile = z.infer<typeof insertUserProfileSchema>;\n\nexport type TestDefinition = typeof testDefinitions.$inferSelect;\n\nexport type TestResult = typeof testResults.$inferSelect;\nexport type InsertTestResult = z.infer<typeof insertTestResultSchema>;\n\nexport type Reminder = typeof reminders.$inferSelect;\nexport type InsertReminder = z.infer<typeof insertReminderSchema>;\n\nexport type UploadedPdf = typeof uploadedPdfs.$inferSelect;\nexport type InsertUploadedPdf = z.infer<typeof insertUploadedPdfSchema>;\n\nexport type SavedDietPlan = typeof savedDietPlans.$inferSelect;\nexport type InsertSavedDietPlan = z.infer<typeof insertSavedDietPlanSchema>;\n\nexport type DietPlanJob = typeof dietPlanJobs.$inferSelect;\n\n// Extended types for frontend\nexport type TestResultWithDefinition = TestResult & {\n  testDefinition: TestDefinition;\n};\n\n// All 50 tests merged with user values (0 if missing)\nexport interface AllTestsData {\n  id: string;\n  testId: string;\n  nameEn: string;\n  nameAr: string;\n  shortName: string | null;\n  category: TestCategory;\n  importance: number;\n  unit: string | null;\n  normalRangeMin: number | null;\n  normalRangeMax: number | null;\n  recheckMonths: number | null;\n  descriptionEn: string | null;\n  descriptionAr: string | null;\n  value: number;\n  valueText: string | null;\n  status: TestStatus | \"pending\";\n  testDate: string | null;\n  pdfFileName: string | null;\n  hasResult: boolean;\n  order: number;\n}\n\nexport type TestCategory = \"vitamins\" | \"minerals\" | \"hormones\" | \"organ_functions\" | \"lipids\" | \"immunity\" | \"blood\" | \"coagulation\" | \"special\";\nexport type TestStatus = \"normal\" | \"low\" | \"high\";\nexport type SubscriptionPlan = \"free\" | \"basic\" | \"premium\";\nexport type Gender = \"male\" | \"female\";\nexport type FitnessGoal = \"weight_loss\" | \"maintain\" | \"muscle_gain\";\nexport type ActivityLevel = \"sedentary\" | \"lightly_active\" | \"very_active\" | \"extremely_active\";\nexport type MealPreference = \"high_protein\" | \"balanced\" | \"low_carb\" | \"vegetarian\" | \"custom_macros\";\nexport type ProteinPreference = \"fish\" | \"chicken\" | \"meat\" | \"mixed\";\nexport type KnowledgeDomain = \"nutrition\" | \"aerobic_training\" | \"resistance_training\" | \"vitamins_minerals\" | \"hormones\";\n\nexport type KnowledgeEntry = typeof knowledgeBase.$inferSelect;\nexport type InsertKnowledgeEntry = z.infer<typeof insertKnowledgeBaseSchema>;\nexport type KnowledgeLearningLogEntry = typeof knowledgeLearningLog.$inferSelect;\n","path":null,"size_bytes":11216,"size_tokens":null},"server/replit_integrations/chat/index.ts":{"content":"export { registerChatRoutes } from \"./routes\";\nexport { chatStorage, type IChatStorage } from \"./storage\";\n\n","path":null,"size_bytes":108,"size_tokens":null},"server/replit_integrations/object_storage/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\n// The type of the access group.\n//\n// Can be flexibly defined according to the use case.\n//\n// Examples:\n// - USER_LIST: the users from a list stored in the database;\n// - EMAIL_DOMAIN: the users whose email is in a specific domain;\n// - GROUP_MEMBER: the users who are members of a specific group;\n// - SUBSCRIBER: the users who are subscribers of a specific service / content\n//   creator.\nexport enum ObjectAccessGroupType {}\n\n// The logic user group that can access the object.\nexport interface ObjectAccessGroup {\n  // The type of the access group.\n  type: ObjectAccessGroupType;\n  // The logic id that is enough to identify the qualified group members.\n  //\n  // It may have different format for different types. For example:\n  // - for USER_LIST, the id could be the user list db entity id, and the\n  //   user list db entity could contain a bunch of user ids. User needs\n  //   to be a member of the user list to be able to access the object.\n  // - for EMAIL_DOMAIN, the id could be the email domain, and the user needs\n  //   to have an email with the domain to be able to access the object.\n  // - for GROUP_MEMBER, the id could be the group db entity id, and the\n  //   group db entity could contain a bunch of user ids. User needs to be\n  //   a member of the group to be able to access the object.\n  // - for SUBSCRIBER, the id could be the subscriber db entity id, and the\n  //   subscriber db entity could contain a bunch of user ids. User needs to\n  //   be a subscriber to be able to access the object.\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\n// The ACL policy of the object.\n// This would be set as part of the object custom metadata:\n// - key: \"custom:aclPolicy\"\n// - value: JSON string of the ObjectAclPolicy object.\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\n// Check if the requested permission is allowed based on the granted permission.\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  // Users granted with read or write permissions can read the object.\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n\n  // Only users granted with write permissions can write the object.\n  return granted === ObjectPermission.WRITE;\n}\n\n// The base class for all access groups.\n//\n// Different types of access groups can be implemented according to the use case.\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n\n  // Check if the user is a member of the group.\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    // Implement the case for each type of access group to instantiate.\n    //\n    // For example:\n    // case \"USER_LIST\":\n    //   return new UserListAccessGroup(group.id);\n    // case \"EMAIL_DOMAIN\":\n    //   return new EmailDomainAccessGroup(group.id);\n    // case \"GROUP_MEMBER\":\n    //   return new GroupMemberAccessGroup(group.id);\n    // case \"SUBSCRIBER\":\n    //   return new SubscriberAccessGroup(group.id);\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\n// Sets the ACL policy to the object metadata.\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\n// Gets the ACL policy from the object metadata.\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\n// Checks if the user can access the object.\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  // When this function is called, the acl policy is required.\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n\n  // Public objects are always accessible for read.\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n\n  // Access control requires the user id.\n  if (!userId) {\n    return false;\n  }\n\n  // The owner of the object can always access it.\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n\n  // Go through the ACL rules to check if the user has the required permission.\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n","path":null,"size_bytes":5545,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"mobile/src/screens/TestsScreen.tsx":{"content":"import React, { useState } from 'react';\nimport {\n  View,\n  Text,\n  StyleSheet,\n  FlatList,\n  TouchableOpacity,\n  I18nManager\n} from 'react-native';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery } from '@tanstack/react-query';\nimport { Ionicons } from '@expo/vector-icons';\nimport { queries } from '../lib/api';\n\ninterface AllTestData {\n  id: string;\n  testId: string;\n  nameEn: string;\n  nameAr: string;\n  category: string;\n  importance: number;\n  unit: string | null;\n  normalRangeMin: number | null;\n  normalRangeMax: number | null;\n  recheckMonths: number | null;\n  value: number;\n  valueText: string | null;\n  status: 'normal' | 'low' | 'high' | 'pending';\n  testDate: string | null;\n  pdfFileName: string | null;\n  hasResult: boolean;\n  order: number;\n}\n\nconst StatusBadge = ({ status, hasResult }: { status: string; hasResult: boolean }) => {\n  const { t } = useTranslation();\n  \n  if (!hasResult) {\n    return (\n      <View style={[styles.badge, styles.pendingBadge]}>\n        <Ionicons name=\"time-outline\" size={12} color=\"#64748b\" />\n        <Text style={styles.pendingBadgeText}>{t('pending')}</Text>\n      </View>\n    );\n  }\n  \n  if (status === 'normal') {\n    return (\n      <View style={[styles.badge, styles.normalBadge]}>\n        <Ionicons name=\"checkmark-circle\" size={12} color=\"#16a34a\" />\n        <Text style={styles.normalBadgeText}>{t('normal')}</Text>\n      </View>\n    );\n  }\n  \n  return (\n    <View style={[styles.badge, styles.abnormalBadge]}>\n      <Ionicons name=\"close-circle\" size={12} color=\"#dc2626\" />\n      <Text style={styles.abnormalBadgeText}>\n        {status === 'high' ? t('high') : t('low')}\n      </Text>\n    </View>\n  );\n};\n\nconst getCategoryColor = (category: string): string => {\n  const colors: Record<string, string> = {\n    vitamins: '#f59e0b',\n    minerals: '#10b981',\n    hormones: '#8b5cf6',\n    organ_functions: '#3b82f6',\n    lipids: '#ef4444',\n    immunity: '#06b6d4',\n    blood: '#ec4899',\n    coagulation: '#f97316',\n    special: '#6366f1'\n  };\n  return colors[category] || '#64748b';\n};\n\nexport default function TestsScreen() {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n\n  const { data: allTests, isLoading } = useQuery({\n    queryKey: ['allTests'],\n    queryFn: queries.allTests\n  });\n\n  const tests = (allTests as AllTestData[]) || [];\n  \n  const categories = ['vitamins', 'minerals', 'hormones', 'organ_functions', 'lipids', 'immunity', 'blood', 'coagulation', 'special'];\n  \n  const filteredTests = selectedCategory\n    ? tests.filter(test => test.category === selectedCategory)\n    : tests;\n\n  const testsWithResults = tests.filter(t => t.hasResult).length;\n  const abnormalTests = tests.filter(t => t.status === 'high' || t.status === 'low').length;\n\n  const renderTest = ({ item, index }: { item: AllTestData; index: number }) => {\n    const testName = isArabic ? item.nameAr : item.nameEn;\n    const categoryColor = getCategoryColor(item.category);\n    \n    return (\n      <View \n        style={[\n          styles.testCard,\n          !item.hasResult && styles.testCardPending,\n          (item.status === 'high' || item.status === 'low') && styles.testCardAbnormal\n        ]} \n        testID={`card-test-${item.testId}`}\n      >\n        <View style={styles.testHeader}>\n          <View style={styles.testNumberContainer}>\n            <Text style={styles.testNumber}>{index + 1}</Text>\n          </View>\n          <Text style={styles.testName}>{testName}</Text>\n          <StatusBadge status={item.status} hasResult={item.hasResult} />\n        </View>\n        \n        <View style={styles.testDetails}>\n          <View style={styles.categoryRow}>\n            <View style={[styles.categoryDot, { backgroundColor: categoryColor }]} />\n            <Text style={styles.categoryText}>{t(item.category)}</Text>\n          </View>\n          \n          <View style={styles.valuesRow}>\n            <View style={styles.valueBox}>\n              <Text style={styles.valueLabel}>{t('yourValue')}</Text>\n              <Text style={[\n                styles.valueText,\n                !item.hasResult && styles.valueTextPending,\n                (item.status === 'high' || item.status === 'low') && styles.valueTextAbnormal\n              ]}>\n                {item.hasResult ? `${item.value} ${item.unit || ''}` : '0'}\n              </Text>\n            </View>\n            \n            <View style={styles.valueBox}>\n              <Text style={styles.valueLabel}>{t('normalRange')}</Text>\n              <Text style={styles.rangeText}>\n                {item.normalRangeMin !== null && item.normalRangeMax !== null\n                  ? `${item.normalRangeMin} - ${item.normalRangeMax} ${item.unit || ''}`\n                  : '-'}\n              </Text>\n            </View>\n          </View>\n          \n          {item.testDate && (\n            <Text style={styles.dateText}>\n              {t('testDate')}: {new Date(item.testDate).toLocaleDateString(isArabic ? 'ar-SA' : 'en-US')}\n            </Text>\n          )}\n        </View>\n      </View>\n    );\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.header}>\n        <Text style={styles.title}>{t('myTests')}</Text>\n        <Text style={styles.count}>\n          {testsWithResults}/50 {t('testsCompleted')} | {abnormalTests} {t('abnormal')}\n        </Text>\n      </View>\n\n      <FlatList\n        horizontal\n        showsHorizontalScrollIndicator={false}\n        data={categories}\n        keyExtractor={item => item}\n        style={styles.categoryList}\n        contentContainerStyle={styles.categoryContent}\n        inverted={isArabic}\n        renderItem={({ item }) => (\n          <TouchableOpacity\n            style={[\n              styles.categoryChip,\n              selectedCategory === item && styles.categoryChipSelected,\n              { borderColor: getCategoryColor(item) }\n            ]}\n            onPress={() => setSelectedCategory(selectedCategory === item ? null : item)}\n            testID={`chip-category-${item}`}\n          >\n            <Text style={[\n              styles.categoryChipText,\n              selectedCategory === item && styles.categoryChipTextSelected\n            ]}>\n              {t(item)}\n            </Text>\n          </TouchableOpacity>\n        )}\n      />\n\n      {isLoading ? (\n        <View style={styles.loadingContainer}>\n          <Text style={styles.loadingText}>{t('loading')}</Text>\n        </View>\n      ) : (\n        <FlatList\n          data={filteredTests}\n          keyExtractor={item => item.id}\n          renderItem={renderTest}\n          contentContainerStyle={styles.listContent}\n          ListEmptyComponent={\n            <View style={styles.emptyContainer}>\n              <Ionicons name=\"flask-outline\" size={64} color=\"#cbd5e1\" />\n              <Text style={styles.emptyText}>{t('noData')}</Text>\n            </View>\n          }\n        />\n      )}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f8fafc'\n  },\n  header: {\n    padding: 16,\n    backgroundColor: '#fff',\n    borderBottomWidth: 1,\n    borderBottomColor: '#e2e8f0'\n  },\n  title: {\n    fontSize: 24,\n    fontWeight: 'bold',\n    color: '#1e293b',\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  count: {\n    fontSize: 14,\n    color: '#64748b',\n    marginTop: 4,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  categoryList: {\n    maxHeight: 50,\n    backgroundColor: '#fff',\n    borderBottomWidth: 1,\n    borderBottomColor: '#e2e8f0'\n  },\n  categoryContent: {\n    paddingHorizontal: 12,\n    paddingVertical: 8\n  },\n  categoryChip: {\n    paddingHorizontal: 16,\n    paddingVertical: 6,\n    borderRadius: 16,\n    backgroundColor: '#fff',\n    marginHorizontal: 4,\n    borderWidth: 1.5\n  },\n  categoryChipSelected: {\n    backgroundColor: '#3b82f6',\n    borderColor: '#3b82f6'\n  },\n  categoryChipText: {\n    fontSize: 13,\n    color: '#475569',\n    fontWeight: '500'\n  },\n  categoryChipTextSelected: {\n    color: '#fff'\n  },\n  listContent: {\n    padding: 16\n  },\n  testCard: {\n    backgroundColor: '#fff',\n    borderRadius: 12,\n    padding: 16,\n    marginBottom: 12,\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.05,\n    shadowRadius: 4,\n    elevation: 2,\n    borderWidth: 1,\n    borderColor: '#e2e8f0'\n  },\n  testCardPending: {\n    backgroundColor: '#f8fafc',\n    borderColor: '#e2e8f0'\n  },\n  testCardAbnormal: {\n    backgroundColor: '#fef2f2',\n    borderColor: '#fecaca'\n  },\n  testHeader: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    marginBottom: 12,\n    gap: 10\n  },\n  testNumberContainer: {\n    width: 28,\n    height: 28,\n    borderRadius: 14,\n    backgroundColor: '#f1f5f9',\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  testNumber: {\n    fontSize: 12,\n    fontWeight: '600',\n    color: '#64748b'\n  },\n  testName: {\n    fontSize: 16,\n    fontWeight: '600',\n    color: '#1e293b',\n    flex: 1,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  badge: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    paddingHorizontal: 10,\n    paddingVertical: 4,\n    borderRadius: 12,\n    gap: 4\n  },\n  pendingBadge: {\n    backgroundColor: '#f1f5f9'\n  },\n  pendingBadgeText: {\n    color: '#64748b',\n    fontSize: 11,\n    fontWeight: '600'\n  },\n  normalBadge: {\n    backgroundColor: '#dcfce7'\n  },\n  normalBadgeText: {\n    color: '#16a34a',\n    fontSize: 11,\n    fontWeight: '600'\n  },\n  abnormalBadge: {\n    backgroundColor: '#fee2e2'\n  },\n  abnormalBadgeText: {\n    color: '#dc2626',\n    fontSize: 11,\n    fontWeight: '600'\n  },\n  testDetails: {\n    borderTopWidth: 1,\n    borderTopColor: '#f1f5f9',\n    paddingTop: 12\n  },\n  categoryRow: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    marginBottom: 10,\n    gap: 6\n  },\n  categoryDot: {\n    width: 8,\n    height: 8,\n    borderRadius: 4\n  },\n  categoryText: {\n    fontSize: 12,\n    color: '#64748b',\n    fontWeight: '500'\n  },\n  valuesRow: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    justifyContent: 'space-between',\n    marginBottom: 8\n  },\n  valueBox: {\n    flex: 1\n  },\n  valueLabel: {\n    fontSize: 11,\n    color: '#94a3b8',\n    marginBottom: 2,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  valueText: {\n    fontSize: 16,\n    fontWeight: '600',\n    color: '#1e293b',\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  valueTextPending: {\n    color: '#94a3b8'\n  },\n  valueTextAbnormal: {\n    color: '#dc2626'\n  },\n  rangeText: {\n    fontSize: 14,\n    color: '#64748b',\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  dateText: {\n    fontSize: 12,\n    color: '#94a3b8',\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  loadingContainer: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  loadingText: {\n    fontSize: 16,\n    color: '#64748b'\n  },\n  emptyContainer: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n    paddingTop: 60\n  },\n  emptyText: {\n    fontSize: 16,\n    color: '#94a3b8',\n    marginTop: 16\n  }\n});\n","path":null,"size_bytes":11196,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/App.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { BottomNav } from \"@/components/BottomNav\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { LanguageToggle } from \"@/components/LanguageToggle\";\nimport { DietPlanJobProvider } from \"@/context/DietPlanJobContext\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\nimport NotFound from \"@/pages/not-found\";\nimport LandingPage from \"@/pages/LandingPage\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport MyTests from \"@/pages/MyTests\";\nimport Compare from \"@/pages/Compare\";\nimport Upload from \"@/pages/Upload\";\nimport DietPlan from \"@/pages/DietPlan\";\nimport MyDietSchedule from \"@/pages/MyDietSchedule\";\nimport Profile from \"@/pages/Profile\";\nimport KnowledgeBase from \"@/pages/KnowledgeBase\";\nimport \"./lib/i18n\";\nimport { useTranslation } from \"react-i18next\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Menu, FlaskConical, GitCompareArrows, CalendarDays, Brain } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\n\nfunction HamburgerMenu() {\n  const { t, i18n } = useTranslation();\n  const [location, setLocation] = useLocation();\n  const [open, setOpen] = useState(false);\n  const isRTL = i18n.language === \"ar\";\n\n  const menuItems = [\n    { path: \"/tests\", icon: FlaskConical, labelKey: \"menuMyTests\" },\n    { path: \"/compare\", icon: GitCompareArrows, labelKey: \"menuCompare\" },\n    { path: \"/my-diet-schedule\", icon: CalendarDays, labelKey: \"menuMyDietSchedule\" },\n    { path: \"/knowledge\", icon: Brain, labelKey: \"menuKnowledge\" },\n  ];\n\n  const handleNav = (path: string) => {\n    setLocation(path);\n    setOpen(false);\n  };\n\n  return (\n    <Sheet open={open} onOpenChange={setOpen}>\n      <SheetTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-hamburger-menu\">\n          <Menu className=\"h-5 w-5\" />\n        </Button>\n      </SheetTrigger>\n      <SheetContent side={isRTL ? \"right\" : \"left\"} className=\"w-[280px] p-0\">\n        <SheetHeader className=\"p-4 border-b\">\n          <SheetTitle className=\"text-start\">\n            <span className=\"text-primary font-bold\">{t(\"appName\")}</span>\n            <span className=\"block text-[10px] text-muted-foreground font-normal\">{t(\"companyName\")}</span>\n          </SheetTitle>\n          <SheetDescription className=\"sr-only\">Navigation menu</SheetDescription>\n        </SheetHeader>\n        <div className=\"p-3 space-y-1\">\n          {menuItems.map((item) => {\n            const Icon = item.icon;\n            const isActive = location === item.path;\n            return (\n              <button\n                key={item.path}\n                onClick={() => handleNav(item.path)}\n                data-testid={`menu-${item.labelKey}`}\n                className={cn(\n                  \"flex items-center gap-3 w-full rounded-md px-3 py-3 text-sm transition-colors\",\n                  isActive\n                    ? \"bg-primary/10 text-primary font-semibold\"\n                    : \"text-foreground hover-elevate\"\n                )}\n              >\n                <Icon className=\"h-5 w-5\" />\n                <span>{t(item.labelKey)}</span>\n              </button>\n            );\n          })}\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n\nfunction AuthenticatedLayout({ children }: { children: React.ReactNode }) {\n  const { t } = useTranslation();\n  return (\n    <div className=\"flex flex-col min-h-screen w-full\">\n      <header className=\"flex items-center justify-between gap-4 p-3 border-b bg-background/95 backdrop-blur shrink-0 sticky top-0 z-40\">\n        <div className=\"flex items-center gap-2\">\n          <HamburgerMenu />\n          <div className=\"flex flex-col\">\n            <h1 className=\"text-lg font-bold text-primary\">{t(\"appName\")}</h1>\n            <span className=\"text-[10px] text-muted-foreground\">{t(\"companyName\")}</span>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <LanguageToggle />\n          <ThemeToggle />\n        </div>\n      </header>\n      <main className=\"flex-1 overflow-auto p-4 pb-20\">\n        {children}\n      </main>\n      <BottomNav />\n    </div>\n  );\n}\n\nfunction AppContent() {\n  const { i18n } = useTranslation();\n  const { isLoading, isAuthenticated } = useAuth();\n\n  useEffect(() => {\n    document.documentElement.dir = i18n.language === \"ar\" ? \"rtl\" : \"ltr\";\n    document.documentElement.lang = i18n.language;\n  }, [i18n.language]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <LandingPage />;\n  }\n\n  return (\n    <DietPlanJobProvider>\n      <AuthenticatedLayout>\n        <Switch>\n          <Route path=\"/\" component={Dashboard} />\n          <Route path=\"/tests\" component={MyTests} />\n          <Route path=\"/compare\" component={Compare} />\n          <Route path=\"/upload\" component={Upload} />\n          <Route path=\"/diet\" component={DietPlan} />\n          <Route path=\"/my-diet-schedule\" component={MyDietSchedule} />\n          <Route path=\"/knowledge\" component={KnowledgeBase} />\n          <Route path=\"/profile\" component={Profile} />\n          <Route path=\"/reminders\" component={Dashboard} />\n          <Route component={NotFound} />\n        </Switch>\n      </AuthenticatedLayout>\n    </DietPlanJobProvider>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <AppContent />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":6026,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"server/replit_integrations/batch/utils.ts":{"content":"import pLimit from \"p-limit\";\nimport pRetry from \"p-retry\";\n\n/**\n * Batch Processing Utilities\n *\n * This module provides a generic batch processing function with built-in\n * rate limiting and automatic retries. Use it for any task that requires\n * processing multiple items through an LLM or external API.\n *\n * USAGE:\n * ```typescript\n * import { batchProcess, isRateLimitError } from \"./replit_integrations/batch\";\n *\n * const results = await batchProcess(\n *   artworks,\n *   async (artwork) => {\n *     // Your custom LLM logic here\n *     const response = await openai.chat.completions.create({\n *       model: \"gpt-5.1\",\n *       messages: [{ role: \"user\", content: `Categorize: ${artwork.name}` }],\n *       response_format: { type: \"json_object\" },\n *     });\n *     return JSON.parse(response.choices[0]?.message?.content || \"{}\");\n *   },\n *   { concurrency: 2, retries: 5 }\n * );\n * ```\n */\n\nexport interface BatchOptions {\n  /** Max concurrent requests (default: 2) */\n  concurrency?: number;\n  /** Max retry attempts for rate limit errors (default: 7) */\n  retries?: number;\n  /** Initial retry delay in ms (default: 2000) */\n  minTimeout?: number;\n  /** Max retry delay in ms (default: 128000) */\n  maxTimeout?: number;\n  /** Callback for progress updates */\n  onProgress?: (completed: number, total: number, item: unknown) => void;\n}\n\n/**\n * Check if an error is a rate limit or quota violation.\n * Use this in custom error handling if needed.\n */\nexport function isRateLimitError(error: unknown): boolean {\n  const errorMsg = error instanceof Error ? error.message : String(error);\n  return (\n    errorMsg.includes(\"429\") ||\n    errorMsg.includes(\"RATELIMIT_EXCEEDED\") ||\n    errorMsg.toLowerCase().includes(\"quota\") ||\n    errorMsg.toLowerCase().includes(\"rate limit\")\n  );\n}\n\n/**\n * Process items in batches with rate limiting and automatic retries.\n *\n * @param items - Array of items to process\n * @param processor - Async function to process each item (write your LLM logic here)\n * @param options - Concurrency and retry settings\n * @returns Promise resolving to array of results in the same order as input\n *\n * @example\n * // Process CSV artwork data with custom categorization\n * const categorized = await batchProcess(\n *   csvRows,\n *   async (row) => {\n *     const response = await openai.chat.completions.create({\n *       model: \"gpt-5.1\", // the newest OpenAI model\n *       messages: [{ role: \"user\", content: `Categorize artwork: ${row.name}` }],\n *       response_format: { type: \"json_object\" },\n *     });\n *     return { ...row, category: JSON.parse(response.choices[0]?.message?.content || \"{}\") };\n *   }\n * );\n */\nexport async function batchProcess<T, R>(\n  items: T[],\n  processor: (item: T, index: number) => Promise<R>,\n  options: BatchOptions = {}\n): Promise<R[]> {\n  const {\n    concurrency = 2,\n    retries = 7,\n    minTimeout = 2000,\n    maxTimeout = 128000,\n    onProgress,\n  } = options;\n\n  const limit = pLimit(concurrency);\n  let completed = 0;\n\n  const promises = items.map((item, index) =>\n    limit(() =>\n      pRetry(\n        async () => {\n          try {\n            const result = await processor(item, index);\n            completed++;\n            onProgress?.(completed, items.length, item);\n            return result;\n          } catch (error: unknown) {\n            if (isRateLimitError(error)) {\n              throw error; // Rethrow to trigger p-retry\n            }\n            // For non-rate-limit errors, abort immediately\n            throw new pRetry.AbortError(\n              error instanceof Error ? error : new Error(String(error))\n            );\n          }\n        },\n        { retries, minTimeout, maxTimeout, factor: 2 }\n      )\n    )\n  );\n\n  return Promise.all(promises);\n}\n\n/**\n * Process items sequentially with SSE progress streaming.\n * Use this when you need real-time progress updates to the client.\n *\n * @param items - Array of items to process\n * @param processor - Async function to process each item\n * @param sendEvent - Function to send SSE events to the client\n * @param options - Retry settings (concurrency is always 1 for sequential)\n */\nexport async function batchProcessWithSSE<T, R>(\n  items: T[],\n  processor: (item: T, index: number) => Promise<R>,\n  sendEvent: (event: { type: string; [key: string]: unknown }) => void,\n  options: Omit<BatchOptions, \"concurrency\" | \"onProgress\"> = {}\n): Promise<R[]> {\n  const { retries = 5, minTimeout = 1000, maxTimeout = 15000 } = options;\n\n  sendEvent({ type: \"started\", total: items.length });\n\n  const results: R[] = [];\n  let errors = 0;\n\n  for (let index = 0; index < items.length; index++) {\n    const item = items[index];\n    sendEvent({ type: \"processing\", index, item });\n\n    try {\n      const result = await pRetry(\n        () => processor(item, index),\n        {\n          retries,\n          minTimeout,\n          maxTimeout,\n          factor: 2,\n          onFailedAttempt: (error) => {\n            if (!isRateLimitError(error)) {\n              throw new pRetry.AbortError(\n                error instanceof Error ? error : new Error(String(error))\n              );\n            }\n          },\n        }\n      );\n      results.push(result);\n      sendEvent({ type: \"progress\", index, result });\n    } catch (error) {\n      errors++;\n      results.push(undefined as R); // Placeholder for failed items\n      sendEvent({\n        type: \"progress\",\n        index,\n        error: error instanceof Error ? error.message : \"Processing failed\",\n      });\n    }\n  }\n\n  sendEvent({ type: \"complete\", processed: items.length, errors });\n  return results;\n}\n\n","path":null,"size_bytes":5593,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"server/replit_integrations/audio/client.ts":{"content":"import OpenAI, { toFile } from \"openai\";\nimport { Buffer } from \"node:buffer\";\nimport { spawn } from \"child_process\";\nimport { writeFile, unlink, readFile } from \"fs/promises\";\nimport { randomUUID } from \"crypto\";\nimport { tmpdir } from \"os\";\nimport { join } from \"path\";\n\nexport const openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\nexport type AudioFormat = \"wav\" | \"mp3\" | \"webm\" | \"mp4\" | \"ogg\" | \"unknown\";\n\n/**\n * Detect audio format from buffer magic bytes.\n * Supports: WAV, MP3, WebM (Chrome/Firefox), MP4/M4A/MOV (Safari/iOS), OGG\n */\nexport function detectAudioFormat(buffer: Buffer): AudioFormat {\n  if (buffer.length < 12) return \"unknown\";\n\n  // WAV: RIFF....WAVE\n  if (buffer[0] === 0x52 && buffer[1] === 0x49 && buffer[2] === 0x46 && buffer[3] === 0x46) {\n    return \"wav\";\n  }\n  // WebM: EBML header\n  if (buffer[0] === 0x1a && buffer[1] === 0x45 && buffer[2] === 0xdf && buffer[3] === 0xa3) {\n    return \"webm\";\n  }\n  // MP3: ID3 tag or frame sync\n  if (\n    (buffer[0] === 0xff && (buffer[1] === 0xfb || buffer[1] === 0xfa || buffer[1] === 0xf3)) ||\n    (buffer[0] === 0x49 && buffer[1] === 0x44 && buffer[2] === 0x33)\n  ) {\n    return \"mp3\";\n  }\n  // MP4/M4A/MOV: ....ftyp (Safari/iOS records in these containers)\n  if (buffer[4] === 0x66 && buffer[5] === 0x74 && buffer[6] === 0x79 && buffer[7] === 0x70) {\n    return \"mp4\";\n  }\n  // OGG: OggS\n  if (buffer[0] === 0x4f && buffer[1] === 0x67 && buffer[2] === 0x67 && buffer[3] === 0x53) {\n    return \"ogg\";\n  }\n  return \"unknown\";\n}\n\n/**\n * Convert any audio/video format to WAV using ffmpeg.\n * Uses temp files instead of pipes because video containers (MP4/MOV)\n * require seeking to find the audio track.\n */\nexport async function convertToWav(audioBuffer: Buffer): Promise<Buffer> {\n  const inputPath = join(tmpdir(), `input-${randomUUID()}`);\n  const outputPath = join(tmpdir(), `output-${randomUUID()}.wav`);\n\n  try {\n    // Write input to temp file (required for video containers that need seeking)\n    await writeFile(inputPath, audioBuffer);\n\n    // Run ffmpeg with file paths\n    await new Promise<void>((resolve, reject) => {\n      const ffmpeg = spawn(\"ffmpeg\", [\n        \"-i\", inputPath,\n        \"-vn\",              // Extract audio only (ignore video track)\n        \"-f\", \"wav\",\n        \"-ar\", \"16000\",     // 16kHz sample rate (good for speech)\n        \"-ac\", \"1\",         // Mono\n        \"-acodec\", \"pcm_s16le\",\n        \"-y\",               // Overwrite output\n        outputPath,\n      ]);\n\n      ffmpeg.stderr.on(\"data\", () => {}); // Suppress logs\n      ffmpeg.on(\"close\", (code) => {\n        if (code === 0) resolve();\n        else reject(new Error(`ffmpeg exited with code ${code}`));\n      });\n      ffmpeg.on(\"error\", reject);\n    });\n\n    // Read converted audio\n    return await readFile(outputPath);\n  } finally {\n    // Clean up temp files\n    await unlink(inputPath).catch(() => {});\n    await unlink(outputPath).catch(() => {});\n  }\n}\n\n/**\n * Auto-detect and convert audio to OpenAI-compatible format.\n * - WAV/MP3: Pass through (already compatible)\n * - WebM/MP4/OGG: Convert to WAV via ffmpeg\n */\nexport async function ensureCompatibleFormat(\n  audioBuffer: Buffer\n): Promise<{ buffer: Buffer; format: \"wav\" | \"mp3\" }> {\n  const detected = detectAudioFormat(audioBuffer);\n  if (detected === \"wav\") return { buffer: audioBuffer, format: \"wav\" };\n  if (detected === \"mp3\") return { buffer: audioBuffer, format: \"mp3\" };\n  // Convert WebM, MP4, OGG, or unknown to WAV\n  const wavBuffer = await convertToWav(audioBuffer);\n  return { buffer: wavBuffer, format: \"wav\" };\n}\n\n/**\n * Voice Chat: User speaks, LLM responds with audio (audio-in, audio-out).\n * Uses gpt-audio model via Replit AI Integrations.\n * Note: Browser records WebM/opus - convert to WAV using ffmpeg before calling this.\n */\nexport async function voiceChat(\n  audioBuffer: Buffer,\n  voice: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\" = \"alloy\",\n  inputFormat: \"wav\" | \"mp3\" = \"wav\",\n  outputFormat: \"wav\" | \"mp3\" = \"mp3\"\n): Promise<{ transcript: string; audioResponse: Buffer }> {\n  const audioBase64 = audioBuffer.toString(\"base64\");\n  const response = await openai.chat.completions.create({\n    model: \"gpt-audio\",\n    modalities: [\"text\", \"audio\"],\n    audio: { voice, format: outputFormat },\n    messages: [{\n      role: \"user\",\n      content: [\n        { type: \"input_audio\", input_audio: { data: audioBase64, format: inputFormat } },\n      ],\n    }],\n  });\n  const message = response.choices[0]?.message as any;\n  const transcript = message?.audio?.transcript || message?.content || \"\";\n  const audioData = message?.audio?.data ?? \"\";\n  return {\n    transcript,\n    audioResponse: Buffer.from(audioData, \"base64\"),\n  };\n}\n\n/**\n * Streaming Voice Chat: For real-time audio responses.\n * Note: Streaming only supports pcm16 output format.\n *\n * @example\n * // Converting browser WebM to WAV before calling:\n * const webmBuffer = Buffer.from(req.body.audio, \"base64\");\n * const wavBuffer = await convertWebmToWav(webmBuffer);\n * for await (const chunk of voiceChatStream(wavBuffer)) { ... }\n */\nexport async function voiceChatStream(\n  audioBuffer: Buffer,\n  voice: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\" = \"alloy\",\n  inputFormat: \"wav\" | \"mp3\" = \"wav\"\n): Promise<AsyncIterable<{ type: \"transcript\" | \"audio\"; data: string }>> {\n  const audioBase64 = audioBuffer.toString(\"base64\");\n  const stream = await openai.chat.completions.create({\n    model: \"gpt-audio\",\n    modalities: [\"text\", \"audio\"],\n    audio: { voice, format: \"pcm16\" },\n    messages: [{\n      role: \"user\",\n      content: [\n        { type: \"input_audio\", input_audio: { data: audioBase64, format: inputFormat } },\n      ],\n    }],\n    stream: true,\n  });\n\n  return (async function* () {\n    for await (const chunk of stream) {\n      const delta = chunk.choices?.[0]?.delta as any;\n      if (!delta) continue;\n      if (delta?.audio?.transcript) {\n        yield { type: \"transcript\", data: delta.audio.transcript };\n      }\n      if (delta?.audio?.data) {\n        yield { type: \"audio\", data: delta.audio.data };\n      }\n    }\n  })();\n}\n\n/**\n * Text-to-Speech: Converts text to speech verbatim.\n * Uses gpt-audio model via Replit AI Integrations.\n */\nexport async function textToSpeech(\n  text: string,\n  voice: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\" = \"alloy\",\n  format: \"wav\" | \"mp3\" | \"flac\" | \"opus\" | \"pcm16\" = \"wav\"\n): Promise<Buffer> {\n  const response = await openai.chat.completions.create({\n    model: \"gpt-audio\",\n    modalities: [\"text\", \"audio\"],\n    audio: { voice, format },\n    messages: [\n      { role: \"system\", content: \"You are an assistant that performs text-to-speech.\" },\n      { role: \"user\", content: `Repeat the following text verbatim: ${text}` },\n    ],\n  });\n  const audioData = (response.choices[0]?.message as any)?.audio?.data ?? \"\";\n  return Buffer.from(audioData, \"base64\");\n}\n\n/**\n * Streaming Text-to-Speech: Converts text to speech with real-time streaming.\n * Uses gpt-audio model via Replit AI Integrations.\n * Note: Streaming only supports pcm16 output format.\n */\nexport async function textToSpeechStream(\n  text: string,\n  voice: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\" = \"alloy\"\n): Promise<AsyncIterable<string>> {\n  const stream = await openai.chat.completions.create({\n    model: \"gpt-audio\",\n    modalities: [\"text\", \"audio\"],\n    audio: { voice, format: \"pcm16\" },\n    messages: [\n      { role: \"system\", content: \"You are an assistant that performs text-to-speech.\" },\n      { role: \"user\", content: `Repeat the following text verbatim: ${text}` },\n    ],\n    stream: true,\n  });\n\n  return (async function* () {\n    for await (const chunk of stream) {\n      const delta = chunk.choices?.[0]?.delta as any;\n      if (!delta) continue;\n      if (delta?.audio?.data) {\n        yield delta.audio.data;\n      }\n    }\n  })();\n}\n\n/**\n * Speech-to-Text: Transcribes audio using dedicated transcription model.\n * Uses gpt-4o-mini-transcribe for accurate transcription.\n */\nexport async function speechToText(\n  audioBuffer: Buffer,\n  format: \"wav\" | \"mp3\" | \"webm\" = \"wav\"\n): Promise<string> {\n  const file = await toFile(audioBuffer, `audio.${format}`);\n  const response = await openai.audio.transcriptions.create({\n    file,\n    model: \"gpt-4o-mini-transcribe\",\n  });\n  return response.text;\n}\n\n/**\n * Streaming Speech-to-Text: Transcribes audio with real-time streaming.\n * Uses gpt-4o-mini-transcribe for accurate transcription.\n */\nexport async function speechToTextStream(\n  audioBuffer: Buffer,\n  format: \"wav\" | \"mp3\" | \"webm\" = \"wav\"\n): Promise<AsyncIterable<string>> {\n  const file = await toFile(audioBuffer, `audio.${format}`);\n  const stream = await openai.audio.transcriptions.create({\n    file,\n    model: \"gpt-4o-mini-transcribe\",\n    stream: true,\n  });\n\n  return (async function* () {\n    for await (const event of stream) {\n      if (event.type === \"transcript.text.delta\") {\n        yield event.delta;\n      }\n    }\n  })();\n}\n","path":null,"size_bytes":9073,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/replit_integrations/audio/audio-playback-worklet.js":{"content":"/**\n * Reusable AudioWorklet for streaming PCM16 audio playback.\n * Place in public/ folder and load via audioContext.audioWorklet.addModule()\n */\nclass RingBuffer {\n  constructor(initialCapacity) {\n    this.capacity = initialCapacity;\n    this.buffer = new Float32Array(initialCapacity);\n    this.readIndex = 0;\n    this.writeIndex = 0;\n    this.availableData = 0;\n  }\n\n  push(data) {\n    const len = data.length;\n    // Auto-grow if needed\n    while (this.availableData + len > this.capacity) {\n      this.grow();\n    }\n    for (let i = 0; i < len; i++) {\n      this.buffer[this.writeIndex] = data[i];\n      this.writeIndex = (this.writeIndex + 1) % this.capacity;\n      this.availableData++;\n    }\n  }\n\n  grow() {\n    const newCapacity = this.capacity * 2;\n    const newBuffer = new Float32Array(newCapacity);\n    // Copy existing data maintaining order\n    for (let i = 0; i < this.availableData; i++) {\n      const srcIndex = (this.readIndex + i) % this.capacity;\n      newBuffer[i] = this.buffer[srcIndex];\n    }\n    this.buffer = newBuffer;\n    this.readIndex = 0;\n    this.writeIndex = this.availableData;\n    this.capacity = newCapacity;\n  }\n\n  pull(outputBuffer) {\n    const len = outputBuffer.length;\n    const available = Math.min(len, this.availableData);\n    for (let i = 0; i < available; i++) {\n      outputBuffer[i] = this.buffer[this.readIndex];\n      this.readIndex = (this.readIndex + 1) % this.capacity;\n    }\n    // Pad remaining with silence\n    for (let i = available; i < len; i++) {\n      outputBuffer[i] = 0;\n    }\n    this.availableData -= available;\n    return available > 0;\n  }\n\n  available() {\n    return this.availableData;\n  }\n\n  clear() {\n    this.readIndex = 0;\n    this.writeIndex = 0;\n    this.availableData = 0;\n  }\n}\n\nclass AudioPlaybackProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.ringBuffer = new RingBuffer(24000 * 30); // 30s initial capacity\n    this.isPlaying = false;\n    this.streamComplete = false;\n\n    this.port.onmessage = (event) => {\n      const { type, samples } = event.data;\n      if (type === \"audio\") {\n        this.ringBuffer.push(samples);\n        this.isPlaying = true;\n      } else if (type === \"clear\") {\n        this.ringBuffer.clear();\n        this.isPlaying = false;\n        this.streamComplete = false;\n      } else if (type === \"streamComplete\") {\n        this.streamComplete = true;\n      } else if (type === \"stop\") {\n        this.isPlaying = false;\n        this.streamComplete = false;\n      }\n    };\n  }\n\n  process(inputs, outputs) {\n    const output = outputs[0];\n    if (!output || output.length === 0) return true;\n\n    const channel = output[0];\n    if (this.isPlaying) {\n      this.ringBuffer.pull(channel);\n      if (this.streamComplete && this.ringBuffer.available() === 0) {\n        this.isPlaying = false;\n        this.streamComplete = false;\n        this.port.postMessage({ type: \"ended\" });\n      }\n    } else {\n      channel.fill(0);\n    }\n    return true;\n  }\n}\n\nregisterProcessor(\"audio-playback-processor\", AudioPlaybackProcessor);\n\n","path":null,"size_bytes":3058,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/pages/MyTests.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { useLocation } from \"wouter\";\nimport { AllTestsTable } from \"@/components/AllTestsTable\";\nimport { MedicalDisclaimer } from \"@/components/MedicalDisclaimer\";\nimport { Button } from \"@/components/ui/button\";\nimport { GitCompareArrows } from \"lucide-react\";\nimport type { AllTestsData } from \"@shared/schema\";\n\nexport default function MyTests() {\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n  const { data: tests = [], isLoading } = useQuery<AllTestsData[]>({\n    queryKey: [\"/api/tests/all\"],\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      <MedicalDisclaimer />\n\n      <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n        <div />\n        <Button\n          variant=\"outline\"\n          onClick={() => setLocation(\"/compare\")}\n          data-testid=\"button-compare-results\"\n        >\n          <GitCompareArrows className=\"h-4 w-4 me-2\" />\n          {t(\"compareResults\")}\n        </Button>\n      </div>\n\n      <AllTestsTable tests={tests} isLoading={isLoading} />\n    </div>\n  );\n}\n","path":null,"size_bytes":1147,"size_tokens":null},"server/replit_integrations/image/index.ts":{"content":"export { registerImageRoutes } from \"./routes\";\nexport { openai, generateImageBuffer, editImages } from \"./client\";\n\n","path":null,"size_bytes":117,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"/{*path}\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":554,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"/{*path}\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1541,"size_tokens":null},"client/src/lib/auth-utils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n\n// Redirect to login with a toast notification\nexport function redirectToLogin(toast?: (options: { title: string; description: string; variant: string }) => void) {\n  if (toast) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n  }\n  setTimeout(() => {\n    window.location.href = \"/api/login\";\n  }, 500);\n}\n","path":null,"size_bytes":517,"size_tokens":null},"mobile/src/screens/HomeScreen.tsx":{"content":"import React from 'react';\nimport {\n  View,\n  Text,\n  StyleSheet,\n  ScrollView,\n  TouchableOpacity,\n  I18nManager\n} from 'react-native';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery } from '@tanstack/react-query';\nimport { Ionicons } from '@expo/vector-icons';\nimport { queries } from '../lib/api';\n\ninterface StatsCardProps {\n  icon: keyof typeof Ionicons.glyphMap;\n  title: string;\n  value: string | number;\n  color: string;\n}\n\nconst StatsCard = ({ icon, title, value, color }: StatsCardProps) => (\n  <View style={[styles.statsCard, { borderLeftColor: color }]}>\n    <Ionicons name={icon} size={24} color={color} />\n    <Text style={styles.statsValue}>{value}</Text>\n    <Text style={styles.statsTitle}>{title}</Text>\n  </View>\n);\n\nexport default function HomeScreen({ navigation }: any) {\n  const { t } = useTranslation();\n  \n  const { data: userTests } = useQuery({\n    queryKey: ['userTests'],\n    queryFn: queries.userTests\n  });\n\n  const { data: reminders } = useQuery({\n    queryKey: ['reminders'],\n    queryFn: queries.reminders\n  });\n\n  const tests = userTests as any[] || [];\n  const remindersList = reminders as any[] || [];\n  \n  const abnormalCount = tests.filter((t: any) => t.status === 'abnormal').length;\n  const normalCount = tests.filter((t: any) => t.status === 'normal').length;\n  const pendingReminders = remindersList.filter((r: any) => !r.isCompleted).length;\n\n  return (\n    <ScrollView style={styles.container} contentContainerStyle={styles.content}>\n      <View style={styles.header}>\n        <Text style={styles.title}>{t('welcome')}</Text>\n        <Text style={styles.subtitle}>{t('subtitle')}</Text>\n      </View>\n\n      <View style={styles.disclaimerCard}>\n        <Ionicons name=\"warning\" size={24} color=\"#dc2626\" />\n        <Text style={styles.disclaimerTitle}>{t('disclaimer.title')}</Text>\n        <Text style={styles.disclaimerText}>{t('disclaimer.text')}</Text>\n      </View>\n\n      <View style={styles.statsGrid}>\n        <StatsCard\n          icon=\"checkmark-circle\"\n          title={t('normal')}\n          value={normalCount}\n          color=\"#22c55e\"\n        />\n        <StatsCard\n          icon=\"alert-circle\"\n          title={t('abnormal')}\n          value={abnormalCount}\n          color=\"#dc2626\"\n        />\n        <StatsCard\n          icon=\"notifications\"\n          title={t('reminders.title')}\n          value={pendingReminders}\n          color=\"#f59e0b\"\n        />\n      </View>\n\n      <TouchableOpacity\n        style={styles.uploadButton}\n        onPress={() => navigation.navigate('Upload')}\n        testID=\"button-upload-home\"\n      >\n        <Ionicons name=\"cloud-upload\" size={24} color=\"#fff\" />\n        <Text style={styles.uploadButtonText}>{t('uploadPdf')}</Text>\n      </TouchableOpacity>\n\n      <TouchableOpacity\n        style={styles.viewTestsButton}\n        onPress={() => navigation.navigate('Tests')}\n        testID=\"button-view-tests\"\n      >\n        <Ionicons name=\"list\" size={24} color=\"#3b82f6\" />\n        <Text style={styles.viewTestsButtonText}>{t('myTests')}</Text>\n      </TouchableOpacity>\n    </ScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f8fafc'\n  },\n  content: {\n    padding: 16\n  },\n  header: {\n    marginBottom: 20,\n    alignItems: I18nManager.isRTL ? 'flex-end' : 'flex-start'\n  },\n  title: {\n    fontSize: 28,\n    fontWeight: 'bold',\n    color: '#1e293b',\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  subtitle: {\n    fontSize: 16,\n    color: '#64748b',\n    marginTop: 4,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  disclaimerCard: {\n    backgroundColor: '#fef2f2',\n    borderRadius: 12,\n    padding: 16,\n    marginBottom: 20,\n    borderWidth: 1,\n    borderColor: '#fecaca',\n    alignItems: 'center'\n  },\n  disclaimerTitle: {\n    fontSize: 16,\n    fontWeight: '600',\n    color: '#dc2626',\n    marginTop: 8,\n    textAlign: 'center'\n  },\n  disclaimerText: {\n    fontSize: 14,\n    color: '#991b1b',\n    marginTop: 8,\n    textAlign: 'center',\n    lineHeight: 20\n  },\n  statsGrid: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    justifyContent: 'space-between',\n    marginBottom: 20\n  },\n  statsCard: {\n    flex: 1,\n    backgroundColor: '#fff',\n    borderRadius: 12,\n    padding: 16,\n    marginHorizontal: 4,\n    alignItems: 'center',\n    borderLeftWidth: 4,\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.05,\n    shadowRadius: 4,\n    elevation: 2\n  },\n  statsValue: {\n    fontSize: 24,\n    fontWeight: 'bold',\n    color: '#1e293b',\n    marginTop: 8\n  },\n  statsTitle: {\n    fontSize: 12,\n    color: '#64748b',\n    marginTop: 4\n  },\n  uploadButton: {\n    backgroundColor: '#3b82f6',\n    borderRadius: 12,\n    padding: 16,\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    marginBottom: 12\n  },\n  uploadButtonText: {\n    color: '#fff',\n    fontSize: 18,\n    fontWeight: '600',\n    marginHorizontal: 8\n  },\n  viewTestsButton: {\n    backgroundColor: '#fff',\n    borderRadius: 12,\n    padding: 16,\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    borderWidth: 1,\n    borderColor: '#3b82f6'\n  },\n  viewTestsButtonText: {\n    color: '#3b82f6',\n    fontSize: 18,\n    fontWeight: '600',\n    marginHorizontal: 8\n  }\n});\n","path":null,"size_bytes":5404,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/PdfUploader.tsx":{"content":"import { useState, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Upload, FileText, CheckCircle, Loader2, AlertTriangle } from \"lucide-react\";\nimport { MedicalDisclaimer } from \"./MedicalDisclaimer\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface PdfUploaderProps {\n  onUploadComplete?: (testsFound: number) => void;\n}\n\nexport function PdfUploader({ onUploadComplete }: PdfUploaderProps) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [isDragging, setIsDragging] = useState(false);\n  const [file, setFile] = useState<File | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [testsFound, setTestsFound] = useState<number | null>(null);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  }, []);\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n    const droppedFile = e.dataTransfer.files[0];\n    if (droppedFile && droppedFile.type === \"application/pdf\") {\n      setFile(droppedFile);\n      setTestsFound(null);\n    } else {\n      toast({\n        title: t(\"error\"),\n        description: \"Please upload a PDF file\",\n        variant: \"destructive\",\n      });\n    }\n  }, [toast, t]);\n\n  const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0];\n    if (selectedFile && selectedFile.type === \"application/pdf\") {\n      setFile(selectedFile);\n      setTestsFound(null);\n    }\n  }, []);\n\n  const handleUpload = async () => {\n    if (!file) return;\n\n    setIsUploading(true);\n    setProgress(10);\n\n    try {\n      const formData = new FormData();\n      formData.append(\"pdf\", file);\n\n      setProgress(30);\n      setIsProcessing(true);\n\n      const response = await fetch(\"/api/analyze-pdf\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Upload failed\");\n      }\n\n      setProgress(90);\n      const result = await response.json();\n      \n      setProgress(100);\n      setTestsFound(result.testsExtracted);\n      \n      toast({\n        title: t(\"success\"),\n        description: `${result.testsExtracted} ${t(\"testsFound\")}`,\n      });\n\n      onUploadComplete?.(result.testsExtracted);\n    } catch (error) {\n      toast({\n        title: t(\"error\"),\n        description: \"Failed to process PDF\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsUploading(false);\n      setIsProcessing(false);\n    }\n  };\n\n  const resetUpload = () => {\n    setFile(null);\n    setProgress(0);\n    setTestsFound(null);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <MedicalDisclaimer />\n      \n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Upload className=\"h-5 w-5\" />\n            {t(\"uploadTitle\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"uploadDescription\")}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {testsFound !== null ? (\n            <div className=\"text-center py-8 space-y-4\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-emerald-100 dark:bg-emerald-900/30\">\n                <CheckCircle className=\"h-8 w-8 text-emerald-600 dark:text-emerald-400\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-semibold\">{t(\"analysisComplete\")}</h3>\n                <p className=\"text-muted-foreground\">\n                  {testsFound} {t(\"testsFound\")}\n                </p>\n              </div>\n              <Button onClick={resetUpload} variant=\"outline\">\n                {t(\"uploadPdf\")}\n              </Button>\n            </div>\n          ) : (\n            <>\n              <div\n                onDragOver={handleDragOver}\n                onDragLeave={handleDragLeave}\n                onDrop={handleDrop}\n                className={`\n                  border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer\n                  ${isDragging \n                    ? \"border-primary bg-primary/5\" \n                    : \"border-border hover:border-primary/50 hover:bg-muted/50\"\n                  }\n                `}\n                onClick={() => document.getElementById(\"pdf-input\")?.click()}\n                data-testid=\"dropzone-pdf\"\n              >\n                <input\n                  id=\"pdf-input\"\n                  type=\"file\"\n                  accept=\"application/pdf\"\n                  className=\"hidden\"\n                  onChange={handleFileSelect}\n                />\n                \n                {file ? (\n                  <div className=\"flex items-center justify-center gap-3\">\n                    <FileText className=\"h-8 w-8 text-primary\" />\n                    <div className=\"text-start\">\n                      <p className=\"font-medium\">{file.name}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {(file.size / 1024 / 1024).toFixed(2)} MB\n                      </p>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    <Upload className=\"h-10 w-10 mx-auto text-muted-foreground\" />\n                    <p className=\"text-muted-foreground\">{t(\"dropzone\")}</p>\n                  </div>\n                )}\n              </div>\n\n              {isUploading && (\n                <div className=\"space-y-2\">\n                  <Progress value={progress} />\n                  <p className=\"text-sm text-center text-muted-foreground flex items-center justify-center gap-2\">\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    {isProcessing ? t(\"processing\") : t(\"loading\")}\n                  </p>\n                </div>\n              )}\n\n              <Button\n                onClick={handleUpload}\n                disabled={!file || isUploading}\n                className=\"w-full\"\n                data-testid=\"button-upload\"\n              >\n                {isUploading ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 me-2 animate-spin\" />\n                    {t(\"processing\")}\n                  </>\n                ) : (\n                  <>\n                    <Upload className=\"h-4 w-4 me-2\" />\n                    {t(\"uploadPdf\")}\n                  </>\n                )}\n              </Button>\n            </>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":7104,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"server/seedTests.ts":{"content":"import { db } from \"./db\";\nimport { testDefinitions } from \"@shared/schema\";\n\n// 50 test definitions organized by category and importance level\nconst tests = [\n  // Level 1: Essential Tests\n  { id: \"vitamin-d\", nameEn: \"Vitamin D\", nameAr: \"فيتامين د\", shortName: \"Vit D\", category: \"vitamins\" as const, level: 1, unit: \"ng/mL\", normalRangeMin: 30, normalRangeMax: 100, recheckMonths: 3, descriptionEn: \"Essential for bone health and immunity\", descriptionAr: \"ضروري لصحة العظام والمناعة\" },\n  { id: \"hemoglobin\", nameEn: \"Hemoglobin\", nameAr: \"الهيموجلوبين\", shortName: \"Hgb\", category: \"blood\" as const, level: 1, unit: \"g/dL\", normalRangeMin: 12, normalRangeMax: 17, recheckMonths: 3, descriptionEn: \"Oxygen-carrying protein in red blood cells\", descriptionAr: \"البروتين الناقل للأكسجين في خلايا الدم الحمراء\" },\n  { id: \"glucose\", nameEn: \"Fasting Glucose\", nameAr: \"السكر الصائم\", shortName: \"FBG\", category: \"organ_functions\" as const, level: 1, unit: \"mg/dL\", normalRangeMin: 70, normalRangeMax: 100, recheckMonths: 3, descriptionEn: \"Blood sugar level after fasting\", descriptionAr: \"مستوى السكر في الدم بعد الصيام\" },\n  { id: \"total-cholesterol\", nameEn: \"Total Cholesterol\", nameAr: \"الكولسترول الكلي\", shortName: \"TC\", category: \"lipids\" as const, level: 1, unit: \"mg/dL\", normalRangeMin: 0, normalRangeMax: 200, recheckMonths: 6, descriptionEn: \"Total amount of cholesterol in blood\", descriptionAr: \"إجمالي الكولسترول في الدم\" },\n  { id: \"tsh\", nameEn: \"TSH\", nameAr: \"هرمون الغدة الدرقية\", shortName: \"TSH\", category: \"hormones\" as const, level: 1, unit: \"mIU/L\", normalRangeMin: 0.4, normalRangeMax: 4.0, recheckMonths: 6, descriptionEn: \"Thyroid stimulating hormone\", descriptionAr: \"الهرمون المحفز للغدة الدرقية\" },\n  \n  // Level 2: General Health\n  { id: \"vitamin-b12\", nameEn: \"Vitamin B12\", nameAr: \"فيتامين ب12\", shortName: \"B12\", category: \"vitamins\" as const, level: 2, unit: \"pg/mL\", normalRangeMin: 200, normalRangeMax: 900, recheckMonths: 6, descriptionEn: \"Essential for nerve function and DNA synthesis\", descriptionAr: \"ضروري لوظائف الأعصاب وتصنيع الحمض النووي\" },\n  { id: \"iron\", nameEn: \"Serum Iron\", nameAr: \"الحديد\", shortName: \"Fe\", category: \"minerals\" as const, level: 2, unit: \"mcg/dL\", normalRangeMin: 60, normalRangeMax: 170, recheckMonths: 6, descriptionEn: \"Essential mineral for blood production\", descriptionAr: \"معدن ضروري لإنتاج الدم\" },\n  { id: \"ferritin\", nameEn: \"Ferritin\", nameAr: \"الفيريتين\", shortName: \"Ferr\", category: \"minerals\" as const, level: 2, unit: \"ng/mL\", normalRangeMin: 12, normalRangeMax: 300, recheckMonths: 6, descriptionEn: \"Iron storage protein\", descriptionAr: \"بروتين تخزين الحديد\" },\n  { id: \"hba1c\", nameEn: \"HbA1c\", nameAr: \"السكر التراكمي\", shortName: \"A1C\", category: \"organ_functions\" as const, level: 2, unit: \"%\", normalRangeMin: 4, normalRangeMax: 5.7, recheckMonths: 3, descriptionEn: \"3-month average blood sugar\", descriptionAr: \"متوسط السكر لثلاثة أشهر\" },\n  { id: \"creatinine\", nameEn: \"Creatinine\", nameAr: \"الكرياتينين\", shortName: \"Cr\", category: \"organ_functions\" as const, level: 2, unit: \"mg/dL\", normalRangeMin: 0.7, normalRangeMax: 1.3, recheckMonths: 12, descriptionEn: \"Kidney function marker\", descriptionAr: \"مؤشر وظائف الكلى\" },\n  { id: \"ldl\", nameEn: \"LDL Cholesterol\", nameAr: \"الكولسترول الضار\", shortName: \"LDL\", category: \"lipids\" as const, level: 2, unit: \"mg/dL\", normalRangeMin: 0, normalRangeMax: 100, recheckMonths: 6, descriptionEn: \"Bad cholesterol\", descriptionAr: \"الكولسترول الضار\" },\n  { id: \"hdl\", nameEn: \"HDL Cholesterol\", nameAr: \"الكولسترول النافع\", shortName: \"HDL\", category: \"lipids\" as const, level: 2, unit: \"mg/dL\", normalRangeMin: 40, normalRangeMax: 100, recheckMonths: 6, descriptionEn: \"Good cholesterol\", descriptionAr: \"الكولسترول النافع\" },\n  { id: \"triglycerides\", nameEn: \"Triglycerides\", nameAr: \"الدهون الثلاثية\", shortName: \"TG\", category: \"lipids\" as const, level: 2, unit: \"mg/dL\", normalRangeMin: 0, normalRangeMax: 150, recheckMonths: 6, descriptionEn: \"Type of fat in blood\", descriptionAr: \"نوع من الدهون في الدم\" },\n  \n  // Level 3: Hormones & Performance\n  { id: \"t3\", nameEn: \"T3 (Triiodothyronine)\", nameAr: \"هرمون T3\", shortName: \"T3\", category: \"hormones\" as const, level: 3, unit: \"ng/dL\", normalRangeMin: 80, normalRangeMax: 200, recheckMonths: 6, descriptionEn: \"Active thyroid hormone\", descriptionAr: \"هرمون الغدة الدرقية النشط\" },\n  { id: \"t4\", nameEn: \"T4 (Thyroxine)\", nameAr: \"هرمون T4\", shortName: \"T4\", category: \"hormones\" as const, level: 3, unit: \"mcg/dL\", normalRangeMin: 5, normalRangeMax: 12, recheckMonths: 6, descriptionEn: \"Main thyroid hormone\", descriptionAr: \"هرمون الغدة الدرقية الرئيسي\" },\n  { id: \"free-t4\", nameEn: \"Free T4\", nameAr: \"T4 الحر\", shortName: \"FT4\", category: \"hormones\" as const, level: 3, unit: \"ng/dL\", normalRangeMin: 0.8, normalRangeMax: 1.8, recheckMonths: 6, descriptionEn: \"Unbound active T4\", descriptionAr: \"هرمون T4 الحر غير المرتبط\" },\n  { id: \"testosterone\", nameEn: \"Testosterone\", nameAr: \"التستوستيرون\", shortName: \"Testo\", category: \"hormones\" as const, level: 3, unit: \"ng/dL\", normalRangeMin: 300, normalRangeMax: 1000, recheckMonths: 6, descriptionEn: \"Male sex hormone\", descriptionAr: \"الهرمون الذكري\" },\n  { id: \"cortisol\", nameEn: \"Cortisol\", nameAr: \"الكورتيزول\", shortName: \"Cort\", category: \"hormones\" as const, level: 3, unit: \"mcg/dL\", normalRangeMin: 6, normalRangeMax: 23, recheckMonths: 6, descriptionEn: \"Stress hormone\", descriptionAr: \"هرمون التوتر\" },\n  { id: \"insulin\", nameEn: \"Fasting Insulin\", nameAr: \"الأنسولين الصائم\", shortName: \"Ins\", category: \"hormones\" as const, level: 3, unit: \"uIU/mL\", normalRangeMin: 2, normalRangeMax: 25, recheckMonths: 6, descriptionEn: \"Blood sugar regulating hormone\", descriptionAr: \"هرمون تنظيم السكر\" },\n  { id: \"folate\", nameEn: \"Folate\", nameAr: \"حمض الفوليك\", shortName: \"Fol\", category: \"vitamins\" as const, level: 3, unit: \"ng/mL\", normalRangeMin: 3, normalRangeMax: 20, recheckMonths: 6, descriptionEn: \"B vitamin essential for cell division\", descriptionAr: \"فيتامين ب ضروري لانقسام الخلايا\" },\n  \n  // Level 4: Immunity & Inflammation\n  { id: \"crp\", nameEn: \"C-Reactive Protein\", nameAr: \"بروتين سي التفاعلي\", shortName: \"CRP\", category: \"immunity\" as const, level: 4, unit: \"mg/L\", normalRangeMin: 0, normalRangeMax: 10, recheckMonths: 6, descriptionEn: \"Inflammation marker\", descriptionAr: \"مؤشر الالتهاب\" },\n  { id: \"hs-crp\", nameEn: \"High-Sensitivity CRP\", nameAr: \"CRP عالي الحساسية\", shortName: \"hs-CRP\", category: \"immunity\" as const, level: 4, unit: \"mg/L\", normalRangeMin: 0, normalRangeMax: 3, recheckMonths: 6, descriptionEn: \"Sensitive inflammation and heart disease marker\", descriptionAr: \"مؤشر حساس للالتهاب وأمراض القلب\" },\n  { id: \"wbc\", nameEn: \"White Blood Cells\", nameAr: \"كريات الدم البيضاء\", shortName: \"WBC\", category: \"blood\" as const, level: 4, unit: \"K/uL\", normalRangeMin: 4, normalRangeMax: 11, recheckMonths: 12, descriptionEn: \"Immune system cells\", descriptionAr: \"خلايا الجهاز المناعي\" },\n  { id: \"esr\", nameEn: \"ESR\", nameAr: \"سرعة الترسيب\", shortName: \"ESR\", category: \"immunity\" as const, level: 4, unit: \"mm/hr\", normalRangeMin: 0, normalRangeMax: 20, recheckMonths: 6, descriptionEn: \"Erythrocyte sedimentation rate\", descriptionAr: \"سرعة ترسيب كريات الدم الحمراء\" },\n  { id: \"alt\", nameEn: \"ALT\", nameAr: \"إنزيم الكبد ALT\", shortName: \"ALT\", category: \"organ_functions\" as const, level: 4, unit: \"U/L\", normalRangeMin: 7, normalRangeMax: 56, recheckMonths: 12, descriptionEn: \"Liver enzyme\", descriptionAr: \"إنزيم الكبد\" },\n  { id: \"ast\", nameEn: \"AST\", nameAr: \"إنزيم الكبد AST\", shortName: \"AST\", category: \"organ_functions\" as const, level: 4, unit: \"U/L\", normalRangeMin: 10, normalRangeMax: 40, recheckMonths: 12, descriptionEn: \"Liver and heart enzyme\", descriptionAr: \"إنزيم الكبد والقلب\" },\n  \n  // Level 5: Advanced Vitamins & Minerals\n  { id: \"calcium\", nameEn: \"Calcium\", nameAr: \"الكالسيوم\", shortName: \"Ca\", category: \"minerals\" as const, level: 5, unit: \"mg/dL\", normalRangeMin: 8.6, normalRangeMax: 10.3, recheckMonths: 12, descriptionEn: \"Essential for bones and muscles\", descriptionAr: \"ضروري للعظام والعضلات\" },\n  { id: \"magnesium\", nameEn: \"Magnesium\", nameAr: \"المغنيسيوم\", shortName: \"Mg\", category: \"minerals\" as const, level: 5, unit: \"mg/dL\", normalRangeMin: 1.7, normalRangeMax: 2.2, recheckMonths: 12, descriptionEn: \"Essential for nerve and muscle function\", descriptionAr: \"ضروري لوظائف الأعصاب والعضلات\" },\n  { id: \"zinc\", nameEn: \"Zinc\", nameAr: \"الزنك\", shortName: \"Zn\", category: \"minerals\" as const, level: 5, unit: \"mcg/dL\", normalRangeMin: 60, normalRangeMax: 120, recheckMonths: 12, descriptionEn: \"Important for immunity and healing\", descriptionAr: \"مهم للمناعة والشفاء\" },\n  { id: \"vitamin-a\", nameEn: \"Vitamin A\", nameAr: \"فيتامين أ\", shortName: \"Vit A\", category: \"vitamins\" as const, level: 5, unit: \"mcg/dL\", normalRangeMin: 30, normalRangeMax: 80, recheckMonths: 12, descriptionEn: \"Important for vision and immunity\", descriptionAr: \"مهم للرؤية والمناعة\" },\n  { id: \"vitamin-e\", nameEn: \"Vitamin E\", nameAr: \"فيتامين هـ\", shortName: \"Vit E\", category: \"vitamins\" as const, level: 5, unit: \"mg/L\", normalRangeMin: 5, normalRangeMax: 20, recheckMonths: 12, descriptionEn: \"Antioxidant vitamin\", descriptionAr: \"فيتامين مضاد للأكسدة\" },\n  { id: \"vitamin-c\", nameEn: \"Vitamin C\", nameAr: \"فيتامين ج\", shortName: \"Vit C\", category: \"vitamins\" as const, level: 5, unit: \"mg/dL\", normalRangeMin: 0.4, normalRangeMax: 2.0, recheckMonths: 12, descriptionEn: \"Essential for immunity and collagen\", descriptionAr: \"ضروري للمناعة والكولاجين\" },\n  { id: \"sodium\", nameEn: \"Sodium\", nameAr: \"الصوديوم\", shortName: \"Na\", category: \"minerals\" as const, level: 5, unit: \"mEq/L\", normalRangeMin: 136, normalRangeMax: 145, recheckMonths: 12, descriptionEn: \"Important electrolyte for fluid balance\", descriptionAr: \"إلكتروليت مهم لتوازن السوائل\" },\n  { id: \"potassium\", nameEn: \"Potassium\", nameAr: \"البوتاسيوم\", shortName: \"K\", category: \"minerals\" as const, level: 5, unit: \"mEq/L\", normalRangeMin: 3.5, normalRangeMax: 5.0, recheckMonths: 12, descriptionEn: \"Essential for heart and muscles\", descriptionAr: \"ضروري للقلب والعضلات\" },\n  \n  // Level 6: Heart & Coagulation\n  { id: \"pt\", nameEn: \"Prothrombin Time\", nameAr: \"زمن البروثرومبين\", shortName: \"PT\", category: \"coagulation\" as const, level: 6, unit: \"seconds\", normalRangeMin: 11, normalRangeMax: 13.5, recheckMonths: 12, descriptionEn: \"Blood clotting time\", descriptionAr: \"زمن تخثر الدم\" },\n  { id: \"inr\", nameEn: \"INR\", nameAr: \"معدل التخثر الدولي\", shortName: \"INR\", category: \"coagulation\" as const, level: 6, unit: \"\", normalRangeMin: 0.8, normalRangeMax: 1.2, recheckMonths: 12, descriptionEn: \"International Normalized Ratio\", descriptionAr: \"المعدل الدولي الطبيعي للتخثر\" },\n  { id: \"ptt\", nameEn: \"PTT\", nameAr: \"زمن الثرومبوبلاستين\", shortName: \"PTT\", category: \"coagulation\" as const, level: 6, unit: \"seconds\", normalRangeMin: 25, normalRangeMax: 35, recheckMonths: 12, descriptionEn: \"Partial thromboplastin time\", descriptionAr: \"زمن الثرومبوبلاستين الجزئي\" },\n  { id: \"d-dimer\", nameEn: \"D-Dimer\", nameAr: \"دي-دايمر\", shortName: \"D-Di\", category: \"coagulation\" as const, level: 6, unit: \"ng/mL\", normalRangeMin: 0, normalRangeMax: 500, recheckMonths: 12, descriptionEn: \"Blood clot breakdown marker\", descriptionAr: \"مؤشر تحلل الجلطات\" },\n  { id: \"fibrinogen\", nameEn: \"Fibrinogen\", nameAr: \"الفيبرينوجين\", shortName: \"Fib\", category: \"coagulation\" as const, level: 6, unit: \"mg/dL\", normalRangeMin: 200, normalRangeMax: 400, recheckMonths: 12, descriptionEn: \"Clotting factor\", descriptionAr: \"عامل التخثر\" },\n  { id: \"rbc\", nameEn: \"Red Blood Cells\", nameAr: \"كريات الدم الحمراء\", shortName: \"RBC\", category: \"blood\" as const, level: 6, unit: \"M/uL\", normalRangeMin: 4.5, normalRangeMax: 5.5, recheckMonths: 12, descriptionEn: \"Oxygen-carrying cells\", descriptionAr: \"الخلايا الناقلة للأكسجين\" },\n  { id: \"platelets\", nameEn: \"Platelets\", nameAr: \"الصفائح الدموية\", shortName: \"PLT\", category: \"blood\" as const, level: 6, unit: \"K/uL\", normalRangeMin: 150, normalRangeMax: 400, recheckMonths: 12, descriptionEn: \"Blood clotting cells\", descriptionAr: \"خلايا تخثر الدم\" },\n  \n  // Level 7: Special Tests\n  { id: \"estradiol\", nameEn: \"Estradiol\", nameAr: \"الإستراديول\", shortName: \"E2\", category: \"hormones\" as const, level: 7, unit: \"pg/mL\", normalRangeMin: 15, normalRangeMax: 350, recheckMonths: 6, descriptionEn: \"Female sex hormone\", descriptionAr: \"الهرمون الأنثوي\" },\n  { id: \"progesterone\", nameEn: \"Progesterone\", nameAr: \"البروجسترون\", shortName: \"Prog\", category: \"hormones\" as const, level: 7, unit: \"ng/mL\", normalRangeMin: 0.1, normalRangeMax: 25, recheckMonths: 6, descriptionEn: \"Pregnancy hormone\", descriptionAr: \"هرمون الحمل\" },\n  { id: \"prolactin\", nameEn: \"Prolactin\", nameAr: \"البرولاكتين\", shortName: \"PRL\", category: \"hormones\" as const, level: 7, unit: \"ng/mL\", normalRangeMin: 2, normalRangeMax: 29, recheckMonths: 6, descriptionEn: \"Milk production hormone\", descriptionAr: \"هرمون إنتاج الحليب\" },\n  { id: \"dhea\", nameEn: \"DHEA-S\", nameAr: \"DHEA-S\", shortName: \"DHEA\", category: \"hormones\" as const, level: 7, unit: \"mcg/dL\", normalRangeMin: 35, normalRangeMax: 430, recheckMonths: 12, descriptionEn: \"Adrenal hormone precursor\", descriptionAr: \"مقدمة هرمونات الغدة الكظرية\" },\n  { id: \"pth\", nameEn: \"Parathyroid Hormone\", nameAr: \"هرمون الجار درقية\", shortName: \"PTH\", category: \"hormones\" as const, level: 7, unit: \"pg/mL\", normalRangeMin: 15, normalRangeMax: 65, recheckMonths: 12, descriptionEn: \"Calcium regulating hormone\", descriptionAr: \"هرمون تنظيم الكالسيوم\" },\n  { id: \"bun\", nameEn: \"Blood Urea Nitrogen\", nameAr: \"نيتروجين يوريا الدم\", shortName: \"BUN\", category: \"organ_functions\" as const, level: 7, unit: \"mg/dL\", normalRangeMin: 7, normalRangeMax: 20, recheckMonths: 12, descriptionEn: \"Kidney function marker\", descriptionAr: \"مؤشر وظائف الكلى\" },\n  { id: \"uric-acid\", nameEn: \"Uric Acid\", nameAr: \"حمض اليوريك\", shortName: \"UA\", category: \"organ_functions\" as const, level: 7, unit: \"mg/dL\", normalRangeMin: 3.5, normalRangeMax: 7.2, recheckMonths: 12, descriptionEn: \"Gout and kidney marker\", descriptionAr: \"مؤشر النقرس والكلى\" },\n  { id: \"bilirubin\", nameEn: \"Total Bilirubin\", nameAr: \"البيليروبين الكلي\", shortName: \"Bili\", category: \"organ_functions\" as const, level: 7, unit: \"mg/dL\", normalRangeMin: 0.1, normalRangeMax: 1.2, recheckMonths: 12, descriptionEn: \"Liver function marker\", descriptionAr: \"مؤشر وظائف الكبد\" },\n  { id: \"albumin\", nameEn: \"Albumin\", nameAr: \"الألبومين\", shortName: \"Alb\", category: \"organ_functions\" as const, level: 7, unit: \"g/dL\", normalRangeMin: 3.5, normalRangeMax: 5.5, recheckMonths: 12, descriptionEn: \"Liver and nutrition marker\", descriptionAr: \"مؤشر الكبد والتغذية\" },\n];\n\nexport async function seedTestDefinitions() {\n  try {\n    console.log(\"Seeding test definitions...\");\n    \n    for (const test of tests) {\n      await db\n        .insert(testDefinitions)\n        .values(test)\n        .onConflictDoUpdate({\n          target: testDefinitions.id,\n          set: test,\n        });\n    }\n    \n    console.log(`Successfully seeded ${tests.length} test definitions`);\n  } catch (error) {\n    console.error(\"Error seeding test definitions:\", error);\n    throw error;\n  }\n}\n\n// Run if executed directly\nseedTestDefinitions().catch(console.error);\n","path":null,"size_bytes":16865,"size_tokens":null},"server/knowledgeEngine.ts":{"content":"import OpenAI from \"openai\";\nimport { storage } from \"./storage\";\nimport type { KnowledgeDomain, InsertKnowledgeEntry } from \"@shared/schema\";\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\nconst PUBMED_BASE = \"https://eutils.ncbi.nlm.nih.gov/entrez/eutils\";\nconst NIH_ODS_BASE = \"https://ods.od.nih.gov/factsheets\";\n\ninterface DomainTopicConfig {\n  domain: KnowledgeDomain;\n  nameEn: string;\n  nameAr: string;\n  topics: {\n    query: string;\n    pubmedTerms: string;\n    nihFactSheet?: string;\n  }[];\n}\n\nconst DOMAIN_CONFIGS: DomainTopicConfig[] = [\n  {\n    domain: \"nutrition\",\n    nameEn: \"Clinical Nutrition\",\n    nameAr: \"التغذية العلاجية\",\n    topics: [\n      { query: \"therapeutic nutrition chronic diseases\", pubmedTerms: \"nutrition therapy[mh] AND chronic disease[mh] AND review[pt]\" },\n      { query: \"nutrition diabetes management\", pubmedTerms: \"diabetes mellitus[mh] AND diet therapy[mh] AND review[pt]\" },\n      { query: \"anti-inflammatory diet\", pubmedTerms: \"anti-inflammatory agents[mh] AND diet[mh] AND review[pt]\" },\n      { query: \"nutrition fatty liver disease\", pubmedTerms: \"non-alcoholic fatty liver disease[mh] AND diet[mh] AND review[pt]\" },\n      { query: \"nutrition kidney health\", pubmedTerms: \"renal insufficiency[mh] AND diet therapy[mh] AND review[pt]\" },\n      { query: \"gut health microbiome nutrition\", pubmedTerms: \"gastrointestinal microbiome[mh] AND diet[mh] AND review[pt]\" },\n      { query: \"cardiovascular nutrition\", pubmedTerms: \"cardiovascular diseases[mh] AND diet therapy[mh] AND review[pt]\" },\n      { query: \"caloric restriction safety\", pubmedTerms: \"caloric restriction[mh] AND safety[tiab] AND review[pt]\" },\n      { query: \"macronutrient ratios health\", pubmedTerms: \"macronutrients[tiab] AND dietary recommendations[tiab] AND review[pt]\" },\n      { query: \"intermittent fasting evidence\", pubmedTerms: \"fasting[mh] AND intermittent[tiab] AND clinical trial[pt]\" },\n      { query: \"nutrition immune system\", pubmedTerms: \"immune system[mh] AND nutritional status[mh] AND review[pt]\" },\n      { query: \"bone health nutrition osteoporosis\", pubmedTerms: \"osteoporosis[mh] AND diet[mh] AND prevention[tiab] AND review[pt]\" },\n      { query: \"Mediterranean diet clinical evidence\", pubmedTerms: \"diet, Mediterranean[mh] AND clinical trial[pt]\" },\n      { query: \"DASH diet hypertension\", pubmedTerms: \"dietary approaches to stop hypertension[mh] AND review[pt]\" },\n      { query: \"glycemic index foods\", pubmedTerms: \"glycemic index[mh] AND food[mh] AND review[pt]\" },\n      { query: \"dietary fiber health\", pubmedTerms: \"dietary fiber[mh] AND health[tiab] AND review[pt]\" },\n      { query: \"hydration electrolyte balance\", pubmedTerms: \"water-electrolyte balance[mh] AND nutrition[tiab] AND review[pt]\" },\n      { query: \"food drug interactions\", pubmedTerms: \"food-drug interactions[mh] AND review[pt]\" },\n      { query: \"nutrition during pregnancy\", pubmedTerms: \"pregnancy[mh] AND nutritional requirements[mh] AND review[pt]\" },\n      { query: \"elderly nutrition aging\", pubmedTerms: \"aged[mh] AND nutritional requirements[mh] AND review[pt]\" },\n    ],\n  },\n  {\n    domain: \"aerobic_training\",\n    nameEn: \"Aerobic Training\",\n    nameAr: \"التدريب الهوائي\",\n    topics: [\n      { query: \"cardio exercise heart rate zones\", pubmedTerms: \"exercise[mh] AND heart rate[mh] AND aerobic[tiab] AND review[pt]\" },\n      { query: \"HIIT vs steady-state cardio\", pubmedTerms: \"high-intensity interval training[mh] AND comparative study[pt]\" },\n      { query: \"aerobic exercise weight loss\", pubmedTerms: \"exercise[mh] AND weight loss[mh] AND aerobic[tiab] AND review[pt]\" },\n      { query: \"cardio metabolic rate\", pubmedTerms: \"basal metabolism[mh] AND exercise[mh] AND review[pt]\" },\n      { query: \"walking health benefits\", pubmedTerms: \"walking[mh] AND health benefit[tiab] AND review[pt]\" },\n      { query: \"swimming exercise physiology\", pubmedTerms: \"swimming[mh] AND exercise[mh] AND physiology[tiab] AND review[pt]\" },\n      { query: \"cycling training benefits\", pubmedTerms: \"bicycling[mh] AND physical fitness[mh] AND review[pt]\" },\n      { query: \"running injury prevention\", pubmedTerms: \"running[mh] AND athletic injuries[mh] AND prevention[tiab] AND review[pt]\" },\n      { query: \"cardio exercise blood pressure\", pubmedTerms: \"exercise[mh] AND blood pressure[mh] AND aerobic[tiab] AND review[pt]\" },\n      { query: \"aerobic training cholesterol\", pubmedTerms: \"exercise[mh] AND cholesterol[mh] AND aerobic[tiab] AND review[pt]\" },\n      { query: \"cardio insulin sensitivity\", pubmedTerms: \"exercise[mh] AND insulin resistance[mh] AND review[pt]\" },\n      { query: \"VO2 max improvement\", pubmedTerms: \"oxygen consumption[mh] AND exercise[mh] AND training[tiab] AND review[pt]\" },\n      { query: \"cardio recovery nutrition\", pubmedTerms: \"exercise[mh] AND recovery[tiab] AND nutrition[tiab] AND review[pt]\" },\n      { query: \"low impact cardio beginners\", pubmedTerms: \"exercise[mh] AND low impact[tiab] AND sedentary[tiab] AND review[pt]\" },\n      { query: \"exercise during fasting\", pubmedTerms: \"exercise[mh] AND fasting[mh] AND review[pt]\" },\n    ],\n  },\n  {\n    domain: \"resistance_training\",\n    nameEn: \"Resistance Training\",\n    nameAr: \"تدريب المقاومة\",\n    topics: [\n      { query: \"resistance training muscle hypertrophy\", pubmedTerms: \"resistance training[mh] AND muscle hypertrophy[tiab] AND review[pt]\" },\n      { query: \"protein requirements muscle building\", pubmedTerms: \"dietary proteins[mh] AND muscle development[mh] AND review[pt]\" },\n      { query: \"progressive overload principles\", pubmedTerms: \"resistance training[mh] AND progressive[tiab] AND overload[tiab] AND review[pt]\" },\n      { query: \"resistance training bone density\", pubmedTerms: \"resistance training[mh] AND bone density[mh] AND review[pt]\" },\n      { query: \"compound vs isolation exercises\", pubmedTerms: \"resistance training[mh] AND exercise[mh] AND comparison[tiab] AND review[pt]\" },\n      { query: \"resistance training metabolic rate\", pubmedTerms: \"resistance training[mh] AND basal metabolism[mh] AND review[pt]\" },\n      { query: \"training volume frequency\", pubmedTerms: \"resistance training[mh] AND exercise dosage[tiab] AND frequency[tiab] AND review[pt]\" },\n      { query: \"resistance training fat loss\", pubmedTerms: \"resistance training[mh] AND weight loss[mh] AND body fat[tiab] AND review[pt]\" },\n      { query: \"muscle recovery nutrition timing\", pubmedTerms: \"muscle[mh] AND recovery[tiab] AND nutrient timing[tiab] AND review[pt]\" },\n      { query: \"creatine supplementation evidence\", pubmedTerms: \"creatine[mh] AND supplementation[tiab] AND review[pt]\" },\n      { query: \"resistance training elderly\", pubmedTerms: \"resistance training[mh] AND aged[mh] AND review[pt]\" },\n      { query: \"resistance training hormonal response\", pubmedTerms: \"resistance training[mh] AND hormones[mh] AND review[pt]\" },\n      { query: \"periodization training\", pubmedTerms: \"resistance training[mh] AND periodization[tiab] AND review[pt]\" },\n      { query: \"resistance training joint health\", pubmedTerms: \"resistance training[mh] AND joint diseases[mh] AND review[pt]\" },\n      { query: \"bodyweight training effectiveness\", pubmedTerms: \"body weight[tiab] AND exercise[mh] AND effectiveness[tiab] AND review[pt]\" },\n    ],\n  },\n  {\n    domain: \"vitamins_minerals\",\n    nameEn: \"Vitamins & Minerals\",\n    nameAr: \"الفيتامينات والمعادن\",\n    topics: [\n      { query: \"vitamin D deficiency treatment\", pubmedTerms: \"vitamin D deficiency[mh] AND therapy[sh] AND review[pt]\", nihFactSheet: \"VitaminD-HealthProfessional\" },\n      { query: \"iron deficiency anemia nutrition\", pubmedTerms: \"anemia, iron-deficiency[mh] AND diet therapy[sh] AND review[pt]\", nihFactSheet: \"Iron-HealthProfessional\" },\n      { query: \"vitamin B12 deficiency treatment\", pubmedTerms: \"vitamin B 12 deficiency[mh] AND therapy[sh] AND review[pt]\", nihFactSheet: \"VitaminB12-HealthProfessional\" },\n      { query: \"calcium absorption cofactors\", pubmedTerms: \"calcium[mh] AND biological availability[mh] AND review[pt]\", nihFactSheet: \"Calcium-HealthProfessional\" },\n      { query: \"magnesium bioavailability types\", pubmedTerms: \"magnesium[mh] AND biological availability[mh] AND review[pt]\", nihFactSheet: \"Magnesium-HealthProfessional\" },\n      { query: \"zinc deficiency food sources\", pubmedTerms: \"zinc[mh] AND deficiency[tiab] AND dietary intake[tiab] AND review[pt]\", nihFactSheet: \"Zinc-HealthProfessional\" },\n      { query: \"folate folic acid pregnancy\", pubmedTerms: \"folic acid[mh] AND pregnancy[mh] AND review[pt]\", nihFactSheet: \"Folate-HealthProfessional\" },\n      { query: \"vitamin C immune function\", pubmedTerms: \"ascorbic acid[mh] AND immune system[mh] AND review[pt]\", nihFactSheet: \"VitaminC-HealthProfessional\" },\n      { query: \"vitamin A safe dosages\", pubmedTerms: \"vitamin A[mh] AND toxicity[tiab] AND dosage[tiab] AND review[pt]\", nihFactSheet: \"VitaminA-HealthProfessional\" },\n      { query: \"vitamin E antioxidant\", pubmedTerms: \"vitamin E[mh] AND antioxidants[mh] AND review[pt]\", nihFactSheet: \"VitaminE-HealthProfessional\" },\n      { query: \"vitamin K coagulation\", pubmedTerms: \"vitamin K[mh] AND blood coagulation[mh] AND review[pt]\", nihFactSheet: \"VitaminK-HealthProfessional\" },\n      { query: \"selenium thyroid function\", pubmedTerms: \"selenium[mh] AND thyroid gland[mh] AND review[pt]\", nihFactSheet: \"Selenium-HealthProfessional\" },\n      { query: \"iodine thyroid health\", pubmedTerms: \"iodine[mh] AND thyroid diseases[mh] AND review[pt]\", nihFactSheet: \"Iodine-HealthProfessional\" },\n      { query: \"potassium blood pressure\", pubmedTerms: \"potassium[mh] AND blood pressure[mh] AND review[pt]\", nihFactSheet: \"Potassium-HealthProfessional\" },\n      { query: \"omega-3 EPA DHA benefits\", pubmedTerms: \"fatty acids, omega-3[mh] AND health[tiab] AND review[pt]\", nihFactSheet: \"Omega3FattyAcids-HealthProfessional\" },\n      { query: \"chromium blood sugar regulation\", pubmedTerms: \"chromium[mh] AND blood glucose[mh] AND review[pt]\", nihFactSheet: \"Chromium-HealthProfessional\" },\n      { query: \"copper iron metabolism\", pubmedTerms: \"copper[mh] AND iron[mh] AND metabolism[mh] AND review[pt]\" },\n      { query: \"CoQ10 supplementation\", pubmedTerms: \"ubiquinone[mh] AND supplementation[tiab] AND review[pt]\" },\n      { query: \"biotin hair nail health\", pubmedTerms: \"biotin[mh] AND hair[mh] AND review[pt]\", nihFactSheet: \"Biotin-HealthProfessional\" },\n      { query: \"mineral absorption interactions\", pubmedTerms: \"minerals[mh] AND biological availability[mh] AND drug interactions[mh] AND review[pt]\" },\n    ],\n  },\n  {\n    domain: \"hormones\",\n    nameEn: \"Hormones & Nutrition\",\n    nameAr: \"الهرمونات والتغذية\",\n    topics: [\n      { query: \"testosterone nutrition optimization\", pubmedTerms: \"testosterone[mh] AND diet[mh] AND review[pt]\" },\n      { query: \"estrogen metabolism diet\", pubmedTerms: \"estrogens[mh] AND diet[mh] AND metabolism[mh] AND review[pt]\" },\n      { query: \"thyroid hormones TSH nutrition\", pubmedTerms: \"thyroid hormones[mh] AND nutritional status[mh] AND review[pt]\" },\n      { query: \"cortisol management nutrition\", pubmedTerms: \"hydrocortisone[mh] AND diet[mh] AND stress[tiab] AND review[pt]\" },\n      { query: \"insulin resistance dietary management\", pubmedTerms: \"insulin resistance[mh] AND diet therapy[sh] AND review[pt]\" },\n      { query: \"growth hormone nutrition\", pubmedTerms: \"human growth hormone[mh] AND nutrition[tiab] AND review[pt]\" },\n      { query: \"leptin resistance weight management\", pubmedTerms: \"leptin[mh] AND obesity[mh] AND diet[mh] AND review[pt]\" },\n      { query: \"ghrelin hunger regulation\", pubmedTerms: \"ghrelin[mh] AND appetite regulation[mh] AND review[pt]\" },\n      { query: \"DHEA adrenal health\", pubmedTerms: \"dehydroepiandrosterone[mh] AND adrenal glands[mh] AND review[pt]\" },\n      { query: \"prolactin nutrition factors\", pubmedTerms: \"prolactin[mh] AND nutrition[tiab] AND review[pt]\" },\n      { query: \"progesterone diet connection\", pubmedTerms: \"progesterone[mh] AND diet[mh] AND review[pt]\" },\n      { query: \"vitamin D hormone precursor\", pubmedTerms: \"vitamin D[mh] AND hormones[mh] AND metabolism[mh] AND review[pt]\" },\n      { query: \"melatonin sleep nutrition\", pubmedTerms: \"melatonin[mh] AND sleep[mh] AND diet[mh] AND review[pt]\" },\n      { query: \"aldosterone sodium potassium\", pubmedTerms: \"aldosterone[mh] AND sodium[mh] AND potassium[mh] AND review[pt]\" },\n      { query: \"parathyroid hormone calcium\", pubmedTerms: \"parathyroid hormone[mh] AND calcium[mh] AND metabolism[mh] AND review[pt]\" },\n    ],\n  },\n];\n\ninterface PubMedArticle {\n  pmid: string;\n  title: string;\n  abstract: string;\n  authors: string;\n  journal: string;\n  year: string;\n  url: string;\n}\n\nasync function fetchPubMedArticles(searchTerm: string, maxResults: number = 3): Promise<PubMedArticle[]> {\n  try {\n    const searchUrl = `${PUBMED_BASE}/esearch.fcgi?db=pubmed&term=${encodeURIComponent(searchTerm)}&retmax=${maxResults}&sort=relevance&retmode=json`;\n    const searchRes = await fetch(searchUrl);\n    if (!searchRes.ok) return [];\n    const searchData = await searchRes.json() as { esearchresult?: { idlist?: string[] } };\n    const ids = searchData?.esearchresult?.idlist || [];\n    if (ids.length === 0) return [];\n\n    await new Promise((r) => setTimeout(r, 400));\n\n    const fetchUrl = `${PUBMED_BASE}/efetch.fcgi?db=pubmed&id=${ids.join(\",\")}&rettype=abstract&retmode=xml`;\n    const fetchRes = await fetch(fetchUrl);\n    if (!fetchRes.ok) return [];\n    const xmlText = await fetchRes.text();\n\n    const articles: PubMedArticle[] = [];\n    const articleBlocks = xmlText.split(\"<PubmedArticle>\");\n\n    for (const block of articleBlocks.slice(1)) {\n      const pmid = extractXmlTag(block, \"PMID\") || \"\";\n      const title = extractXmlTag(block, \"ArticleTitle\") || \"\";\n      const abstractParts: string[] = [];\n      const abstractTexts = block.match(/<AbstractText[^>]*>([\\s\\S]*?)<\\/AbstractText>/g);\n      if (abstractTexts) {\n        for (const at of abstractTexts) {\n          const cleaned = at.replace(/<[^>]+>/g, \"\").trim();\n          if (cleaned) abstractParts.push(cleaned);\n        }\n      }\n      const abstract = abstractParts.join(\" \");\n\n      const authorNames: string[] = [];\n      const authorBlocks = block.match(/<Author[^>]*>[\\s\\S]*?<\\/Author>/g);\n      if (authorBlocks) {\n        for (const ab of authorBlocks.slice(0, 3)) {\n          const lastName = extractXmlTag(ab, \"LastName\") || \"\";\n          const initials = extractXmlTag(ab, \"Initials\") || \"\";\n          if (lastName) authorNames.push(`${lastName} ${initials}`.trim());\n        }\n      }\n\n      const journal = extractXmlTag(block, \"Title\") || extractXmlTag(block, \"ISOAbbreviation\") || \"\";\n      const year = extractXmlTag(block, \"Year\") || \"\";\n\n      if (title && abstract.length > 100) {\n        articles.push({\n          pmid,\n          title: cleanXmlText(title),\n          abstract: cleanXmlText(abstract),\n          authors: authorNames.join(\", \") + (authorBlocks && authorBlocks.length > 3 ? \" et al.\" : \"\"),\n          journal: cleanXmlText(journal),\n          year,\n          url: `https://pubmed.ncbi.nlm.nih.gov/${pmid}/`,\n        });\n      }\n    }\n\n    return articles;\n  } catch (error) {\n    console.error(`[KnowledgeEngine] PubMed fetch error:`, error);\n    return [];\n  }\n}\n\nfunction extractXmlTag(xml: string, tag: string): string | null {\n  const match = xml.match(new RegExp(`<${tag}[^>]*>([\\\\s\\\\S]*?)<\\\\/${tag}>`));\n  return match ? match[1].trim() : null;\n}\n\nfunction cleanXmlText(text: string): string {\n  return text.replace(/<[^>]+>/g, \"\").replace(/\\s+/g, \" \").trim();\n}\n\nasync function fetchNIHFactSheet(sheetName: string): Promise<string | null> {\n  try {\n    const url = `${NIH_ODS_BASE}/${sheetName}/`;\n    const res = await fetch(url);\n    if (!res.ok) return null;\n    const html = await res.text();\n\n    let text = html\n      .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, \"\")\n      .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, \"\")\n      .replace(/<nav[^>]*>[\\s\\S]*?<\\/nav>/gi, \"\")\n      .replace(/<header[^>]*>[\\s\\S]*?<\\/header>/gi, \"\")\n      .replace(/<footer[^>]*>[\\s\\S]*?<\\/footer>/gi, \"\")\n      .replace(/<[^>]+>/g, \" \")\n      .replace(/&nbsp;/g, \" \")\n      .replace(/&amp;/g, \"&\")\n      .replace(/&lt;/g, \"<\")\n      .replace(/&gt;/g, \">\")\n      .replace(/\\s+/g, \" \")\n      .trim();\n\n    if (text.length > 8000) {\n      text = text.substring(0, 8000);\n    }\n\n    return text.length > 200 ? text : null;\n  } catch (error) {\n    console.error(`[KnowledgeEngine] NIH fact sheet fetch error for ${sheetName}:`, error);\n    return null;\n  }\n}\n\nasync function processRealSourcesForTopic(\n  domain: KnowledgeDomain,\n  topic: { query: string; pubmedTerms: string; nihFactSheet?: string }\n): Promise<InsertKnowledgeEntry[]> {\n  let realContent = \"\";\n  let sources: { name: string; url: string }[] = [];\n\n  const articles = await fetchPubMedArticles(topic.pubmedTerms, 3);\n  if (articles.length > 0) {\n    for (const article of articles) {\n      realContent += `\\n\\n[PubMed Study - ${article.journal} ${article.year}]\\nTitle: ${article.title}\\nAuthors: ${article.authors}\\nAbstract: ${article.abstract}\\n`;\n      sources.push({ name: `PubMed - ${article.journal} (${article.year})`, url: article.url });\n    }\n  }\n\n  await new Promise((r) => setTimeout(r, 400));\n\n  if (topic.nihFactSheet) {\n    const nihContent = await fetchNIHFactSheet(topic.nihFactSheet);\n    if (nihContent) {\n      realContent += `\\n\\n[NIH Office of Dietary Supplements - ${topic.nihFactSheet}]\\n${nihContent}\\n`;\n      sources.push({\n        name: \"NIH Office of Dietary Supplements\",\n        url: `https://ods.od.nih.gov/factsheets/${topic.nihFactSheet}/`,\n      });\n    }\n  }\n\n  if (!realContent || realContent.length < 200) {\n    console.log(`[KnowledgeEngine] Insufficient real content for \"${topic.query}\" - skipping`);\n    return [];\n  }\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a medical research summarizer. You ONLY summarize content from the REAL scientific sources provided below. \nDo NOT generate or invent any information. Only extract and organize facts from the provided research content.\n\nRULES:\n1. ONLY use data explicitly stated in the provided source material\n2. Include specific numbers, dosages, and measurements from the sources\n3. Cite which source each fact comes from\n4. Provide Arabic translation\n5. Focus on practical, actionable health information\n6. If a fact is not in the provided sources, do NOT include it\n\nRespond in JSON:\n{\n  \"entries\": [\n    {\n      \"topic\": \"Specific extracted topic\",\n      \"content\": \"Summary of real findings from the sources with specific data\",\n      \"contentAr\": \"Arabic translation\",\n      \"sourceIndex\": 0\n    }\n  ]\n}\n\nGenerate 2-4 entries that summarize distinct findings from the provided research.`,\n        },\n        {\n          role: \"user\",\n          content: `Summarize and structure the following REAL scientific content about \"${topic.query}\":\\n\\n${realContent}`,\n        },\n      ],\n      max_tokens: 4000,\n      temperature: 0.1,\n      response_format: { type: \"json_object\" },\n    });\n\n    const text = response.choices[0]?.message?.content || \"{}\";\n    const parsed = JSON.parse(text);\n    const entries = parsed.entries || (Array.isArray(parsed) ? parsed : []);\n\n    return entries\n      .filter((e: { topic?: string; content?: string }) => e.topic && e.content && e.content.length > 50)\n      .map((e: { topic: string; content: string; contentAr?: string; sourceIndex?: number }) => {\n        const sourceIdx = typeof e.sourceIndex === \"number\" && e.sourceIndex < sources.length ? e.sourceIndex : 0;\n        const source = sources[sourceIdx] || sources[0] || { name: \"PubMed\", url: \"\" };\n        return {\n          domain,\n          topic: e.topic,\n          content: e.content,\n          contentAr: e.contentAr || null,\n          source: source.name,\n          sourceUrl: source.url,\n          tags: [topic.query, domain],\n        };\n      });\n  } catch (error) {\n    console.error(`[KnowledgeEngine] AI summarization error for \"${topic.query}\":`, error);\n    return [];\n  }\n}\n\nexport async function learnDomain(domain: KnowledgeDomain): Promise<number> {\n  const config = DOMAIN_CONFIGS.find((c) => c.domain === domain);\n  if (!config) return 0;\n\n  const lastLog = await storage.getLastLearningLog(domain);\n  const previousTopics = lastLog?.topicsSearched || [];\n\n  const availableTopics = config.topics.filter((t) => !previousTopics.includes(t.query));\n  const topicsToLearn = availableTopics.length > 0 ? availableTopics : config.topics;\n  const selectedTopics = topicsToLearn.slice(0, 3);\n\n  console.log(`[KnowledgeEngine] Learning domain \"${domain}\" from real sources - topics: ${selectedTopics.map((t) => t.query).join(\", \")}`);\n\n  let totalEntries = 0;\n  for (const topic of selectedTopics) {\n    const entries = await processRealSourcesForTopic(domain, topic);\n    if (entries.length > 0) {\n      await storage.addKnowledgeEntries(entries);\n      totalEntries += entries.length;\n      console.log(`[KnowledgeEngine] \"${topic.query}\" -> ${entries.length} entries from real sources`);\n    }\n    await new Promise((r) => setTimeout(r, 1500));\n  }\n\n  await storage.addLearningLog(domain, selectedTopics.map((t) => t.query), totalEntries);\n  console.log(`[KnowledgeEngine] Domain \"${domain}\" learned ${totalEntries} entries from ${selectedTopics.length} real-source topics`);\n\n  return totalEntries;\n}\n\nexport async function dailyLearningJob(): Promise<void> {\n  console.log(\"[KnowledgeEngine] Starting daily learning job (fetching from real scientific sources)...\");\n\n  const domains: KnowledgeDomain[] = [\n    \"nutrition\",\n    \"aerobic_training\",\n    \"resistance_training\",\n    \"vitamins_minerals\",\n    \"hormones\",\n  ];\n\n  let totalNewEntries = 0;\n  for (const domain of domains) {\n    try {\n      const count = await learnDomain(domain);\n      totalNewEntries += count;\n    } catch (error) {\n      console.error(`[KnowledgeEngine] Error learning domain \"${domain}\":`, error);\n    }\n    await new Promise((r) => setTimeout(r, 3000));\n  }\n\n  console.log(`[KnowledgeEngine] Daily learning complete. Total new entries from real sources: ${totalNewEntries}`);\n}\n\nexport async function searchRelevantKnowledge(\n  testResults: { testName: string; status: string; category: string }[],\n  fitnessGoal: string\n): Promise<string> {\n  const abnormalTests = testResults.filter((t) => t.status === \"low\" || t.status === \"high\");\n\n  const searchTermsByDomain: Partial<Record<KnowledgeDomain, string[]>> = {};\n\n  for (const test of abnormalTests) {\n    const testNameLower = test.testName.toLowerCase();\n\n    if (\n      testNameLower.includes(\"vitamin\") ||\n      testNameLower.includes(\"iron\") ||\n      testNameLower.includes(\"ferritin\") ||\n      testNameLower.includes(\"calcium\") ||\n      testNameLower.includes(\"zinc\") ||\n      testNameLower.includes(\"magnesium\") ||\n      testNameLower.includes(\"folate\") ||\n      testNameLower.includes(\"selenium\") ||\n      testNameLower.includes(\"b12\") ||\n      testNameLower.includes(\"potassium\")\n    ) {\n      if (!searchTermsByDomain[\"vitamins_minerals\"]) searchTermsByDomain[\"vitamins_minerals\"] = [];\n      searchTermsByDomain[\"vitamins_minerals\"].push(testNameLower);\n    }\n\n    if (\n      testNameLower.includes(\"testosterone\") ||\n      testNameLower.includes(\"tsh\") ||\n      testNameLower.includes(\"t3\") ||\n      testNameLower.includes(\"t4\") ||\n      testNameLower.includes(\"cortisol\") ||\n      testNameLower.includes(\"insulin\") ||\n      testNameLower.includes(\"estrogen\") ||\n      testNameLower.includes(\"progesterone\") ||\n      testNameLower.includes(\"prolactin\") ||\n      testNameLower.includes(\"dhea\")\n    ) {\n      if (!searchTermsByDomain[\"hormones\"]) searchTermsByDomain[\"hormones\"] = [];\n      searchTermsByDomain[\"hormones\"].push(testNameLower);\n    }\n\n    if (\n      testNameLower.includes(\"cholesterol\") ||\n      testNameLower.includes(\"triglyceride\") ||\n      testNameLower.includes(\"glucose\") ||\n      testNameLower.includes(\"sugar\") ||\n      testNameLower.includes(\"hba1c\") ||\n      testNameLower.includes(\"albumin\") ||\n      testNameLower.includes(\"creatinine\") ||\n      testNameLower.includes(\"uric\") ||\n      test.category === \"organ_functions\" ||\n      test.category === \"lipids\"\n    ) {\n      if (!searchTermsByDomain[\"nutrition\"]) searchTermsByDomain[\"nutrition\"] = [];\n      searchTermsByDomain[\"nutrition\"].push(testNameLower);\n    }\n  }\n\n  if (fitnessGoal === \"weight_loss\" || fitnessGoal === \"maintain\") {\n    if (!searchTermsByDomain[\"aerobic_training\"]) searchTermsByDomain[\"aerobic_training\"] = [];\n    searchTermsByDomain[\"aerobic_training\"].push(\"cardio\", \"weight loss\", \"fat loss\");\n  }\n  if (fitnessGoal === \"muscle_gain\") {\n    if (!searchTermsByDomain[\"resistance_training\"]) searchTermsByDomain[\"resistance_training\"] = [];\n    searchTermsByDomain[\"resistance_training\"].push(\"muscle\", \"protein\", \"hypertrophy\");\n  }\n\n  let knowledgeContext = \"\";\n  for (const [domain, terms] of Object.entries(searchTermsByDomain)) {\n    const entries = await storage.searchKnowledge(domain as KnowledgeDomain, terms);\n    if (entries.length > 0) {\n      knowledgeContext += `\\n\\n--- ${domain.toUpperCase()} KNOWLEDGE (from verified sources) ---\\n`;\n      for (const entry of entries.slice(0, 10)) {\n        knowledgeContext += `[Source: ${entry.source}${entry.sourceUrl ? \" - \" + entry.sourceUrl : \"\"}] ${entry.topic}: ${entry.content}\\n`;\n      }\n    }\n  }\n\n  return knowledgeContext;\n}\n\nexport async function learnFromDietPlanGeneration(\n  testResults: { testName: string; status: string; value: number | null; unit: string | null }[],\n  generatedPlan: {\n    supplements?: { name: string; dosage: string; reason: string; foodSources?: string[]; scientificBasis?: string }[];\n    conditionTips?: { condition: string; advice: string[] }[];\n    deficiencies?: { name: string; current: string; target: string; foods: string[] }[];\n  }\n): Promise<void> {\n  const entries: InsertKnowledgeEntry[] = [];\n\n  if (generatedPlan.supplements) {\n    for (const supp of generatedPlan.supplements) {\n      const existing = await storage.searchKnowledge(\"vitamins_minerals\", [supp.name.toLowerCase()]);\n      const alreadyKnown = existing.some(\n        (e) => e.topic.toLowerCase().includes(supp.name.toLowerCase()) && e.content.includes(supp.dosage)\n      );\n      if (!alreadyKnown && supp.scientificBasis && supp.scientificBasis !== \"AI-generated\") {\n        entries.push({\n          domain: \"vitamins_minerals\",\n          topic: `${supp.name} supplementation - ${supp.dosage}`,\n          content: `${supp.reason}. Recommended dosage: ${supp.dosage}. ${supp.foodSources ? \"Natural food sources: \" + supp.foodSources.join(\", \") : \"\"}`,\n          contentAr: null,\n          source: supp.scientificBasis || \"Clinical diet plan analysis\",\n          sourceUrl: null,\n          tags: [supp.name.toLowerCase(), \"supplement\", \"dosage\"],\n        });\n      }\n    }\n  }\n\n  if (entries.length > 0) {\n    await storage.addKnowledgeEntries(entries);\n    console.log(`[KnowledgeEngine] Stored ${entries.length} new verified knowledge entries from diet plan generation`);\n  }\n}\n\nlet dailyJobInterval: ReturnType<typeof setInterval> | null = null;\n\nexport function startDailyLearningSchedule(): void {\n  dailyLearningJob().catch((err) => {\n    console.error(\"[KnowledgeEngine] Initial learning job failed:\", err);\n  });\n\n  dailyJobInterval = setInterval(\n    () => {\n      dailyLearningJob().catch((err) => {\n        console.error(\"[KnowledgeEngine] Scheduled learning job failed:\", err);\n      });\n    },\n    24 * 60 * 60 * 1000\n  );\n\n  console.log(\"[KnowledgeEngine] Daily learning schedule started (fetches from PubMed + NIH every 24 hours)\");\n}\n\nexport function stopDailyLearningSchedule(): void {\n  if (dailyJobInterval) {\n    clearInterval(dailyJobInterval);\n    dailyJobInterval = null;\n  }\n}\n","path":null,"size_bytes":28120,"size_tokens":null},"client/src/pages/MyDietSchedule.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  CalendarDays,\n  Trash2,\n  ChevronDown,\n  ChevronUp,\n  Salad,\n  Info,\n  AlertCircle,\n  Coffee,\n  Sun,\n  Moon,\n  Apple,\n  Flame,\n  Beef,\n  Wheat,\n  Droplets,\n  Target,\n  Stethoscope,\n  TrendingUp,\n  Pill,\n  Lightbulb,\n  Heart,\n  Ban,\n  BookOpen,\n  AlertTriangle,\n  ArrowDown,\n  Loader2,\n  Beaker,\n  UtensilsCrossed,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SavedPlan {\n  id: string;\n  userId: string;\n  planData: string;\n  createdAt: string;\n}\n\ninterface MealItem {\n  name: string;\n  description: string;\n  calories: number;\n  protein: number;\n  carbs: number;\n  fats: number;\n  benefits: string;\n}\n\ninterface DietPlanData {\n  healthSummary: string;\n  summary: string;\n  goalDescription: string;\n  calories: {\n    bmr: number;\n    tdee: number;\n    target: number;\n    deficit_or_surplus: number;\n  };\n  macros: {\n    protein: { grams: number; percentage: number };\n    carbs: { grams: number; percentage: number };\n    fats: { grams: number; percentage: number };\n  };\n  intakeAlignment: string;\n  deficiencies: { name: string; current: string; target: string; foods: string[] }[];\n  supplements: { name: string; dosage: string; reason: string; duration: string; foodSources?: string[]; targetLabValue?: string; scientificBasis?: string }[];\n  mealPlan: {\n    breakfast: MealItem[];\n    lunch: MealItem[];\n    dinner: MealItem[];\n    snacks: MealItem[];\n  };\n  tips: string[];\n  warnings: string[];\n  conditionTips: { condition: string; advice: string[]; avoidFoods: string[] }[];\n  references: string[];\n}\n\nexport default function MyDietSchedule() {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n  const [expandedPlan, setExpandedPlan] = useState<string | null>(null);\n\n  const { data: savedPlans, isLoading } = useQuery<SavedPlan[]>({\n    queryKey: [\"/api/saved-diet-plans\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/saved-diet-plans/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/saved-diet-plans\"] });\n    },\n  });\n\n  const handleDelete = (id: string) => {\n    if (confirm(t(\"deleteConfirm\"))) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  const formatDate = (dateStr: string) => {\n    const d = new Date(dateStr);\n    return d.toLocaleDateString(isArabic ? \"ar-SA\" : \"en-US\", {\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\",\n    });\n  };\n\n  const parsePlanData = (planDataStr: string): DietPlanData | null => {\n    try {\n      return JSON.parse(planDataStr);\n    } catch {\n      return null;\n    }\n  };\n\n  const renderPlanContent = (plan: DietPlanData) => {\n    const mealSections = [\n      { key: \"breakfast\", icon: Coffee, label: t(\"breakfast\"), items: plan.mealPlan.breakfast },\n      { key: \"lunch\", icon: Sun, label: t(\"lunch\"), items: plan.mealPlan.lunch },\n      { key: \"dinner\", icon: Moon, label: t(\"dinner\"), items: plan.mealPlan.dinner },\n      { key: \"snacks\", icon: Apple, label: t(\"snacks\"), items: plan.mealPlan.snacks },\n    ];\n\n    return (\n      <div className=\"space-y-3 mt-3\">\n        {plan.healthSummary && (\n          <Card data-testid=\"saved-section-health-summary\">\n            <CardHeader className=\"pb-2 p-3\">\n              <CardTitle className=\"text-xs flex items-center gap-2\">\n                <Stethoscope className=\"h-3.5 w-3.5 text-primary\" />\n                {t(\"healthSummaryTitle\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-3 pt-0\">\n              <p className=\"text-xs leading-relaxed text-muted-foreground\">{plan.healthSummary}</p>\n            </CardContent>\n          </Card>\n        )}\n\n        <Card>\n          <CardContent className=\"p-3\">\n            <p className=\"text-xs leading-relaxed\">{plan.summary}</p>\n            {plan.goalDescription && (\n              <div className=\"mt-1.5 flex items-start gap-1.5\">\n                <Target className=\"h-3.5 w-3.5 text-primary mt-0.5 shrink-0\" />\n                <p className=\"text-xs text-muted-foreground\">{plan.goalDescription}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <div className=\"grid grid-cols-3 gap-2\">\n          <Card>\n            <CardContent className=\"p-3 text-center\">\n              <Flame className=\"h-4 w-4 text-orange-500 mx-auto mb-0.5\" />\n              <p className=\"text-[10px] text-muted-foreground\">{t(\"targetCalories\")}</p>\n              <p className=\"text-base font-bold\">{plan.calories.target}</p>\n              <p className=\"text-[10px] text-muted-foreground\">{t(\"kcalPerDay\")}</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-3 text-center\">\n              <div className=\"flex items-center justify-center gap-2\">\n                <div className=\"text-center\">\n                  <Beef className=\"h-3 w-3 text-red-500 mx-auto mb-0.5\" />\n                  <p className=\"text-[10px] text-muted-foreground\">{t(\"protein\")}</p>\n                  <p className=\"text-xs font-bold\">{plan.macros.protein.grams}{t(\"gram\")}</p>\n                </div>\n                <div className=\"text-center\">\n                  <Wheat className=\"h-3 w-3 text-amber-500 mx-auto mb-0.5\" />\n                  <p className=\"text-[10px] text-muted-foreground\">{t(\"carbs\")}</p>\n                  <p className=\"text-xs font-bold\">{plan.macros.carbs.grams}{t(\"gram\")}</p>\n                </div>\n                <div className=\"text-center\">\n                  <Droplets className=\"h-3 w-3 text-blue-500 mx-auto mb-0.5\" />\n                  <p className=\"text-[10px] text-muted-foreground\">{t(\"fats\")}</p>\n                  <p className=\"text-xs font-bold\">{plan.macros.fats.grams}{t(\"gram\")}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-3 text-center\">\n              <Target className=\"h-4 w-4 text-primary mx-auto mb-0.5\" />\n              <p className=\"text-[10px] text-muted-foreground\">{t(\"bmr\")}</p>\n              <p className=\"text-base font-bold\">{plan.calories.bmr}</p>\n              <p className=\"text-[10px] text-muted-foreground\">{t(\"tdee\")}: {plan.calories.tdee}</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {plan.intakeAlignment && (\n          <Card>\n            <CardHeader className=\"pb-2 p-3\">\n              <CardTitle className=\"text-xs flex items-center gap-2\">\n                <TrendingUp className=\"h-3.5 w-3.5 text-primary\" />\n                {t(\"intakeAlignmentTitle\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-3 pt-0\">\n              <p className=\"text-xs leading-relaxed text-muted-foreground\">{plan.intakeAlignment}</p>\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.deficiencies && plan.deficiencies.length > 0 && (\n          <Card>\n            <CardHeader className=\"pb-2 p-3\">\n              <CardTitle className=\"text-xs flex items-center gap-2\">\n                <ArrowDown className=\"h-3.5 w-3.5 text-primary\" />\n                {t(\"deficiencies\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-3 pt-0 space-y-2\">\n              {plan.deficiencies.map((d, i) => (\n                <div key={i} className=\"rounded-md bg-muted/50 p-2\">\n                  <div className=\"flex items-center justify-between gap-2 mb-1 flex-wrap\">\n                    <span className=\"font-semibold text-xs\">{d.name}</span>\n                    <div className=\"flex items-center gap-1\">\n                      <Badge variant=\"destructive\" className=\"text-[10px]\">{d.current}</Badge>\n                      <span className=\"text-[10px] text-muted-foreground\">{isArabic ? \"\\u2190\" : \"\\u2192\"}</span>\n                      <Badge variant=\"secondary\" className=\"text-[10px]\">{d.target}</Badge>\n                    </div>\n                  </div>\n                  <div className=\"flex flex-wrap gap-1 mt-1\">\n                    {d.foods.map((food, fi) => (\n                      <Badge key={fi} variant=\"outline\" className=\"text-[10px]\">{food}</Badge>\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.supplements && plan.supplements.length > 0 && (\n          <Card>\n            <CardHeader className=\"pb-2 p-3\">\n              <CardTitle className=\"text-xs flex items-center gap-2\">\n                <Pill className=\"h-3.5 w-3.5 text-green-600 dark:text-green-400\" />\n                {t(\"supplementsTitle\")}\n              </CardTitle>\n              <p className=\"text-[10px] text-muted-foreground mt-1\">{t(\"supplementsDisclaimer\")}</p>\n            </CardHeader>\n            <CardContent className=\"p-3 pt-0 space-y-2\">\n              {plan.supplements.map((s, i) => (\n                <div key={i} className=\"rounded-md bg-muted/50 p-2.5 space-y-1.5\">\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <p className=\"font-semibold text-xs\">{s.name}</p>\n                    <Badge variant=\"outline\" className=\"text-[10px]\">{s.dosage}</Badge>\n                  </div>\n                  <p className=\"text-[10px] text-muted-foreground\">{s.reason}</p>\n                  {s.targetLabValue && (\n                    <div className=\"flex items-center gap-1.5\">\n                      <Target className=\"h-3 w-3 text-blue-500 shrink-0\" />\n                      <p className=\"text-[10px] text-blue-600 dark:text-blue-400\">{t(\"supplementTarget\")}: {s.targetLabValue}</p>\n                    </div>\n                  )}\n                  <div className=\"flex items-center gap-1.5\">\n                    <Pill className=\"h-3 w-3 text-green-500 shrink-0\" />\n                    <p className=\"text-[10px] text-green-600 dark:text-green-400\">{t(\"supplementDuration\")}: {s.duration}</p>\n                  </div>\n                  {s.foodSources && s.foodSources.length > 0 && (\n                    <div className=\"mt-1 space-y-0.5\">\n                      <div className=\"flex items-center gap-1.5\">\n                        <UtensilsCrossed className=\"h-3 w-3 text-orange-500 shrink-0\" />\n                        <p className=\"text-[10px] font-medium\">{t(\"supplementFoodSources\")}</p>\n                      </div>\n                      <div className=\"ps-5 space-y-0.5\">\n                        {s.foodSources.map((food, fi) => (\n                          <p key={fi} className=\"text-[10px] text-muted-foreground\">- {food}</p>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                  {s.scientificBasis && (\n                    <div className=\"flex items-center gap-1.5 mt-1\">\n                      <Beaker className=\"h-3 w-3 text-purple-500 shrink-0\" />\n                      <p className=\"text-[10px] text-purple-600 dark:text-purple-400\">{s.scientificBasis}</p>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"flex items-center gap-2 rounded-md bg-primary/10 p-2.5\">\n          <Info className=\"h-3.5 w-3.5 text-primary shrink-0\" />\n          <p className=\"text-[11px] font-medium text-primary\">{t(\"chooseOneMealNote\")}</p>\n        </div>\n\n        {mealSections.map((section) => (\n          <Card key={section.key}>\n            <CardHeader className=\"pb-2 p-3\">\n              <CardTitle className=\"text-xs flex items-center gap-2\">\n                <section.icon className=\"h-3.5 w-3.5 text-primary\" />\n                {section.label}\n                {section.items.length > 1 && (\n                  <Badge variant=\"outline\" className=\"text-[10px] ms-auto\">{section.items.length} {t(\"mealOption\")}</Badge>\n                )}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-3 pt-0 space-y-2\">\n              {section.items.map((item, i) => (\n                <div key={i} className=\"rounded-md bg-muted/50 p-2\">\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <div className=\"flex items-center gap-1.5\">\n                      {section.items.length > 1 && (\n                        <Badge variant=\"outline\" className=\"text-[10px]\">{t(\"mealOption\")} {i + 1}</Badge>\n                      )}\n                      <p className=\"font-semibold text-xs\">{item.name}</p>\n                    </div>\n                    {item.calories > 0 && (\n                      <Badge variant=\"outline\" className=\"text-[10px]\">\n                        <Flame className=\"h-2.5 w-2.5 me-0.5 text-orange-500\" />\n                        {item.calories} {t(\"kcal\")}\n                      </Badge>\n                    )}\n                  </div>\n                  <p className=\"text-[10px] text-muted-foreground mt-0.5\">{item.description}</p>\n                  {(item.protein > 0 || item.carbs > 0 || item.fats > 0) && (\n                    <div className=\"flex items-center gap-2 mt-1 flex-wrap\">\n                      <span className=\"text-[10px] text-blue-600 dark:text-blue-400 font-medium\">{t(\"protein\")}: {item.protein}{t(\"gram\")}</span>\n                      <span className=\"text-[10px] text-amber-600 dark:text-amber-400 font-medium\">{t(\"carbs\")}: {item.carbs}{t(\"gram\")}</span>\n                      <span className=\"text-[10px] text-rose-600 dark:text-rose-400 font-medium\">{t(\"fats\")}: {item.fats}{t(\"gram\")}</span>\n                    </div>\n                  )}\n                  <p className=\"text-[10px] text-green-600 dark:text-green-400 mt-0.5\">{item.benefits}</p>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        ))}\n\n        {plan.conditionTips && plan.conditionTips.length > 0 && (\n          <Card>\n            <CardHeader className=\"pb-2 p-3\">\n              <CardTitle className=\"text-xs flex items-center gap-2\">\n                <Heart className=\"h-3.5 w-3.5 text-primary\" />\n                {t(\"conditionBasedTips\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-3 pt-0 space-y-2\">\n              {plan.conditionTips.map((ct, i) => (\n                <div key={i} className=\"rounded-md bg-muted/50 p-2 space-y-1\">\n                  <p className=\"font-semibold text-xs\">{ct.condition}</p>\n                  <ul className=\"space-y-0.5\">\n                    {ct.advice.map((a, ai) => (\n                      <li key={ai} className=\"text-[10px] flex items-start gap-1\">\n                        <Lightbulb className=\"h-3 w-3 text-yellow-500 mt-0.5 shrink-0\" />\n                        {a}\n                      </li>\n                    ))}\n                  </ul>\n                  {ct.avoidFoods.length > 0 && (\n                    <div className=\"flex flex-wrap gap-1 mt-1\">\n                      <Ban className=\"h-3 w-3 text-orange-500\" />\n                      {ct.avoidFoods.map((f, fi) => (\n                        <Badge key={fi} variant=\"outline\" className=\"text-[10px]\">{f}</Badge>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.tips && plan.tips.length > 0 && (\n          <Card>\n            <CardHeader className=\"pb-2 p-3\">\n              <CardTitle className=\"text-xs flex items-center gap-2\">\n                <Lightbulb className=\"h-3.5 w-3.5 text-yellow-500\" />\n                {t(\"dietTips\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-3 pt-0\">\n              <ul className=\"space-y-0.5\">\n                {plan.tips.map((tip, i) => (\n                  <li key={i} className=\"text-[10px] flex items-start gap-1.5\">\n                    <span className=\"mt-1 h-1 w-1 rounded-full bg-primary shrink-0\" />\n                    {tip}\n                  </li>\n                ))}\n              </ul>\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.references && plan.references.length > 0 && (\n          <Card>\n            <CardHeader className=\"pb-2 p-3\">\n              <CardTitle className=\"text-xs flex items-center gap-2 text-muted-foreground\">\n                <BookOpen className=\"h-3.5 w-3.5\" />\n                {t(\"referencesTitle\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-3 pt-0\">\n              <ul className=\"space-y-0.5\">\n                {plan.references.map((ref, i) => (\n                  <li key={i} className=\"text-[10px] text-muted-foreground flex items-start gap-1\">\n                    <span className=\"text-[9px] font-mono shrink-0\">[{i + 1}]</span>\n                    {ref}\n                  </li>\n                ))}\n              </ul>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center gap-2\">\n        <CalendarDays className=\"h-5 w-5 text-primary\" />\n        <h2 className=\"text-lg font-bold\" data-testid=\"text-diet-schedule-title\">{t(\"myDietSchedule\")}</h2>\n      </div>\n\n      <Card className=\"border-blue-200 dark:border-blue-800/40 bg-blue-50/50 dark:bg-blue-950/20\" data-testid=\"card-diet-schedule-notes\">\n        <CardContent className=\"p-4 space-y-3\">\n          <div className=\"flex items-center gap-2\">\n            <Info className=\"h-5 w-5 text-blue-600 dark:text-blue-400 shrink-0\" />\n            <span className=\"text-sm font-semibold text-blue-800 dark:text-blue-300\">{t(\"dietScheduleNotesTitle\")}</span>\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-start gap-2\">\n              <CalendarDays className=\"h-4 w-4 text-blue-500 mt-0.5 shrink-0\" />\n              <p className=\"text-sm text-blue-900/80 dark:text-blue-200/70 leading-relaxed\">{t(\"dietScheduleNote\")}</p>\n            </div>\n            <div className=\"flex items-start gap-2\">\n              <AlertCircle className=\"h-4 w-4 text-amber-500 mt-0.5 shrink-0\" />\n              <p className=\"text-sm text-blue-900/80 dark:text-blue-200/70 leading-relaxed\">{t(\"plateauNote\")}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {isLoading && (\n        <Card>\n          <CardContent className=\"py-8 text-center\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary mx-auto\" />\n          </CardContent>\n        </Card>\n      )}\n\n      {!isLoading && (!savedPlans || savedPlans.length === 0) && (\n        <Card>\n          <CardContent className=\"py-8 text-center space-y-3\">\n            <Salad className=\"h-12 w-12 text-muted-foreground mx-auto\" />\n            <p className=\"font-semibold text-sm\" data-testid=\"text-no-saved-plans\">{t(\"noSavedPlans\")}</p>\n            <p className=\"text-xs text-muted-foreground\">{t(\"noSavedPlansDesc\")}</p>\n          </CardContent>\n        </Card>\n      )}\n\n      {savedPlans && savedPlans.length > 0 && (\n        <div className=\"space-y-3\">\n          {savedPlans.map((saved) => {\n            const plan = parsePlanData(saved.planData);\n            const isExpanded = expandedPlan === saved.id;\n\n            return (\n              <Card key={saved.id} data-testid={`card-saved-plan-${saved.id}`}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <div className=\"flex items-center gap-2 min-w-0\">\n                      <Salad className=\"h-5 w-5 text-primary shrink-0\" />\n                      <div className=\"min-w-0\">\n                        <p className=\"font-semibold text-sm\">{t(\"myDietSchedule\")}</p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {t(\"savedOn\")} {formatDate(saved.createdAt)}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => setExpandedPlan(isExpanded ? null : saved.id)}\n                        data-testid={`button-toggle-plan-${saved.id}`}\n                      >\n                        {isExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleDelete(saved.id)}\n                        disabled={deleteMutation.isPending}\n                        data-testid={`button-delete-plan-${saved.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4 text-destructive\" />\n                      </Button>\n                    </div>\n                  </div>\n\n                  {plan && (\n                    <div className=\"mt-2 flex items-center gap-2 flex-wrap\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        <Flame className=\"h-3 w-3 me-1 text-orange-500\" />\n                        {plan.calories.target} {t(\"kcal\")}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        <Beef className=\"h-3 w-3 me-1 text-red-500\" />\n                        {plan.macros.protein.grams}{t(\"gram\")}\n                      </Badge>\n                    </div>\n                  )}\n\n                  {isExpanded && plan && renderPlanContent(plan)}\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":22114,"size_tokens":null},"client/src/components/CategoryBadge.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Badge } from \"@/components/ui/badge\";\nimport type { TestCategory } from \"@shared/schema\";\nimport { \n  Pill, \n  Gem, \n  Activity, \n  HeartPulse,\n  Droplets,\n  Shield,\n  TestTube,\n  Scissors,\n  Microscope\n} from \"lucide-react\";\n\ninterface CategoryBadgeProps {\n  category: TestCategory;\n  showIcon?: boolean;\n}\n\nconst categoryConfig: Record<TestCategory, { icon: typeof Pill; colorClass: string }> = {\n  vitamins: { icon: Pill, colorClass: \"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400 border-orange-200 dark:border-orange-800\" },\n  minerals: { icon: Gem, colorClass: \"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-400 border-cyan-200 dark:border-cyan-800\" },\n  hormones: { icon: Activity, colorClass: \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400 border-purple-200 dark:border-purple-800\" },\n  organ_functions: { icon: HeartPulse, colorClass: \"bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-400 border-pink-200 dark:border-pink-800\" },\n  lipids: { icon: Droplets, colorClass: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800\" },\n  immunity: { icon: Shield, colorClass: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800\" },\n  blood: { icon: TestTube, colorClass: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 border-red-200 dark:border-red-800\" },\n  coagulation: { icon: Scissors, colorClass: \"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-400 border-indigo-200 dark:border-indigo-800\" },\n  special: { icon: Microscope, colorClass: \"bg-slate-100 text-slate-800 dark:bg-slate-900/30 dark:text-slate-400 border-slate-200 dark:border-slate-800\" },\n};\n\nexport function CategoryBadge({ category, showIcon = true }: CategoryBadgeProps) {\n  const { t } = useTranslation();\n  const config = categoryConfig[category];\n  const Icon = config.icon;\n\n  return (\n    <Badge className={`${config.colorClass}`}>\n      {showIcon && <Icon className=\"h-3 w-3 me-1\" />}\n      {t(category)}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":2193,"size_tokens":null},"server/replit_integrations/chat/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport OpenAI from \"openai\";\nimport { chatStorage } from \"./storage\";\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\nexport function registerChatRoutes(app: Express): void {\n  // Get all conversations\n  app.get(\"/api/conversations\", async (req: Request, res: Response) => {\n    try {\n      const conversations = await chatStorage.getAllConversations();\n      res.json(conversations);\n    } catch (error) {\n      console.error(\"Error fetching conversations:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversations\" });\n    }\n  });\n\n  // Get single conversation with messages\n  app.get(\"/api/conversations/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const conversation = await chatStorage.getConversation(id);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n      const messages = await chatStorage.getMessagesByConversation(id);\n      res.json({ ...conversation, messages });\n    } catch (error) {\n      console.error(\"Error fetching conversation:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversation\" });\n    }\n  });\n\n  // Create new conversation\n  app.post(\"/api/conversations\", async (req: Request, res: Response) => {\n    try {\n      const { title } = req.body;\n      const conversation = await chatStorage.createConversation(title || \"New Chat\");\n      res.status(201).json(conversation);\n    } catch (error) {\n      console.error(\"Error creating conversation:\", error);\n      res.status(500).json({ error: \"Failed to create conversation\" });\n    }\n  });\n\n  // Delete conversation\n  app.delete(\"/api/conversations/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await chatStorage.deleteConversation(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting conversation:\", error);\n      res.status(500).json({ error: \"Failed to delete conversation\" });\n    }\n  });\n\n  // Send message and get AI response (streaming)\n  app.post(\"/api/conversations/:id/messages\", async (req: Request, res: Response) => {\n    try {\n      const conversationId = parseInt(req.params.id);\n      const { content } = req.body;\n\n      // Save user message\n      await chatStorage.createMessage(conversationId, \"user\", content);\n\n      // Get conversation history for context\n      const messages = await chatStorage.getMessagesByConversation(conversationId);\n      const chatMessages = messages.map((m) => ({\n        role: m.role as \"user\" | \"assistant\",\n        content: m.content,\n      }));\n\n      // Set up SSE\n      res.setHeader(\"Content-Type\", \"text/event-stream\");\n      res.setHeader(\"Cache-Control\", \"no-cache\");\n      res.setHeader(\"Connection\", \"keep-alive\");\n\n      // Stream response from OpenAI\n      const stream = await openai.chat.completions.create({\n        model: \"gpt-5.1\",\n        messages: chatMessages,\n        stream: true,\n        max_completion_tokens: 2048,\n      });\n\n      let fullResponse = \"\";\n\n      for await (const chunk of stream) {\n        const content = chunk.choices[0]?.delta?.content || \"\";\n        if (content) {\n          fullResponse += content;\n          res.write(`data: ${JSON.stringify({ content })}\\n\\n`);\n        }\n      }\n\n      // Save assistant message\n      await chatStorage.createMessage(conversationId, \"assistant\", fullResponse);\n\n      res.write(`data: ${JSON.stringify({ done: true })}\\n\\n`);\n      res.end();\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      // Check if headers already sent (SSE streaming started)\n      if (res.headersSent) {\n        res.write(`data: ${JSON.stringify({ error: \"Failed to send message\" })}\\n\\n`);\n        res.end();\n      } else {\n        res.status(500).json({ error: \"Failed to send message\" });\n      }\n    }\n  });\n}\n\n","path":null,"size_bytes":4044,"size_tokens":null},"client/src/pages/Compare.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { MedicalDisclaimer } from \"@/components/MedicalDisclaimer\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, TrendingUp, TrendingDown, Minus, ArrowUp, ArrowDown, GitCompareArrows, Pill, Gem, Dna, HeartPulse, Droplets, Shield, Microscope, Syringe, FlaskConical, type LucideIcon } from \"lucide-react\";\nimport type { TestResultWithDefinition, TestCategory } from \"@shared/schema\";\n\nconst categoryIcons: Record<TestCategory, LucideIcon> = {\n  vitamins: Pill,\n  minerals: Gem,\n  hormones: Dna,\n  organ_functions: HeartPulse,\n  lipids: Droplets,\n  immunity: Shield,\n  blood: Microscope,\n  coagulation: Syringe,\n  special: FlaskConical,\n};\n\ninterface ComparisonItem {\n  testId: string;\n  nameEn: string;\n  nameAr: string;\n  category: TestCategory;\n  unit: string | null;\n  normalRangeMin: number | null;\n  normalRangeMax: number | null;\n  oldValue: number | null;\n  oldStatus: string;\n  oldDate: string;\n  newValue: number | null;\n  newStatus: string;\n  newDate: string;\n  change: \"improved\" | \"worsened\" | \"same\" | \"unknown\";\n  changePercent: number | null;\n}\n\nfunction getStatusColor(status: string) {\n  if (status === \"normal\") return \"text-green-600 dark:text-green-400\";\n  if (status === \"high\" || status === \"low\") return \"text-red-600 dark:text-red-400\";\n  return \"text-muted-foreground\";\n}\n\nfunction getStatusBadgeVariant(status: string): \"default\" | \"destructive\" | \"secondary\" | \"outline\" {\n  if (status === \"normal\") return \"secondary\";\n  if (status === \"high\" || status === \"low\") return \"destructive\";\n  return \"outline\";\n}\n\nexport default function Compare() {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n\n  const { data: tests = [], isLoading } = useQuery<TestResultWithDefinition[]>({\n    queryKey: [\"/api/tests\"],\n  });\n\n  const comparisons: ComparisonItem[] = (() => {\n    const grouped = new Map<string, TestResultWithDefinition[]>();\n    for (const test of tests) {\n      const existing = grouped.get(test.testId) || [];\n      existing.push(test);\n      grouped.set(test.testId, existing);\n    }\n\n    const items: ComparisonItem[] = [];\n    for (const [testId, results] of Array.from(grouped.entries())) {\n      if (results.length < 2) continue;\n\n      const sorted = [...results].sort((a, b) =>\n        new Date(a.testDate).getTime() - new Date(b.testDate).getTime()\n      );\n\n      const oldResult = sorted[sorted.length - 2];\n      const newResult = sorted[sorted.length - 1];\n      const def = newResult.testDefinition;\n\n      let change: ComparisonItem[\"change\"] = \"unknown\";\n      let changePercent: number | null = null;\n\n      if (oldResult.value != null && newResult.value != null && oldResult.value !== 0) {\n        changePercent = ((newResult.value - oldResult.value) / oldResult.value) * 100;\n\n        if (Math.abs(changePercent) < 1) {\n          change = \"same\";\n        } else {\n          const oldWasAbnormal = oldResult.status === \"high\" || oldResult.status === \"low\";\n          const newIsNormal = newResult.status === \"normal\";\n          const newIsAbnormal = newResult.status === \"high\" || newResult.status === \"low\";\n          const oldWasNormal = oldResult.status === \"normal\";\n\n          if (oldWasAbnormal && newIsNormal) {\n            change = \"improved\";\n          } else if (oldWasNormal && newIsAbnormal) {\n            change = \"worsened\";\n          } else if (oldWasAbnormal && newIsAbnormal) {\n            if (oldResult.status === newResult.status) {\n              if (def.normalRangeMin != null && def.normalRangeMax != null) {\n                const midRange = (def.normalRangeMin + def.normalRangeMax) / 2;\n                const oldDist = Math.abs(oldResult.value - midRange);\n                const newDist = Math.abs(newResult.value - midRange);\n                change = newDist < oldDist ? \"improved\" : \"worsened\";\n              } else {\n                change = \"same\";\n              }\n            } else {\n              change = \"worsened\";\n            }\n          } else {\n            change = \"same\";\n          }\n        }\n      }\n\n      items.push({\n        testId,\n        nameEn: def.nameEn,\n        nameAr: def.nameAr,\n        category: def.category as TestCategory,\n        unit: def.unit,\n        normalRangeMin: def.normalRangeMin,\n        normalRangeMax: def.normalRangeMax,\n        oldValue: oldResult.value,\n        oldStatus: oldResult.status || \"normal\",\n        oldDate: oldResult.testDate ? new Date(oldResult.testDate).toLocaleDateString(isArabic ? \"ar\" : \"en\", { year: \"2-digit\", month: \"2-digit\", day: \"2-digit\" }) : \"\",\n        newValue: newResult.value,\n        newStatus: newResult.status || \"normal\",\n        newDate: newResult.testDate ? new Date(newResult.testDate).toLocaleDateString(isArabic ? \"ar\" : \"en\", { year: \"2-digit\", month: \"2-digit\", day: \"2-digit\" }) : \"\",\n        change,\n        changePercent,\n      });\n    }\n\n    return items;\n  })();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" data-testid=\"loading-spinner\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <MedicalDisclaimer />\n\n      <div className=\"flex items-center gap-2\">\n        <GitCompareArrows className=\"h-5 w-5 text-primary\" />\n        <h2 className=\"text-lg font-bold\" data-testid=\"text-compare-title\">{t(\"compareResults\")}</h2>\n      </div>\n\n      {comparisons.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-8 text-center\">\n            <GitCompareArrows className=\"h-12 w-12 text-muted-foreground mx-auto mb-3\" />\n            <p className=\"text-muted-foreground font-medium\" data-testid=\"text-no-comparison\">\n              {t(\"noComparisonData\")}\n            </p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              {t(\"noComparisonHint\")}\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <>\n          <div className=\"flex items-center gap-3 text-xs text-muted-foreground flex-wrap\">\n            <span className=\"flex items-center gap-1\"><TrendingUp className=\"h-3 w-3 text-green-500\" /> {t(\"improved\")}</span>\n            <span className=\"flex items-center gap-1\"><TrendingDown className=\"h-3 w-3 text-red-500\" /> {t(\"worsened\")}</span>\n            <span className=\"flex items-center gap-1\"><Minus className=\"h-3 w-3 text-muted-foreground\" /> {t(\"noChange\")}</span>\n          </div>\n\n          <div className=\"space-y-3\">\n            {comparisons.map((item) => (\n              <Card key={item.testId} data-testid={`card-compare-${item.testId}`}>\n                <CardContent className=\"p-3\">\n                  <div className=\"flex items-center justify-between gap-2 mb-2\">\n                    <div className=\"flex items-center gap-2 min-w-0\">\n                      {(() => { const Icon = categoryIcons[item.category]; return <Icon className=\"h-4 w-4 text-muted-foreground shrink-0\" />; })()}\n                      <span className=\"font-semibold text-sm truncate\" data-testid={`text-test-name-${item.testId}`}>\n                        {isArabic ? item.nameAr : item.nameEn}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-1 shrink-0\">\n                      {item.change === \"improved\" && (\n                        <Badge variant=\"secondary\" className=\"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 text-xs\">\n                          <TrendingUp className=\"h-3 w-3 me-1\" />\n                          {t(\"improved\")}\n                        </Badge>\n                      )}\n                      {item.change === \"worsened\" && (\n                        <Badge variant=\"destructive\" className=\"text-xs\">\n                          <TrendingDown className=\"h-3 w-3 me-1\" />\n                          {t(\"worsened\")}\n                        </Badge>\n                      )}\n                      {item.change === \"same\" && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          <Minus className=\"h-3 w-3 me-1\" />\n                          {t(\"noChange\")}\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-3 gap-2 text-center\">\n                    <div className=\"rounded-md bg-muted/50 p-2\">\n                      <p className=\"text-[10px] text-muted-foreground mb-1\">{t(\"previousResult\")}</p>\n                      <p className={`text-sm font-bold ${getStatusColor(item.oldStatus)}`} data-testid={`text-old-value-${item.testId}`}>\n                        {item.oldValue ?? \"-\"}\n                      </p>\n                      <Badge variant={getStatusBadgeVariant(item.oldStatus)} className=\"text-[10px] mt-1\">\n                        {t(item.oldStatus)}\n                      </Badge>\n                      <p className=\"text-[10px] text-muted-foreground mt-1\">{item.oldDate}</p>\n                    </div>\n\n                    <div className=\"flex flex-col items-center justify-center\">\n                      {item.changePercent != null ? (\n                        <>\n                          <div className={`flex items-center gap-0.5 text-sm font-bold ${\n                            item.change === \"improved\" ? \"text-green-600 dark:text-green-400\" :\n                            item.change === \"worsened\" ? \"text-red-600 dark:text-red-400\" :\n                            \"text-muted-foreground\"\n                          }`}>\n                            {item.changePercent > 0 ? (\n                              <ArrowUp className=\"h-4 w-4\" />\n                            ) : item.changePercent < 0 ? (\n                              <ArrowDown className=\"h-4 w-4\" />\n                            ) : null}\n                            <span>{Math.abs(item.changePercent).toFixed(1)}%</span>\n                          </div>\n                          <p className=\"text-[10px] text-muted-foreground mt-1\">\n                            {item.unit || \"\"}\n                          </p>\n                        </>\n                      ) : (\n                        <Minus className=\"h-4 w-4 text-muted-foreground\" />\n                      )}\n                    </div>\n\n                    <div className=\"rounded-md bg-muted/50 p-2\">\n                      <p className=\"text-[10px] text-muted-foreground mb-1\">{t(\"latestResult\")}</p>\n                      <p className={`text-sm font-bold ${getStatusColor(item.newStatus)}`} data-testid={`text-new-value-${item.testId}`}>\n                        {item.newValue ?? \"-\"}\n                      </p>\n                      <Badge variant={getStatusBadgeVariant(item.newStatus)} className=\"text-[10px] mt-1\">\n                        {t(item.newStatus)}\n                      </Badge>\n                      <p className=\"text-[10px] text-muted-foreground mt-1\">{item.newDate}</p>\n                    </div>\n                  </div>\n\n                  {item.normalRangeMin != null && item.normalRangeMax != null && (\n                    <p className=\"text-[10px] text-muted-foreground text-center mt-2\">\n                      {t(\"normalRange\")}: {item.normalRangeMin} - {item.normalRangeMax} {item.unit || \"\"}\n                    </p>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":11558,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"server/storage.ts":{"content":"import { eq, and, desc, sql } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport {\n  users,\n  userProfiles,\n  testDefinitions,\n  testResults,\n  reminders,\n  uploadedPdfs,\n  savedDietPlans,\n  dietPlanJobs,\n  knowledgeBase,\n  knowledgeLearningLog,\n  type User,\n  type UpsertUser,\n  type UserProfile,\n  type InsertUserProfile,\n  type TestDefinition,\n  type TestResult,\n  type InsertTestResult,\n  type Reminder,\n  type InsertReminder,\n  type UploadedPdf,\n  type InsertUploadedPdf,\n  type TestResultWithDefinition,\n  type SavedDietPlan,\n  type DietPlanJob,\n  type KnowledgeEntry,\n  type InsertKnowledgeEntry,\n  type KnowledgeDomain,\n  type KnowledgeLearningLogEntry,\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  \n  getUserProfile(userId: string): Promise<UserProfile | undefined>;\n  upsertUserProfile(profile: InsertUserProfile): Promise<UserProfile>;\n  \n  getTestDefinitions(): Promise<TestDefinition[]>;\n  getTestDefinitionById(id: string): Promise<TestDefinition | undefined>;\n  \n  getTestResultsByUser(userId: string): Promise<TestResultWithDefinition[]>;\n  createTestResult(result: InsertTestResult): Promise<TestResult>;\n  deleteTestResult(id: string, userId: string): Promise<void>;\n  \n  getRemindersByUser(userId: string): Promise<(Reminder & { testDefinition: TestDefinition })[]>;\n  createReminder(reminder: InsertReminder): Promise<Reminder>;\n  updateReminder(id: string, userId: string, updates: { sent?: boolean; sentAt?: Date | null }): Promise<void>;\n  deleteReminder(id: string, userId: string): Promise<void>;\n  deleteReminderByTest(userId: string, testId: string): Promise<void>;\n  \n  getUploadedPdfsByUser(userId: string): Promise<UploadedPdf[]>;\n  createUploadedPdf(pdf: InsertUploadedPdf): Promise<UploadedPdf>;\n  incrementFilesUploaded(userId: string): Promise<void>;\n  \n  getSavedDietPlans(userId: string): Promise<SavedDietPlan[]>;\n  saveDietPlan(userId: string, planData: string): Promise<SavedDietPlan>;\n  deleteSavedDietPlan(id: string, userId: string): Promise<void>;\n\n  addKnowledgeEntry(entry: InsertKnowledgeEntry): Promise<KnowledgeEntry>;\n  addKnowledgeEntries(entries: InsertKnowledgeEntry[]): Promise<KnowledgeEntry[]>;\n  searchKnowledge(domain: KnowledgeDomain, searchTerms: string[]): Promise<KnowledgeEntry[]>;\n  getAllKnowledge(domain?: KnowledgeDomain): Promise<KnowledgeEntry[]>;\n  getKnowledgeCount(): Promise<Record<string, number>>;\n  deleteKnowledgeEntry(id: string): Promise<void>;\n  getLastLearningLog(domain: KnowledgeDomain): Promise<KnowledgeLearningLogEntry | null>;\n  addLearningLog(domain: KnowledgeDomain, topicsSearched: string[], entriesAdded: number): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async getUserProfile(userId: string): Promise<UserProfile | undefined> {\n    const [profile] = await db\n      .select()\n      .from(userProfiles)\n      .where(eq(userProfiles.id, userId));\n    return profile;\n  }\n\n  async upsertUserProfile(profile: InsertUserProfile): Promise<UserProfile> {\n    const [result] = await db\n      .insert(userProfiles)\n      .values(profile)\n      .onConflictDoUpdate({\n        target: userProfiles.id,\n        set: {\n          ...profile,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return result;\n  }\n\n  async getTestDefinitions(): Promise<TestDefinition[]> {\n    return db.select().from(testDefinitions).orderBy(testDefinitions.level);\n  }\n\n  async getTestDefinitionById(id: string): Promise<TestDefinition | undefined> {\n    const [def] = await db\n      .select()\n      .from(testDefinitions)\n      .where(eq(testDefinitions.id, id));\n    return def;\n  }\n\n  async getTestResultsByUser(userId: string): Promise<TestResultWithDefinition[]> {\n    const results = await db\n      .select({\n        id: testResults.id,\n        userId: testResults.userId,\n        testId: testResults.testId,\n        value: testResults.value,\n        valueText: testResults.valueText,\n        status: testResults.status,\n        testDate: testResults.testDate,\n        pdfFileName: testResults.pdfFileName,\n        pdfFilePath: testResults.pdfFilePath,\n        createdAt: testResults.createdAt,\n        testDefinition: testDefinitions,\n      })\n      .from(testResults)\n      .innerJoin(testDefinitions, eq(testResults.testId, testDefinitions.id))\n      .where(eq(testResults.userId, userId))\n      .orderBy(desc(testResults.testDate));\n\n    return results as TestResultWithDefinition[];\n  }\n\n  async createTestResult(result: InsertTestResult): Promise<TestResult> {\n    const [created] = await db.insert(testResults).values(result).returning();\n    return created;\n  }\n\n  async deleteTestResult(id: string, userId: string): Promise<void> {\n    await db\n      .delete(testResults)\n      .where(and(eq(testResults.id, id), eq(testResults.userId, userId)));\n  }\n\n  async getRemindersByUser(userId: string): Promise<(Reminder & { testDefinition: TestDefinition })[]> {\n    const results = await db\n      .select({\n        id: reminders.id,\n        userId: reminders.userId,\n        testId: reminders.testId,\n        dueDate: reminders.dueDate,\n        sent: reminders.sent,\n        sentAt: reminders.sentAt,\n        createdAt: reminders.createdAt,\n        testDefinition: testDefinitions,\n      })\n      .from(reminders)\n      .innerJoin(testDefinitions, eq(reminders.testId, testDefinitions.id))\n      .where(eq(reminders.userId, userId))\n      .orderBy(reminders.dueDate);\n\n    return results as (Reminder & { testDefinition: TestDefinition })[];\n  }\n\n  async createReminder(reminder: InsertReminder): Promise<Reminder> {\n    const [created] = await db.insert(reminders).values(reminder).returning();\n    return created;\n  }\n\n  async updateReminder(id: string, userId: string, updates: { sent?: boolean; sentAt?: Date | null }): Promise<void> {\n    await db\n      .update(reminders)\n      .set(updates)\n      .where(and(eq(reminders.id, id), eq(reminders.userId, userId)));\n  }\n\n  async deleteReminder(id: string, userId: string): Promise<void> {\n    await db.delete(reminders).where(and(eq(reminders.id, id), eq(reminders.userId, userId)));\n  }\n\n  async deleteReminderByTest(userId: string, testId: string): Promise<void> {\n    await db.delete(reminders).where(and(eq(reminders.userId, userId), eq(reminders.testId, testId)));\n  }\n\n  async getUploadedPdfsByUser(userId: string): Promise<UploadedPdf[]> {\n    return db\n      .select()\n      .from(uploadedPdfs)\n      .where(eq(uploadedPdfs.userId, userId))\n      .orderBy(desc(uploadedPdfs.createdAt));\n  }\n\n  async createUploadedPdf(pdf: InsertUploadedPdf): Promise<UploadedPdf> {\n    const [created] = await db.insert(uploadedPdfs).values(pdf).returning();\n    return created;\n  }\n\n  async incrementFilesUploaded(userId: string): Promise<void> {\n    await db\n      .update(userProfiles)\n      .set({\n        filesUploaded: sql`COALESCE(${userProfiles.filesUploaded}, 0) + 1`,\n        updatedAt: new Date(),\n      })\n      .where(eq(userProfiles.id, userId));\n  }\n\n  async getUploadedPdfById(id: string, userId: string): Promise<UploadedPdf | null> {\n    const results = await db\n      .select()\n      .from(uploadedPdfs)\n      .where(and(eq(uploadedPdfs.id, id), eq(uploadedPdfs.userId, userId)));\n    return results[0] || null;\n  }\n\n  async updateUploadedPdfStatus(\n    id: string, \n    status: \"pending\" | \"processing\" | \"success\" | \"failed\",\n    testsExtracted?: number,\n    errorMessage?: string\n  ): Promise<UploadedPdf | null> {\n    const updateData: Record<string, unknown> = { status };\n    if (testsExtracted !== undefined) {\n      updateData.testsExtracted = testsExtracted;\n      updateData.processedAt = new Date();\n    }\n    if (errorMessage !== undefined) {\n      updateData.errorMessage = errorMessage;\n    }\n    const [updated] = await db\n      .update(uploadedPdfs)\n      .set(updateData)\n      .where(eq(uploadedPdfs.id, id))\n      .returning();\n    return updated || null;\n  }\n\n  async deleteUploadedPdf(id: string, userId: string): Promise<boolean> {\n    const result = await db\n      .delete(uploadedPdfs)\n      .where(and(eq(uploadedPdfs.id, id), eq(uploadedPdfs.userId, userId)))\n      .returning();\n    return result.length > 0;\n  }\n\n  async getSavedDietPlans(userId: string): Promise<SavedDietPlan[]> {\n    return db\n      .select()\n      .from(savedDietPlans)\n      .where(eq(savedDietPlans.userId, userId))\n      .orderBy(desc(savedDietPlans.createdAt));\n  }\n\n  async saveDietPlan(userId: string, planData: string): Promise<SavedDietPlan> {\n    const [created] = await db\n      .insert(savedDietPlans)\n      .values({ userId, planData })\n      .returning();\n    return created;\n  }\n\n  async deleteSavedDietPlan(id: string, userId: string): Promise<void> {\n    await db\n      .delete(savedDietPlans)\n      .where(and(eq(savedDietPlans.id, id), eq(savedDietPlans.userId, userId)));\n  }\n\n  async createDietPlanJob(userId: string, language: string): Promise<DietPlanJob> {\n    const [job] = await db\n      .insert(dietPlanJobs)\n      .values({ userId, language, status: \"pending\" })\n      .returning();\n    return job;\n  }\n\n  async getDietPlanJob(id: string, userId: string): Promise<DietPlanJob | null> {\n    const [job] = await db\n      .select()\n      .from(dietPlanJobs)\n      .where(and(eq(dietPlanJobs.id, id), eq(dietPlanJobs.userId, userId)));\n    return job || null;\n  }\n\n  async getLatestPendingJob(userId: string): Promise<DietPlanJob | null> {\n    const [job] = await db\n      .select()\n      .from(dietPlanJobs)\n      .where(and(\n        eq(dietPlanJobs.userId, userId),\n        sql`${dietPlanJobs.status} IN ('pending', 'processing')`\n      ))\n      .orderBy(desc(dietPlanJobs.createdAt))\n      .limit(1);\n    return job || null;\n  }\n\n  async failStaleJobs(): Promise<number> {\n    const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);\n    const staleJobs = await db\n      .update(dietPlanJobs)\n      .set({ status: \"failed\", error: \"Server restarted during generation\", completedAt: new Date() })\n      .where(and(\n        sql`${dietPlanJobs.status} IN ('pending', 'processing')`,\n        sql`${dietPlanJobs.createdAt} < ${fiveMinutesAgo}`\n      ))\n      .returning();\n    return staleJobs.length;\n  }\n\n  async updateDietPlanJob(id: string, updates: { status?: string; planData?: string; error?: string }): Promise<DietPlanJob | null> {\n    const updateData: Record<string, unknown> = { ...updates };\n    if (updates.status === \"completed\" || updates.status === \"failed\") {\n      updateData.completedAt = new Date();\n    }\n    const [updated] = await db\n      .update(dietPlanJobs)\n      .set(updateData)\n      .where(eq(dietPlanJobs.id, id))\n      .returning();\n    return updated || null;\n  }\n\n  async addKnowledgeEntry(entry: InsertKnowledgeEntry): Promise<KnowledgeEntry> {\n    const [created] = await db.insert(knowledgeBase).values(entry).returning();\n    return created;\n  }\n\n  async addKnowledgeEntries(entries: InsertKnowledgeEntry[]): Promise<KnowledgeEntry[]> {\n    if (entries.length === 0) return [];\n    const created = await db.insert(knowledgeBase).values(entries).returning();\n    return created;\n  }\n\n  async searchKnowledge(domain: KnowledgeDomain, searchTerms: string[]): Promise<KnowledgeEntry[]> {\n    if (searchTerms.length === 0) {\n      return db.select().from(knowledgeBase)\n        .where(eq(knowledgeBase.domain, domain))\n        .orderBy(desc(knowledgeBase.createdAt))\n        .limit(20);\n    }\n    const searchPattern = searchTerms.map(t => t.toLowerCase()).join(\"|\");\n    return db.select().from(knowledgeBase)\n      .where(and(\n        eq(knowledgeBase.domain, domain),\n        sql`(LOWER(${knowledgeBase.topic}) ~* ${searchPattern} OR LOWER(${knowledgeBase.content}) ~* ${searchPattern} OR EXISTS (SELECT 1 FROM unnest(${knowledgeBase.tags}) tag WHERE LOWER(tag) ~* ${searchPattern}))`\n      ))\n      .orderBy(desc(knowledgeBase.createdAt))\n      .limit(30);\n  }\n\n  async getAllKnowledge(domain?: KnowledgeDomain): Promise<KnowledgeEntry[]> {\n    if (domain) {\n      return db.select().from(knowledgeBase)\n        .where(eq(knowledgeBase.domain, domain))\n        .orderBy(desc(knowledgeBase.createdAt));\n    }\n    return db.select().from(knowledgeBase).orderBy(desc(knowledgeBase.createdAt));\n  }\n\n  async getKnowledgeCount(): Promise<Record<string, number>> {\n    const results = await db\n      .select({ domain: knowledgeBase.domain, count: sql<number>`count(*)::int` })\n      .from(knowledgeBase)\n      .groupBy(knowledgeBase.domain);\n    const counts: Record<string, number> = {};\n    for (const r of results) {\n      counts[r.domain] = r.count;\n    }\n    return counts;\n  }\n\n  async deleteKnowledgeEntry(id: string): Promise<void> {\n    await db.delete(knowledgeBase).where(eq(knowledgeBase.id, id));\n  }\n\n  async getLastLearningLog(domain: KnowledgeDomain): Promise<KnowledgeLearningLogEntry | null> {\n    const [log] = await db.select().from(knowledgeLearningLog)\n      .where(eq(knowledgeLearningLog.domain, domain))\n      .orderBy(desc(knowledgeLearningLog.createdAt))\n      .limit(1);\n    return log || null;\n  }\n\n  async addLearningLog(domain: KnowledgeDomain, topicsSearched: string[], entriesAdded: number): Promise<void> {\n    await db.insert(knowledgeLearningLog).values({\n      domain,\n      topicsSearched,\n      entriesAdded,\n      status: \"completed\",\n    });\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":13862,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"mobile/README.md":{"content":"# BioTrack AI - تطبيق الهاتف\n# BioTrack AI - Mobile App\n**by Alshira company**\n\nتطبيق React Native/Expo لتحليل نتائج الفحوصات الطبية بالذكاء الاصطناعي.\n\nA React Native/Expo app for AI-powered analysis of medical lab results.\n\n## المميزات | Features\n\n- 📊 تحليل PDF بالذكاء الاصطناعي | AI-powered PDF analysis\n- 🧪 50 نوع فحص | 50 test types\n- 🔴🟢 ترميز لوني للنتائج | Color-coded results\n- 🌐 عربي/إنجليزي مع RTL | Arabic/English with RTL\n- 🔔 تذكيرات إعادة الفحص | Recheck reminders\n- 👤 ملف شخصي صحي | Health profile\n\n## المتطلبات | Requirements\n\n- Node.js 18+\n- Expo CLI: `npm install -g expo-cli`\n- EAS CLI (للبناء): `npm install -g eas-cli`\n- حساب Expo (مجاني)\n\n## التشغيل المحلي | Local Development\n\n```bash\ncd mobile\nnpm install\nnpx expo start\n```\n\nثم افتح التطبيق في:\n- تطبيق Expo Go على هاتفك (مسح QR code)\n- محاكي Android/iOS\n\n## بناء التطبيق | Building the App\n\n### إعداد حساب Expo\n1. سجل في https://expo.dev\n2. سجل دخول: `eas login`\n\n### بناء APK للأندرويد\n```bash\neas build --platform android --profile production\n```\n\n### بناء للـ iOS\n```bash\neas build --platform ios --profile production\n```\n\n## النشر على المتاجر | Store Publishing\n\n### Google Play Store\n1. أنشئ حساب مطور ($25 مرة واحدة)\n2. أنشئ تطبيق في Google Play Console\n3. ارفع ملف APK أو AAB\n\n### Apple App Store\n1. أنشئ حساب مطور ($99/سنة)\n2. أنشئ التطبيق في App Store Connect\n3. ارفع باستخدام EAS Submit:\n   ```bash\n   eas submit --platform ios\n   ```\n\n## هيكل المشروع | Project Structure\n\n```\nmobile/\n├── App.tsx                 # Entry point\n├── app.json               # Expo configuration\n├── eas.json               # EAS build configuration\n├── src/\n│   ├── screens/           # App screens\n│   │   ├── HomeScreen.tsx\n│   │   ├── TestsScreen.tsx\n│   │   ├── UploadScreen.tsx\n│   │   ├── ProfileScreen.tsx\n│   │   ├── RemindersScreen.tsx\n│   │   └── LoginScreen.tsx\n│   ├── navigation/        # Navigation setup\n│   │   ├── TabNavigator.tsx\n│   │   └── RootNavigator.tsx\n│   ├── context/           # React contexts\n│   │   └── AuthContext.tsx\n│   ├── hooks/             # Custom hooks\n│   │   └── useAuth.ts\n│   └── lib/               # Utilities\n│       ├── api.ts         # API client\n│       └── i18n.ts        # Translations\n└── assets/                # Icons and images\n```\n\n## الإعدادات المطلوبة | Configuration\n\n### ربط API\nعدّل `src/lib/api.ts`:\n```typescript\nconst API_BASE_URL = 'https://your-app-url.replit.app';\n```\n\n### معرف التطبيق\nعدّل `app.json`:\n- `ios.bundleIdentifier`\n- `android.package`\n\n## تنبيه طبي | Medical Disclaimer\n\nهذا التطبيق للأغراض التوعوية فقط ولا يغني عن استشارة الطبيب المختص.\n\nThis app is for informational purposes only and does not replace professional medical advice.\n","path":null,"size_bytes":3368,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/pages/DietPlan.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { UserProfile } from \"@shared/schema\";\nimport {\n  Loader2,\n  Sun,\n  Coffee,\n  Moon,\n  Apple,\n  AlertTriangle,\n  Lightbulb,\n  ArrowDown,\n  Salad,\n  RefreshCw,\n  Flame,\n  Target,\n  ShieldAlert,\n  Beef,\n  Wheat,\n  Droplets,\n  ChevronLeft,\n  ChevronRight,\n  Check,\n  X,\n  Armchair,\n  Bike,\n  Dumbbell,\n  Zap,\n  Heart,\n  Leaf,\n  BarChart3,\n  Scale,\n  Ban,\n  Fish,\n  Pill,\n  Stethoscope,\n  TrendingUp,\n  BookOpen,\n  Save,\n  Info,\n  Beaker,\n  UtensilsCrossed,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { cn } from \"@/lib/utils\";\nimport { useDietPlanJob } from \"@/context/DietPlanJobContext\";\n\ninterface MealItem {\n  name: string;\n  description: string;\n  calories: number;\n  protein: number;\n  carbs: number;\n  fats: number;\n  benefits: string;\n}\n\ninterface Deficiency {\n  name: string;\n  current: string;\n  target: string;\n  foods: string[];\n}\n\ninterface Supplement {\n  name: string;\n  dosage: string;\n  reason: string;\n  duration: string;\n  foodSources: string[];\n  targetLabValue: string;\n  scientificBasis: string;\n}\n\ninterface ConditionTip {\n  condition: string;\n  advice: string[];\n  avoidFoods: string[];\n}\n\ninterface DietPlanData {\n  healthSummary: string;\n  summary: string;\n  goalDescription: string;\n  calories: {\n    bmr: number;\n    tdee: number;\n    target: number;\n    deficit_or_surplus: number;\n  };\n  macros: {\n    protein: { grams: number; percentage: number };\n    carbs: { grams: number; percentage: number };\n    fats: { grams: number; percentage: number };\n  };\n  intakeAlignment: string;\n  deficiencies: Deficiency[];\n  supplements: Supplement[];\n  mealPlan: {\n    breakfast: MealItem[];\n    lunch: MealItem[];\n    dinner: MealItem[];\n    snacks: MealItem[];\n  };\n  tips: string[];\n  warnings: string[];\n  conditionTips: ConditionTip[];\n  references: string[];\n}\n\ntype QuestionnaireStep = \"disclaimer\" | \"activity\" | \"allergy\" | \"allergySelect\" | \"proteinPref\" | \"carbPref\" | \"preference\" | \"generating\";\n\nconst ALLERGY_OPTIONS = [\n  { key: \"eggs\", labelKey: \"allergyEggs\" },\n  { key: \"dairy\", labelKey: \"allergyDairy\" },\n  { key: \"peanuts\", labelKey: \"allergyPeanuts\" },\n  { key: \"nuts\", labelKey: \"allergyNuts\" },\n  { key: \"seafood\", labelKey: \"allergySeafood\" },\n  { key: \"soy\", labelKey: \"allergySoy\" },\n  { key: \"sesame\", labelKey: \"allergySesame\" },\n  { key: \"wheat\", labelKey: \"allergyWheat\" },\n  { key: \"fish\", labelKey: \"allergyFish\" },\n];\n\nexport default function DietPlan() {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n  const [plan, setPlan] = useState<DietPlanData | null>(null);\n  const [step, setStep] = useState<QuestionnaireStep>(\"disclaimer\");\n  const [showQuestionnaire, setShowQuestionnaire] = useState(false);\n  const { toast } = useToast();\n\n  const [activityLevel, setActivityLevel] = useState<string>(\"\");\n  const [hasAllergies, setHasAllergies] = useState<boolean | null>(null);\n  const [selectedAllergies, setSelectedAllergies] = useState<string[]>([]);\n  const [mealPreference, setMealPreference] = useState<string>(\"\");\n  const [selectedProteins, setSelectedProteins] = useState<string[]>([]);\n  const [selectedCarbs, setSelectedCarbs] = useState<string[]>([]);\n  const { isGenerating, completedPlan, startJob, clearCompletedPlan } = useDietPlanJob();\n\n  const { data: profile } = useQuery<UserProfile>({\n    queryKey: [\"/api/profile\"],\n  });\n\n  const exportMutation = useMutation({\n    mutationFn: async (planData: DietPlanData) => {\n      const res = await apiRequest(\"POST\", \"/api/saved-diet-plans\", {\n        planData: JSON.stringify(planData),\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/saved-diet-plans\"] });\n      toast({ title: t(\"exportSuccess\") });\n    },\n    onError: () => {\n      toast({ title: t(\"exportError\"), variant: \"destructive\" });\n    },\n  });\n\n  const saveMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"PATCH\", \"/api/profile\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/profile\"] });\n    },\n  });\n\n  useEffect(() => {\n    if (completedPlan) {\n      setPlan(completedPlan);\n      setShowQuestionnaire(false);\n      clearCompletedPlan();\n    }\n  }, [completedPlan, clearCompletedPlan]);\n\n  useEffect(() => {\n    if (isGenerating && !showQuestionnaire) {\n      setShowQuestionnaire(true);\n      setStep(\"generating\");\n    }\n  }, [isGenerating]);\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      await saveMutation.mutateAsync({\n        activityLevel,\n        mealPreference,\n        hasAllergies: hasAllergies || false,\n        allergies: hasAllergies ? selectedAllergies : [],\n        proteinPreferences: mealPreference === \"vegetarian\" ? [] : selectedProteins,\n        carbPreferences: mealPreference === \"keto\" ? [] : selectedCarbs,\n      });\n      const res = await fetch(\"/api/diet-plan\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ language: i18n.language }),\n        credentials: \"include\",\n      });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.message || t(\"dietPlanError\"));\n      }\n      return data;\n    },\n    onSuccess: (data: { jobId: string; status: string }) => {\n      startJob(data.jobId);\n    },\n    onError: (error: Error) => {\n      setShowQuestionnaire(false);\n      setStep(\"disclaimer\");\n      toast({\n        title: error.message || t(\"dietPlanError\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const startQuestionnaire = () => {\n    if (profile?.activityLevel) setActivityLevel(profile.activityLevel);\n    if (profile?.mealPreference) setMealPreference(profile.mealPreference);\n    if (profile?.hasAllergies != null) setHasAllergies(profile.hasAllergies);\n    if (profile?.allergies) setSelectedAllergies(profile.allergies);\n    if (profile?.proteinPreferences) setSelectedProteins(profile.proteinPreferences);\n    else if (profile?.proteinPreference && profile.proteinPreference !== \"mixed\") setSelectedProteins([profile.proteinPreference]);\n    if (profile?.carbPreferences) setSelectedCarbs(profile.carbPreferences);\n    setShowQuestionnaire(true);\n    setStep(\"disclaimer\");\n  };\n\n  const handleAllergyToggle = (key: string) => {\n    setSelectedAllergies(prev =>\n      prev.includes(key) ? prev.filter(a => a !== key) : [...prev, key]\n    );\n  };\n\n  const handleFinishQuestionnaire = () => {\n    setStep(\"generating\");\n    generateMutation.mutate();\n  };\n\n  const BackArrow = isArabic ? ChevronRight : ChevronLeft;\n  const NextArrow = isArabic ? ChevronLeft : ChevronRight;\n\n  const activityOptions = [\n    { key: \"sedentary\", labelKey: \"activitySedentary\", descKey: \"activitySedentaryDesc\", icon: Armchair },\n    { key: \"lightly_active\", labelKey: \"activityLight\", descKey: \"activityLightDesc\", icon: Bike },\n    { key: \"very_active\", labelKey: \"activityVery\", descKey: \"activityVeryDesc\", icon: Dumbbell },\n    { key: \"extremely_active\", labelKey: \"activityExtreme\", descKey: \"activityExtremeDesc\", icon: Zap },\n  ];\n\n  const proteinOptions = [\n    { key: \"fish\", labelKey: \"proteinFish\" },\n    { key: \"chicken\", labelKey: \"proteinChicken\" },\n    { key: \"meat\", labelKey: \"proteinMeat\" },\n    { key: \"vegetarian\", labelKey: \"proteinVegetarian\" },\n  ];\n\n  const carbOptions = [\n    { key: \"rice\", labelKey: \"carbRice\" },\n    { key: \"bread\", labelKey: \"carbBread\" },\n    { key: \"pasta\", labelKey: \"carbPasta\" },\n    { key: \"oats\", labelKey: \"carbOats\" },\n    { key: \"potato\", labelKey: \"carbPotato\" },\n    { key: \"sweet_potato\", labelKey: \"carbSweetPotato\" },\n    { key: \"quinoa\", labelKey: \"carbQuinoa\" },\n    { key: \"bulgur\", labelKey: \"carbBulgur\" },\n    { key: \"keto\", labelKey: \"carbKeto\" },\n    { key: \"corn\", labelKey: \"carbCorn\" },\n    { key: \"beans\", labelKey: \"carbBeans\" },\n    { key: \"fruits\", labelKey: \"carbFruits\" },\n  ];\n\n  const handleProteinToggle = (key: string) => {\n    setSelectedProteins(prev =>\n      prev.includes(key) ? prev.filter(p => p !== key) : [...prev, key]\n    );\n  };\n\n  const handleCarbToggle = (key: string) => {\n    setSelectedCarbs(prev =>\n      prev.includes(key) ? prev.filter(c => c !== key) : [...prev, key]\n    );\n  };\n\n  const preferenceOptions = [\n    { key: \"high_protein\", labelKey: \"prefHighProtein\", descKey: \"prefHighProteinDesc\", icon: Beef, recommended: true, macroRanges: { protein: \"40-50%\", carbs: \"35-40%\", fats: \"10-25%\" } },\n    { key: \"balanced\", labelKey: \"prefBalanced\", descKey: \"prefBalancedDesc\", icon: Scale, recommended: false, macroRanges: { protein: \"20-35%\", carbs: \"40-55%\", fats: \"20-30%\" } },\n    { key: \"low_carb\", labelKey: \"prefLowCarb\", descKey: \"prefLowCarbDesc\", icon: Leaf, recommended: false, macroRanges: { protein: \"25-35%\", carbs: \"10-20%\", fats: \"40-50%\" } },\n    { key: \"keto\", labelKey: \"prefKeto\", descKey: \"prefKetoDesc\", icon: Flame, recommended: false, macroRanges: { protein: \"20-25%\", carbs: \"5-10%\", fats: \"65-75%\" } },\n    { key: \"vegetarian\", labelKey: \"prefVegetarian\", descKey: \"prefVegetarianDesc\", icon: Leaf, recommended: false, macroRanges: { protein: \"15-25%\", carbs: \"45-55%\", fats: \"20-30%\" } },\n    { key: \"custom_macros\", labelKey: \"prefCustomMacros\", descKey: \"prefCustomMacrosDesc\", icon: BarChart3, recommended: false, macroRanges: null },\n  ];\n\n  const goalLabels: Record<string, string> = {\n    weight_loss: t(\"goalWeightLoss\"),\n    maintain: t(\"goalMaintain\"),\n    muscle_gain: t(\"goalMuscleGain\"),\n  };\n\n  const getNextStepAfterAllergy = () => {\n    if (mealPreference === \"vegetarian\") return \"preference\";\n    return \"proteinPref\";\n  };\n\n  if (showQuestionnaire && !plan) {\n    return (\n      <div className=\"space-y-4\">\n        {step === \"disclaimer\" && (\n          <div className=\"space-y-4\">\n            <Card className=\"border-orange-200 dark:border-orange-800/40\">\n              <CardContent className=\"p-5 flex flex-col items-center text-center gap-3\">\n                <ShieldAlert className=\"h-10 w-10 text-orange-500\" />\n                <h2 className=\"text-lg font-bold\">{t(\"warning\")}</h2>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  {t(\"nutritionDisclaimer\")}\n                </p>\n                <Button\n                  className=\"mt-2 w-full\"\n                  onClick={() => setStep(\"activity\")}\n                  data-testid=\"button-accept-disclaimer\"\n                >\n                  {t(\"questContinue\")}\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {step === \"activity\" && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n              <Button variant=\"ghost\" size=\"icon\" onClick={() => setStep(\"disclaimer\")} data-testid=\"button-back-activity\">\n                <BackArrow className=\"h-5 w-5\" />\n              </Button>\n              <span className=\"text-xs text-muted-foreground\">{t(\"questStep\")} 1 {t(\"questOf\")} 5</span>\n            </div>\n            <div className=\"text-center space-y-1\">\n              <h2 className=\"text-xl font-bold\" data-testid=\"text-activity-title\">{t(\"questActivityTitle\")}</h2>\n              <p className=\"text-sm text-muted-foreground\">{t(\"questActivitySubtitle\")}</p>\n            </div>\n            <div className=\"space-y-3\">\n              {activityOptions.map(opt => {\n                const Icon = opt.icon;\n                const isSelected = activityLevel === opt.key;\n                return (\n                  <Card\n                    key={opt.key}\n                    className={cn(\n                      \"cursor-pointer transition-colors\",\n                      isSelected && \"border-primary bg-primary/5\"\n                    )}\n                    onClick={() => setActivityLevel(opt.key)}\n                    data-testid={`card-activity-${opt.key}`}\n                  >\n                    <CardContent className=\"p-4 flex items-center gap-4\">\n                      <div className={cn(\"p-2 rounded-lg\", isSelected ? \"bg-primary/10\" : \"bg-muted/50\")}>\n                        <Icon className={cn(\"h-6 w-6\", isSelected ? \"text-primary\" : \"text-muted-foreground\")} />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-semibold text-sm\">{t(opt.labelKey)}</p>\n                        <p className=\"text-xs text-muted-foreground mt-0.5\">{t(opt.descKey)}</p>\n                      </div>\n                      {isSelected && <Check className=\"h-5 w-5 text-primary shrink-0\" />}\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n            <Button\n              className=\"w-full\"\n              disabled={!activityLevel}\n              onClick={() => setStep(\"allergy\")}\n              data-testid=\"button-next-activity\"\n            >\n              {t(\"questNext\")} <NextArrow className=\"h-4 w-4 ms-1\" />\n            </Button>\n          </div>\n        )}\n\n        {step === \"allergy\" && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n              <Button variant=\"ghost\" size=\"icon\" onClick={() => setStep(\"activity\")} data-testid=\"button-back-allergy\">\n                <BackArrow className=\"h-5 w-5\" />\n              </Button>\n              <span className=\"text-xs text-muted-foreground\">{t(\"questStep\")} 2 {t(\"questOf\")} 5</span>\n            </div>\n            <div className=\"text-center space-y-1\">\n              <h2 className=\"text-xl font-bold\" data-testid=\"text-allergy-title\">{t(\"questAllergyTitle\")}</h2>\n            </div>\n            <div className=\"space-y-3\">\n              <Card\n                className={cn(\n                  \"cursor-pointer transition-colors\",\n                  hasAllergies === true && \"border-primary bg-primary/5\"\n                )}\n                onClick={() => setHasAllergies(true)}\n                data-testid=\"card-allergy-yes\"\n              >\n                <CardContent className=\"p-4 flex items-center justify-between gap-4\">\n                  <span className=\"font-semibold text-sm\">{t(\"questAllergyYes\")}</span>\n                  <div className={cn(\"p-1.5 rounded-full\", hasAllergies === true ? \"bg-primary/10\" : \"bg-muted/50\")}>\n                    <Check className={cn(\"h-5 w-5\", hasAllergies === true ? \"text-primary\" : \"text-muted-foreground\")} />\n                  </div>\n                </CardContent>\n              </Card>\n              <Card\n                className={cn(\n                  \"cursor-pointer transition-colors\",\n                  hasAllergies === false && \"border-primary bg-primary/5\"\n                )}\n                onClick={() => { setHasAllergies(false); setSelectedAllergies([]); }}\n                data-testid=\"card-allergy-no\"\n              >\n                <CardContent className=\"p-4 flex items-center justify-between gap-4\">\n                  <span className=\"font-semibold text-sm\">{t(\"questAllergyNo\")}</span>\n                  <div className={cn(\"p-1.5 rounded-full\", hasAllergies === false ? \"bg-primary/10\" : \"bg-muted/50\")}>\n                    <X className={cn(\"h-5 w-5\", hasAllergies === false ? \"text-primary\" : \"text-muted-foreground\")} />\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n            <Button\n              className=\"w-full\"\n              disabled={hasAllergies === null}\n              onClick={() => setStep(hasAllergies ? \"allergySelect\" : \"proteinPref\")}\n              data-testid=\"button-next-allergy\"\n            >\n              {t(\"questNext\")} <NextArrow className=\"h-4 w-4 ms-1\" />\n            </Button>\n          </div>\n        )}\n\n        {step === \"allergySelect\" && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n              <Button variant=\"ghost\" size=\"icon\" onClick={() => setStep(\"allergy\")} data-testid=\"button-back-allergySelect\">\n                <BackArrow className=\"h-5 w-5\" />\n              </Button>\n              <span className=\"text-xs text-muted-foreground\">{t(\"questStep\")} 2 {t(\"questOf\")} 5</span>\n            </div>\n            <div className=\"text-center space-y-1\">\n              <h2 className=\"text-xl font-bold\" data-testid=\"text-allergySelect-title\">{t(\"questAllergyWhich\")}</h2>\n            </div>\n            <div className=\"flex flex-wrap gap-2 justify-center\">\n              {ALLERGY_OPTIONS.map(opt => {\n                const isSelected = selectedAllergies.includes(opt.key);\n                return (\n                  <Badge\n                    key={opt.key}\n                    variant={isSelected ? \"default\" : \"outline\"}\n                    className={cn(\n                      \"cursor-pointer px-4 py-2 text-sm\",\n                      isSelected && \"bg-primary text-primary-foreground\"\n                    )}\n                    onClick={() => handleAllergyToggle(opt.key)}\n                    data-testid={`badge-allergy-${opt.key}`}\n                  >\n                    {t(opt.labelKey)}\n                  </Badge>\n                );\n              })}\n            </div>\n            <Button\n              className=\"w-full\"\n              onClick={() => setStep(\"proteinPref\")}\n              data-testid=\"button-next-allergySelect\"\n            >\n              {t(\"questContinue\")}\n            </Button>\n          </div>\n        )}\n\n        {step === \"proteinPref\" && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n              <Button variant=\"ghost\" size=\"icon\" onClick={() => setStep(hasAllergies ? \"allergySelect\" : \"allergy\")} data-testid=\"button-back-proteinPref\">\n                <BackArrow className=\"h-5 w-5\" />\n              </Button>\n              <span className=\"text-xs text-muted-foreground\">{t(\"questStep\")} 3 {t(\"questOf\")} 5</span>\n            </div>\n            <div className=\"text-center space-y-1\">\n              <h2 className=\"text-xl font-bold\" data-testid=\"text-proteinPref-title\">{t(\"questProteinTitle\")}</h2>\n              <p className=\"text-sm text-muted-foreground\">{t(\"questProteinSubtitle\")}</p>\n            </div>\n            <div className=\"flex flex-wrap gap-2 justify-center\">\n              {proteinOptions.map(opt => {\n                const isSelected = selectedProteins.includes(opt.key);\n                return (\n                  <Badge\n                    key={opt.key}\n                    variant={isSelected ? \"default\" : \"outline\"}\n                    className={cn(\"cursor-pointer text-sm py-2 px-4\", isSelected && \"bg-primary\")}\n                    onClick={() => handleProteinToggle(opt.key)}\n                    data-testid={`badge-protein-${opt.key}`}\n                  >\n                    {isSelected && <Check className=\"h-3 w-3 me-1\" />}\n                    {t(opt.labelKey)}\n                  </Badge>\n                );\n              })}\n            </div>\n            <Button\n              className=\"w-full\"\n              disabled={selectedProteins.length === 0}\n              onClick={() => setStep(\"carbPref\")}\n              data-testid=\"button-next-proteinPref\"\n            >\n              {t(\"questNext\")} <NextArrow className=\"h-4 w-4 ms-1\" />\n            </Button>\n          </div>\n        )}\n\n        {step === \"carbPref\" && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n              <Button variant=\"ghost\" size=\"icon\" onClick={() => setStep(\"proteinPref\")} data-testid=\"button-back-carbPref\">\n                <BackArrow className=\"h-5 w-5\" />\n              </Button>\n              <span className=\"text-xs text-muted-foreground\">{t(\"questStep\")} 4 {t(\"questOf\")} 5</span>\n            </div>\n            <div className=\"text-center space-y-1\">\n              <h2 className=\"text-xl font-bold\" data-testid=\"text-carbPref-title\">{t(\"questCarbTitle\")}</h2>\n              <p className=\"text-sm text-muted-foreground\">{t(\"questCarbSubtitle\")}</p>\n            </div>\n            <div className=\"flex flex-wrap gap-2 justify-center\">\n              {carbOptions.map(opt => {\n                const isSelected = selectedCarbs.includes(opt.key);\n                return (\n                  <Badge\n                    key={opt.key}\n                    variant={isSelected ? \"default\" : \"outline\"}\n                    className={cn(\"cursor-pointer text-sm py-2 px-4\", isSelected && \"bg-primary\")}\n                    onClick={() => handleCarbToggle(opt.key)}\n                    data-testid={`badge-carb-${opt.key}`}\n                  >\n                    {isSelected && <Check className=\"h-3 w-3 me-1\" />}\n                    {t(opt.labelKey)}\n                  </Badge>\n                );\n              })}\n            </div>\n            <Button\n              className=\"w-full\"\n              disabled={selectedCarbs.length === 0}\n              onClick={() => setStep(\"preference\")}\n              data-testid=\"button-next-carbPref\"\n            >\n              {t(\"questNext\")} <NextArrow className=\"h-4 w-4 ms-1\" />\n            </Button>\n          </div>\n        )}\n\n        {step === \"preference\" && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n              <Button variant=\"ghost\" size=\"icon\" onClick={() => setStep(\"carbPref\")} data-testid=\"button-back-preference\">\n                <BackArrow className=\"h-5 w-5\" />\n              </Button>\n              <span className=\"text-xs text-muted-foreground\">{t(\"questStep\")} 5 {t(\"questOf\")} 5</span>\n            </div>\n            <div className=\"text-center space-y-1\">\n              <h2 className=\"text-xl font-bold\" data-testid=\"text-preference-title\">{t(\"questPreferenceTitle\")}</h2>\n            </div>\n            <div className=\"space-y-3\">\n              {preferenceOptions.map(opt => {\n                const Icon = opt.icon;\n                const isSelected = mealPreference === opt.key;\n                return (\n                  <Card\n                    key={opt.key}\n                    className={cn(\n                      \"cursor-pointer transition-colors\",\n                      isSelected && \"border-primary bg-primary/5\"\n                    )}\n                    onClick={() => setMealPreference(opt.key)}\n                    data-testid={`card-preference-${opt.key}`}\n                  >\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-start gap-3\">\n                        <div className={cn(\"p-2 rounded-lg shrink-0\", isSelected ? \"bg-primary/10\" : \"bg-muted/50\")}>\n                          <Icon className={cn(\"h-5 w-5\", isSelected ? \"text-primary\" : \"text-muted-foreground\")} />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2 flex-wrap\">\n                            <p className=\"font-semibold text-sm\">{t(opt.labelKey)}</p>\n                            {opt.recommended && (\n                              <Badge variant=\"secondary\" className=\"text-[10px]\">{t(\"recommended\")}</Badge>\n                            )}\n                          </div>\n                          <p className=\"text-xs text-muted-foreground mt-0.5\">{t(opt.descKey)}</p>\n                          {opt.macroRanges && (\n                            <div className=\"flex items-center gap-3 mt-2\">\n                              <div className=\"flex-1 h-2 rounded-full bg-muted overflow-hidden flex\">\n                                <div className=\"bg-red-400 dark:bg-red-500\" style={{ width: opt.macroRanges.protein.split(\"-\")[0] + \"%\" }} />\n                                <div className=\"bg-amber-400 dark:bg-amber-500\" style={{ width: opt.macroRanges.carbs.split(\"-\")[0] + \"%\" }} />\n                                <div className=\"bg-blue-400 dark:bg-blue-500\" style={{ width: opt.macroRanges.fats.split(\"-\")[0] + \"%\" }} />\n                              </div>\n                            </div>\n                          )}\n                          {opt.macroRanges && (\n                            <div className=\"flex justify-between mt-1 text-[10px] text-muted-foreground\">\n                              <span>{opt.macroRanges.protein} {t(\"protein\")}</span>\n                              <span>{opt.macroRanges.carbs} {t(\"carbs\")}</span>\n                              <span>{opt.macroRanges.fats} {t(\"fats\")}</span>\n                            </div>\n                          )}\n                        </div>\n                        {isSelected && <Check className=\"h-5 w-5 text-primary shrink-0 mt-1\" />}\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n            <Button\n              className=\"w-full\"\n              disabled={!mealPreference || generateMutation.isPending}\n              onClick={handleFinishQuestionnaire}\n              data-testid=\"button-generate-diet\"\n            >\n              {generateMutation.isPending ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 me-2 animate-spin\" />\n                  {t(\"generatingDietPlan\")}\n                </>\n              ) : (\n                <>\n                  <Salad className=\"h-4 w-4 me-2\" />\n                  {t(\"generateDietPlan\")}\n                </>\n              )}\n            </Button>\n            {generateMutation.isError && (\n              <p className=\"text-sm text-destructive text-center\" data-testid=\"text-diet-error\">\n                {t(\"dietPlanError\")}\n              </p>\n            )}\n          </div>\n        )}\n\n        {step === \"generating\" && (\n          <Card>\n            <CardContent className=\"py-12 text-center space-y-4\">\n              <Loader2 className=\"h-10 w-10 animate-spin text-primary mx-auto\" data-testid=\"loading-diet\" />\n              <p className=\"text-sm text-muted-foreground font-medium\">{t(\"generatingDietPlan\")}</p>\n              <div className=\"flex items-center justify-center gap-2 mt-4 px-4\">\n                <Info className=\"h-4 w-4 text-primary shrink-0\" />\n                <p className=\"text-xs text-muted-foreground\" data-testid=\"text-exit-note\">\n                  {t(\"canExitWhileGenerating\")}\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  }\n\n  if (plan) {\n    const mealSections = [\n      { key: \"breakfast\", icon: Coffee, label: t(\"breakfast\"), items: plan.mealPlan.breakfast },\n      { key: \"lunch\", icon: Sun, label: t(\"lunch\"), items: plan.mealPlan.lunch },\n      { key: \"dinner\", icon: Moon, label: t(\"dinner\"), items: plan.mealPlan.dinner },\n      { key: \"snacks\", icon: Apple, label: t(\"snacks\"), items: plan.mealPlan.snacks },\n    ];\n\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center gap-2\">\n          <Salad className=\"h-5 w-5 text-primary\" />\n          <h2 className=\"text-lg font-bold\" data-testid=\"text-diet-title\">{t(\"dietPlan\")}</h2>\n        </div>\n\n        <Card className=\"border-amber-300 dark:border-amber-700/50 bg-amber-50/50 dark:bg-amber-950/20\" data-testid=\"card-nutrition-disclaimer\">\n          <CardContent className=\"p-4 space-y-2\">\n            <div className=\"flex items-center gap-2\">\n              <ShieldAlert className=\"h-5 w-5 text-amber-600 dark:text-amber-400 shrink-0\" />\n              <span className=\"text-sm font-semibold text-amber-800 dark:text-amber-300\">{t(\"disclaimerTitle\")}</span>\n            </div>\n            <p className=\"text-sm text-amber-900/80 dark:text-amber-200/70 leading-relaxed\">\n              {t(\"nutritionDisclaimer\")}\n            </p>\n          </CardContent>\n        </Card>\n\n        {plan.healthSummary && (\n          <Card data-testid=\"section-health-summary\">\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Stethoscope className=\"h-4 w-4 text-primary\" />\n                {t(\"healthSummaryTitle\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0\">\n              <p className=\"text-sm leading-relaxed text-muted-foreground\" data-testid=\"text-health-summary\">{plan.healthSummary}</p>\n            </CardContent>\n          </Card>\n        )}\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <p className=\"text-sm leading-relaxed\" data-testid=\"text-diet-summary\">{plan.summary}</p>\n            {plan.goalDescription && (\n              <div className=\"mt-2 flex items-start gap-2\">\n                <Target className=\"h-4 w-4 text-primary mt-0.5 shrink-0\" />\n                <p className=\"text-sm text-muted-foreground\">{plan.goalDescription}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\" data-testid=\"section-calories-macros\">\n          <Card>\n            <CardContent className=\"p-4 text-center\">\n              <Flame className=\"h-5 w-5 text-orange-500 mx-auto mb-1\" />\n              <p className=\"text-xs text-muted-foreground\">{t(\"targetCalories\")}</p>\n              <p className=\"text-xl font-bold\" data-testid=\"text-target-calories\">{plan.calories.target}</p>\n              <p className=\"text-xs text-muted-foreground\">{t(\"kcalPerDay\")}</p>\n              {plan.calories.deficit_or_surplus !== 0 && (\n                <Badge variant={plan.calories.deficit_or_surplus < 0 ? \"destructive\" : \"secondary\"} className=\"mt-1 text-xs\">\n                  {plan.calories.deficit_or_surplus > 0 ? \"+\" : \"\"}{plan.calories.deficit_or_surplus} {t(\"kcal\")}\n                </Badge>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4 text-center\">\n              <div className=\"flex items-center justify-center gap-4\">\n                <div className=\"text-center\">\n                  <Beef className=\"h-4 w-4 text-red-500 mx-auto mb-0.5\" />\n                  <p className=\"text-xs text-muted-foreground\">{t(\"protein\")}</p>\n                  <p className=\"text-sm font-bold\" data-testid=\"text-protein\">{plan.macros.protein.grams}{t(\"gram\")}</p>\n                  <p className=\"text-[10px] text-muted-foreground\">{plan.macros.protein.percentage}%</p>\n                </div>\n                <div className=\"text-center\">\n                  <Wheat className=\"h-4 w-4 text-amber-500 mx-auto mb-0.5\" />\n                  <p className=\"text-xs text-muted-foreground\">{t(\"carbs\")}</p>\n                  <p className=\"text-sm font-bold\" data-testid=\"text-carbs\">{plan.macros.carbs.grams}{t(\"gram\")}</p>\n                  <p className=\"text-[10px] text-muted-foreground\">{plan.macros.carbs.percentage}%</p>\n                </div>\n                <div className=\"text-center\">\n                  <Droplets className=\"h-4 w-4 text-blue-500 mx-auto mb-0.5\" />\n                  <p className=\"text-xs text-muted-foreground\">{t(\"fats\")}</p>\n                  <p className=\"text-sm font-bold\" data-testid=\"text-fats\">{plan.macros.fats.grams}{t(\"gram\")}</p>\n                  <p className=\"text-[10px] text-muted-foreground\">{plan.macros.fats.percentage}%</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4 text-center\">\n              <Target className=\"h-5 w-5 text-primary mx-auto mb-1\" />\n              <p className=\"text-xs text-muted-foreground\">{t(\"bmr\")}</p>\n              <p className=\"text-lg font-bold\" data-testid=\"text-bmr\">{plan.calories.bmr}</p>\n              <p className=\"text-xs text-muted-foreground mt-1\">{t(\"tdee\")}: {plan.calories.tdee}</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {plan.intakeAlignment && (\n          <Card data-testid=\"section-intake-alignment\">\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <TrendingUp className=\"h-4 w-4 text-primary\" />\n                {t(\"intakeAlignmentTitle\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0\">\n              <p className=\"text-sm leading-relaxed text-muted-foreground\" data-testid=\"text-intake-alignment\">{plan.intakeAlignment}</p>\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.warnings.length > 0 && (\n          <Card className=\"border-orange-200 dark:border-orange-800/40\">\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2 text-orange-600 dark:text-orange-400\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                {t(\"doctorFollowUp\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0\">\n              <ul className=\"space-y-1\">\n                {plan.warnings.map((w, i) => (\n                  <li key={i} className=\"text-sm text-muted-foreground flex items-start gap-2\">\n                    <span className=\"mt-1.5 h-1.5 w-1.5 rounded-full bg-orange-500 shrink-0\" />\n                    {w}\n                  </li>\n                ))}\n              </ul>\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.deficiencies.length > 0 && (\n          <Card>\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <ArrowDown className=\"h-4 w-4 text-primary\" />\n                {t(\"deficiencies\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0 space-y-3\">\n              {plan.deficiencies.map((d, i) => (\n                <div key={i} className=\"rounded-md bg-muted/50 p-3\">\n                  <div className=\"flex items-center justify-between gap-2 mb-1 flex-wrap\">\n                    <span className=\"font-semibold text-sm\">{d.name}</span>\n                    <div className=\"flex items-center gap-1\">\n                      <Badge variant=\"destructive\" className=\"text-xs\">{d.current}</Badge>\n                      <span className=\"text-xs text-muted-foreground\">{isArabic ? \"\\u2190\" : \"\\u2192\"}</span>\n                      <Badge variant=\"secondary\" className=\"text-xs\">{d.target}</Badge>\n                    </div>\n                  </div>\n                  <div className=\"flex flex-wrap gap-1 mt-2\">\n                    {d.foods.map((food, fi) => (\n                      <Badge key={fi} variant=\"outline\" className=\"text-xs\">{food}</Badge>\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.supplements && plan.supplements.length > 0 && (\n          <Card data-testid=\"section-supplements\">\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Pill className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                {t(\"supplementsTitle\")}\n              </CardTitle>\n              <p className=\"text-[11px] text-muted-foreground mt-1\">{t(\"supplementsDisclaimer\")}</p>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0 space-y-3\">\n              {plan.supplements.map((s, i) => (\n                <div key={i} className=\"rounded-md bg-muted/50 p-3 space-y-2\" data-testid={`supplement-item-${i}`}>\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <p className=\"font-semibold text-sm\">{s.name}</p>\n                    <Badge variant=\"outline\" className=\"text-xs\">{s.dosage}</Badge>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">{s.reason}</p>\n                  {s.targetLabValue && (\n                    <div className=\"flex items-center gap-1.5\">\n                      <Target className=\"h-3 w-3 text-blue-500 shrink-0\" />\n                      <p className=\"text-xs text-blue-600 dark:text-blue-400\">{t(\"supplementTarget\")}: {s.targetLabValue}</p>\n                    </div>\n                  )}\n                  <div className=\"flex items-center gap-1.5\">\n                    <Pill className=\"h-3 w-3 text-green-500 shrink-0\" />\n                    <p className=\"text-xs text-green-600 dark:text-green-400\">{t(\"supplementDuration\")}: {s.duration}</p>\n                  </div>\n                  {s.foodSources && s.foodSources.length > 0 && (\n                    <div className=\"mt-1 space-y-1\">\n                      <div className=\"flex items-center gap-1.5\">\n                        <UtensilsCrossed className=\"h-3 w-3 text-orange-500 shrink-0\" />\n                        <p className=\"text-xs font-medium\">{t(\"supplementFoodSources\")}</p>\n                      </div>\n                      <div className=\"ps-5 space-y-0.5\">\n                        {s.foodSources.map((food, fi) => (\n                          <p key={fi} className=\"text-[11px] text-muted-foreground\">- {food}</p>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                  {s.scientificBasis && (\n                    <div className=\"flex items-center gap-1.5 mt-1\">\n                      <Beaker className=\"h-3 w-3 text-purple-500 shrink-0\" />\n                      <p className=\"text-[11px] text-purple-600 dark:text-purple-400\">{s.scientificBasis}</p>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"flex items-center gap-2 rounded-md bg-primary/10 p-3\" data-testid=\"note-choose-one-meal\">\n          <Info className=\"h-4 w-4 text-primary shrink-0\" />\n          <p className=\"text-xs font-medium text-primary\">{t(\"chooseOneMealNote\")}</p>\n        </div>\n\n        {mealSections.map((section) => (\n          <Card key={section.key}>\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <section.icon className=\"h-4 w-4 text-primary\" />\n                {section.label}\n                {section.key !== \"snacks\" && section.items.length > 1 && (\n                  <Badge variant=\"outline\" className=\"text-[10px] ms-auto\">{section.items.length} {t(\"mealOption\")}</Badge>\n                )}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0 space-y-2\">\n              {section.items.map((item, i) => (\n                <div key={i} className=\"rounded-md bg-muted/50 p-3\">\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <div className=\"flex items-center gap-2\">\n                      {section.key !== \"snacks\" && section.items.length > 1 && (\n                        <Badge variant=\"outline\" className=\"text-[10px]\">{t(\"mealOption\")} {i + 1}</Badge>\n                      )}\n                      <p className=\"font-semibold text-sm\">{item.name}</p>\n                    </div>\n                    {item.calories > 0 && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        <Flame className=\"h-3 w-3 me-1 text-orange-500\" />\n                        {item.calories} {t(\"kcal\")}\n                      </Badge>\n                    )}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-0.5\">{item.description}</p>\n                  {(item.protein > 0 || item.carbs > 0 || item.fats > 0) && (\n                    <div className=\"flex items-center gap-3 mt-1.5 flex-wrap\" data-testid={`macros-${section.key}-${i}`}>\n                      <span className=\"text-[11px] text-blue-600 dark:text-blue-400 font-medium\">{t(\"protein\")}: {item.protein}{t(\"gram\")}</span>\n                      <span className=\"text-[11px] text-amber-600 dark:text-amber-400 font-medium\">{t(\"carbs\")}: {item.carbs}{t(\"gram\")}</span>\n                      <span className=\"text-[11px] text-rose-600 dark:text-rose-400 font-medium\">{t(\"fats\")}: {item.fats}{t(\"gram\")}</span>\n                    </div>\n                  )}\n                  <p className=\"text-xs text-green-600 dark:text-green-400 mt-1\">{item.benefits}</p>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        ))}\n\n        {plan.conditionTips && plan.conditionTips.length > 0 && (\n          <Card>\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Heart className=\"h-4 w-4 text-primary\" />\n                {t(\"conditionBasedTips\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0 space-y-4\">\n              {plan.conditionTips.map((ct, i) => (\n                <div key={i} className=\"rounded-md bg-muted/50 p-3 space-y-2\">\n                  <p className=\"font-semibold text-sm\">{ct.condition}</p>\n                  <ul className=\"space-y-1\">\n                    {ct.advice.map((a, ai) => (\n                      <li key={ai} className=\"text-sm flex items-start gap-2\">\n                        <Lightbulb className=\"h-3.5 w-3.5 text-yellow-500 mt-0.5 shrink-0\" />\n                        {a}\n                      </li>\n                    ))}\n                  </ul>\n                  {ct.avoidFoods.length > 0 && (\n                    <div>\n                      <p className=\"text-xs font-medium text-orange-600 dark:text-orange-400 flex items-center gap-1 mb-1\">\n                        <Ban className=\"h-3 w-3\" />\n                        {t(\"reduceFoods\")}\n                      </p>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {ct.avoidFoods.map((f, fi) => (\n                          <Badge key={fi} variant=\"outline\" className=\"text-xs\">{f}</Badge>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.tips.length > 0 && (\n          <Card>\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Lightbulb className=\"h-4 w-4 text-yellow-500\" />\n                {t(\"dietTips\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0\">\n              <ul className=\"space-y-1\">\n                {plan.tips.map((tip, i) => (\n                  <li key={i} className=\"text-sm flex items-start gap-2\">\n                    <span className=\"mt-1.5 h-1.5 w-1.5 rounded-full bg-primary shrink-0\" />\n                    {tip}\n                  </li>\n                ))}\n              </ul>\n            </CardContent>\n          </Card>\n        )}\n\n        {plan.references && plan.references.length > 0 && (\n          <Card data-testid=\"section-references\">\n            <CardHeader className=\"pb-2 p-4\">\n              <CardTitle className=\"text-sm flex items-center gap-2 text-muted-foreground\">\n                <BookOpen className=\"h-4 w-4\" />\n                {t(\"referencesTitle\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0\">\n              <ul className=\"space-y-1\">\n                {plan.references.map((ref, i) => (\n                  <li key={i} className=\"text-xs text-muted-foreground flex items-start gap-2\">\n                    <span className=\"mt-1 text-[10px] font-mono shrink-0\">[{i + 1}]</span>\n                    {ref}\n                  </li>\n                ))}\n              </ul>\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"flex flex-col items-center gap-2 pb-4\">\n          <Button\n            onClick={() => plan && exportMutation.mutate(plan)}\n            disabled={exportMutation.isPending}\n            className=\"w-full max-w-xs\"\n            data-testid=\"button-export-diet\"\n          >\n            {exportMutation.isPending ? (\n              <Loader2 className=\"h-4 w-4 me-2 animate-spin\" />\n            ) : (\n              <Save className=\"h-4 w-4 me-2\" />\n            )}\n            {t(\"exportToDietSchedule\")}\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={() => {\n              setPlan(null);\n              startQuestionnaire();\n            }}\n            disabled={generateMutation.isPending}\n            className=\"w-full max-w-xs\"\n            data-testid=\"button-regenerate-diet\"\n          >\n            <RefreshCw className=\"h-4 w-4 me-2\" />\n            {t(\"regenerateDietPlan\")}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center gap-2\">\n        <Salad className=\"h-5 w-5 text-primary\" />\n        <h2 className=\"text-lg font-bold\" data-testid=\"text-diet-title\">{t(\"dietPlan\")}</h2>\n      </div>\n\n      <Card>\n        <CardContent className=\"py-8 text-center space-y-4\">\n          <Salad className=\"h-12 w-12 text-primary mx-auto\" />\n          <div>\n            <p className=\"font-semibold text-base\" data-testid=\"text-diet-intro\">\n              {t(\"dietPlanIntro\")}\n            </p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              {t(\"dietPlanDescription\")}\n            </p>\n            {profile?.fitnessGoal && (\n              <div className=\"mt-3 flex items-center justify-center gap-2\">\n                <Target className=\"h-4 w-4 text-primary\" />\n                <span className=\"text-sm font-medium\">{t(\"fitnessGoal\")}:</span>\n                <Badge variant=\"secondary\" data-testid=\"badge-current-goal\">\n                  {goalLabels[profile.fitnessGoal] || profile.fitnessGoal}\n                </Badge>\n              </div>\n            )}\n          </div>\n          <Button onClick={startQuestionnaire} data-testid=\"button-start-diet\">\n            <Salad className=\"h-4 w-4 me-2\" />\n            {t(\"generateDietPlan\")}\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":46579,"size_tokens":null},"client/src/components/RemindersCard.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Bell, Calendar, Clock } from \"lucide-react\";\nimport { format, formatDistanceToNow, isPast, isFuture } from \"date-fns\";\nimport type { Locale as DateLocale } from \"date-fns\";\nimport { arSA, enUS } from \"date-fns/locale\";\n\ninterface Reminder {\n  id: string;\n  testName: string;\n  testNameAr: string;\n  dueDate: Date;\n  sent: boolean;\n}\n\ninterface RemindersCardProps {\n  reminders: Reminder[];\n  isLoading?: boolean;\n}\n\nexport function RemindersCard({ reminders, isLoading }: RemindersCardProps) {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n  const dateLocale = isArabic ? arSA : enUS;\n\n  const sortedReminders = [...reminders].sort(\n    (a, b) => new Date(a.dueDate).getTime() - new Date(b.dueDate).getTime()\n  );\n\n  const upcomingReminders = sortedReminders.filter(r => isFuture(new Date(r.dueDate)) && !r.sent);\n  const overdueReminders = sortedReminders.filter(r => isPast(new Date(r.dueDate)) && !r.sent);\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Bell className=\"h-5 w-5\" />\n          {t(\"upcomingReminders\")}\n          {(upcomingReminders.length + overdueReminders.length) > 0 && (\n            <Badge variant=\"secondary\" className=\"ms-auto\">\n              {upcomingReminders.length + overdueReminders.length}\n            </Badge>\n          )}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"flex justify-center py-8\">\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n          </div>\n        ) : sortedReminders.length === 0 ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <Bell className=\"h-10 w-10 mx-auto mb-2 opacity-20\" />\n            <p>{t(\"noReminders\")}</p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {overdueReminders.map((reminder) => (\n              <ReminderItem \n                key={reminder.id} \n                reminder={reminder} \n                isArabic={isArabic}\n                dateLocale={dateLocale}\n                isOverdue\n              />\n            ))}\n            {upcomingReminders.map((reminder) => (\n              <ReminderItem \n                key={reminder.id} \n                reminder={reminder} \n                isArabic={isArabic}\n                dateLocale={dateLocale}\n              />\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction ReminderItem({ \n  reminder, \n  isArabic, \n  dateLocale,\n  isOverdue \n}: { \n  reminder: Reminder; \n  isArabic: boolean; \n  dateLocale: DateLocale;\n  isOverdue?: boolean;\n}) {\n  const dueDate = new Date(reminder.dueDate);\n  \n  return (\n    <div \n      className={`flex items-center gap-3 p-3 rounded-lg border ${\n        isOverdue \n          ? \"bg-red-50 border-red-200 dark:bg-red-950/20 dark:border-red-800\" \n          : \"bg-muted/50\"\n      }`}\n      data-testid={`reminder-${reminder.id}`}\n    >\n      <div className={`p-2 rounded-lg ${\n        isOverdue \n          ? \"bg-red-100 dark:bg-red-900/30\" \n          : \"bg-primary/10\"\n      }`}>\n        <Clock className={`h-4 w-4 ${isOverdue ? \"text-red-600 dark:text-red-400\" : \"text-primary\"}`} />\n      </div>\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"font-medium truncate\">\n          {isArabic ? reminder.testNameAr : reminder.testName}\n        </p>\n        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n          <Calendar className=\"h-3 w-3\" />\n          <span>{format(dueDate, \"PP\", { locale: dateLocale })}</span>\n          <span className=\"text-xs\">\n            ({formatDistanceToNow(dueDate, { addSuffix: true, locale: dateLocale })})\n          </span>\n        </div>\n      </div>\n      {isOverdue && (\n        <Badge variant=\"destructive\" className=\"shrink-0\">\n          Overdue\n        </Badge>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":4124,"size_tokens":null},"client/src/lib/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\nconst resources = {\n  en: {\n    translation: {\n      // App\n      appName: \"BioTrack AI\",\n      appDescription: \"AI-Powered Health Analysis\",\n      companyName: \"by Alshira company\",\n      warning: \"Warning\",\n      appPurpose: \"This app is for health tracking and awareness purposes only.\",\n      medicalDisclaimer: \"This app does not replace professional medical advice. Always consult a healthcare provider.\",\n      \n      // Navigation\n      dashboard: \"Dashboard\",\n      myTests: \"My Tests\",\n      uploadPdf: \"Upload PDF\",\n      profile: \"Profile\",\n      reminders: \"Reminders\",\n      subscription: \"Subscription\",\n      logout: \"Logout\",\n      login: \"Login\",\n      \n      // Dashboard\n      welcomeBack: \"Welcome back\",\n      totalTests: \"Total Tests\",\n      normalTests: \"Normal\",\n      abnormalTests: \"Abnormal\",\n      pendingReminders: \"Pending Reminders\",\n      recentUploads: \"Recent Uploads\",\n      quickStats: \"Quick Stats\",\n      \n      // Tests\n      testName: \"Test Name\",\n      yourValue: \"Your Value\",\n      normalRange: \"Normal Range\",\n      testDate: \"Test Date\",\n      status: \"Status\",\n      category: \"Category\",\n      normal: \"Normal\",\n      low: \"Low\",\n      high: \"High\",\n      slightlyHigh: \"Slightly High\",\n      slightlyLow: \"Slightly Low\",\n      \n      // Categories\n      vitamins: \"Vitamins\",\n      minerals: \"Minerals\",\n      hormones: \"Hormones\",\n      organ_functions: \"Organ Functions\",\n      lipids: \"Lipids\",\n      immunity: \"Immunity\",\n      blood: \"Blood Tests\",\n      coagulation: \"Coagulation\",\n      special: \"Special Tests\",\n      \n      // Sorting\n      sortBy: \"Sort by\",\n      importance: \"Importance\",\n      newest: \"Newest\",\n      oldest: \"Oldest\",\n      byStatus: \"By Status\",\n      byCategory: \"By Category\",\n      \n      // Upload\n      uploadTitle: \"Upload Lab Results\",\n      uploadDescription: \"Upload your PDF lab results and our AI will analyze them\",\n      dropzone: \"Drop PDF here or click to upload\",\n      processing: \"Processing...\",\n      analysisComplete: \"Analysis Complete\",\n      testsFound: \"tests found\",\n      \n      // Profile\n      personalInfo: \"Personal Information\",\n      name: \"Name\",\n      email: \"Email\",\n      phone: \"Phone\",\n      age: \"Age\",\n      weight: \"Weight (kg)\",\n      height: \"Height (cm)\",\n      gender: \"Gender\",\n      male: \"Male\",\n      female: \"Female\",\n      changePhoto: \"Change Photo\",\n      saveChanges: \"Save Changes\",\n      \n      // Subscription\n      currentPlan: \"Current Plan\",\n      freePlan: \"Free Plan\",\n      basicPlan: \"Basic Plan\",\n      premiumPlan: \"Premium Plan\",\n      filesUsed: \"Files Used\",\n      filesLimit: \"files limit\",\n      unlimited: \"Unlimited\",\n      upgrade: \"Upgrade\",\n      \n      // Reminders\n      upcomingReminders: \"Upcoming Reminders\",\n      dueDate: \"Due Date\",\n      noReminders: \"No upcoming reminders\",\n      \n      // Levels\n      level1: \"Level 1: Essential Tests\",\n      level2: \"Level 2: General Health\",\n      level3: \"Level 3: Hormones & Performance\",\n      level4: \"Level 4: Immunity & Inflammation\",\n      level5: \"Level 5: Advanced Vitamins & Minerals\",\n      level6: \"Level 6: Heart & Coagulation\",\n      level7: \"Level 7: Special Tests\",\n      \n      // Common\n      loading: \"Loading...\",\n      error: \"Error\",\n      success: \"Success\",\n      cancel: \"Cancel\",\n      confirm: \"Confirm\",\n      noData: \"No data available\",\n      years: \"years\",\n      pending: \"Pending\",\n      testsCompleted: \"tests completed\",\n      abnormal: \"abnormal\",\n      defaultOrder: \"Default Order\",\n      allCategories: \"All Categories\",\n      allStatuses: \"All Statuses\",\n      reminder: \"Reminder\",\n      setReminder: \"Set Reminder\",\n      reminderSet: \"Reminder Set\",\n      reminderSetDesc: \"You will be reminded on the selected date\",\n      reminderDeleted: \"Reminder Deleted\",\n      reminderError: \"Failed to set reminder\",\n      home: \"Home\",\n      upload: \"Upload\",\n      \n      // Uploaded Files History\n      uploadedFiles: \"Uploaded Files\",\n      processed: \"Processed\",\n      failed: \"Failed\",\n      testsExtracted: \"tests extracted\",\n      aiCouldNotRead: \"AI could not read this file\",\n      fileDeleted: \"File deleted successfully\",\n      deleteFileFailed: \"Failed to delete file\",\n      retry: \"Retry\",\n      retryFailed: \"Retry failed. Please try again.\",\n      pleaseUploadPdf: \"Please upload a PDF file\",\n      \n      // Compare\n      compare: \"Compare\",\n      compareResults: \"Compare Results\",\n      previousResult: \"Previous\",\n      latestResult: \"Latest\",\n      improved: \"Improved\",\n      worsened: \"Worsened\",\n      noChange: \"No Change\",\n      noComparisonData: \"No comparison data available\",\n      noComparisonHint: \"Upload two or more lab reports to compare your results over time\",\n\n      // Diet Plan\n      dietPlan: \"Diet Plan\",\n      dietPlanNav: \"Diet\",\n      dietPlanIntro: \"AI-Powered Personalized Diet Plan\",\n      dietPlanDescription: \"Based on your lab results, weight, height, and fitness goal, our AI will design a tailored nutrition plan\",\n      generateDietPlan: \"Generate Diet Plan\",\n      generatingDietPlan: \"Analyzing your health data and designing your diet plan...\",\n      canExitWhileGenerating: \"You can exit this page. We will notify you when your diet plan is ready.\",\n      dietPlanError: \"Failed to generate diet plan. Please try again.\",\n      regenerateDietPlan: \"Generate New Plan\",\n      breakfast: \"Breakfast\",\n      lunch: \"Lunch\",\n      dinner: \"Dinner\",\n      snacks: \"Snacks\",\n      deficiencies: \"Deficiencies to Address\",\n      dietTips: \"Dietary Tips\",\n      warnings: \"Important Warnings\",\n      targetCalories: \"Target Calories\",\n      kcalPerDay: \"kcal/day\",\n      kcal: \"kcal\",\n      protein: \"Protein\",\n      carbs: \"Carbs\",\n      fats: \"Fats\",\n      gram: \"g\",\n      bmr: \"Basal Metabolic Rate\",\n      tdee: \"TDEE\",\n      fitnessGoal: \"Fitness Goal\",\n      goalWeightLoss: \"Weight Loss\",\n      goalMaintain: \"Maintain Weight\",\n      goalMuscleGain: \"Muscle Gain (Lean)\",\n      disclaimerTitle: \"Important Notice\",\n      nutritionDisclaimer: \"This diet plan is provided for educational and awareness purposes only and does not constitute medical advice, diagnosis, or treatment. BioTrack AI and Alshira company bear no responsibility for any decisions made based on this information. Always consult your physician or a certified nutritionist before making any changes to your diet, especially if you have chronic conditions or take medications. Your health and safety are your top priority.\",\n      conditionBasedTips: \"Health-Specific Tips\",\n      avoidTheseFoods: \"Foods to Avoid\",\n      reduceFoods: \"Consider reducing\",\n      mealOption: \"Option\",\n      chooseOneMealNote: \"Choose one option per meal - rotate between options throughout the week for variety\",\n      supplementsTitle: \"Suggested Supplements\",\n      supplementsDisclaimer: \"These are general guidance only. Consult your doctor before starting any supplement.\",\n      supplementDuration: \"Duration\",\n      supplementTarget: \"Target Value\",\n      supplementFoodSources: \"Natural Food Sources\",\n      doctorFollowUp: \"Doctor Follow-up\",\n      healthSummaryTitle: \"Health Status Summary\",\n      intakeAlignmentTitle: \"Intake Alignment with Your Goal\",\n      referencesTitle: \"References & Sources\",\n      bmrSafetyNote: \"BMR is your minimum safe calorie threshold\",\n      deficitReduced: \"Deficit reduced due to nutritional deficiencies\",\n\n      // Questionnaire\n      questStep: \"Step\",\n      questOf: \"of\",\n      questNext: \"Next\",\n      questBack: \"Back\",\n      questActivityTitle: \"What is your activity level?\",\n      questActivitySubtitle: \"Consider your daily activities and exercise routine\",\n      activitySedentary: \"Sedentary\",\n      activitySedentaryDesc: \"You spend most of your day sitting with little or no exercise\",\n      activityLight: \"Lightly Active\",\n      activityLightDesc: \"Light daily activities or light exercise 1-3 times/week\",\n      activityVery: \"Very Active\",\n      activityVeryDesc: \"On your feet most of the day or exercise 3-5 times/week\",\n      activityExtreme: \"Extremely Active\",\n      activityExtremeDesc: \"Your work requires physical effort or intense exercise 5+ times/week\",\n      questAllergyTitle: \"Do you have any food allergies?\",\n      questAllergyYes: \"Yes\",\n      questAllergyNo: \"No\",\n      questAllergyWhich: \"Which of these ingredients are you allergic to?\",\n      allergyEggs: \"Eggs\",\n      allergyDairy: \"Dairy\",\n      allergyPeanuts: \"Peanuts\",\n      allergyNuts: \"Nuts\",\n      allergySeafood: \"Seafood\",\n      allergySoy: \"Soy\",\n      allergySesame: \"Sesame\",\n      allergyWheat: \"Wheat\",\n      allergyFish: \"Fish\",\n      questContinue: \"Continue\",\n      questProteinTitle: \"Which proteins do you prefer?\",\n      questProteinSubtitle: \"Select one or more protein sources you enjoy\",\n      proteinFish: \"Fish\",\n      proteinChicken: \"Chicken\",\n      proteinMeat: \"Red Meat\",\n      proteinVegetarian: \"Vegetarian (Legumes & Tofu)\",\n      questCarbTitle: \"Which carbs do you prefer?\",\n      questCarbSubtitle: \"Select one or more carbohydrate sources you enjoy\",\n      carbRice: \"Rice\",\n      carbBread: \"Bread\",\n      carbPasta: \"Pasta\",\n      carbOats: \"Oats\",\n      carbPotato: \"Potato\",\n      carbSweetPotato: \"Sweet Potato\",\n      carbQuinoa: \"Quinoa\",\n      carbBulgur: \"Bulgur\",\n      carbKeto: \"Keto (Nuts & Seeds)\",\n      carbCorn: \"Corn\",\n      carbBeans: \"Beans & Legumes\",\n      carbFruits: \"Fruits\",\n      questPreferenceTitle: \"What type of meals do you prefer?\",\n      prefHighProtein: \"High Protein\",\n      prefHighProteinDesc: \"Boosts strength and vitality with light, healthy proteins\",\n      prefBalanced: \"Balanced\",\n      prefBalancedDesc: \"Gives your body balanced nutrition for health and vitality\",\n      prefLowCarb: \"Low Carb\",\n      prefLowCarbDesc: \"Low carbohydrate meals, rich in healthy fats and vegetables\",\n      prefKeto: \"Keto\",\n      prefKetoDesc: \"Very low carb, high fat diet that puts the body in a state of ketosis\",\n      prefVegetarian: \"Vegetarian\",\n      prefVegetarianDesc: \"Healthy vegetarian dishes with colorful vegetables and nutritious grains\",\n      prefCustomMacros: \"Custom Macros\",\n      prefCustomMacrosDesc: \"Designed specifically for athletes and fitness enthusiasts\",\n      recommended: \"Recommended\",\n\n      // Sidebar menu\n      menuMyTests: \"My Tests\",\n      menuCompare: \"Compare Results\",\n      menuMyDietSchedule: \"My Diet Schedule\",\n      menuKnowledge: \"Knowledge Base\",\n\n      // My Diet Schedule\n      myDietSchedule: \"My Diet Schedule\",\n      noSavedPlans: \"No saved diet plans yet\",\n      noSavedPlansDesc: \"Generate a diet plan and export it here for easy access anytime\",\n      savedOn: \"Saved on\",\n      deletePlan: \"Delete\",\n      deleteConfirm: \"Are you sure you want to delete this saved plan?\",\n      exportToDietSchedule: \"Export to My Diet Schedule\",\n      exportSuccess: \"Diet plan saved to My Diet Schedule successfully\",\n      exportError: \"Failed to save diet plan\",\n      viewPlan: \"View Plan\",\n      hidePlan: \"Hide Plan\",\n      dietScheduleNote: \"The diet schedule should be changed every 3 weeks to 1 month for best results\",\n      plateauNote: \"If your weight plateaus for about 2 weeks, take a free/cheat meal to break the plateau and restart your metabolism\",\n      dietScheduleNotesTitle: \"Important Notes\",\n\n      // Share\n      shareResults: \"Share Results\",\n      shareSuccess: \"Shared successfully\",\n      copiedToClipboard: \"Copied to clipboard\",\n      copyFailed: \"Failed to copy\",\n      \n      // PDF Errors\n      scannedPdfError: \"This PDF appears to be scanned. Please upload a digital/text-based PDF.\",\n      analysisFailedError: \"Failed to analyze this file. Please try again.\",\n    }\n  },\n  ar: {\n    translation: {\n      // App\n      appName: \"BioTrack AI\",\n      appDescription: \"تحليل صحي مدعوم بالذكاء الاصطناعي\",\n      companyName: \"by Alshira company\",\n      warning: \"تحذير\",\n      appPurpose: \"هذا التطبيق لمتابعة الصحة ولأغراض التوعوية فقط.\",\n      medicalDisclaimer: \"لا يغني هذا التطبيق عن الاستشارة الطبية. استشر طبيبك دائماً.\",\n      \n      // Navigation\n      dashboard: \"لوحة التحكم\",\n      myTests: \"فحوصاتي\",\n      uploadPdf: \"رفع PDF\",\n      profile: \"الملف الشخصي\",\n      reminders: \"التذكيرات\",\n      subscription: \"الاشتراك\",\n      logout: \"تسجيل خروج\",\n      login: \"تسجيل دخول\",\n      \n      // Dashboard\n      welcomeBack: \"مرحباً بعودتك\",\n      totalTests: \"إجمالي الفحوصات\",\n      normalTests: \"طبيعي\",\n      abnormalTests: \"غير طبيعي\",\n      pendingReminders: \"تذكيرات قادمة\",\n      recentUploads: \"آخر الملفات\",\n      quickStats: \"إحصائيات سريعة\",\n      \n      // Tests\n      testName: \"اسم الفحص\",\n      yourValue: \"قيمتك\",\n      normalRange: \"النطاق الطبيعي\",\n      testDate: \"تاريخ الفحص\",\n      status: \"الحالة\",\n      category: \"التصنيف\",\n      normal: \"طبيعي\",\n      low: \"منخفض\",\n      high: \"مرتفع\",\n      slightlyHigh: \"مرتفع بشكل بسيط\",\n      slightlyLow: \"منخفض بشكل بسيط\",\n      \n      // Categories\n      vitamins: \"الفيتامينات\",\n      minerals: \"المعادن\",\n      hormones: \"الهرمونات\",\n      organ_functions: \"وظائف الأعضاء\",\n      lipids: \"الدهون\",\n      immunity: \"المناعة\",\n      blood: \"فحوصات الدم\",\n      coagulation: \"التخثر\",\n      special: \"فحوصات خاصة\",\n      \n      // Sorting\n      sortBy: \"ترتيب حسب\",\n      importance: \"الأهمية\",\n      newest: \"الأحدث\",\n      oldest: \"الأقدم\",\n      byStatus: \"الحالة\",\n      byCategory: \"التصنيف\",\n      \n      // Upload\n      uploadTitle: \"رفع نتائج التحاليل\",\n      uploadDescription: \"ارفع ملف PDF لنتائج تحاليلك وسيقوم الذكاء الاصطناعي بتحليلها\",\n      dropzone: \"اسحب ملف PDF هنا أو اضغط للرفع\",\n      processing: \"جاري المعالجة...\",\n      analysisComplete: \"اكتمل التحليل\",\n      testsFound: \"فحص تم استخراجه\",\n      \n      // Profile\n      personalInfo: \"المعلومات الشخصية\",\n      name: \"الاسم\",\n      email: \"البريد الإلكتروني\",\n      phone: \"رقم الهاتف\",\n      age: \"العمر\",\n      weight: \"الوزن (كجم)\",\n      height: \"الطول (سم)\",\n      gender: \"الجنس\",\n      male: \"ذكر\",\n      female: \"أنثى\",\n      changePhoto: \"تغيير الصورة\",\n      saveChanges: \"حفظ التغييرات\",\n      \n      // Subscription\n      currentPlan: \"خطتك الحالية\",\n      freePlan: \"مجاني\",\n      basicPlan: \"أساسي\",\n      premiumPlan: \"متقدم\",\n      filesUsed: \"الملفات المستخدمة\",\n      filesLimit: \"الحد الأقصى\",\n      unlimited: \"غير محدود\",\n      upgrade: \"ترقية\",\n      \n      // Reminders\n      upcomingReminders: \"التذكيرات القادمة\",\n      dueDate: \"تاريخ الاستحقاق\",\n      noReminders: \"لا توجد تذكيرات قادمة\",\n      \n      // Levels\n      level1: \"المستوى الأول: الفحوصات الأساسية\",\n      level2: \"المستوى الثاني: الصحة العامة\",\n      level3: \"المستوى الثالث: الهرمونات والأداء\",\n      level4: \"المستوى الرابع: المناعة والالتهابات\",\n      level5: \"المستوى الخامس: الفيتامينات والمعادن المتقدمة\",\n      level6: \"المستوى السادس: القلب والتخثر\",\n      level7: \"المستوى السابع: الفحوصات الخاصة\",\n      \n      // Common\n      loading: \"جاري التحميل...\",\n      error: \"خطأ\",\n      success: \"تم بنجاح\",\n      cancel: \"إلغاء\",\n      confirm: \"تأكيد\",\n      noData: \"لا توجد بيانات\",\n      years: \"سنة\",\n      pending: \"معلق\",\n      testsCompleted: \"فحص مكتمل\",\n      abnormal: \"غير طبيعي\",\n      defaultOrder: \"الترتيب الافتراضي\",\n      allCategories: \"جميع التصنيفات\",\n      allStatuses: \"جميع الحالات\",\n      reminder: \"تذكير\",\n      setReminder: \"تعيين تذكير\",\n      reminderSet: \"تم تعيين التذكير\",\n      reminderSetDesc: \"سيتم تذكيرك في التاريخ المحدد\",\n      reminderDeleted: \"تم حذف التذكير\",\n      reminderError: \"فشل في تعيين التذكير\",\n      home: \"الرئيسية\",\n      upload: \"رفع\",\n      \n      // Uploaded Files History\n      uploadedFiles: \"الملفات المرفوعة\",\n      processed: \"تمت المعالجة\",\n      failed: \"فشل\",\n      testsExtracted: \"فحص مستخرج\",\n      aiCouldNotRead: \"لم يتمكن الذكاء الاصطناعي من قراءة هذا الملف\",\n      fileDeleted: \"تم حذف الملف بنجاح\",\n      deleteFileFailed: \"فشل في حذف الملف\",\n      retry: \"إعادة المحاولة\",\n      retryFailed: \"فشلت إعادة المحاولة. يرجى المحاولة مرة أخرى.\",\n      pleaseUploadPdf: \"يرجى رفع ملف PDF\",\n      \n      // Compare\n      compare: \"مقارنة\",\n      compareResults: \"مقارنة النتائج\",\n      previousResult: \"السابق\",\n      latestResult: \"الأحدث\",\n      improved: \"تحسّن\",\n      worsened: \"تراجع\",\n      noChange: \"لا تغيير\",\n      noComparisonData: \"لا توجد بيانات للمقارنة\",\n      noComparisonHint: \"ارفع تقريرين أو أكثر لمقارنة نتائجك عبر الزمن\",\n\n      // Diet Plan\n      dietPlan: \"النظام الغذائي\",\n      dietPlanNav: \"التغذية\",\n      dietPlanIntro: \"نظام غذائي مخصص بالذكاء الاصطناعي\",\n      dietPlanDescription: \"بناءً على نتائج تحاليلك ووزنك وطولك وهدفك، سيصمم الذكاء الاصطناعي خطة تغذية مخصصة لك\",\n      generateDietPlan: \"تصميم النظام الغذائي\",\n      generatingDietPlan: \"جاري تحليل بياناتك الصحية وتصميم نظامك الغذائي...\",\n      canExitWhileGenerating: \"يمكنك الخروج من هذه الصفحة. سنرسل لك إشعاراً عند اكتمال إصدار جدولك الغذائي.\",\n      dietPlanError: \"فشل في تصميم النظام الغذائي. يرجى المحاولة مرة أخرى.\",\n      regenerateDietPlan: \"تصميم نظام جديد\",\n      breakfast: \"الإفطار\",\n      lunch: \"الغداء\",\n      dinner: \"العشاء\",\n      snacks: \"الوجبات الخفيفة\",\n      deficiencies: \"النواقص التي يجب معالجتها\",\n      dietTips: \"نصائح غذائية\",\n      warnings: \"تحذيرات مهمة\",\n      targetCalories: \"السعرات المستهدفة\",\n      kcalPerDay: \"سعرة/يوم\",\n      kcal: \"سعرة\",\n      protein: \"بروتين\",\n      carbs: \"كاربوهيدرات\",\n      fats: \"دهون\",\n      gram: \"جم\",\n      bmr: \"معدل الأيض الأساسي\",\n      tdee: \"إجمالي الطاقة اليومية\",\n      fitnessGoal: \"الهدف المنشود\",\n      goalWeightLoss: \"نزول الوزن\",\n      goalMaintain: \"الحفاظ على الوزن\",\n      goalMuscleGain: \"زيادة الوزن (عضل)\",\n      disclaimerTitle: \"تنبيه مهم\",\n      nutritionDisclaimer: \"هذا النظام الغذائي مقدّم لأغراض التعليم والتوعية فقط، ولا يُعتبر استشارة طبية أو تشخيصاً أو علاجاً. لا تتحمل BioTrack AI وشركة الشيرا أي مسؤولية عن أي قرارات تُتخذ بناءً على هذه المعلومات. يُرجى دائماً مراجعة طبيبك المختص أو أخصائي تغذية معتمد قبل إجراء أي تغييرات على نظامك الغذائي، خاصةً إذا كنت تعاني من أمراض مزمنة أو تتناول أدوية. صحتك وسلامتك هي أولويتنا.\",\n      conditionBasedTips: \"نصائح صحية مخصصة\",\n      avoidTheseFoods: \"أطعمة يجب تجنبها\",\n      reduceFoods: \"يفضل التقليل من\",\n      mealOption: \"خيار\",\n      chooseOneMealNote: \"اختر خياراً واحداً لكل وجبة - نوّع بين الخيارات على مدار الأسبوع\",\n      supplementsTitle: \"مكملات غذائية مقترحة\",\n      supplementsDisclaimer: \"هذه إرشادات عامة فقط. استشر طبيبك قبل البدء بأي مكمل غذائي.\",\n      supplementDuration: \"المدة\",\n      supplementTarget: \"القيمة المستهدفة\",\n      supplementFoodSources: \"مصادر طبيعية من الغذاء\",\n      doctorFollowUp: \"متابعة مع الطبيب\",\n      healthSummaryTitle: \"ملخص الحالة الصحية\",\n      intakeAlignmentTitle: \"مدى توافق الأكل مع الهدف\",\n      referencesTitle: \"المراجع والمصادر\",\n      bmrSafetyNote: \"BMR هو الحد الأدنى الآمن للسعرات\",\n      deficitReduced: \"تم تخفيف العجز الحراري بسبب نواقص غذائية\",\n\n      // Questionnaire\n      questStep: \"خطوة\",\n      questOf: \"من\",\n      questNext: \"التالي\",\n      questBack: \"رجوع\",\n      questActivityTitle: \"ما هو مستوى نشاطك؟\",\n      questActivitySubtitle: \"اعتبر الأنشطة اليومية والتمارين الرياضية\",\n      activitySedentary: \"قليل الحركة\",\n      activitySedentaryDesc: \"تقضي معظم يومك جالساً مع القليل من التمارين أو بدونها\",\n      activityLight: \"نشيط بشكل خفيف\",\n      activityLightDesc: \"تقوم بأنشطة يومية خفيفة أو تمارين خفيفة ١-٣ مرة أسبوعياً\",\n      activityVery: \"نشيط بشكل عالي\",\n      activityVeryDesc: \"تقف على قدميك معظم اليوم أو تمارس الرياضة بشكل معتدل ٣-٥ مرات أسبوعياً\",\n      activityExtreme: \"نشيط بشكل عالي جداً\",\n      activityExtremeDesc: \"عملك يتطلب مجهوداً بدنياً أو تمارس رياضة مكثفة أكثر من ٥ مرات أسبوعياً\",\n      questAllergyTitle: \"هل تعاني من أي حساسية غذائية؟\",\n      questAllergyYes: \"نعم\",\n      questAllergyNo: \"لا\",\n      questAllergyWhich: \"هل لديك حساسية تجاه أي من هذه المكونات؟\",\n      allergyEggs: \"بيض\",\n      allergyDairy: \"مشتقات الألبان\",\n      allergyPeanuts: \"فول سوداني\",\n      allergyNuts: \"مكسرات\",\n      allergySeafood: \"مأكولات بحرية\",\n      allergySoy: \"صويا\",\n      allergySesame: \"سمسم\",\n      allergyWheat: \"قمح\",\n      allergyFish: \"سمك\",\n      questContinue: \"واصل\",\n      questProteinTitle: \"ماذا تفضل من البروتين؟\",\n      questProteinSubtitle: \"اختر صنف أو أكثر من مصادر البروتين المفضلة لديك\",\n      proteinFish: \"أسماك\",\n      proteinChicken: \"دجاج\",\n      proteinMeat: \"لحوم حمراء\",\n      proteinVegetarian: \"نباتي (بقوليات وتوفو)\",\n      questCarbTitle: \"ماذا تفضل من الكربوهيدرات؟\",\n      questCarbSubtitle: \"اختر صنف أو أكثر من مصادر الكربوهيدرات المفضلة لديك\",\n      carbRice: \"أرز\",\n      carbBread: \"خبز\",\n      carbPasta: \"معكرونة\",\n      carbOats: \"شوفان\",\n      carbPotato: \"بطاطس\",\n      carbSweetPotato: \"بطاطا حلوة\",\n      carbQuinoa: \"كينوا\",\n      carbBulgur: \"برغل\",\n      carbKeto: \"كيتو (مكسرات وبذور)\",\n      carbCorn: \"ذرة\",\n      carbBeans: \"بقوليات\",\n      carbFruits: \"فواكه\",\n      questPreferenceTitle: \"أي نوع من الوجبات تفضل؟\",\n      prefHighProtein: \"عالية البروتين\",\n      prefHighProteinDesc: \"يعزز القوة والحيوية ببروتينات خفيفة وصحية\",\n      prefBalanced: \"المتوازنة\",\n      prefBalancedDesc: \"يمنح جسمك تغذية متوازنة للصحة والحيوية\",\n      prefLowCarb: \"اللو-كارب\",\n      prefLowCarbDesc: \"وجبات منخفضة بالكربوهيدرات، وغنية بالدهون الصحية وخضار بدون نشويات\",\n      prefKeto: \"الكيتو\",\n      prefKetoDesc: \"كربوهيدرات منخفضة جداً ودهون عالية لإدخال الجسم في حالة الكيتوسيز\",\n      prefVegetarian: \"النباتية\",\n      prefVegetarianDesc: \"أطباق صحية نباتية مع خضروات ملونة وحبوب مغذية\",\n      prefCustomMacros: \"ماكروز مخصصة\",\n      prefCustomMacrosDesc: \"مصمم خصيصاً للرياضيين ومحبي اللياقة\",\n      recommended: \"الموصى فيها\",\n\n      // Sidebar menu\n      menuMyTests: \"فحوصاتي\",\n      menuCompare: \"مقارنة النتائج\",\n      menuMyDietSchedule: \"جدولي الغذائي\",\n      menuKnowledge: \"قاعدة المعرفة\",\n\n      // My Diet Schedule\n      myDietSchedule: \"جدولي الغذائي\",\n      noSavedPlans: \"لا توجد خطط غذائية محفوظة\",\n      noSavedPlansDesc: \"قم بتوليد نظام غذائي وتصديره هنا للوصول إليه في أي وقت\",\n      savedOn: \"تم الحفظ في\",\n      deletePlan: \"حذف\",\n      deleteConfirm: \"هل أنت متأكد من حذف هذه الخطة المحفوظة؟\",\n      exportToDietSchedule: \"تصدير إلى جدولي الغذائي\",\n      exportSuccess: \"تم حفظ النظام الغذائي في جدولي الغذائي بنجاح\",\n      exportError: \"فشل في حفظ النظام الغذائي\",\n      viewPlan: \"عرض الخطة\",\n      hidePlan: \"إخفاء الخطة\",\n      dietScheduleNote: \"يتم تغيير الجدول الغذائي كل ٣ أسابيع إلى شهر للحصول على أفضل النتائج\",\n      plateauNote: \"عند ثبات الوزن لمدة أسبوعين تقريباً، يجب أخذ وجبة مفتوحة (شيت ميل) لكسر هذا الثبات وتنشيط عملية الأيض\",\n      dietScheduleNotesTitle: \"ملاحظات مهمة\",\n\n      // Share\n      shareResults: \"مشاركة النتائج\",\n      shareSuccess: \"تمت المشاركة بنجاح\",\n      copiedToClipboard: \"تم النسخ إلى الحافظة\",\n      copyFailed: \"فشل في النسخ\",\n      \n      // PDF Errors\n      scannedPdfError: \"يبدو أن هذا الملف ممسوح ضوئياً. يرجى رفع ملف PDF رقمي/نصي.\",\n      analysisFailedError: \"فشل في تحليل هذا الملف. يرجى المحاولة مرة أخرى.\",\n    }\n  }\n};\n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    resources,\n    lng: 'ar',\n    fallbackLng: 'ar',\n    interpolation: {\n      escapeValue: false\n    },\n    detection: {\n      order: ['localStorage'],\n      caches: ['localStorage'],\n      lookupLocalStorage: 'i18nextLng',\n    }\n  });\n\nexport default i18n;\n","path":null,"size_bytes":27655,"size_tokens":null},"mobile/src/screens/ProfileScreen.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  StyleSheet,\n  ScrollView,\n  TextInput,\n  TouchableOpacity,\n  Alert,\n  I18nManager\n} from 'react-native';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Ionicons } from '@expo/vector-icons';\nimport { queries, api } from '../lib/api';\n\ninterface UserProfile {\n  id: number;\n  name: string;\n  email: string;\n  age?: number;\n  gender?: 'male' | 'female';\n  height?: number;\n  weight?: number;\n  bloodType?: string;\n  subscription: 'free' | 'basic' | 'premium';\n  pdfCount: number;\n}\n\nexport default function ProfileScreen() {\n  const { t, i18n } = useTranslation();\n  const queryClient = useQueryClient();\n  const isArabic = i18n.language === 'ar';\n\n  const [age, setAge] = useState('');\n  const [gender, setGender] = useState<'male' | 'female' | null>(null);\n  const [height, setHeight] = useState('');\n  const [weight, setWeight] = useState('');\n  const [bloodType, setBloodType] = useState('');\n\n  const { data: user } = useQuery({\n    queryKey: ['user'],\n    queryFn: queries.user\n  });\n\n  const profile = user as UserProfile | undefined;\n\n  useEffect(() => {\n    if (profile) {\n      if (profile.age) setAge(profile.age.toString());\n      if (profile.gender) setGender(profile.gender);\n      if (profile.height) setHeight(profile.height.toString());\n      if (profile.weight) setWeight(profile.weight.toString());\n      if (profile.bloodType) setBloodType(profile.bloodType);\n    }\n  }, [profile]);\n\n  const updateMutation = useMutation({\n    mutationFn: (data: Partial<UserProfile>) => \n      api.patch('/api/user', data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['user'] });\n      Alert.alert(t('profile.save'), t('normal'));\n    },\n    onError: () => {\n      Alert.alert(t('errors.uploadFailed'));\n    }\n  });\n\n  const handleSave = () => {\n    updateMutation.mutate({\n      age: age ? parseInt(age) : undefined,\n      gender: gender || undefined,\n      height: height ? parseInt(height) : undefined,\n      weight: weight ? parseInt(weight) : undefined,\n      bloodType: bloodType || undefined\n    });\n  };\n\n  const toggleLanguage = () => {\n    const newLang = isArabic ? 'en' : 'ar';\n    i18n.changeLanguage(newLang);\n  };\n\n  const getSubscriptionInfo = () => {\n    if (!profile) return { color: '#64748b', remaining: 0 };\n    switch (profile.subscription) {\n      case 'premium':\n        return { color: '#a855f7', remaining: Infinity };\n      case 'basic':\n        return { color: '#3b82f6', remaining: 20 - profile.pdfCount };\n      default:\n        return { color: '#64748b', remaining: 3 - profile.pdfCount };\n    }\n  };\n\n  const subInfo = getSubscriptionInfo();\n\n  return (\n    <ScrollView style={styles.container} contentContainerStyle={styles.content}>\n      <View style={styles.header}>\n        <View style={styles.avatar}>\n          <Ionicons name=\"person\" size={40} color=\"#fff\" />\n        </View>\n        <Text style={styles.name}>{profile?.name || t('profile.age')}</Text>\n        <Text style={styles.email}>{profile?.email}</Text>\n      </View>\n\n      <View style={styles.subscriptionCard}>\n        <View style={styles.subscriptionHeader}>\n          <Ionicons name=\"diamond\" size={24} color={subInfo.color} />\n          <Text style={[styles.subscriptionType, { color: subInfo.color }]}>\n            {t(`subscription.${profile?.subscription || 'free'}`)}\n          </Text>\n        </View>\n        <Text style={styles.subscriptionRemaining}>\n          {subInfo.remaining === Infinity \n            ? '∞' \n            : `${Math.max(0, subInfo.remaining)} ${t('subscription.remaining')}`}\n        </Text>\n        {profile?.subscription !== 'premium' && (\n          <TouchableOpacity style={styles.upgradeButton} testID=\"button-upgrade\">\n            <Text style={styles.upgradeButtonText}>{t('subscription.upgrade')}</Text>\n          </TouchableOpacity>\n        )}\n      </View>\n\n      <View style={styles.section}>\n        <Text style={styles.sectionTitle}>{t('profile.age')}</Text>\n\n        <View style={styles.inputGroup}>\n          <Text style={styles.label}>{t('profile.age')}</Text>\n          <TextInput\n            style={styles.input}\n            value={age}\n            onChangeText={setAge}\n            keyboardType=\"number-pad\"\n            placeholder=\"25\"\n            testID=\"input-age\"\n          />\n        </View>\n\n        <View style={styles.inputGroup}>\n          <Text style={styles.label}>{t('profile.gender')}</Text>\n          <View style={styles.genderButtons}>\n            <TouchableOpacity\n              style={[styles.genderButton, gender === 'male' && styles.genderButtonSelected]}\n              onPress={() => setGender('male')}\n              testID=\"button-gender-male\"\n            >\n              <Ionicons \n                name=\"male\" \n                size={20} \n                color={gender === 'male' ? '#fff' : '#3b82f6'} \n              />\n              <Text style={[\n                styles.genderButtonText,\n                gender === 'male' && styles.genderButtonTextSelected\n              ]}>\n                {t('profile.male')}\n              </Text>\n            </TouchableOpacity>\n            <TouchableOpacity\n              style={[styles.genderButton, gender === 'female' && styles.genderButtonSelected]}\n              onPress={() => setGender('female')}\n              testID=\"button-gender-female\"\n            >\n              <Ionicons \n                name=\"female\" \n                size={20} \n                color={gender === 'female' ? '#fff' : '#ec4899'} \n              />\n              <Text style={[\n                styles.genderButtonText,\n                gender === 'female' && styles.genderButtonTextSelected\n              ]}>\n                {t('profile.female')}\n              </Text>\n            </TouchableOpacity>\n          </View>\n        </View>\n\n        <View style={styles.row}>\n          <View style={[styles.inputGroup, styles.halfWidth]}>\n            <Text style={styles.label}>{t('profile.height')}</Text>\n            <TextInput\n              style={styles.input}\n              value={height}\n              onChangeText={setHeight}\n              keyboardType=\"number-pad\"\n              placeholder=\"170\"\n              testID=\"input-height\"\n            />\n          </View>\n          <View style={[styles.inputGroup, styles.halfWidth]}>\n            <Text style={styles.label}>{t('profile.weight')}</Text>\n            <TextInput\n              style={styles.input}\n              value={weight}\n              onChangeText={setWeight}\n              keyboardType=\"number-pad\"\n              placeholder=\"70\"\n              testID=\"input-weight\"\n            />\n          </View>\n        </View>\n\n        <View style={styles.inputGroup}>\n          <Text style={styles.label}>{t('profile.bloodType')}</Text>\n          <TextInput\n            style={styles.input}\n            value={bloodType}\n            onChangeText={setBloodType}\n            placeholder=\"A+\"\n            testID=\"input-blood-type\"\n          />\n        </View>\n\n        <TouchableOpacity\n          style={styles.saveButton}\n          onPress={handleSave}\n          disabled={updateMutation.isPending}\n          testID=\"button-save-profile\"\n        >\n          <Ionicons name=\"save\" size={20} color=\"#fff\" />\n          <Text style={styles.saveButtonText}>{t('profile.save')}</Text>\n        </TouchableOpacity>\n      </View>\n\n      <View style={styles.section}>\n        <Text style={styles.sectionTitle}>{t('settings')}</Text>\n        \n        <TouchableOpacity \n          style={styles.settingItem}\n          onPress={toggleLanguage}\n          testID=\"button-toggle-language\"\n        >\n          <Ionicons name=\"language\" size={24} color=\"#64748b\" />\n          <Text style={styles.settingText}>\n            {isArabic ? 'English' : 'العربية'}\n          </Text>\n          <Ionicons name=\"chevron-forward\" size={20} color=\"#94a3b8\" />\n        </TouchableOpacity>\n      </View>\n    </ScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f8fafc'\n  },\n  content: {\n    padding: 16\n  },\n  header: {\n    alignItems: 'center',\n    marginBottom: 24\n  },\n  avatar: {\n    width: 80,\n    height: 80,\n    borderRadius: 40,\n    backgroundColor: '#3b82f6',\n    justifyContent: 'center',\n    alignItems: 'center',\n    marginBottom: 12\n  },\n  name: {\n    fontSize: 20,\n    fontWeight: 'bold',\n    color: '#1e293b'\n  },\n  email: {\n    fontSize: 14,\n    color: '#64748b',\n    marginTop: 4\n  },\n  subscriptionCard: {\n    backgroundColor: '#fff',\n    borderRadius: 12,\n    padding: 16,\n    marginBottom: 24,\n    alignItems: 'center',\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.05,\n    shadowRadius: 4,\n    elevation: 2\n  },\n  subscriptionHeader: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    marginBottom: 8\n  },\n  subscriptionType: {\n    fontSize: 18,\n    fontWeight: 'bold',\n    marginHorizontal: 8\n  },\n  subscriptionRemaining: {\n    fontSize: 14,\n    color: '#64748b',\n    marginBottom: 12\n  },\n  upgradeButton: {\n    backgroundColor: '#3b82f6',\n    paddingHorizontal: 24,\n    paddingVertical: 10,\n    borderRadius: 20\n  },\n  upgradeButtonText: {\n    color: '#fff',\n    fontWeight: '600'\n  },\n  section: {\n    backgroundColor: '#fff',\n    borderRadius: 12,\n    padding: 16,\n    marginBottom: 16,\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.05,\n    shadowRadius: 4,\n    elevation: 2\n  },\n  sectionTitle: {\n    fontSize: 18,\n    fontWeight: '600',\n    color: '#1e293b',\n    marginBottom: 16,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  inputGroup: {\n    marginBottom: 16\n  },\n  label: {\n    fontSize: 14,\n    color: '#64748b',\n    marginBottom: 8,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  input: {\n    backgroundColor: '#f8fafc',\n    borderRadius: 8,\n    padding: 12,\n    fontSize: 16,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  row: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    justifyContent: 'space-between'\n  },\n  halfWidth: {\n    width: '48%'\n  },\n  genderButtons: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    justifyContent: 'space-between'\n  },\n  genderButton: {\n    flex: 1,\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    padding: 12,\n    borderRadius: 8,\n    borderWidth: 1,\n    borderColor: '#e2e8f0',\n    marginHorizontal: 4\n  },\n  genderButtonSelected: {\n    backgroundColor: '#3b82f6',\n    borderColor: '#3b82f6'\n  },\n  genderButtonText: {\n    fontSize: 14,\n    color: '#64748b',\n    marginHorizontal: 4\n  },\n  genderButtonTextSelected: {\n    color: '#fff'\n  },\n  saveButton: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#22c55e',\n    borderRadius: 8,\n    padding: 14,\n    marginTop: 8\n  },\n  saveButtonText: {\n    color: '#fff',\n    fontSize: 16,\n    fontWeight: '600',\n    marginHorizontal: 8\n  },\n  settingItem: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    paddingVertical: 12,\n    borderBottomWidth: 1,\n    borderBottomColor: '#f1f5f9'\n  },\n  settingText: {\n    flex: 1,\n    fontSize: 16,\n    color: '#1e293b',\n    marginHorizontal: 12,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  }\n});\n","path":null,"size_bytes":11589,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"mobile/App.tsx":{"content":"import React from 'react';\nimport { StatusBar } from 'expo-status-bar';\nimport { I18nManager } from 'react-native';\nimport { NavigationContainer } from '@react-navigation/native';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { SafeAreaProvider } from 'react-native-safe-area-context';\n\nimport './src/lib/i18n';\nimport { AuthProvider } from './src/context/AuthContext';\nimport RootNavigator from './src/navigation/RootNavigator';\n\nI18nManager.allowRTL(true);\nI18nManager.forceRTL(true);\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      retry: 1,\n      staleTime: 5 * 60 * 1000\n    }\n  }\n});\n\nexport default function App() {\n  return (\n    <SafeAreaProvider>\n      <QueryClientProvider client={queryClient}>\n        <AuthProvider>\n          <NavigationContainer>\n            <StatusBar style=\"dark\" />\n            <RootNavigator />\n          </NavigationContainer>\n        </AuthProvider>\n      </QueryClientProvider>\n    </SafeAreaProvider>\n  );\n}\n","path":null,"size_bytes":1014,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"server/replit_integrations/batch/index.ts":{"content":"export {\n  batchProcess,\n  batchProcessWithSSE,\n  isRateLimitError,\n  type BatchOptions,\n} from \"./utils\";\n\n","path":null,"size_bytes":108,"size_tokens":null},"mobile/src/screens/UploadScreen.tsx":{"content":"import React, { useState } from 'react';\nimport {\n  View,\n  Text,\n  StyleSheet,\n  TouchableOpacity,\n  ActivityIndicator,\n  Alert,\n  I18nManager\n} from 'react-native';\nimport { useTranslation } from 'react-i18next';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport * as DocumentPicker from 'expo-document-picker';\nimport { Ionicons } from '@expo/vector-icons';\nimport { api } from '../lib/api';\n\nexport default function UploadScreen({ navigation }: any) {\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n  const [selectedFile, setSelectedFile] = useState<DocumentPicker.DocumentPickerAsset | null>(null);\n\n  const uploadMutation = useMutation({\n    mutationFn: (file: { uri: string; name: string; type: string }) => \n      api.uploadPdf(file),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['userTests'] });\n      queryClient.invalidateQueries({ queryKey: ['reminders'] });\n      Alert.alert(\n        t('normal'),\n        t('subtitle'),\n        [{ text: t('disclaimer.understand'), onPress: () => navigation.navigate('Tests') }]\n      );\n    },\n    onError: (error: any) => {\n      Alert.alert(t('errors.uploadFailed'), error.message);\n    }\n  });\n\n  const pickDocument = async () => {\n    try {\n      const result = await DocumentPicker.getDocumentAsync({\n        type: 'application/pdf',\n        copyToCacheDirectory: true\n      });\n\n      if (!result.canceled && result.assets[0]) {\n        setSelectedFile(result.assets[0]);\n      }\n    } catch (error) {\n      Alert.alert(t('errors.uploadFailed'));\n    }\n  };\n\n  const handleUpload = () => {\n    if (selectedFile) {\n      uploadMutation.mutate({\n        uri: selectedFile.uri,\n        name: selectedFile.name,\n        type: 'application/pdf'\n      });\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.content}>\n        <View style={styles.iconContainer}>\n          <Ionicons name=\"document-text\" size={80} color=\"#3b82f6\" />\n        </View>\n\n        <Text style={styles.title}>{t('uploadPdf')}</Text>\n        <Text style={styles.subtitle}>{t('subtitle')}</Text>\n\n        <TouchableOpacity\n          style={styles.selectButton}\n          onPress={pickDocument}\n          testID=\"button-select-file\"\n        >\n          <Ionicons name=\"folder-open\" size={24} color=\"#3b82f6\" />\n          <Text style={styles.selectButtonText}>{t('selectFile')}</Text>\n        </TouchableOpacity>\n\n        {selectedFile && (\n          <View style={styles.fileCard}>\n            <Ionicons name=\"document\" size={24} color=\"#64748b\" />\n            <Text style={styles.fileName} numberOfLines={1}>\n              {selectedFile.name}\n            </Text>\n            <TouchableOpacity onPress={() => setSelectedFile(null)}>\n              <Ionicons name=\"close-circle\" size={24} color=\"#ef4444\" />\n            </TouchableOpacity>\n          </View>\n        )}\n\n        <TouchableOpacity\n          style={[\n            styles.uploadButton,\n            (!selectedFile || uploadMutation.isPending) && styles.uploadButtonDisabled\n          ]}\n          onPress={handleUpload}\n          disabled={!selectedFile || uploadMutation.isPending}\n          testID=\"button-upload-file\"\n        >\n          {uploadMutation.isPending ? (\n            <>\n              <ActivityIndicator color=\"#fff\" />\n              <Text style={styles.uploadButtonText}>{t('analyzing')}</Text>\n            </>\n          ) : (\n            <>\n              <Ionicons name=\"cloud-upload\" size={24} color=\"#fff\" />\n              <Text style={styles.uploadButtonText}>{t('uploadPdf')}</Text>\n            </>\n          )}\n        </TouchableOpacity>\n\n        <View style={styles.infoCard}>\n          <Ionicons name=\"information-circle\" size={24} color=\"#3b82f6\" />\n          <Text style={styles.infoText}>{t('disclaimer.text')}</Text>\n        </View>\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f8fafc'\n  },\n  content: {\n    flex: 1,\n    padding: 20,\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  iconContainer: {\n    width: 120,\n    height: 120,\n    borderRadius: 60,\n    backgroundColor: '#eff6ff',\n    justifyContent: 'center',\n    alignItems: 'center',\n    marginBottom: 24\n  },\n  title: {\n    fontSize: 24,\n    fontWeight: 'bold',\n    color: '#1e293b',\n    marginBottom: 8,\n    textAlign: 'center'\n  },\n  subtitle: {\n    fontSize: 16,\n    color: '#64748b',\n    textAlign: 'center',\n    marginBottom: 32\n  },\n  selectButton: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#fff',\n    borderWidth: 2,\n    borderColor: '#3b82f6',\n    borderStyle: 'dashed',\n    borderRadius: 12,\n    padding: 20,\n    width: '100%',\n    marginBottom: 16\n  },\n  selectButtonText: {\n    fontSize: 16,\n    color: '#3b82f6',\n    fontWeight: '600',\n    marginHorizontal: 8\n  },\n  fileCard: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    backgroundColor: '#fff',\n    borderRadius: 12,\n    padding: 16,\n    width: '100%',\n    marginBottom: 16,\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.05,\n    shadowRadius: 4,\n    elevation: 2\n  },\n  fileName: {\n    flex: 1,\n    fontSize: 14,\n    color: '#1e293b',\n    marginHorizontal: 12,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  uploadButton: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#3b82f6',\n    borderRadius: 12,\n    padding: 16,\n    width: '100%',\n    marginBottom: 24\n  },\n  uploadButtonDisabled: {\n    backgroundColor: '#94a3b8'\n  },\n  uploadButtonText: {\n    fontSize: 18,\n    color: '#fff',\n    fontWeight: '600',\n    marginHorizontal: 8\n  },\n  infoCard: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'flex-start',\n    backgroundColor: '#eff6ff',\n    borderRadius: 12,\n    padding: 16,\n    width: '100%'\n  },\n  infoText: {\n    flex: 1,\n    fontSize: 14,\n    color: '#1e40af',\n    marginHorizontal: 12,\n    lineHeight: 20,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  }\n});\n","path":null,"size_bytes":6240,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"shared/models/auth.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { index, jsonb, pgTable, timestamp, varchar } from \"drizzle-orm/pg-core\";\n\n// Session storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)]\n);\n\n// User storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":1010,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 0 0% 10%;\n  --border: 0 0% 92%;\n  --card: 0 0% 98%;\n  --card-foreground: 0 0% 10%;\n  --card-border: 0 0% 94%;\n  --sidebar: 0 0% 96%;\n  --sidebar-foreground: 0 0% 10%;\n  --sidebar-border: 0 0% 90%;\n  --sidebar-primary: 210 100% 45%;\n  --sidebar-primary-foreground: 210 100% 98%;\n  --sidebar-accent: 0 0% 92%;\n  --sidebar-accent-foreground: 0 0% 10%;\n  --sidebar-ring: 210 100% 45%;\n  --popover: 0 0% 94%;\n  --popover-foreground: 0 0% 10%;\n  --popover-border: 0 0% 88%;\n  --primary: 210 100% 45%;\n  --primary-foreground: 210 100% 98%;\n  --secondary: 0 0% 90%;\n  --secondary-foreground: 0 0% 10%;\n  --muted: 0 0% 92%;\n  --muted-foreground: 0 0% 30%;\n  --accent: 210 15% 94%;\n  --accent-foreground: 210 15% 15%;\n  --destructive: 0 85% 45%;\n  --destructive-foreground: 0 85% 98%;\n  --input: 0 0% 80%;\n  --ring: 210 100% 45%;\n  --chart-1: 210 100% 35%;\n  --chart-2: 180 80% 35%;\n  --chart-3: 150 70% 30%;\n  --chart-4: 280 75% 35%;\n  --chart-5: 30 85% 40%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.08);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.08);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.10);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.12);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.15);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 0 0% 8%;\n  --foreground: 0 0% 95%;\n  --border: 0 0% 18%;\n  --card: 0 0% 10%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 0 0% 14%;\n  --sidebar: 0 0% 12%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 0 0% 16%;\n  --sidebar-primary: 210 100% 55%;\n  --sidebar-primary-foreground: 210 100% 98%;\n  --sidebar-accent: 0 0% 16%;\n  --sidebar-accent-foreground: 0 0% 95%;\n  --sidebar-ring: 210 100% 55%;\n  --popover: 0 0% 14%;\n  --popover-foreground: 0 0% 95%;\n  --popover-border: 0 0% 18%;\n  --primary: 210 100% 50%;\n  --primary-foreground: 210 100% 98%;\n  --secondary: 0 0% 18%;\n  --secondary-foreground: 0 0% 95%;\n  --muted: 0 0% 16%;\n  --muted-foreground: 0 0% 70%;\n  --accent: 210 12% 16%;\n  --accent-foreground: 210 12% 92%;\n  --destructive: 0 80% 45%;\n  --destructive-foreground: 0 80% 98%;\n  --input: 0 0% 30%;\n  --ring: 210 100% 55%;\n  --chart-1: 210 100% 65%;\n  --chart-2: 180 80% 65%;\n  --chart-3: 150 70% 60%;\n  --chart-4: 280 75% 65%;\n  --chart-5: 30 85% 60%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.20);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.20);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.25);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.30);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.35);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10573,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"mobile/src/navigation/TabNavigator.tsx":{"content":"import React from 'react';\nimport { I18nManager } from 'react-native';\nimport { createBottomTabNavigator } from '@react-navigation/bottom-tabs';\nimport { useTranslation } from 'react-i18next';\nimport { Ionicons } from '@expo/vector-icons';\n\nimport HomeScreen from '../screens/HomeScreen';\nimport TestsScreen from '../screens/TestsScreen';\nimport UploadScreen from '../screens/UploadScreen';\nimport RemindersScreen from '../screens/RemindersScreen';\nimport ProfileScreen from '../screens/ProfileScreen';\n\nconst Tab = createBottomTabNavigator();\n\nexport default function TabNavigator() {\n  const { t } = useTranslation();\n\n  return (\n    <Tab.Navigator\n      screenOptions={{\n        tabBarActiveTintColor: '#3b82f6',\n        tabBarInactiveTintColor: '#64748b',\n        tabBarStyle: {\n          backgroundColor: '#fff',\n          borderTopColor: '#e2e8f0',\n          paddingBottom: 8,\n          paddingTop: 8,\n          height: 70\n        },\n        tabBarLabelStyle: {\n          fontSize: 12,\n          fontWeight: '500'\n        },\n        headerStyle: {\n          backgroundColor: '#fff'\n        },\n        headerTitleStyle: {\n          color: '#1e293b',\n          fontWeight: '600'\n        },\n        headerTitleAlign: 'center'\n      }}\n    >\n      <Tab.Screen\n        name=\"Home\"\n        component={HomeScreen}\n        options={{\n          title: t('home'),\n          tabBarIcon: ({ color, size }: { color: string; size: number }) => (\n            <Ionicons name=\"home\" size={size} color={color} />\n          )\n        }}\n      />\n      <Tab.Screen\n        name=\"Tests\"\n        component={TestsScreen}\n        options={{\n          title: t('tests'),\n          tabBarIcon: ({ color, size }: { color: string; size: number }) => (\n            <Ionicons name=\"flask\" size={size} color={color} />\n          )\n        }}\n      />\n      <Tab.Screen\n        name=\"Upload\"\n        component={UploadScreen}\n        options={{\n          title: t('upload'),\n          tabBarIcon: ({ color, size }: { color: string; size: number }) => (\n            <Ionicons name=\"cloud-upload\" size={size} color={color} />\n          )\n        }}\n      />\n      <Tab.Screen\n        name=\"Reminders\"\n        component={RemindersScreen}\n        options={{\n          title: t('reminders.title'),\n          tabBarIcon: ({ color, size }: { color: string; size: number }) => (\n            <Ionicons name=\"notifications\" size={size} color={color} />\n          )\n        }}\n      />\n      <Tab.Screen\n        name=\"Profile\"\n        component={ProfileScreen}\n        options={{\n          title: t('profile'),\n          tabBarIcon: ({ color, size }: { color: string; size: number }) => (\n            <Ionicons name=\"person\" size={size} color={color} />\n          )\n        }}\n      />\n    </Tab.Navigator>\n  );\n}\n","path":null,"size_bytes":2776,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"mobile/src/context/AuthContext.tsx":{"content":"import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport * as SecureStore from 'expo-secure-store';\n\ninterface User {\n  id: number;\n  name: string;\n  email: string;\n  subscription: 'free' | 'basic' | 'premium';\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  login: (userData: User, token: string) => Promise<void>;\n  logout: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const token = await SecureStore.getItemAsync('authToken');\n      if (token) {\n        const userData = await SecureStore.getItemAsync('userData');\n        if (userData) {\n          setUser(JSON.parse(userData));\n        }\n      }\n    } catch (error) {\n      console.error('Auth check failed:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = async (userData: User, token: string) => {\n    await SecureStore.setItemAsync('authToken', token);\n    await SecureStore.setItemAsync('userData', JSON.stringify(userData));\n    setUser(userData);\n  };\n\n  const logout = async () => {\n    await SecureStore.deleteItemAsync('authToken');\n    await SecureStore.deleteItemAsync('userData');\n    setUser(null);\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        isLoading,\n        isAuthenticated: !!user,\n        login,\n        logout\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":1942,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/TestStatusBadge.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowUp, ArrowDown, Check } from \"lucide-react\";\nimport type { TestStatus } from \"@shared/schema\";\n\ninterface TestStatusBadgeProps {\n  status: TestStatus;\n}\n\nexport function TestStatusBadge({ status }: TestStatusBadgeProps) {\n  const { t } = useTranslation();\n\n  if (status === \"normal\") {\n    return (\n      <Badge className=\"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800\">\n        <Check className=\"h-3 w-3 me-1\" />\n        {t(\"normal\")}\n      </Badge>\n    );\n  }\n\n  if (status === \"low\") {\n    return (\n      <Badge className=\"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 border-red-200 dark:border-red-800\">\n        <ArrowDown className=\"h-3 w-3 me-1\" />\n        Low\n      </Badge>\n    );\n  }\n\n  return (\n    <Badge className=\"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 border-red-200 dark:border-red-800\">\n      <ArrowUp className=\"h-3 w-3 me-1\" />\n      High\n    </Badge>\n  );\n}\n","path":null,"size_bytes":1097,"size_tokens":null},"mobile/src/navigation/RootNavigator.tsx":{"content":"import React from 'react';\nimport { createNativeStackNavigator } from '@react-navigation/native-stack';\nimport { ActivityIndicator, View } from 'react-native';\n\nimport { useAuth } from '../context/AuthContext';\nimport LoginScreen from '../screens/LoginScreen';\nimport TabNavigator from './TabNavigator';\n\nconst Stack = createNativeStackNavigator();\n\nexport default function RootNavigator() {\n  const { isAuthenticated, isLoading, login } = useAuth();\n\n  if (isLoading) {\n    return (\n      <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n        <ActivityIndicator size=\"large\" color=\"#3b82f6\" />\n      </View>\n    );\n  }\n\n  const handleLogin = () => {\n    login(\n      { id: 1, name: 'User', email: 'user@example.com', subscription: 'free' },\n      'demo-token'\n    );\n  };\n\n  return (\n    <Stack.Navigator screenOptions={{ headerShown: false }}>\n      {isAuthenticated ? (\n        <Stack.Screen name=\"Main\" component={TabNavigator} />\n      ) : (\n        <Stack.Screen name=\"Login\">\n          {() => <LoginScreen onLogin={handleLogin} />}\n        </Stack.Screen>\n      )}\n    </Stack.Navigator>\n  );\n}\n","path":null,"size_bytes":1131,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/AppSidebar.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useLocation, Link } from \"wouter\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  LayoutDashboard, \n  TestTube, \n  Upload, \n  User, \n  Bell,\n  Pill,\n  LogOut\n} from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { UserProfile } from \"@shared/schema\";\n\nexport function AppSidebar() {\n  const { t } = useTranslation();\n  const [location] = useLocation();\n  const { user } = useAuth();\n\n  const { data: profile } = useQuery<UserProfile>({\n    queryKey: [\"/api/profile\"],\n    enabled: !!user,\n  });\n\n  const menuItems = [\n    { title: t(\"dashboard\"), url: \"/\", icon: LayoutDashboard },\n    { title: t(\"myTests\"), url: \"/tests\", icon: TestTube },\n    { title: t(\"uploadPdf\"), url: \"/upload\", icon: Upload },\n    { title: t(\"reminders\"), url: \"/reminders\", icon: Bell },\n    { title: t(\"profile\"), url: \"/profile\", icon: User },\n  ];\n\n  const displayName = user ? [user.firstName, user.lastName].filter(Boolean).join(\" \") || \"User\" : \"\";\n  const initials = displayName.split(\" \").map((n: string) => n[0]).join(\"\").toUpperCase().slice(0, 2);\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"border-b p-4\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"p-2 rounded-lg bg-primary/10\">\n            <Pill className=\"h-5 w-5 text-primary\" />\n          </div>\n          <div>\n            <h1 className=\"font-bold\">{t(\"appName\")}</h1>\n            <p className=\"text-xs text-muted-foreground\">{t(\"appDescription\")}</p>\n          </div>\n        </div>\n      </SidebarHeader>\n      \n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {menuItems.map((item) => (\n                <SidebarMenuItem key={item.url}>\n                  <SidebarMenuButton asChild isActive={location === item.url}>\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"border-t p-4\">\n        {user ? (\n          <div className=\"flex items-center gap-3\">\n            <Avatar className=\"h-9 w-9\">\n              <AvatarImage \n                src={profile?.profileImagePath || user.profileImageUrl || undefined} \n                alt={displayName}\n              />\n              <AvatarFallback className=\"bg-primary/10 text-primary text-sm\">\n                {initials}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"font-medium text-sm truncate\">{displayName}</p>\n              <p className=\"text-xs text-muted-foreground truncate\">{user.email}</p>\n            </div>\n            <Button variant=\"ghost\" size=\"icon\" asChild>\n              <a href=\"/api/logout\" data-testid=\"button-logout\">\n                <LogOut className=\"h-4 w-4\" />\n              </a>\n            </Button>\n          </div>\n        ) : (\n          <Button asChild className=\"w-full\" data-testid=\"button-login-sidebar\">\n            <a href=\"/api/login\">{t(\"login\")}</a>\n          </Button>\n        )}\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":3733,"size_tokens":null},"mobile/src/lib/api.ts":{"content":"import * as SecureStore from 'expo-secure-store';\n\nconst API_BASE_URL = 'https://your-app-url.replit.app';\n\nlet authToken: string | null = null;\n\nexport const setAuthToken = async (token: string) => {\n  authToken = token;\n  await SecureStore.setItemAsync('authToken', token);\n};\n\nexport const getAuthToken = async () => {\n  if (!authToken) {\n    authToken = await SecureStore.getItemAsync('authToken');\n  }\n  return authToken;\n};\n\nexport const clearAuthToken = async () => {\n  authToken = null;\n  await SecureStore.deleteItemAsync('authToken');\n};\n\nconst getHeaders = async () => {\n  const token = await getAuthToken();\n  return {\n    'Content-Type': 'application/json',\n    ...(token ? { Authorization: `Bearer ${token}` } : {})\n  };\n};\n\nexport const api = {\n  async get<T>(endpoint: string): Promise<T> {\n    const headers = await getHeaders();\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, { headers });\n    if (!response.ok) {\n      throw new Error(`API Error: ${response.status}`);\n    }\n    return response.json();\n  },\n\n  async post<T>(endpoint: string, data?: any): Promise<T> {\n    const headers = await getHeaders();\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n      method: 'POST',\n      headers,\n      body: JSON.stringify(data)\n    });\n    if (!response.ok) {\n      throw new Error(`API Error: ${response.status}`);\n    }\n    return response.json();\n  },\n\n  async patch<T>(endpoint: string, data?: any): Promise<T> {\n    const headers = await getHeaders();\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n      method: 'PATCH',\n      headers,\n      body: JSON.stringify(data)\n    });\n    if (!response.ok) {\n      throw new Error(`API Error: ${response.status}`);\n    }\n    return response.json();\n  },\n\n  async delete(endpoint: string): Promise<void> {\n    const headers = await getHeaders();\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n      method: 'DELETE',\n      headers\n    });\n    if (!response.ok) {\n      throw new Error(`API Error: ${response.status}`);\n    }\n  },\n\n  async uploadPdf(file: { uri: string; name: string; type: string }): Promise<any> {\n    const token = await getAuthToken();\n    const formData = new FormData();\n    formData.append('pdf', {\n      uri: file.uri,\n      name: file.name,\n      type: 'application/pdf'\n    } as any);\n\n    const response = await fetch(`${API_BASE_URL}/api/analyze-pdf`, {\n      method: 'POST',\n      headers: {\n        ...(token ? { Authorization: `Bearer ${token}` } : {})\n      },\n      body: formData\n    });\n\n    if (!response.ok) {\n      throw new Error(`Upload Error: ${response.status}`);\n    }\n    return response.json();\n  }\n};\n\nexport const queries = {\n  user: () => api.get('/api/user'),\n  tests: () => api.get('/api/tests'),\n  userTests: () => api.get('/api/user-tests'),\n  allTests: () => api.get('/api/tests/all'),\n  reminders: () => api.get('/api/reminders'),\n  testDefinitions: () => api.get('/api/test-definitions')\n};\n","path":null,"size_bytes":2980,"size_tokens":null},"mobile/src/screens/LoginScreen.tsx":{"content":"import React, { useState } from 'react';\nimport {\n  View,\n  Text,\n  StyleSheet,\n  TouchableOpacity,\n  TextInput,\n  Alert,\n  ActivityIndicator,\n  I18nManager,\n  Linking\n} from 'react-native';\nimport { useTranslation } from 'react-i18next';\nimport { Ionicons } from '@expo/vector-icons';\nimport * as SecureStore from 'expo-secure-store';\n\ninterface LoginScreenProps {\n  onLogin: () => void;\n}\n\nexport default function LoginScreen({ onLogin }: LoginScreenProps) {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleReplitLogin = async () => {\n    setIsLoading(true);\n    try {\n      const authUrl = 'https://your-app-url.replit.app/api/login';\n      await Linking.openURL(authUrl);\n      \n      setTimeout(() => {\n        setIsLoading(false);\n        onLogin();\n      }, 2000);\n    } catch (error) {\n      setIsLoading(false);\n      Alert.alert(t('errors.loginRequired'));\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.content}>\n        <View style={styles.logoContainer}>\n          <Ionicons name=\"flask\" size={80} color=\"#3b82f6\" />\n        </View>\n\n        <Text style={styles.title}>{t('appName')}</Text>\n        <Text style={styles.subtitle}>{t('subtitle')}</Text>\n\n        <View style={styles.featuresContainer}>\n          <View style={styles.featureItem}>\n            <Ionicons name=\"document-text\" size={24} color=\"#22c55e\" />\n            <Text style={styles.featureText}>{t('uploadPdf')}</Text>\n          </View>\n          <View style={styles.featureItem}>\n            <Ionicons name=\"analytics\" size={24} color=\"#3b82f6\" />\n            <Text style={styles.featureText}>{t('allTests')}</Text>\n          </View>\n          <View style={styles.featureItem}>\n            <Ionicons name=\"notifications\" size={24} color=\"#f59e0b\" />\n            <Text style={styles.featureText}>{t('reminders.title')}</Text>\n          </View>\n        </View>\n\n        <TouchableOpacity\n          style={styles.loginButton}\n          onPress={handleReplitLogin}\n          disabled={isLoading}\n          testID=\"button-login\"\n        >\n          {isLoading ? (\n            <ActivityIndicator color=\"#fff\" />\n          ) : (\n            <>\n              <Ionicons name=\"log-in\" size={24} color=\"#fff\" />\n              <Text style={styles.loginButtonText}>{t('login')}</Text>\n            </>\n          )}\n        </TouchableOpacity>\n\n        <View style={styles.disclaimerCard}>\n          <Ionicons name=\"shield-checkmark\" size={20} color=\"#16a34a\" />\n          <Text style={styles.disclaimerText}>\n            {t('disclaimer.text')}\n          </Text>\n        </View>\n\n        <TouchableOpacity\n          style={styles.languageButton}\n          onPress={() => i18n.changeLanguage(isArabic ? 'en' : 'ar')}\n          testID=\"button-language-toggle\"\n        >\n          <Ionicons name=\"language\" size={20} color=\"#64748b\" />\n          <Text style={styles.languageButtonText}>\n            {isArabic ? 'English' : 'العربية'}\n          </Text>\n        </TouchableOpacity>\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f8fafc'\n  },\n  content: {\n    flex: 1,\n    padding: 24,\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  logoContainer: {\n    width: 120,\n    height: 120,\n    borderRadius: 60,\n    backgroundColor: '#eff6ff',\n    justifyContent: 'center',\n    alignItems: 'center',\n    marginBottom: 24\n  },\n  title: {\n    fontSize: 32,\n    fontWeight: 'bold',\n    color: '#1e293b',\n    marginBottom: 8,\n    textAlign: 'center'\n  },\n  subtitle: {\n    fontSize: 16,\n    color: '#64748b',\n    textAlign: 'center',\n    marginBottom: 32\n  },\n  featuresContainer: {\n    width: '100%',\n    marginBottom: 32\n  },\n  featureItem: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    backgroundColor: '#fff',\n    padding: 16,\n    borderRadius: 12,\n    marginBottom: 12,\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.05,\n    shadowRadius: 4,\n    elevation: 2\n  },\n  featureText: {\n    fontSize: 16,\n    color: '#1e293b',\n    marginHorizontal: 12,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  loginButton: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: '#3b82f6',\n    borderRadius: 12,\n    padding: 16,\n    width: '100%',\n    marginBottom: 24\n  },\n  loginButtonText: {\n    fontSize: 18,\n    color: '#fff',\n    fontWeight: '600',\n    marginHorizontal: 8\n  },\n  disclaimerCard: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'flex-start',\n    backgroundColor: '#f0fdf4',\n    borderRadius: 12,\n    padding: 16,\n    width: '100%',\n    marginBottom: 24\n  },\n  disclaimerText: {\n    flex: 1,\n    fontSize: 13,\n    color: '#166534',\n    marginHorizontal: 12,\n    lineHeight: 18,\n    textAlign: I18nManager.isRTL ? 'right' : 'left'\n  },\n  languageButton: {\n    flexDirection: I18nManager.isRTL ? 'row-reverse' : 'row',\n    alignItems: 'center',\n    padding: 12\n  },\n  languageButtonText: {\n    fontSize: 16,\n    color: '#64748b',\n    marginHorizontal: 8\n  }\n});\n","path":null,"size_bytes":5274,"size_tokens":null},"server/replit_integrations/audio/index.ts":{"content":"export { registerAudioRoutes } from \"./routes\";\nexport {\n  openai,\n  detectAudioFormat,\n  convertToWav,\n  ensureCompatibleFormat,\n  type AudioFormat,\n  voiceChat,\n  voiceChatStream,\n  textToSpeech,\n  textToSpeechStream,\n  speechToText,\n  speechToTextStream,\n} from \"./client\";\n","path":null,"size_bytes":277,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"server/dietPlanGenerator.ts":{"content":"import OpenAI from \"openai\";\nimport { searchRelevantKnowledge, learnFromDietPlanGeneration } from \"./knowledgeEngine\";\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\ninterface UserHealthData {\n  weight: number | null;\n  height: number | null;\n  age: number | null;\n  gender: string | null;\n  fitnessGoal: string | null;\n  activityLevel: string | null;\n  mealPreference: string | null;\n  hasAllergies: boolean | null;\n  allergies: string[] | null;\n  proteinPreference: string | null;\n  proteinPreferences: string[] | null;\n  carbPreferences: string[] | null;\n  language: string;\n  testResults: {\n    testId?: string;\n    testName: string;\n    value: number | null;\n    status: string;\n    normalRangeMin: number | null;\n    normalRangeMax: number | null;\n    unit: string | null;\n    category: string;\n  }[];\n}\n\nexport interface DietPlanResult {\n  healthSummary: string;\n  summary: string;\n  goalDescription: string;\n  calories: {\n    bmr: number;\n    tdee: number;\n    target: number;\n    deficit_or_surplus: number;\n  };\n  macros: {\n    protein: { grams: number; percentage: number };\n    carbs: { grams: number; percentage: number };\n    fats: { grams: number; percentage: number };\n  };\n  intakeAlignment: string;\n  deficiencies: { name: string; current: string; target: string; foods: string[] }[];\n  supplements: { name: string; dosage: string; reason: string; duration: string; foodSources: string[]; targetLabValue: string; scientificBasis: string }[];\n  mealPlan: {\n    breakfast: { name: string; description: string; calories: number; protein: number; carbs: number; fats: number; benefits: string }[];\n    lunch: { name: string; description: string; calories: number; protein: number; carbs: number; fats: number; benefits: string }[];\n    dinner: { name: string; description: string; calories: number; protein: number; carbs: number; fats: number; benefits: string }[];\n    snacks: { name: string; description: string; calories: number; protein: number; carbs: number; fats: number; benefits: string }[];\n  };\n  tips: string[];\n  warnings: string[];\n  conditionTips: { condition: string; advice: string[]; avoidFoods: string[] }[];\n  references: string[];\n}\n\nfunction calculateBMR(weight: number, height: number, age: number, gender: string): number {\n  if (gender === \"male\") {\n    return 10 * weight + 6.25 * height - 5 * age + 5;\n  }\n  return 10 * weight + 6.25 * height - 5 * age - 161;\n}\n\nfunction getActivityMultiplier(level: string): number {\n  switch (level) {\n    case \"sedentary\": return 1.2;\n    case \"lightly_active\": return 1.375;\n    case \"very_active\": return 1.725;\n    case \"extremely_active\": return 1.9;\n    default: return 1.375;\n  }\n}\n\nfunction calculateTDEE(bmr: number, activityLevel: string): number {\n  return Math.round(bmr * getActivityMultiplier(activityLevel));\n}\n\nfunction getTargetCalories(tdee: number, bmr: number, goal: string, hasSevereDeficiency: boolean): { target: number; delta: number } {\n  if (goal === \"weight_loss\") {\n    let deficit = 500;\n    if (hasSevereDeficiency) {\n      deficit = 200;\n    }\n    const target = Math.max(Math.round(tdee - deficit), bmr);\n    return { target, delta: target - tdee };\n  }\n  if (goal === \"muscle_gain\") {\n    return { target: Math.round(tdee + 300), delta: 300 };\n  }\n  return { target: tdee, delta: 0 };\n}\n\nfunction getMacroTargets(targetCalories: number, goal: string, preference: string, weight: number) {\n  let proteinPerKg: number, fatPercentage: number, minCarbGrams: number;\n\n  if (preference === \"high_protein\") {\n    proteinPerKg = goal === \"muscle_gain\" ? 2.4 : 2.2;\n    fatPercentage = 0.20;\n    minCarbGrams = 0;\n  } else if (preference === \"low_carb\") {\n    proteinPerKg = 1.8;\n    fatPercentage = 0.50;\n    minCarbGrams = Math.round(weight * 1.5);\n  } else if (preference === \"keto\") {\n    proteinPerKg = 1.6;\n    fatPercentage = 0.70;\n    minCarbGrams = Math.round(weight * 0.3);\n  } else if (preference === \"vegetarian\") {\n    proteinPerKg = 1.4;\n    fatPercentage = 0.30;\n    minCarbGrams = 0;\n  } else {\n    minCarbGrams = 0;\n    switch (goal) {\n      case \"weight_loss\":\n        proteinPerKg = 2.0;\n        fatPercentage = 0.25;\n        break;\n      case \"muscle_gain\":\n        proteinPerKg = 2.2;\n        fatPercentage = 0.25;\n        break;\n      default:\n        proteinPerKg = 1.6;\n        fatPercentage = 0.30;\n    }\n  }\n\n  const proteinGrams = Math.round(weight * proteinPerKg);\n  const proteinCalories = proteinGrams * 4;\n  const fatCalories = Math.round(targetCalories * fatPercentage);\n  const fatGrams = Math.round(fatCalories / 9);\n  let carbCalories = targetCalories - proteinCalories - fatCalories;\n  let carbGrams = Math.round(Math.max(carbCalories, 0) / 4);\n\n  if ((preference === \"low_carb\" || preference === \"keto\") && carbGrams < minCarbGrams) {\n    carbGrams = minCarbGrams;\n    carbCalories = carbGrams * 4;\n    const remaining = targetCalories - proteinCalories - carbCalories;\n    const adjustedFatGrams = Math.round(Math.max(remaining, 0) / 9);\n    return {\n      protein: { grams: proteinGrams, percentage: Math.round((proteinCalories / targetCalories) * 100) },\n      carbs: { grams: carbGrams, percentage: Math.round((carbCalories / targetCalories) * 100) },\n      fats: { grams: adjustedFatGrams, percentage: Math.round((adjustedFatGrams * 9 / targetCalories) * 100) },\n    };\n  }\n\n  return {\n    protein: { grams: proteinGrams, percentage: Math.round((proteinCalories / targetCalories) * 100) },\n    carbs: { grams: carbGrams, percentage: Math.round((Math.max(carbCalories, 0) / targetCalories) * 100) },\n    fats: { grams: fatGrams, percentage: Math.round((fatCalories / targetCalories) * 100) },\n  };\n}\n\nfunction detectSevereDeficiencies(testResults: UserHealthData[\"testResults\"]): { hasSevere: boolean; list: string[] } {\n  const severeList: string[] = [];\n  const criticalTestIds = [\"vitamin-d\", \"iron\", \"vitamin-b12\", \"hemoglobin\", \"ferritin\", \"calcium\", \"folate\"];\n\n  for (const t of testResults) {\n    if (t.value == null) continue;\n    if (t.status === \"low\") {\n      const id = (t.testId || \"\").toLowerCase();\n      if (criticalTestIds.some(ct => id === ct || id.includes(ct))) {\n        severeList.push(t.testName);\n      }\n    }\n  }\n  return { hasSevere: severeList.length > 0, list: severeList };\n}\n\nexport async function generateDietPlan(userData: UserHealthData): Promise<DietPlanResult> {\n  const isArabic = userData.language === \"ar\";\n  const goal = userData.fitnessGoal || \"maintain\";\n  const activityLevel = userData.activityLevel || \"sedentary\";\n  const mealPreference = userData.mealPreference || \"balanced\";\n  const allergies = userData.allergies || [];\n  const hasAllergies = userData.hasAllergies || false;\n  const proteinPref = userData.proteinPreference || \"mixed\";\n  const proteinPrefs = userData.proteinPreferences && userData.proteinPreferences.length > 0\n    ? userData.proteinPreferences\n    : [proteinPref];\n  const carbPrefs = userData.carbPreferences || [];\n\n  const abnormalTests = userData.testResults.filter(t => t.status === \"low\" || t.status === \"high\");\n  const normalTests = userData.testResults.filter(t => t.status === \"normal\");\n\n  const weight = userData.weight || 70;\n  const height = userData.height || 170;\n  const age = userData.age || 30;\n  const gender = userData.gender || \"male\";\n\n  const { hasSevere: hasSevereDeficiency, list: severeDeficiencyList } = detectSevereDeficiencies(userData.testResults);\n\n  const bmr = Math.round(calculateBMR(weight, height, age, gender));\n  const tdee = calculateTDEE(bmr, activityLevel);\n  const { target: targetCalories, delta } = getTargetCalories(tdee, bmr, goal, hasSevereDeficiency);\n  const macros = getMacroTargets(targetCalories, goal, mealPreference, weight);\n\n  const currentProteinPerKg = mealPreference === \"high_protein\"\n    ? (goal === \"muscle_gain\" ? 2.4 : 2.2)\n    : mealPreference === \"low_carb\" ? 1.8\n    : mealPreference === \"keto\" ? 1.6\n    : mealPreference === \"vegetarian\" ? 1.4\n    : goal === \"weight_loss\" ? 2.0\n    : goal === \"muscle_gain\" ? 2.2 : 1.6;\n  const currentMinCarbGrams = mealPreference === \"keto\" ? Math.round(weight * 0.3)\n    : mealPreference === \"low_carb\" ? Math.round(weight * 1.5) : 0;\n\n  const bmi = (weight / Math.pow(height / 100, 2)).toFixed(1);\n  const bmiCategory = parseFloat(bmi) < 18.5 ? \"underweight\" : parseFloat(bmi) < 25 ? \"healthy\" : parseFloat(bmi) < 30 ? \"overweight\" : \"obese\";\n\n  const allergyNames: Record<string, { en: string; ar: string }> = {\n    eggs: { en: \"Eggs\", ar: \"بيض\" },\n    dairy: { en: \"Dairy\", ar: \"مشتقات الألبان\" },\n    peanuts: { en: \"Peanuts\", ar: \"فول سوداني\" },\n    nuts: { en: \"Nuts\", ar: \"مكسرات\" },\n    seafood: { en: \"Seafood\", ar: \"مأكولات بحرية\" },\n    soy: { en: \"Soy\", ar: \"صويا\" },\n    sesame: { en: \"Sesame\", ar: \"سمسم\" },\n    wheat: { en: \"Wheat\", ar: \"قمح\" },\n    fish: { en: \"Fish\", ar: \"سمك\" },\n  };\n\n  const allergyList = hasAllergies && allergies.length > 0\n    ? allergies.map(a => isArabic ? (allergyNames[a]?.ar || a) : (allergyNames[a]?.en || a)).join(\", \")\n    : \"\";\n\n  const activityLabels: Record<string, { en: string; ar: string }> = {\n    sedentary: { en: \"Sedentary\", ar: \"قليل الحركة\" },\n    lightly_active: { en: \"Lightly Active\", ar: \"نشيط بشكل خفيف\" },\n    very_active: { en: \"Very Active\", ar: \"نشيط بشكل عالي\" },\n    extremely_active: { en: \"Extremely Active\", ar: \"نشيط بشكل عالي جداً\" },\n  };\n\n  const preferenceLabels: Record<string, { en: string; ar: string }> = {\n    high_protein: { en: \"High Protein\", ar: \"عالية البروتين\" },\n    balanced: { en: \"Balanced\", ar: \"متوازنة\" },\n    low_carb: { en: \"Low Carb\", ar: \"لو-كارب\" },\n    keto: { en: \"Keto\", ar: \"كيتو\" },\n    vegetarian: { en: \"Vegetarian\", ar: \"نباتية\" },\n    custom_macros: { en: \"Custom Macros\", ar: \"ماكروز مخصصة\" },\n  };\n\n  const proteinPrefLabels: Record<string, { en: string; ar: string }> = {\n    fish: { en: \"Fish\", ar: \"أسماك\" },\n    chicken: { en: \"Chicken\", ar: \"دجاج\" },\n    meat: { en: \"Red Meat\", ar: \"لحوم حمراء\" },\n    vegetarian: { en: \"Vegetarian (Legumes, Tofu, Lentils)\", ar: \"نباتي (بقوليات، توفو، عدس)\" },\n    mixed: { en: \"Mixed (all types)\", ar: \"متنوع (جميع الأنواع)\" },\n  };\n\n  const carbPrefLabels: Record<string, { en: string; ar: string }> = {\n    rice: { en: \"Rice\", ar: \"أرز\" },\n    bread: { en: \"Bread\", ar: \"خبز\" },\n    pasta: { en: \"Pasta\", ar: \"معكرونة\" },\n    oats: { en: \"Oats\", ar: \"شوفان\" },\n    potato: { en: \"Potato\", ar: \"بطاطس\" },\n    sweet_potato: { en: \"Sweet Potato\", ar: \"بطاطا حلوة\" },\n    quinoa: { en: \"Quinoa\", ar: \"كينوا\" },\n    bulgur: { en: \"Bulgur\", ar: \"برغل\" },\n    keto: { en: \"Keto (Nuts & Seeds)\", ar: \"كيتو (مكسرات وبذور)\" },\n    corn: { en: \"Corn\", ar: \"ذرة\" },\n    beans: { en: \"Beans & Legumes\", ar: \"بقوليات\" },\n    fruits: { en: \"Fruits\", ar: \"فواكه\" },\n  };\n\n  const testsDescription = userData.testResults\n    .filter(t => t.value != null)\n    .map(t => {\n      const statusText = t.status === \"low\" ? \"LOW\" : t.status === \"high\" ? \"HIGH\" : \"NORMAL\";\n      const range = t.normalRangeMin != null && t.normalRangeMax != null\n        ? `(normal: ${t.normalRangeMin}-${t.normalRangeMax} ${t.unit || \"\"})`\n        : \"\";\n      return `- ${t.testName}: ${t.value} ${t.unit || \"\"} [${statusText}] ${range}`;\n    })\n    .join(\"\\n\");\n\n  const goalDescriptions: Record<string, { en: string; ar: string }> = {\n    weight_loss: {\n      en: \"Weight Loss - Low calorie diet to lose fat while preserving muscle\",\n      ar: \"نزول الوزن - نظام منخفض السعرات لخسارة الدهون مع الحفاظ على العضلات\",\n    },\n    maintain: {\n      en: \"Weight Maintenance - Balanced diet to maintain current weight and correct deficiencies\",\n      ar: \"ثبات الوزن - نظام متوازن للحفاظ على الوزن الحالي وتعديل النواقص\",\n    },\n    muscle_gain: {\n      en: \"Muscle Gain - Clean calorie surplus for building lean muscle with healthy food sources only\",\n      ar: \"زيادة الوزن (عضل) - زيادة سعرات من مصادر نظيفة وصحية لبناء العضلات فقط\",\n    },\n  };\n\n  const proteinListAr = proteinPrefs.map(p => proteinPrefLabels[p]?.ar || p).join(\"، \");\n  const proteinListEn = proteinPrefs.map(p => proteinPrefLabels[p]?.en || p).join(\", \");\n\n  const proteinInstruction = mealPreference !== \"vegetarian\"\n    ? isArabic\n      ? `\\n- ⚠️ قاعدة صارمة: المستخدم اختار هذه البروتينات فقط: [${proteinListAr}]. يُمنع منعاً باتاً استخدام أي نوع بروتين لم يختره المستخدم. إذا اختار \"دجاج\" فقط، لا تضع سمك أو لحم. إذا اختار \"دجاج ولحم حمراء\"، لا تضع سمك. نوّع بين الأنواع المختارة فقط.`\n      : `\\n- STRICT RULE: The user selected ONLY these proteins: [${proteinListEn}]. You MUST NOT include any protein source the user did NOT select. If they chose only \"Chicken\", do NOT include fish or red meat. If they chose \"Chicken and Red Meat\", do NOT include fish. Rotate ONLY between the selected types.`\n    : \"\";\n\n  const carbListAr = carbPrefs.map(c => carbPrefLabels[c]?.ar || c).join(\"، \");\n  const carbListEn = carbPrefs.map(c => carbPrefLabels[c]?.en || c).join(\", \");\n\n  const carbInstruction = carbPrefs.length > 0\n    ? isArabic\n      ? `\\n- ⚠️ قاعدة صارمة: المستخدم اختار هذه الكربوهيدرات فقط: [${carbListAr}]. يُمنع منعاً باتاً استخدام أي مصدر كربوهيدرات لم يختره المستخدم. إذا اختار \"شوفان وأرز\" فقط، لا تضع خبز أو معكرونة أو بطاطس. استخدم فقط ما اختاره المستخدم.`\n      : `\\n- STRICT RULE: The user selected ONLY these carb sources: [${carbListEn}]. You MUST NOT include any carbohydrate source the user did NOT select. If they chose only \"Oats and Rice\", do NOT include bread, pasta, or potato. Use ONLY the user's selected carb sources.`\n    : \"\";\n\n  const toneInstruction = isArabic\n    ? `\\n\\nأسلوب مهم جداً:\n- لا تخوّف المستخدم! لا تستخدم كلمات مثل \"خطورة\" أو \"خطر الإصابة\" أو \"مرض\".\n- بدلاً من ذلك، استخدم أسلوب إيجابي ومشجع. مثلاً:\n  - بدل \"هناك خطورة للإصابة بالسكري\" → \"هدفنا تخفيض مستوى السكر الصائم للوصول إلى الحد الطبيعي\"\n  - بدل \"أنت معرض لأمراض القلب\" → \"نعمل على تحسين مستويات الدهون لصحة قلب أفضل\"\n  - بدل \"لديك نقص خطير\" → \"نسعى لرفع مستوى [الفيتامين/المعدن] للوصول إلى المعدل المثالي\"\n- الهدف هو مساعدة المستخدم للوصول إلى الصحة المثالية بأسلوب محفّز وإيجابي\n- ركز على ما يمكن فعله وليس على المخاطر\n- استخدم عبارات مثل: \"لتحسين\"، \"للوصول إلى المعدل الطبيعي\"، \"لتعزيز صحتك\"، \"خطوة نحو صحة أفضل\"`\n    : `\\n\\nIMPORTANT TONE GUIDELINES:\n- Do NOT scare the user! Never use words like \"risk\", \"danger\", \"disease risk\", or \"you are at risk of\".\n- Instead, use a positive, encouraging, supportive tone. For example:\n  - Instead of \"You are at risk of diabetes\" → \"Our goal is to bring your fasting sugar to the normal range\"\n  - Instead of \"You are at risk of heart disease\" → \"We're working on improving your lipid levels for better heart health\"\n  - Instead of \"You have a serious deficiency\" → \"Let's work on raising your [vitamin/mineral] to the optimal level\"\n- The goal is to help the user reach optimal health with a motivating, positive approach\n- Focus on what can be done, not on risks\n- Use phrases like: \"to improve\", \"to reach the normal range\", \"to boost your health\", \"a step toward better health\"`;\n\n  const supplementInstruction = isArabic\n    ? `\\n- بناءً على نتائج التحاليل والنواقص، اقترح مكملات غذائية محددة إذا لزم الأمر (مثل فيتامين د، حديد، ب12، أوميغا-3، إلخ). لكل مكمل حدد:\n  * \"name\": اسم المكمل\n  * \"dosage\": الجرعة المقترحة (مثال: \"1000 وحدة دولية يومياً\")\n  * \"reason\": سبب الحاجة مرتبط بنتيجة التحليل\n  * \"duration\": مدة الاستخدام المقترحة\n  * \"foodSources\": قائمة بـ 3-5 أطعمة طبيعية غنية بهذا العنصر مع الكمية (مثل: \"100 جرام سلمون = 600 وحدة دولية فيتامين د\")\n  * \"targetLabValue\": القيمة المستهدفة للتحليل المرتبط (مثال: \"فيتامين د: 30-50 نانوجرام/مل\")\n  * \"scientificBasis\": مرجع علمي مختصر يدعم التوصية (مثال: \"NIH Office of Dietary Supplements - توصيات الجرعة اليومية\")\n- ركز أولاً على تعويض النواقص من خلال الغذاء الطبيعي، وأضف المكملات فقط عند الحاجة الفعلية\n- اذكر المصادر الغذائية الطبيعية لكل مكمل حتى يمكن الحصول عليه من الطعام أيضاً\n- ⚠️ لا تقدم تشخيصاً طبياً. لا توصي بأدوية أو مكملات دوائية بجرعات علاجية. استخدم لغة إرشادية مثل \"يمكنك مناقشة مع طبيبك\" أو \"قد يكون من المفيد\"`\n    : `\\n- Based on lab results and deficiencies, suggest specific dietary supplements if needed (e.g., Vitamin D, Iron, B12, Omega-3, etc.). For each supplement provide:\n  * \"name\": Supplement name\n  * \"dosage\": Suggested dosage (e.g., \"1000 IU daily\")\n  * \"reason\": Reason linked to specific lab result\n  * \"duration\": Suggested duration of use\n  * \"foodSources\": List of 3-5 natural foods rich in this nutrient with amounts (e.g., \"100g salmon = 600 IU vitamin D\")\n  * \"targetLabValue\": Target value for the related lab test (e.g., \"Vitamin D: 30-50 ng/mL\")\n  * \"scientificBasis\": Brief scientific reference supporting the recommendation (e.g., \"NIH Office of Dietary Supplements - daily intake recommendations\")\n- Focus first on compensating deficiencies through natural food, and add supplements only when truly needed\n- List natural food sources for each supplement so the user can also get it from food\n- Do NOT provide medical diagnosis. Do NOT recommend pharmaceutical drugs or therapeutic dosages. Use guiding language like \"you may discuss with your doctor\" or \"it may be helpful to consider\".`;\n\n  const deficiencyCalorieNote = hasSevereDeficiency\n    ? isArabic\n      ? `\\n⚠️ تنبيه مهم: تم اكتشاف نقص في عناصر غذائية حيوية (${severeDeficiencyList.join(\"، \")}). لذلك ${goal === \"weight_loss\" ? \"تم تخفيف العجز الحراري إلى 200 سعرة فقط بدلاً من 500 لضمان حصول الجسم على ما يكفي من العناصر الغذائية أثناء نزول الوزن. الأولوية هي تصحيح النواقص أولاً.\" : \"الأولوية هي تصحيح هذه النواقص من خلال الغذاء الطبيعي قبل التركيز على السعرات.\"}\n- لا تقترح أي خطة غذائية تقل سعراتها عن BMR (${bmr} سعرة). هذا الحد الأدنى الآمن لوظائف الجسم الحيوية.`\n      : `\\nIMPORTANT: Severe nutritional deficiencies detected (${severeDeficiencyList.join(\", \")}). Therefore ${goal === \"weight_loss\" ? \"the calorie deficit has been reduced to only 200 kcal instead of 500 to ensure the body gets enough nutrients while losing weight. Priority is correcting deficiencies first.\" : \"priority is correcting these deficiencies through natural food before focusing on calories.\"}\n- NEVER suggest a diet plan below BMR (${bmr} kcal). This is the minimum safe threshold for vital body functions.`\n    : isArabic\n      ? `\\n- لا تقترح أي خطة غذائية تقل سعراتها عن BMR (${bmr} سعرة). هذا الحد الأدنى الآمن لوظائف الجسم الحيوية.`\n      : `\\n- NEVER suggest a diet plan below BMR (${bmr} kcal). This is the minimum safe threshold for vital body functions.`;\n\n  const bmiCategoryLabels: Record<string, { en: string; ar: string }> = {\n    underweight: { en: \"Underweight\", ar: \"أقل من الوزن الطبيعي\" },\n    healthy: { en: \"Healthy Weight\", ar: \"وزن صحي\" },\n    overweight: { en: \"Overweight\", ar: \"زيادة في الوزن\" },\n    obese: { en: \"Obesity\", ar: \"سمنة\" },\n  };\n\n  const systemPrompt = isArabic\n    ? `أنت خبير تغذية ودود ومحفّز يعمل بمنهجية طبية. مهمتك تصميم نظام غذائي مخصص بناءً على نتائج التحاليل الطبية والبيانات الجسدية للمستخدم.\n\n⸻ المنهجية المطلوبة (اتبعها بالترتيب): ⸻\n\n📋 الخطوة 1: التحقق الصحي أولاً\n- اقرأ جميع نتائج التحاليل وحدد: القيم الطبيعية، النقص، الارتفاع\n- أعطِ الأولوية لتصحيح أي خلل صحي قبل التوصية بعجز أو فائض حراري\n- اكتب \"healthSummary\" يتضمن: ملخص شامل للحالة الصحية بناءً على التحاليل (ما هو طبيعي، ما يحتاج تحسين، ما يحتاج متابعة)\n\n📊 الخطوة 2: حساب الطاقة (BMR / TDEE)\n- BMR = ${bmr} سعرة (الحد الأدنى الآمن - معادلة Mifflin-St Jeor)\n- TDEE = ${tdee} سعرة (بناءً على مستوى النشاط: ${activityLabels[activityLevel]?.ar || activityLevel})\n- السعرات المستهدفة = ${targetCalories} سعرة\n${deficiencyCalorieNote}\n\n🎯 الخطوة 3: مواءمة الهدف مع الحالة الصحية\n- الهدف: ${goalDescriptions[goal].ar}\n${goal === \"weight_loss\" && hasSevereDeficiency ? \"- ⚠️ يوجد نقص غذائي حاد → تم تخفيف العجز الحراري وتركيز النظام على تعويض النواقص أولاً\" : \"\"}\n${goal === \"weight_loss\" ? \"- استخدم عجزاً معتدلاً فقط. إذا وُجد نقص غذائي حاد → خفّف العجز أو أوقفه مؤقتاً وأوصِ بأطعمة داعمة\" : \"\"}\n- اكتب \"intakeAlignment\" يشرح: مدى توافق السعرات الحالية مع الهدف، ما يحتاج زيادة، ما يحتاج تقليل\n\n🔗 الخطوة 4: الربط بين الغذاء والتحاليل\n- اربط كل توصية غذائية بسبب صحي واضح من التحاليل\n- مثال: نقص فيتامين D → أطعمة غنية بفيتامين D | انخفاض الحديد → مصادر حديد + أطعمة تحسّن الامتصاص\n- في \"benefits\" لكل وجبة: اذكر بوضوح لماذا هذه الوجبة مفيدة وأي تحليل تساعد في تحسينه\n\n⸻ تعليمات النظام الغذائي: ⸻\n\nمستوى النشاط: ${activityLabels[activityLevel]?.ar || activityLevel}\nنوع الوجبات المفضل: ${preferenceLabels[mealPreference]?.ar || mealPreference}\nالبروتين المفضل: ${proteinListAr}\n${carbPrefs.length > 0 ? `الكربوهيدرات المفضلة: ${carbListAr}` : \"\"}\nBMI: ${bmi} (${bmiCategoryLabels[bmiCategory].ar})\n\nالسعرات المستهدفة: ${targetCalories} سعرة حرارية يومياً\nالبروتين: ${macros.protein.grams}جم | الكاربوهيدرات: ${macros.carbs.grams}جم | الدهون: ${macros.fats.grams}جم\n${toneInstruction}\n\nتعليمات مهمة:\n- هذا النظام الغذائي يجب أن يكون مصمماً خصيصاً لهذا المستخدم بناءً على: الطول (${height}سم)، الوزن (${weight}كجم)، الجنس (${gender === \"male\" ? \"ذكر\" : \"أنثى\"})، العمر (${age})، الهدف (${goalDescriptions[goal].ar})، ونتائج الفحوصات الطبية\n- صمم الوجبات بحيث تتوافق مع السعرات والماكرو المحدد أعلاه\n- ⚠️⚠️ قاعدة إلزامية: يجب تقديم بالضبط 5 خيارات مختلفة ومتنوعة لكل وجبة (فطور = 5 خيارات، غداء = 5 خيارات، عشاء = 5 خيارات، وجبات خفيفة = 5 خيارات). المجموع = 20 خيار وجبة. هذا شرط أساسي لا يمكن تجاوزه. لكي يختار المستخدم ما يناسبه ويغير يومياً${proteinInstruction}${carbInstruction}\n- ⚠️ قاعدة ذهبية: لا تضع أي مكون لم يختره المستخدم. النظام مبني فقط على اختيارات المستخدم من البروتين والكربوهيدرات. إذا لم يختر مصدراً معيناً، لا تدرجه في أي وجبة\n- ${goal === \"weight_loss\" ? \"ركز على وجبات مشبعة ومنخفضة السعرات وغنية بالبروتين والألياف\" : \"\"}\n- ${goal === \"muscle_gain\" ? \"ركز على مصادر غذاء نظيفة وصحية فقط (لا وجبات سريعة، لا دهون مشبعة مفرطة)\" : \"\"}\n- ${goal === \"maintain\" ? \"ركز على التوازن بين العناصر الغذائية وتعديل النواقص من خلال الطعام\" : \"\"}\n- ${mealPreference === \"high_protein\" ? \"⚠️ نظام عالي البروتين: ركز على بروتين بنسبة \" + macros.protein.percentage + \"% من السعرات (\" + macros.protein.grams + \" جرام/يوم = \" + currentProteinPerKg + \" جرام/كجم من وزن الجسم). وزّع البروتين بالتساوي على جميع الوجبات (30-50 جرام لكل وجبة رئيسية)\" : \"\"}\n- ${mealPreference === \"low_carb\" ? \"⚠️ نظام منخفض الكربوهيدرات (لو كارب): الكاربوهيدرات محددة بـ \" + macros.carbs.grams + \" جرام/يوم فقط وهي أقل نسبة آمنة يحتاجها الجسم (~\" + currentMinCarbGrams + \" جرام كحد أدنى = 1.5 جرام/كجم). عوّض السعرات المتبقية بالدهون الصحية (\" + macros.fats.percentage + \"%) والبروتين\" : \"\"}\n- ${mealPreference === \"keto\" ? \"⚠️ نظام كيتو: الكربوهيدرات منخفضة جداً \" + macros.carbs.grams + \" جرام/يوم (~\" + macros.carbs.percentage + \"% فقط) لإدخال الجسم في حالة الكيتوسيز. الدهون الصحية هي المصدر الرئيسي للطاقة (\" + macros.fats.percentage + \"% = \" + macros.fats.grams + \" جرام/يوم). ركز على: زيت الزيتون، الأفوكادو، المكسرات، الزبدة، جبن كامل الدسم. تجنب تماماً: الأرز، الخبز، المعكرونة، البطاطس، السكريات، الفواكه عالية السكر. الخضروات المسموحة: ورقية فقط (سبانخ، خس، بروكلي، كوسا، خيار)\" : \"\"}\n- ${mealPreference === \"balanced\" || mealPreference === \"custom_macros\" || (![\"high_protein\", \"low_carb\", \"keto\", \"vegetarian\"].includes(mealPreference)) ? \"نظام متوازن: وزّع العناصر الغذائية بشكل متوازن - بروتين \" + macros.protein.percentage + \"%، كربوهيدرات \" + macros.carbs.percentage + \"%، دهون \" + macros.fats.percentage + \"%\" : \"\"}\n- ${mealPreference === \"vegetarian\" ? \"جميع الوجبات نباتية - لا لحوم أو دواجن أو أسماك. اعتمد على البقوليات والحبوب والمكسرات كمصادر بروتين\" : \"\"}\n- ركز على الأطعمة التي تحسّن النواقص الموجودة في التحاليل وتساعد على تعويضها طبيعياً من خلال التغذية\n- حلّل نتائج الفحوصات وصمم الوجبات لمعالجة النواقص: إذا كان فيتامين د منخفض أضف أطعمة غنية به، إذا كان الحديد منخفض أضف مصادر حديد طبيعية، وهكذا\n${hasAllergies && allergyList ? `- ⚠️ حساسية المستخدم: ${allergyList}. يُمنع منعاً باتاً وضع أي مكون يسبب الحساسية في أي وجبة` : \"\"}\n- قدم وجبات عملية وسهلة التحضير ومتوفرة في المنطقة العربية\n- ⚠️ قاعدة إلزامية: يجب كتابة كل مكون بالجرامات بدقة في وصف الوجبة لضمان عدم تجاوز السعرات الحرارية المحددة. مثال: \"150 جرام صدر دجاج مشوي، 80 جرام أرز بسمتي، 100 جرام خضروات مشكلة، 10 مل زيت زيتون\". لا تكتب \"قطعة دجاج\" أو \"طبق أرز\" - يجب تحديد الوزن بالجرام لكل مكون\n- تأكد أن مجموع سعرات المكونات بالجرامات يتطابق مع السعرات المعلنة لكل وجبة\n- اذكر القيم الغذائية (بروتين، كارب، دهون) بالجرام لكل وجبة\n- اذكر الفوائد الصحية لكل وجبة وارتباطها بتحسين نتائج الفحوصات المحددة${supplementInstruction}\n- قدم نصائح غذائية عامة بأسلوب إيجابي ومحفّز بناءً على الحالة الصحية والهدف\n- أضف نصائح مخصصة لكل حالة صحية مكتشفة في \"conditionTips\" بأسلوب إيجابي (بدون تخويف)\n- إذا كانت هناك قيم تحتاج متابعة طبيب، اذكرها بلطف في \"warnings\" (مثال: \"ننصحك بمتابعة مستوى X مع طبيبك للاطمئنان\")\n\n⸻ السلامة الطبية: ⸻\n- لا تقدم تشخيصاً طبياً\n- لا توصي بمكملات دوائية بجرعات علاجية\n- استخدم لغة إرشادية غير علاجية (مثل: \"يمكنك مناقشة مع طبيبك\"، \"قد يكون من المفيد\")\n- جميع الردود يجب أن تكون باللغة العربية\n\n⚠️⚠️⚠️ قاعدة حرجة جداً:\n1. يُمنع منعاً باتاً استخدام \"...\" أو أي اختصار في أي حقل\n2. كل خيار من الـ 20 وجبة يجب أن يحتوي على بيانات كاملة في جميع الحقول (name, description, benefits)\n3. حقل \"name\" = اسم وصفي للوجبة (مثل: \"شوفان بالموز والعسل\"). يُمنع استخدام \"خيار 1\" أو \"خيار 2\"\n4. حقل \"description\" = جميع المكونات بالجرامات (مثل: \"60 جرام شوفان، 200 مل حليب\")\n5. حقل \"benefits\" = الفائدة الصحية المرتبطة بالتحاليل (مثل: \"يساعد في تحسين الكولسترول\")\n6. المثال أدناه يعرض خيارين فقط للاختصار، لكن يجب كتابة 5 خيارات كاملة لكل وجبة\n\nأرجع JSON بالشكل التالي (المثال يعرض 2 من 5 خيارات - اكتب 5 كاملة):\n{\n  \"healthSummary\": \"ملخص شامل للحالة الصحية بناءً على التحاليل\",\n  \"summary\": \"ملخص عام إيجابي عن الخطة الغذائية\",\n  \"goalDescription\": \"وصف مختصر للهدف والخطة بأسلوب تحفيزي\",\n  \"intakeAlignment\": \"شرح مفصل: هل السعرات المستهدفة تتوافق مع الهدف والحالة الصحية\",\n  \"deficiencies\": [{\"name\": \"اسم النقص\", \"current\": \"القيمة الحالية\", \"target\": \"القيمة المستهدفة\", \"foods\": [\"طعام 1 (وسبب اختياره)\", \"طعام 2\"]}],\n  \"supplements\": [{\"name\": \"اسم المكمل\", \"dosage\": \"الجرعة المقترحة\", \"reason\": \"سبب الحاجة مرتبط بالتحليل\", \"duration\": \"مدة الاستخدام\", \"foodSources\": [\"100 جرام سلمون = 600 وحدة دولية\", \"كوب حليب مدعم = 400 وحدة دولية\", \"بيضة واحدة = 40 وحدة دولية\"], \"targetLabValue\": \"فيتامين د: 30-50 نانوجرام/مل\", \"scientificBasis\": \"NIH Office of Dietary Supplements\"}],\n  \"mealPlan\": {\n    \"breakfast\": [\n      {\"name\": \"شوفان بالموز والعسل\", \"description\": \"60 جرام شوفان، 200 مل حليب قليل الدسم، موزة واحدة، 15 جرام عسل\", \"calories\": 420, \"protein\": 15, \"carbs\": 62, \"fats\": 12, \"benefits\": \"غني بالألياف يساعد في تحسين مستوى الكولسترول\"},\n      {\"name\": \"بيض مسلوق مع خبز أسمر\", \"description\": \"3 بيضات مسلوقة، شريحتين خبز أسمر، 50 جرام خيار\", \"calories\": 400, \"protein\": 24, \"carbs\": 35, \"fats\": 18, \"benefits\": \"مصدر ممتاز للبروتين لدعم العضلات\"}\n    ],\n    \"lunch\": [{\"name\": \"اسم وصفي\", \"description\": \"مكونات بالجرامات\", \"calories\": 0, \"protein\": 0, \"carbs\": 0, \"fats\": 0, \"benefits\": \"فائدة صحية\"}],\n    \"dinner\": [{\"name\": \"اسم وصفي\", \"description\": \"مكونات بالجرامات\", \"calories\": 0, \"protein\": 0, \"carbs\": 0, \"fats\": 0, \"benefits\": \"فائدة صحية\"}],\n    \"snacks\": [{\"name\": \"اسم وصفي\", \"description\": \"مكونات بالجرامات\", \"calories\": 0, \"protein\": 0, \"carbs\": 0, \"fats\": 0, \"benefits\": \"فائدة صحية\"}]\n  },\n  \"tips\": [\"نصيحة مع السبب الصحي\"],\n  \"warnings\": [\"ننصحك بمتابعة X مع طبيبك للاطمئنان\"],\n  \"conditionTips\": [{\"condition\": \"اسم الحالة\", \"advice\": [\"نصيحة 1\"], \"avoidFoods\": [\"طعام يفضل تقليله\"]}],\n  \"references\": [\"معادلة Mifflin-St Jeor لحساب BMR\", \"NHLBI BMI Calculator\", \"مرجع آخر\"]\n}`\n    : `You are a friendly, motivating nutrition expert who works with a medical methodology. Your mission is to design a personalized diet plan based on the user's lab results and physical data.\n\n⸻ REQUIRED METHODOLOGY (follow in order): ⸻\n\nSTEP 1: Health Verification First\n- Read ALL lab results and identify: normal values, deficiencies, elevated values\n- PRIORITIZE correcting any health imbalance BEFORE recommending calorie deficit or surplus\n- Write \"healthSummary\": comprehensive health status based on lab results (what's normal, what needs improvement, any correlations between results)\n\nSTEP 2: Energy Calculation (BMR / TDEE)\n- BMR = ${bmr} kcal (minimum safe threshold - Mifflin-St Jeor equation)\n- TDEE = ${tdee} kcal (based on activity level: ${activityLabels[activityLevel]?.en || activityLevel})\n- Target Calories = ${targetCalories} kcal\n${deficiencyCalorieNote}\n\nSTEP 3: Align Goal with Health Status\n- Goal: ${goalDescriptions[goal].en}\n${goal === \"weight_loss\" && hasSevereDeficiency ? \"- WARNING: Severe nutritional deficiencies detected → calorie deficit reduced, plan focuses on correcting deficiencies first\" : \"\"}\n${goal === \"weight_loss\" ? \"- Use MODERATE deficit only. If severe nutritional deficiencies exist → reduce deficit or pause it temporarily and recommend supportive foods instead of focusing only on calories\" : \"\"}\n- Write \"intakeAlignment\": explain whether current calorie target aligns with the goal, what needs to increase, what needs to decrease\n\nSTEP 4: Link Food to Lab Results\n- Link EVERY dietary recommendation to a clear health reason from lab results\n- Example: Low Vitamin D → Vitamin D-rich foods | Low Iron → iron sources + absorption-enhancing foods\n- In \"benefits\" for each meal: clearly state WHY this meal is beneficial and WHICH specific lab result it helps improve\n\n⸻ DIET PLAN INSTRUCTIONS: ⸻\n\nActivity Level: ${activityLabels[activityLevel]?.en || activityLevel}\nMeal Preference: ${preferenceLabels[mealPreference]?.en || mealPreference}\nProtein Preferences: ${proteinListEn}\n${carbPrefs.length > 0 ? `Carb Preferences: ${carbListEn}` : \"\"}\nBMI: ${bmi} (${bmiCategoryLabels[bmiCategory].en})\n\nTarget Calories: ${targetCalories} kcal/day\nProtein: ${macros.protein.grams}g | Carbs: ${macros.carbs.grams}g | Fats: ${macros.fats.grams}g\n${toneInstruction}\n\nImportant instructions:\n- This diet plan MUST be custom-designed for this specific user based on: Height (${height}cm), Weight (${weight}kg), Gender (${gender}), Age (${age}), Goal (${goalDescriptions[goal].en}), and their lab test results\n- Design meals that align with the calorie and macro targets above\n- MANDATORY: Provide EXACTLY 5 different varied options for each meal (breakfast = 5 options, lunch = 5 options, dinner = 5 options, snacks = 5 options). Total = 20 meal options. This is a NON-NEGOTIABLE requirement. The user needs to choose and rotate daily${proteinInstruction}${carbInstruction}\n- GOLDEN RULE: Do NOT include any ingredient the user did NOT select. The diet plan is built EXCLUSIVELY from the user's protein and carbohydrate choices. If a source was not selected, it MUST NOT appear in any meal\n- ${goal === \"weight_loss\" ? \"Focus on satiating, low-calorie meals rich in protein and fiber\" : \"\"}\n- ${goal === \"muscle_gain\" ? \"Focus on clean, healthy food sources ONLY (no fast food, no excessive saturated fats)\" : \"\"}\n- ${goal === \"maintain\" ? \"Focus on balanced nutrition and correcting deficiencies through food\" : \"\"}\n- ${mealPreference === \"high_protein\" ? \"HIGH PROTEIN PLAN: Focus on protein at \" + macros.protein.percentage + \"% of calories (\" + macros.protein.grams + \"g/day = \" + currentProteinPerKg + \"g/kg body weight). Distribute protein evenly across all meals (30-50g per main meal)\" : \"\"}\n- ${mealPreference === \"low_carb\" ? \"LOW CARB PLAN: Carbs limited to \" + macros.carbs.grams + \"g/day - the minimum safe amount (~\" + currentMinCarbGrams + \"g minimum = 1.5g/kg). Compensate remaining calories with healthy fats (\" + macros.fats.percentage + \"%) and protein\" : \"\"}\n- ${mealPreference === \"keto\" ? \"KETO PLAN: Very low carbs at \" + macros.carbs.grams + \"g/day (~\" + macros.carbs.percentage + \"% only) to put the body into ketosis. Healthy fats are the primary energy source (\" + macros.fats.percentage + \"% = \" + macros.fats.grams + \"g/day). Focus on: olive oil, avocado, nuts, butter, full-fat cheese. STRICTLY AVOID: rice, bread, pasta, potatoes, sugars, high-sugar fruits. Allowed vegetables: leafy only (spinach, lettuce, broccoli, zucchini, cucumber)\" : \"\"}\n- ${mealPreference === \"balanced\" || mealPreference === \"custom_macros\" || (![\"high_protein\", \"low_carb\", \"keto\", \"vegetarian\"].includes(mealPreference)) ? \"BALANCED PLAN: Distribute nutrients evenly - Protein \" + macros.protein.percentage + \"%, Carbs \" + macros.carbs.percentage + \"%, Fats \" + macros.fats.percentage + \"%\" : \"\"}\n- ${mealPreference === \"vegetarian\" ? \"All meals must be vegetarian - no meat, poultry, or fish. Rely on legumes, grains, and nuts as protein sources\" : \"\"}\n- Focus on foods that address deficiencies found in lab results and compensate naturally through nutrition\n- Analyze test results and design meals to treat deficiencies: if Vitamin D is low add foods rich in it, if Iron is low add natural iron sources, and so on\n${hasAllergies && allergyList ? `- ALLERGY WARNING: User is allergic to: ${allergyList}. You MUST NOT include any allergen-containing ingredient in any meal` : \"\"}\n- Provide practical, easy-to-prepare meals\n- MANDATORY RULE: Every ingredient in the meal description MUST be specified in grams. Example: \"150g grilled chicken breast, 80g basmati rice, 100g mixed vegetables, 10ml olive oil\". Do NOT write \"a piece of chicken\" or \"a plate of rice\" - specify the exact weight in grams for every single ingredient\n- Ensure the total calories from gram-specified ingredients match the declared calories for each meal\n- Include macronutrient breakdown (protein, carbs, fats) in grams for each meal\n- Mention health benefits of each meal and link them to specific lab result improvements${supplementInstruction}\n- Provide general dietary tips with a positive, encouraging tone based on the health condition and goal\n- Add personalized tips for each detected health condition in \"conditionTips\" with a positive tone (no scary language)\n- If there are values that need doctor follow-up, mention them gently in \"warnings\"\n\n⸻ MEDICAL SAFETY: ⸻\n- Do NOT provide medical diagnosis\n- Do NOT recommend pharmaceutical drugs or therapeutic dosages\n- Use guiding, non-therapeutic language (e.g., \"you may discuss with your doctor\", \"it may be helpful to consider\")\n- All responses must be in English\n\nCRITICAL RULES:\n1. You MUST NOT use \"...\" or any abbreviation in any field\n2. Every single one of the 20 meal options MUST have COMPLETE data in ALL fields (name, description, benefits)\n3. \"name\" = descriptive meal name (e.g., \"Oatmeal with Banana and Honey\"). NEVER use \"Option 1\" or \"Option 2\"\n4. \"description\" = ALL ingredients with gram weights (e.g., \"60g oats, 200ml low-fat milk\")\n5. \"benefits\" = health benefit linked to lab results (e.g., \"Helps improve cholesterol levels\")\n6. The example below shows only 2 options for brevity, but you MUST write 5 COMPLETE options for each meal\n\nReturn JSON in this format (example shows 2 of 5 options - write all 5 complete):\n{\n  \"healthSummary\": \"Comprehensive health status based on lab results\",\n  \"summary\": \"Positive summary of the diet plan\",\n  \"goalDescription\": \"Brief motivating description of the goal and plan\",\n  \"intakeAlignment\": \"Detailed explanation of calorie alignment with goal and health\",\n  \"deficiencies\": [{\"name\": \"Deficiency name\", \"current\": \"Current value\", \"target\": \"Target value\", \"foods\": [\"food 1 (reason)\", \"food 2\"]}],\n  \"supplements\": [{\"name\": \"Supplement name\", \"dosage\": \"Suggested dosage\", \"reason\": \"Reason linked to lab result\", \"duration\": \"Duration\", \"foodSources\": [\"100g salmon = 600 IU vitamin D\", \"1 cup fortified milk = 400 IU\", \"1 egg = 40 IU\"], \"targetLabValue\": \"Vitamin D: 30-50 ng/mL\", \"scientificBasis\": \"NIH Office of Dietary Supplements\"}],\n  \"mealPlan\": {\n    \"breakfast\": [\n      {\"name\": \"Oatmeal with Banana and Honey\", \"description\": \"60g oats, 200ml low-fat milk, 1 banana, 15g honey\", \"calories\": 420, \"protein\": 15, \"carbs\": 62, \"fats\": 12, \"benefits\": \"Rich in fiber, helps improve cholesterol levels\"},\n      {\"name\": \"Boiled Eggs with Brown Toast\", \"description\": \"3 boiled eggs, 2 slices brown bread, 50g cucumber\", \"calories\": 400, \"protein\": 24, \"carbs\": 35, \"fats\": 18, \"benefits\": \"Excellent protein source for muscle support\"}\n    ],\n    \"lunch\": [{\"name\": \"Descriptive meal name\", \"description\": \"ingredients with grams\", \"calories\": 0, \"protein\": 0, \"carbs\": 0, \"fats\": 0, \"benefits\": \"health benefit\"}],\n    \"dinner\": [{\"name\": \"Descriptive meal name\", \"description\": \"ingredients with grams\", \"calories\": 0, \"protein\": 0, \"carbs\": 0, \"fats\": 0, \"benefits\": \"health benefit\"}],\n    \"snacks\": [{\"name\": \"Descriptive meal name\", \"description\": \"ingredients with grams\", \"calories\": 0, \"protein\": 0, \"carbs\": 0, \"fats\": 0, \"benefits\": \"health benefit\"}]\n  },\n  \"tips\": [\"tip with health reason\"],\n  \"warnings\": [\"We recommend following up on X with your doctor for peace of mind\"],\n  \"conditionTips\": [{\"condition\": \"Condition (positive framing)\", \"advice\": [\"tip 1\"], \"avoidFoods\": [\"food to reduce\"]}],\n  \"references\": [\"Mifflin-St Jeor equation for BMR calculation\", \"NHLBI BMI Calculator (nhlbi.nih.gov)\", \"other relevant references\"]\n}`;\n\n  const userContent = isArabic\n    ? `بيانات المستخدم:\n- العمر: ${age} سنة\n- الجنس: ${gender === \"male\" ? \"ذكر\" : \"أنثى\"}\n- الوزن: ${weight} كجم\n- الطول: ${height} سم\n- مؤشر كتلة الجسم (BMI): ${bmi} (${bmiCategoryLabels[bmiCategory].ar})\n- الهدف: ${goalDescriptions[goal].ar}\n- مستوى النشاط: ${activityLabels[activityLevel]?.ar || activityLevel}\n- نوع الوجبات: ${preferenceLabels[mealPreference]?.ar || mealPreference}\n- البروتين المفضل: ${proteinListAr}\n${carbPrefs.length > 0 ? `- الكربوهيدرات المفضلة: ${carbListAr}` : \"\"}\n${hasAllergies && allergyList ? `- الحساسيات الغذائية: ${allergyList}` : \"- لا يوجد حساسيات غذائية\"}\n\nحسابات الطاقة:\n- BMR (معدل الأيض الأساسي): ${bmr} سعرة (الحد الأدنى الآمن - لا يمكن النزول عنه)\n- TDEE (إجمالي الطاقة اليومية): ${tdee} سعرة\n- السعرات المستهدفة: ${targetCalories} سعرة/يوم (${delta > 0 ? \"فائض +\" + delta : delta < 0 ? \"عجز \" + delta : \"ثبات\"} سعرة)\n- البروتين: ${macros.protein.grams}جم | الكاربوهيدرات: ${macros.carbs.grams}جم | الدهون: ${macros.fats.grams}جم\n${hasSevereDeficiency ? `\\n⚠️ تنبيه: تم اكتشاف نقص حاد في: ${severeDeficiencyList.join(\"، \")}. ${goal === \"weight_loss\" ? \"تم تخفيف العجز الحراري لضمان تعويض النواقص أولاً.\" : \"الأولوية تصحيح النواقص.\"}` : \"\"}\n\nنتائج التحاليل:\n${testsDescription || \"لا توجد نتائج تحاليل متوفرة\"}\n\nملخص:\n- فحوصات طبيعية: ${normalTests.length}\n- فحوصات غير طبيعية: ${abnormalTests.length}\n\nالمطلوب:\n1. ابدأ بتحليل الحالة الصحية من التحاليل (healthSummary)\n2. تحقق من أن السعرات آمنة (لا تقل عن BMR = ${bmr}) وتتوافق مع الحالة الصحية (intakeAlignment)\n3. صمم نظام غذائي مخصص 100% لهذا المستخدم\n4. استخدم فقط البروتينات التي اختارها: [${proteinListAr}]\n5. استخدم فقط الكربوهيدرات التي اختارها: [${carbPrefs.length > 0 ? carbListAr : \"لم يحدد\"}]\n6. اربط كل وجبة وتوصية بسبب صحي واضح من التحاليل\n7. عالج النواقص من خلال الغذاء الطبيعي أولاً\n8. اقترح مكملات فقط عند الحاجة الفعلية (بلغة إرشادية)\n9. قدم بالضبط 5 خيارات متنوعة لكل وجبة (فطور = 5، غداء = 5، عشاء = 5، وجبات خفيفة = 5) المجموع 20 خيار - لا تقدم أقل من 5\n10. أضف المراجع العلمية في \"references\"`\n    : `User data:\n- Age: ${age} years\n- Gender: ${gender}\n- Weight: ${weight} kg\n- Height: ${height} cm\n- BMI: ${bmi} (${bmiCategoryLabels[bmiCategory].en})\n- Goal: ${goalDescriptions[goal].en}\n- Activity Level: ${activityLabels[activityLevel]?.en || activityLevel}\n- Meal Preference: ${preferenceLabels[mealPreference]?.en || mealPreference}\n- Protein Preferences: ${proteinListEn}\n${carbPrefs.length > 0 ? `- Carb Preferences: ${carbListEn}` : \"\"}\n${hasAllergies && allergyList ? `- Food Allergies: ${allergyList}` : \"- No food allergies\"}\n\nEnergy Calculations:\n- BMR (Basal Metabolic Rate): ${bmr} kcal (minimum safe threshold - cannot go below this)\n- TDEE (Total Daily Energy Expenditure): ${tdee} kcal\n- Target Calories: ${targetCalories} kcal/day (${delta > 0 ? \"surplus +\" + delta : delta < 0 ? \"deficit \" + delta : \"maintenance\"} kcal)\n- Protein: ${macros.protein.grams}g | Carbs: ${macros.carbs.grams}g | Fats: ${macros.fats.grams}g\n${hasSevereDeficiency ? `\\nWARNING: Severe deficiencies detected in: ${severeDeficiencyList.join(\", \")}. ${goal === \"weight_loss\" ? \"Calorie deficit reduced to ensure deficiency correction first.\" : \"Priority is correcting deficiencies.\"}` : \"\"}\n\nLab Results:\n${testsDescription || \"No lab results available\"}\n\nSummary:\n- Normal tests: ${normalTests.length}\n- Abnormal tests: ${abnormalTests.length}\n\nRequirements:\n1. Start with health analysis from lab results (healthSummary)\n2. Verify calories are safe (not below BMR = ${bmr}) and aligned with health status (intakeAlignment)\n3. Design a 100% personalized diet plan for this specific user\n4. Use ONLY the proteins they selected: [${proteinListEn}]\n5. Use ONLY the carbs they selected: [${carbPrefs.length > 0 ? carbListEn : \"not specified\"}]\n6. Link every meal and recommendation to a clear health reason from lab results\n7. Treat deficiencies through natural food first\n8. Suggest supplements ONLY when truly needed (use guiding language)\n9. Provide EXACTLY 5 varied options for each meal (breakfast = 5, lunch = 5, dinner = 5, snacks = 5) Total 20 options - do NOT provide fewer than 5\n10. Add scientific references in \"references\"`;\n\n  let knowledgeContext = \"\";\n  try {\n    knowledgeContext = await searchRelevantKnowledge(\n      userData.testResults.map(t => ({\n        testName: t.testName,\n        status: t.status,\n        category: t.category,\n      })),\n      goal\n    );\n    if (knowledgeContext) {\n      console.log(`[KnowledgeEngine] Found relevant knowledge context (${knowledgeContext.length} chars)`);\n    }\n  } catch (err) {\n    console.warn(\"[KnowledgeEngine] Failed to fetch knowledge context:\", err);\n  }\n\n  const knowledgeSection = knowledgeContext\n    ? isArabic\n      ? `\\n\\n--- معلومات علمية من قاعدة المعرفة (استخدمها لتحسين التوصيات) ---\\n${knowledgeContext}`\n      : `\\n\\n--- Scientific Knowledge from Knowledge Base (use to enhance recommendations) ---\\n${knowledgeContext}`\n    : \"\";\n\n  const finalUserContent = userContent + knowledgeSection;\n\n  console.log(\"Calling OpenAI for diet plan generation...\");\n  const callStart = Date.now();\n  const response = await openai.chat.completions.create({\n    model: \"gpt-4o\",\n    messages: [\n      { role: \"system\", content: systemPrompt },\n      { role: \"user\", content: finalUserContent },\n    ],\n    max_completion_tokens: 16384,\n    temperature: 0.7,\n  });\n  console.log(`OpenAI response received in ${((Date.now() - callStart) / 1000).toFixed(1)}s`);\n\n  const content = response.choices[0]?.message?.content || \"{}\";\n\n  try {\n    const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n    if (!jsonMatch) throw new Error(\"No JSON found in response\");\n    const parsed = JSON.parse(jsonMatch[0]);\n\n    const defaultReferences = isArabic\n      ? [\n        \"معادلة Mifflin-St Jeor لحساب معدل الأيض الأساسي (BMR)\",\n        \"حاسبة مؤشر كتلة الجسم - المعهد الوطني للقلب والرئة والدم (NHLBI) - nhlbi.nih.gov\",\n        \"إرشادات التغذية - منظمة الصحة العالمية (WHO)\",\n        \"NIH Office of Dietary Supplements - ods.od.nih.gov\",\n        \"PubMed - المكتبة الوطنية للطب - pubmed.ncbi.nlm.nih.gov\",\n        \"Open Food Facts - قاعدة بيانات الملصقات الغذائية - openfoodfacts.org\",\n      ]\n      : [\n        \"Mifflin-St Jeor equation for Basal Metabolic Rate (BMR) calculation\",\n        \"NHLBI BMI Calculator - National Heart, Lung, and Blood Institute - nhlbi.nih.gov\",\n        \"WHO Dietary Guidelines\",\n        \"NIH Office of Dietary Supplements - ods.od.nih.gov\",\n        \"PubMed - National Library of Medicine - pubmed.ncbi.nlm.nih.gov\",\n        \"Open Food Facts - Food nutrition database - openfoodfacts.org\",\n      ];\n\n    const isPlaceholder = (val: string) => !val || val === \"...\" || val === \"…\" || val.trim().length < 3;\n\n    const cleanMeal = (m: any) => ({\n      name: m.name || \"\",\n      description: m.description || \"\",\n      calories: m.calories || 0,\n      protein: m.protein || 0,\n      carbs: m.carbs || 0,\n      fats: m.fats || 0,\n      benefits: m.benefits || \"\",\n    });\n\n    const sanitizedMealPlan = {\n      breakfast: (parsed.mealPlan?.breakfast || []).map(cleanMeal),\n      lunch: (parsed.mealPlan?.lunch || []).map(cleanMeal),\n      dinner: (parsed.mealPlan?.dinner || []).map(cleanMeal),\n      snacks: (parsed.mealPlan?.snacks || []).map(cleanMeal),\n    };\n\n    let incompleteMeals = 0;\n    for (const [section, meals] of Object.entries(sanitizedMealPlan)) {\n      for (const meal of meals as any[]) {\n        if (isPlaceholder(meal.name) || isPlaceholder(meal.description) || isPlaceholder(meal.benefits)) {\n          incompleteMeals++;\n          console.warn(`Incomplete meal in ${section}: name=\"${meal.name}\", desc=\"${(meal.description || \"\").slice(0, 30)}\", benefits=\"${(meal.benefits || \"\").slice(0, 30)}\"`);\n        }\n      }\n    }\n\n    for (const [section, meals] of Object.entries(sanitizedMealPlan)) {\n      if ((meals as any[]).length < 3) {\n        console.error(`REJECTED: ${section} has only ${(meals as any[]).length} options (minimum 3 required)`);\n        throw new Error(\"DIET_PLAN_INCOMPLETE\");\n      }\n    }\n\n    if (incompleteMeals > 4) {\n      console.error(`REJECTED: ${incompleteMeals} out of 20 meal options have incomplete data`);\n      throw new Error(\"DIET_PLAN_INCOMPLETE\");\n    } else if (incompleteMeals > 0) {\n      console.warn(`WARNING: ${incompleteMeals} meal options have incomplete data but within acceptable threshold`);\n    }\n\n    const result: DietPlanResult = {\n      healthSummary: parsed.healthSummary || \"\",\n      summary: parsed.summary || \"\",\n      goalDescription: parsed.goalDescription || \"\",\n      calories: {\n        bmr,\n        tdee,\n        target: targetCalories,\n        deficit_or_surplus: delta,\n      },\n      macros,\n      intakeAlignment: parsed.intakeAlignment || \"\",\n      deficiencies: parsed.deficiencies || [],\n      supplements: (parsed.supplements || []).map((s: any) => ({\n        name: s.name || \"\",\n        dosage: s.dosage || \"\",\n        reason: s.reason || \"\",\n        duration: s.duration || \"\",\n        foodSources: Array.isArray(s.foodSources) ? s.foodSources : [],\n        targetLabValue: s.targetLabValue || \"\",\n        scientificBasis: s.scientificBasis || \"\",\n      })),\n      mealPlan: sanitizedMealPlan,\n      tips: parsed.tips || [],\n      warnings: parsed.warnings || [],\n      conditionTips: parsed.conditionTips || [],\n      references: parsed.references && parsed.references.length > 0 ? parsed.references : defaultReferences,\n    };\n\n    learnFromDietPlanGeneration(\n      userData.testResults.map(t => ({\n        testName: t.testName,\n        status: t.status,\n        value: t.value,\n        unit: t.unit,\n      })),\n      result\n    ).catch(err => console.warn(\"[KnowledgeEngine] Failed to learn from generation:\", err));\n\n    return result;\n  } catch (error: any) {\n    if (error?.message === \"DIET_PLAN_INCOMPLETE\") {\n      throw error;\n    }\n    console.error(\"Failed to parse diet plan response:\", content?.slice(0, 500));\n    throw new Error(\"DIET_PLAN_PARSE_ERROR\");\n  }\n}\n","path":null,"size_bytes":54865,"size_tokens":null},"client/src/components/DashboardStats.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { \n  TestTube, \n  CheckCircle, \n  AlertCircle, \n  Bell,\n  FileText\n} from \"lucide-react\";\n\ninterface DashboardStatsProps {\n  totalTests: number;\n  normalTests: number;\n  abnormalTests: number;\n  pendingReminders: number;\n  recentUploads: number;\n}\n\nexport function DashboardStats({\n  totalTests,\n  normalTests,\n  abnormalTests,\n  pendingReminders,\n  recentUploads,\n}: DashboardStatsProps) {\n  const { t } = useTranslation();\n\n  const stats = [\n    {\n      label: t(\"totalTests\"),\n      value: totalTests,\n      icon: TestTube,\n      colorClass: \"text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900/30\",\n    },\n    {\n      label: t(\"normalTests\"),\n      value: normalTests,\n      icon: CheckCircle,\n      colorClass: \"text-emerald-600 dark:text-emerald-400 bg-emerald-100 dark:bg-emerald-900/30\",\n    },\n    {\n      label: t(\"abnormalTests\"),\n      value: abnormalTests,\n      icon: AlertCircle,\n      colorClass: \"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/30\",\n    },\n    {\n      label: t(\"pendingReminders\"),\n      value: pendingReminders,\n      icon: Bell,\n      colorClass: \"text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-900/30\",\n    },\n    {\n      label: t(\"recentUploads\"),\n      value: recentUploads,\n      icon: FileText,\n      colorClass: \"text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/30\",\n    },\n  ];\n\n  return (\n    <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4\">\n      {stats.map((stat) => (\n        <Card key={stat.label} className=\"hover-elevate\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2 space-y-0\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {stat.label}\n            </CardTitle>\n            <div className={`p-2 rounded-lg ${stat.colorClass}`}>\n              <stat.icon className=\"h-4 w-4\" />\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stat.value}</div>\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":2227,"size_tokens":null},"client/src/components/UploadedFilesHistory.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { format } from \"date-fns\";\nimport { ar, enUS } from \"date-fns/locale\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  FileText, \n  CheckCircle, \n  XCircle, \n  Loader2, \n  Clock, \n  Trash2, \n  RefreshCw,\n  AlertTriangle\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useState, useRef } from \"react\";\n\ninterface UploadedPdf {\n  id: string;\n  fileName: string;\n  status: \"pending\" | \"processing\" | \"success\" | \"failed\";\n  errorMessage: string | null;\n  testsExtracted: number | null;\n  createdAt: string;\n  processedAt: string | null;\n}\n\nexport function UploadedFilesHistory() {\n  const { t, i18n } = useTranslation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const isArabic = i18n.language === \"ar\";\n  const dateLocale = isArabic ? ar : enUS;\n  const [retryingId, setRetryingId] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const { data: uploadedPdfs = [], isLoading } = useQuery<UploadedPdf[]>({\n    queryKey: [\"/api/uploaded-pdfs\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/uploaded-pdfs/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/uploaded-pdfs\"] });\n      toast({\n        title: t(\"success\"),\n        description: t(\"fileDeleted\"),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"error\"),\n        description: t(\"deleteFileFailed\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const retryMutation = useMutation({\n    mutationFn: async ({ id, file }: { id: string; file: File }) => {\n      const formData = new FormData();\n      formData.append(\"pdf\", file);\n      const response = await fetch(`/api/uploaded-pdfs/${id}/retry`, {\n        method: \"POST\",\n        body: formData,\n      });\n      if (!response.ok) {\n        throw new Error(\"Retry failed\");\n      }\n      return response.json();\n    },\n    onSuccess: (result) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/uploaded-pdfs\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tests\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tests/all\"] });\n      setRetryingId(null);\n      toast({\n        title: t(\"success\"),\n        description: `${result.testsExtracted} ${t(\"testsFound\")}`,\n      });\n    },\n    onError: () => {\n      setRetryingId(null);\n      toast({\n        title: t(\"error\"),\n        description: t(\"retryFailed\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleRetryClick = (id: string) => {\n    setRetryingId(id);\n    fileInputRef.current?.click();\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file && retryingId) {\n      if (file.type === \"application/pdf\") {\n        retryMutation.mutate({ id: retryingId, file });\n      } else {\n        toast({\n          title: t(\"error\"),\n          description: t(\"pleaseUploadPdf\"),\n          variant: \"destructive\",\n        });\n        setRetryingId(null);\n      }\n    }\n    e.target.value = \"\";\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"success\":\n        return (\n          <Badge variant=\"default\" className=\"bg-emerald-600 gap-1\">\n            <CheckCircle className=\"h-3 w-3\" />\n            {t(\"processed\")}\n          </Badge>\n        );\n      case \"failed\":\n        return (\n          <Badge variant=\"destructive\" className=\"gap-1\">\n            <XCircle className=\"h-3 w-3\" />\n            {t(\"failed\")}\n          </Badge>\n        );\n      case \"processing\":\n        return (\n          <Badge variant=\"secondary\" className=\"gap-1\">\n            <Loader2 className=\"h-3 w-3 animate-spin\" />\n            {t(\"processing\")}\n          </Badge>\n        );\n      default:\n        return (\n          <Badge variant=\"outline\" className=\"gap-1\">\n            <Clock className=\"h-3 w-3\" />\n            {t(\"pending\")}\n          </Badge>\n        );\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"py-8 text-center\">\n          <Loader2 className=\"h-6 w-6 animate-spin mx-auto text-muted-foreground\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (uploadedPdfs.length === 0) {\n    return null;\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <FileText className=\"h-5 w-5\" />\n          {t(\"uploadedFiles\")}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"application/pdf\"\n          className=\"hidden\"\n          onChange={handleFileSelect}\n        />\n        <div className=\"space-y-3\">\n          {uploadedPdfs.map((pdf) => (\n            <div \n              key={pdf.id} \n              className=\"flex items-center justify-between p-3 border rounded-lg gap-3\"\n              data-testid={`file-item-${pdf.id}`}\n            >\n              <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                <FileText className=\"h-8 w-8 text-muted-foreground flex-shrink-0\" />\n                <div className=\"min-w-0 flex-1\">\n                  <p className=\"font-medium truncate\" title={pdf.fileName}>\n                    {pdf.fileName}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {pdf.createdAt && format(new Date(pdf.createdAt), \"PPp\", { locale: dateLocale })}\n                  </p>\n                  {pdf.status === \"success\" && pdf.testsExtracted !== null && (\n                    <p className=\"text-sm text-emerald-600 dark:text-emerald-400\">\n                      {pdf.testsExtracted} {t(\"testsExtracted\")}\n                    </p>\n                  )}\n                  {pdf.status === \"failed\" && pdf.errorMessage && (\n                    <p className=\"text-sm text-destructive flex items-center gap-1\">\n                      <AlertTriangle className=\"h-3 w-3\" />\n                      {pdf.errorMessage === \"SCANNED_PDF\" \n                        ? t(\"scannedPdfError\") \n                        : pdf.errorMessage === \"ANALYSIS_FAILED\"\n                          ? t(\"analysisFailedError\")\n                          : t(\"aiCouldNotRead\")}\n                    </p>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2 flex-shrink-0\">\n                {getStatusBadge(pdf.status)}\n                {pdf.status === \"failed\" && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => handleRetryClick(pdf.id)}\n                    disabled={retryMutation.isPending && retryingId === pdf.id}\n                    data-testid={`button-retry-${pdf.id}`}\n                  >\n                    {retryMutation.isPending && retryingId === pdf.id ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <RefreshCw className=\"h-4 w-4\" />\n                    )}\n                    <span className=\"ms-1\">{t(\"retry\")}</span>\n                  </Button>\n                )}\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => deleteMutation.mutate(pdf.id)}\n                  disabled={deleteMutation.isPending}\n                  data-testid={`button-delete-file-${pdf.id}`}\n                >\n                  <Trash2 className=\"h-4 w-4 text-destructive\" />\n                </Button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":8024,"size_tokens":null},"client/src/pages/Upload.tsx":{"content":"import { useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { PdfUploader } from \"@/components/PdfUploader\";\nimport { UploadedFilesHistory } from \"@/components/UploadedFilesHistory\";\n\nexport default function Upload() {\n  const queryClient = useQueryClient();\n  const [, setLocation] = useLocation();\n\n  const handleUploadComplete = (testsFound: number) => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/tests\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/reminders\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/uploaded-pdfs\"] });\n    \n    if (testsFound > 0) {\n      setTimeout(() => setLocation(\"/tests\"), 1500);\n    }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto space-y-6\">\n      <PdfUploader onUploadComplete={handleUploadComplete} />\n      <UploadedFilesHistory />\n    </div>\n  );\n}\n","path":null,"size_bytes":939,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <table\n    ref={ref}\n    className={cn(\"w-full caption-bottom text-sm\", className)}\n    {...props}\n  />\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2696,"size_tokens":null},"replit.md":{"content":"# BioTrack AI - AI-Powered Health Analysis Application\n**by Alshira company**\n\n## Overview\nBioTrack AI is a comprehensive health tracking application that analyzes PDF lab results using AI and helps users track 50 different medical tests. The app supports Arabic (default) and English languages with RTL support.\n\n## Key Features\n- **AI PDF Analysis**: Upload lab results and AI automatically extracts test values\n- **AI Diet Plan**: Personalized nutrition plans based on lab results, weight, height, and deficiencies\n- **Test Comparison**: Side-by-side comparison of old vs new test results with trend indicators\n- **50 Test Types**: Vitamins, minerals, hormones, organ functions, lipids, immunity, blood, coagulation, and special tests\n- **Color-Coded Results**: Red for abnormal (High/Low), green for normal\n- **7 Importance Levels**: Tests organized by clinical importance\n- **Bilingual**: Full Arabic and English support with RTL\n- **Recheck Reminders**: Automated alerts based on recommended intervals\n- **Subscription System**: Free (3 PDFs), Basic (20 PDFs), Premium (unlimited)\n\n## Recent Changes\n- **Health Verification First**: AI analyzes lab results and prioritizes correcting deficiencies BEFORE recommending calorie deficit/surplus\n- **BMR Safety Floor**: System never suggests diet plans below BMR (minimum safe calorie threshold)\n- **Smart Deficit Adjustment**: If severe deficiencies detected (vitamin D, iron, B12, etc.), calorie deficit is automatically reduced from 500 to 200 kcal\n- **Health Summary Section**: New section showing comprehensive health status from lab results\n- **Intake Alignment Section**: New section explaining how current calories align with goal and health status\n- **Food-Lab Linking**: Every meal's benefits field links to specific lab result improvements\n- **References Section**: Scientific references added at end of each diet plan (NHLBI BMI Calculator, Mifflin-St Jeor equation, WHO guidelines)\n- **Medical Safety**: No diagnosis, no drug supplements, guiding language only (\"discuss with your doctor\")\n- **Diet Plan Questionnaire**: 4-step questionnaire before generating diet plan (activity level, allergies, protein preference, meal preference)\n- **Protein Preference**: New question asking user if they prefer fish, chicken, red meat, or mixed - AI uses this to customize meals\n- **3 Meal Options**: Each meal (breakfast, lunch, dinner) provides 3 varied options for daily rotation\n- **Activity-Based TDEE**: TDEE calculation uses actual activity level (sedentary/light/very/extremely active)\n- **Allergy Support**: 9 common allergens can be excluded from diet plan (eggs, dairy, peanuts, nuts, seafood, soy, sesame, wheat, fish)\n- **Meal Preferences**: High protein, balanced, low carb, vegetarian, custom macros with macro range visualization\n- **Enhanced Supplement Recommendations**: AI suggests specific supplements with dosage, duration, natural food sources (with gram amounts), target lab values, and scientific references (NIH, PubMed, Open Food Facts). Displayed with detailed cards showing food alternatives and scientific basis\n- **Deficiency Compensation**: Focus on compensating deficiencies through natural food first, supplements only when needed\n- **5 Meal Options**: Each meal section provides exactly 5 varied options (20 total) for daily rotation\n- **Positive Tone**: All tips use encouraging, supportive language - no scary medical warnings (e.g., \"bring sugar to normal range\" instead of \"risk of diabetes\")\n- **Condition-Based Tips**: Personalized health tips based on detected conditions with positive framing\n- **Navigation Restructure**: Hamburger menu (top-left) with My Tests and Compare; Bottom nav reduced to 4 items (Home, Upload, Diet, Profile)\n- **Nutrition Disclaimer**: Warning disclaimer shown before questionnaire starts\n- **Dashboard Shortcuts**: Quick access cards for Diet Plan and Compare Results on dashboard\n- **Reminder System**: Added calendar date picker in tests table for setting recheck reminders\n- **Tests Table Columns**: 8 columns (#, Test Name, Category, Your Value, Normal Range, Status, Test Date, Reminder)\n- **All 50 Tests Display**: Tests without results show value \"0\" ensuring complete table view\n- Added React Native/Expo mobile application for Android and iOS\n- Mobile app includes: Home, Tests, Upload, Reminders, Profile screens\n- Added authentication context and secure storage for mobile\n- Mobile app uses same backend API as web app\n- Initial implementation of complete health tracking system\n- Created 50 test definitions with Arabic/English names\n- Implemented PDF upload and AI analysis using Replit AI Integrations\n- Set up Replit Auth for user authentication\n- Created responsive UI with dark mode support\n- **Knowledge Base - Real Sources**: Rebuilt knowledge engine to fetch from REAL scientific sources (PubMed API + NIH ODS fact sheets). AI only summarizes fetched content, never generates from scratch. Every entry has verified source URL.\n- Knowledge engine fetches 3 topics per domain daily from PubMed (research abstracts) and NIH (fact sheets)\n- 5 domains: nutrition, aerobic training, resistance training, vitamins/minerals, hormones\n- All knowledge entries include real PubMed PMID links and NIH fact sheet URLs\n\n## Project Architecture\n\n### Web Frontend (client/src/)\n- **Framework**: React with Vite\n- **UI Library**: Shadcn/ui with Tailwind CSS\n- **State Management**: TanStack Query\n- **Routing**: Wouter\n- **i18n**: i18next with Arabic (default) and English\n\n### Mobile App (mobile/)\n- **Framework**: React Native with Expo\n- **Navigation**: React Navigation (bottom tabs + stack)\n- **State Management**: TanStack Query\n- **i18n**: i18next with Arabic (default) and English + RTL\n- **Secure Storage**: expo-secure-store for auth tokens\n- **Build System**: EAS Build for Android/iOS\n\n### Backend (server/)\n- **Framework**: Express.js with TypeScript\n- **Database**: PostgreSQL with Drizzle ORM\n- **Authentication**: Replit Auth (OpenID Connect)\n- **AI Integration**: OpenAI via Replit AI Integrations\n\n### Database Tables\n- `users` - User authentication (Replit Auth)\n- `sessions` - Session storage\n- `user_profiles` - Extended user data (health metrics, subscription)\n- `test_definitions` - 50 test types with normal ranges\n- `test_results` - User's test values\n- `reminders` - Recheck reminders\n- `uploaded_pdfs` - PDF upload tracking\n- `knowledge_base` - Scientific knowledge from PubMed/NIH (real sources only)\n- `knowledge_learning_log` - Tracks daily learning progress per domain\n\n## User Preferences\n- Default language: Arabic\n- RTL support for Arabic interface\n- Dark mode available\n\n## Important Paths\n\n### Web App\n- Main app: `/client/src/App.tsx`\n- API routes: `/server/routes.ts`\n- Database schema: `/shared/schema.ts`\n- Translations: `/client/src/lib/i18n.ts`\n- Test definitions seed: `/server/seedTests.ts`\n\n### Mobile App\n- Main app: `/mobile/App.tsx`\n- Screens: `/mobile/src/screens/`\n- Navigation: `/mobile/src/navigation/`\n- API client: `/mobile/src/lib/api.ts`\n- Translations: `/mobile/src/lib/i18n.ts`\n- Auth context: `/mobile/src/context/AuthContext.tsx`\n- Build config: `/mobile/app.json`, `/mobile/eas.json`\n\n## Running the Project\n\n### Web App\n- Development: `npm run dev`\n- Database push: `npm run db:push`\n- Seed tests: `npx tsx server/seedTests.ts`\n\n### Mobile App\n```bash\ncd mobile\nnpm install\nnpx expo start\n```\n\n### Building Mobile App for Stores\n```bash\ncd mobile\neas build --platform android --profile production\neas build --platform ios --profile production\n```\n","path":null,"size_bytes":7537,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/hooks/use-auth.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/models/auth\";\n\nasync function fetchUser(): Promise<User | null> {\n  const response = await fetch(\"/api/auth/user\", {\n    credentials: \"include\",\n  });\n\n  if (response.status === 401) {\n    return null;\n  }\n\n  if (!response.ok) {\n    throw new Error(`${response.status}: ${response.statusText}`);\n  }\n\n  return response.json();\n}\n\nasync function logout(): Promise<void> {\n  window.location.href = \"/api/logout\";\n}\n\nexport function useAuth() {\n  const queryClient = useQueryClient();\n  const { data: user, isLoading } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: fetchUser,\n    retry: false,\n    staleTime: 1000 * 60 * 5, // 5 minutes\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: logout,\n    onSuccess: () => {\n      queryClient.setQueryData([\"/api/auth/user\"], null);\n    },\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    logout: logoutMutation.mutate,\n    isLoggingOut: logoutMutation.isPending,\n  };\n}\n","path":null,"size_bytes":1091,"size_tokens":null},"server/replit_integrations/auth/routes.ts":{"content":"import type { Express } from \"express\";\nimport { authStorage } from \"./storage\";\nimport { isAuthenticated } from \"./replitAuth\";\n\n// Register auth-specific routes\nexport function registerAuthRoutes(app: Express): void {\n  // Get current authenticated user\n  app.get(\"/api/auth/user\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await authStorage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n}\n","path":null,"size_bytes":609,"size_tokens":null},"mobile/src/lib/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport { I18nManager } from 'react-native';\n\nconst resources = {\n  ar: {\n    translation: {\n      appName: 'BioTrack AI',\n      companyName: 'by Alshira company',\n      home: 'الرئيسية',\n      tests: 'الفحوصات',\n      upload: 'رفع PDF',\n      profile: 'الملف الشخصي',\n      settings: 'الإعدادات',\n      login: 'تسجيل الدخول',\n      logout: 'تسجيل الخروج',\n      welcome: 'مرحباً بك في BioTrack AI',\n      subtitle: 'تحليل نتائج فحوصاتك الطبية بالذكاء الاصطناعي',\n      uploadPdf: 'رفع ملف PDF',\n      selectFile: 'اختر ملف',\n      analyzing: 'جاري التحليل...',\n      myTests: 'فحوصاتي',\n      allTests: 'جميع الفحوصات',\n      abnormal: 'غير طبيعي',\n      normal: 'طبيعي',\n      high: 'مرتفع',\n      low: 'منخفض',\n      testName: 'اسم الفحص',\n      value: 'القيمة',\n      normalRange: 'المعدل الطبيعي',\n      status: 'الحالة',\n      date: 'التاريخ',\n      categories: {\n        vitamins: 'فيتامينات',\n        minerals: 'معادن',\n        hormones: 'هرمونات',\n        organs: 'وظائف الأعضاء',\n        lipids: 'دهون',\n        immunity: 'مناعة',\n        blood: 'فحوصات الدم',\n        coagulation: 'تخثر الدم',\n        special: 'فحوصات خاصة'\n      },\n      importance: {\n        critical: 'حرج',\n        veryHigh: 'عالي جداً',\n        high: 'عالي',\n        medium: 'متوسط',\n        low: 'منخفض',\n        routine: 'روتيني',\n        optional: 'اختياري'\n      },\n      subscription: {\n        free: 'مجاني',\n        basic: 'أساسي',\n        premium: 'متقدم',\n        remaining: 'ملفات متبقية',\n        upgrade: 'ترقية الاشتراك'\n      },\n      reminders: {\n        title: 'التذكيرات',\n        recheck: 'إعادة الفحص',\n        dueIn: 'مستحق خلال',\n        days: 'يوم',\n        overdue: 'متأخر'\n      },\n      disclaimer: {\n        title: 'تنبيه طبي هام',\n        text: 'هذا التطبيق للأغراض التوعوية فقط ولا يغني عن استشارة الطبيب المختص. يرجى مراجعة طبيبك لتفسير النتائج واتخاذ القرارات الطبية.',\n        understand: 'أفهم ذلك'\n      },\n      profile: {\n        age: 'العمر',\n        gender: 'الجنس',\n        male: 'ذكر',\n        female: 'أنثى',\n        height: 'الطول (سم)',\n        weight: 'الوزن (كجم)',\n        bloodType: 'فصيلة الدم',\n        save: 'حفظ'\n      },\n      errors: {\n        uploadFailed: 'فشل رفع الملف',\n        analysisFailed: 'فشل التحليل',\n        loginRequired: 'يرجى تسجيل الدخول',\n        limitReached: 'وصلت للحد الأقصى'\n      },\n      pending: 'معلق',\n      testsCompleted: 'فحص مكتمل',\n      yourValue: 'قيمتك',\n      testDate: 'تاريخ الفحص',\n      loading: 'جاري التحميل...',\n      noData: 'لا توجد بيانات',\n      vitamins: 'الفيتامينات',\n      minerals: 'المعادن',\n      hormones: 'الهرمونات',\n      organ_functions: 'وظائف الأعضاء',\n      lipids: 'الدهون',\n      immunity: 'المناعة',\n      blood: 'فحوصات الدم',\n      coagulation: 'التخثر',\n      special: 'فحوصات خاصة'\n    }\n  },\n  en: {\n    translation: {\n      appName: 'BioTrack AI',\n      companyName: 'by Alshira company',\n      home: 'Home',\n      tests: 'Tests',\n      upload: 'Upload PDF',\n      profile: 'Profile',\n      settings: 'Settings',\n      login: 'Login',\n      logout: 'Logout',\n      welcome: 'Welcome to BioTrack AI',\n      subtitle: 'AI-powered analysis of your lab results',\n      uploadPdf: 'Upload PDF File',\n      selectFile: 'Select File',\n      analyzing: 'Analyzing...',\n      myTests: 'My Tests',\n      allTests: 'All Tests',\n      abnormal: 'Abnormal',\n      normal: 'Normal',\n      high: 'High',\n      low: 'Low',\n      testName: 'Test Name',\n      value: 'Value',\n      normalRange: 'Normal Range',\n      status: 'Status',\n      date: 'Date',\n      categories: {\n        vitamins: 'Vitamins',\n        minerals: 'Minerals',\n        hormones: 'Hormones',\n        organs: 'Organ Functions',\n        lipids: 'Lipids',\n        immunity: 'Immunity',\n        blood: 'Blood Tests',\n        coagulation: 'Coagulation',\n        special: 'Special Tests'\n      },\n      importance: {\n        critical: 'Critical',\n        veryHigh: 'Very High',\n        high: 'High',\n        medium: 'Medium',\n        low: 'Low',\n        routine: 'Routine',\n        optional: 'Optional'\n      },\n      subscription: {\n        free: 'Free',\n        basic: 'Basic',\n        premium: 'Premium',\n        remaining: 'files remaining',\n        upgrade: 'Upgrade Plan'\n      },\n      reminders: {\n        title: 'Reminders',\n        recheck: 'Recheck',\n        dueIn: 'Due in',\n        days: 'days',\n        overdue: 'Overdue'\n      },\n      disclaimer: {\n        title: 'Medical Disclaimer',\n        text: 'This app is for informational purposes only and does not replace professional medical advice. Please consult your doctor to interpret results and make medical decisions.',\n        understand: 'I Understand'\n      },\n      profile: {\n        age: 'Age',\n        gender: 'Gender',\n        male: 'Male',\n        female: 'Female',\n        height: 'Height (cm)',\n        weight: 'Weight (kg)',\n        bloodType: 'Blood Type',\n        save: 'Save'\n      },\n      errors: {\n        uploadFailed: 'Upload failed',\n        analysisFailed: 'Analysis failed',\n        loginRequired: 'Please login',\n        limitReached: 'Limit reached'\n      },\n      pending: 'Pending',\n      testsCompleted: 'tests completed',\n      yourValue: 'Your Value',\n      testDate: 'Test Date',\n      loading: 'Loading...',\n      noData: 'No data available',\n      vitamins: 'Vitamins',\n      minerals: 'Minerals',\n      hormones: 'Hormones',\n      organ_functions: 'Organ Functions',\n      lipids: 'Lipids',\n      immunity: 'Immunity',\n      blood: 'Blood Tests',\n      coagulation: 'Coagulation',\n      special: 'Special Tests'\n    }\n  }\n};\n\ni18n.use(initReactI18next).init({\n  resources,\n  lng: 'ar',\n  fallbackLng: 'ar',\n  interpolation: {\n    escapeValue: false\n  }\n});\n\nI18nManager.allowRTL(true);\nI18nManager.forceRTL(true);\n\nexport default i18n;\n","path":null,"size_bytes":6617,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"server/replit_integrations/chat/storage.ts":{"content":"import { db } from \"../../db\";\nimport { conversations, messages } from \"@shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\n\nexport interface IChatStorage {\n  getConversation(id: number): Promise<typeof conversations.$inferSelect | undefined>;\n  getAllConversations(): Promise<(typeof conversations.$inferSelect)[]>;\n  createConversation(title: string): Promise<typeof conversations.$inferSelect>;\n  deleteConversation(id: number): Promise<void>;\n  getMessagesByConversation(conversationId: number): Promise<(typeof messages.$inferSelect)[]>;\n  createMessage(conversationId: number, role: string, content: string): Promise<typeof messages.$inferSelect>;\n}\n\nexport const chatStorage: IChatStorage = {\n  async getConversation(id: number) {\n    const [conversation] = await db.select().from(conversations).where(eq(conversations.id, id));\n    return conversation;\n  },\n\n  async getAllConversations() {\n    return db.select().from(conversations).orderBy(desc(conversations.createdAt));\n  },\n\n  async createConversation(title: string) {\n    const [conversation] = await db.insert(conversations).values({ title }).returning();\n    return conversation;\n  },\n\n  async deleteConversation(id: number) {\n    await db.delete(messages).where(eq(messages.conversationId, id));\n    await db.delete(conversations).where(eq(conversations.id, id));\n  },\n\n  async getMessagesByConversation(conversationId: number) {\n    return db.select().from(messages).where(eq(messages.conversationId, conversationId)).orderBy(messages.createdAt);\n  },\n\n  async createMessage(conversationId: number, role: string, content: string) {\n    const [message] = await db.insert(messages).values({ conversationId, role, content }).returning();\n    return message;\n  },\n};\n\n","path":null,"size_bytes":1737,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"server/replit_integrations/object_storage/index.ts":{"content":"export {\n  ObjectStorageService,\n  ObjectNotFoundError,\n  objectStorageClient,\n} from \"./objectStorage\";\n\nexport type {\n  ObjectAclPolicy,\n  ObjectAccessGroup,\n  ObjectAccessGroupType,\n  ObjectAclRule,\n} from \"./objectAcl\";\n\nexport {\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nexport { registerObjectStorageRoutes } from \"./routes\";\n\n","path":null,"size_bytes":377,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/replit_integrations/audio/audio-utils.ts":{"content":"/**\n * Audio utility functions for voice chat.\n * Handles PCM16 decoding and AudioContext initialization.\n */\n\n/**\n * Decode base64 PCM16 audio to Float32Array for Web Audio API\n */\nexport function decodePCM16ToFloat32(base64Audio: string): Float32Array {\n  const raw = atob(base64Audio);\n  const bytes = new Uint8Array(raw.length);\n  for (let i = 0; i < raw.length; i++) {\n    bytes[i] = raw.charCodeAt(i);\n  }\n  const pcm16 = new Int16Array(bytes.buffer);\n  const float32 = new Float32Array(pcm16.length);\n  for (let i = 0; i < pcm16.length; i++) {\n    float32[i] = pcm16[i] / 32768;\n  }\n  return float32;\n}\n\n/**\n * Create and initialize AudioContext with worklet\n */\nexport async function createAudioPlaybackContext(\n  workletPath = \"/audio-playback-worklet.js\",\n  sampleRate = 24000\n): Promise<{ ctx: AudioContext; worklet: AudioWorkletNode }> {\n  const ctx = new AudioContext({ sampleRate });\n  await ctx.audioWorklet.addModule(workletPath);\n  const worklet = new AudioWorkletNode(ctx, \"audio-playback-processor\");\n  worklet.connect(ctx.destination);\n  return { ctx, worklet };\n}\n\n","path":null,"size_bytes":1086,"size_tokens":null},"client/src/components/ProfileForm.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { User, Camera, Save, Loader2, Target } from \"lucide-react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { UserProfile } from \"@shared/schema\";\n\nconst profileSchema = z.object({\n  phone: z.string().optional(),\n  age: z.coerce.number().min(1).max(120).optional(),\n  weight: z.coerce.number().min(1).max(500).optional(),\n  height: z.coerce.number().min(30).max(300).optional(),\n  gender: z.enum([\"male\", \"female\"]).optional(),\n  fitnessGoal: z.enum([\"weight_loss\", \"maintain\", \"muscle_gain\"]).optional(),\n});\n\ntype ProfileFormValues = z.infer<typeof profileSchema>;\n\ninterface ProfileFormProps {\n  user: {\n    id: string;\n    email?: string | null;\n    firstName?: string | null;\n    lastName?: string | null;\n    profileImageUrl?: string | null;\n  };\n  profile?: UserProfile | null;\n}\n\nconst countryCodes = [\n  { code: \"+966\", country: \"SA\", flag: \"🇸🇦\", name: \"Saudi Arabia\" },\n  { code: \"+971\", country: \"AE\", flag: \"🇦🇪\", name: \"UAE\" },\n  { code: \"+973\", country: \"BH\", flag: \"🇧🇭\", name: \"Bahrain\" },\n  { code: \"+965\", country: \"KW\", flag: \"🇰🇼\", name: \"Kuwait\" },\n  { code: \"+968\", country: \"OM\", flag: \"🇴🇲\", name: \"Oman\" },\n  { code: \"+974\", country: \"QA\", flag: \"🇶🇦\", name: \"Qatar\" },\n  { code: \"+20\", country: \"EG\", flag: \"🇪🇬\", name: \"Egypt\" },\n  { code: \"+962\", country: \"JO\", flag: \"🇯🇴\", name: \"Jordan\" },\n  { code: \"+961\", country: \"LB\", flag: \"🇱🇧\", name: \"Lebanon\" },\n  { code: \"+964\", country: \"IQ\", flag: \"🇮🇶\", name: \"Iraq\" },\n  { code: \"+212\", country: \"MA\", flag: \"🇲🇦\", name: \"Morocco\" },\n  { code: \"+1\", country: \"US\", flag: \"🇺🇸\", name: \"USA\" },\n  { code: \"+44\", country: \"GB\", flag: \"🇬🇧\", name: \"UK\" },\n];\n\nexport function ProfileForm({ user, profile }: ProfileFormProps) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\n  const [countryCode, setCountryCode] = useState(\"+966\");\n\n  const form = useForm<ProfileFormValues>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      phone: profile?.phone || \"\",\n      age: profile?.age || undefined,\n      weight: profile?.weight || undefined,\n      height: profile?.height || undefined,\n      gender: profile?.gender || undefined,\n      fitnessGoal: profile?.fitnessGoal || \"maintain\",\n    },\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: ProfileFormValues) => {\n      return apiRequest(\"PATCH\", \"/api/profile\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/profile\"] });\n      toast({\n        title: t(\"success\"),\n        description: \"Profile updated successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"error\"),\n        description: \"Failed to update profile\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ProfileFormValues) => {\n    updateProfileMutation.mutate(data);\n  };\n\n  const handleImageChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setImagePreview(reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const displayName = [user.firstName, user.lastName].filter(Boolean).join(\" \") || \"User\";\n  const initials = displayName.split(\" \").map(n => n[0]).join(\"\").toUpperCase().slice(0, 2);\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <User className=\"h-5 w-5\" />\n          {t(\"personalInfo\")}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <div className=\"flex flex-col items-center gap-4 pb-6 border-b\">\n              <div className=\"relative inline-block\">\n                <Avatar className=\"h-24 w-24 border-2 border-muted\">\n                  <AvatarImage \n                    src={imagePreview || profile?.profileImagePath || user.profileImageUrl || undefined} \n                    alt={displayName} \n                  />\n                  <AvatarFallback className=\"text-2xl bg-muted text-muted-foreground\">\n                    {initials}\n                  </AvatarFallback>\n                </Avatar>\n                <label \n                  htmlFor=\"avatar-upload\"\n                  className=\"absolute -bottom-1 -end-1 p-2 bg-primary text-primary-foreground rounded-full cursor-pointer shadow-md\"\n                >\n                  <Camera className=\"h-4 w-4\" />\n                </label>\n                <input\n                  id=\"avatar-upload\"\n                  type=\"file\"\n                  accept=\"image/*\"\n                  className=\"hidden\"\n                  onChange={handleImageChange}\n                  data-testid=\"input-avatar\"\n                />\n              </div>\n              <div className=\"text-center\">\n                <h3 className=\"font-semibold text-lg\">{displayName}</h3>\n                <p className=\"text-sm text-muted-foreground\">{user.email}</p>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"phone\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"phone\")}</FormLabel>\n                    <div className=\"flex flex-row-reverse gap-2\" dir=\"ltr\">\n                      <FormControl>\n                        <Input \n                          {...field} \n                          type=\"tel\"\n                          placeholder=\"5XX XXX XXXX\"\n                          className=\"flex-1 text-start\"\n                          dir=\"ltr\"\n                          data-testid=\"input-phone\"\n                        />\n                      </FormControl>\n                      <Select value={countryCode} onValueChange={setCountryCode}>\n                        <SelectTrigger className=\"w-[100px] shrink-0\" data-testid=\"select-country-code\">\n                          <SelectValue>\n                            {countryCodes.find(c => c.code === countryCode)?.flag} {countryCode}\n                          </SelectValue>\n                        </SelectTrigger>\n                        <SelectContent>\n                          {countryCodes.map((c) => (\n                            <SelectItem key={c.code} value={c.code}>\n                              {c.flag} {c.code} ({c.name})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"age\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"age\")}</FormLabel>\n                    <FormControl>\n                      <Input \n                        {...field} \n                        type=\"number\"\n                        min={1}\n                        max={120}\n                        placeholder=\"25\"\n                        data-testid=\"input-age\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"weight\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"weight\")}</FormLabel>\n                    <FormControl>\n                      <Input \n                        {...field} \n                        type=\"number\"\n                        min={1}\n                        step={0.1}\n                        placeholder=\"70\"\n                        data-testid=\"input-weight\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"height\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"height\")}</FormLabel>\n                    <FormControl>\n                      <Input \n                        {...field} \n                        type=\"number\"\n                        min={30}\n                        max={300}\n                        placeholder=\"170\"\n                        data-testid=\"input-height\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"gender\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"gender\")}</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-gender\">\n                          <SelectValue placeholder={t(\"gender\")} />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"male\">{t(\"male\")}</SelectItem>\n                        <SelectItem value=\"female\">{t(\"female\")}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"fitnessGoal\"\n                render={({ field }) => (\n                  <FormItem className=\"md:col-span-2\">\n                    <FormLabel className=\"flex items-center gap-1.5\">\n                      <Target className=\"h-4 w-4\" />\n                      {t(\"fitnessGoal\")}\n                    </FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-fitness-goal\">\n                          <SelectValue placeholder={t(\"fitnessGoal\")} />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"weight_loss\">{t(\"goalWeightLoss\")}</SelectItem>\n                        <SelectItem value=\"maintain\">{t(\"goalMaintain\")}</SelectItem>\n                        <SelectItem value=\"muscle_gain\">{t(\"goalMuscleGain\")}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <Button \n              type=\"submit\" \n              className=\"w-full\" \n              disabled={updateProfileMutation.isPending}\n              data-testid=\"button-save-profile\"\n            >\n              {updateProfileMutation.isPending ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 me-2 animate-spin\" />\n                  {t(\"loading\")}\n                </>\n              ) : (\n                <>\n                  <Save className=\"h-4 w-4 me-2\" />\n                  {t(\"saveChanges\")}\n                </>\n              )}\n            </Button>\n          </form>\n        </Form>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":12616,"size_tokens":null},"client/src/components/MedicalDisclaimer.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { AlertTriangle } from \"lucide-react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\n\nexport function MedicalDisclaimer() {\n  const { t } = useTranslation();\n\n  return (\n    <Alert className=\"border-red-500 bg-red-50 dark:bg-red-950/30\">\n      <AlertTriangle className=\"h-5 w-5 text-red-600 dark:text-red-400\" />\n      <AlertTitle className=\"text-red-700 dark:text-red-300 font-bold text-base\">\n        {t(\"warning\")}\n      </AlertTitle>\n      <AlertDescription className=\"text-red-600 dark:text-red-300 font-semibold\">\n        {t(\"appPurpose\")}\n        <br />\n        {t(\"medicalDisclaimer\")}\n      </AlertDescription>\n    </Alert>\n  );\n}\n","path":null,"size_bytes":726,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { startDailyLearningSchedule } from \"./knowledgeEngine\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    console.error(\"Internal Server Error:\", err);\n\n    if (res.headersSent) {\n      return next(err);\n    }\n\n    return res.status(status).json({ message });\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n      startDailyLearningSchedule();\n    },\n  );\n})();\n","path":null,"size_bytes":2760,"size_tokens":null},"client/src/components/AllTestsTable.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { CategoryIcon, CategoryLegend } from \"./CategoryIcon\";\nimport { format } from \"date-fns\";\nimport { arSA, enUS } from \"date-fns/locale\";\nimport type { AllTestsData, TestCategory, Reminder } from \"@shared/schema\";\nimport { ArrowUpDown, Filter, CheckCircle, XCircle, Clock, CalendarDays, Bell, X, Share2, Check, Info } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface AllTestsTableProps {\n  tests: AllTestsData[];\n  isLoading?: boolean;\n}\n\ntype SortOption = \"default\" | \"importance\" | \"category\" | \"status\";\ntype FilterCategory = TestCategory | \"all\";\ntype FilterStatus = \"all\" | \"normal\" | \"low\" | \"high\" | \"pending\";\n\ninterface ReminderWithDef extends Reminder {\n  testDefinition?: {\n    nameEn: string;\n    nameAr: string;\n  };\n}\n\nexport function AllTestsTable({ tests, isLoading }: AllTestsTableProps) {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n  const dateLocale = isArabic ? arSA : enUS;\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const [sortBy, setSortBy] = useState<SortOption>(\"default\");\n  const [filterCategory, setFilterCategory] = useState<FilterCategory>(\"all\");\n  const [filterStatus, setFilterStatus] = useState<FilterStatus>(\"all\");\n  const [openPopover, setOpenPopover] = useState<string | null>(null);\n  const [copied, setCopied] = useState(false);\n\n  const { data: reminders = [] } = useQuery<ReminderWithDef[]>({\n    queryKey: [\"/api/reminders\"],\n  });\n\n  const createReminderMutation = useMutation({\n    mutationFn: async ({ testId, dueDate }: { testId: string; dueDate: Date }) => {\n      return apiRequest(\"POST\", \"/api/reminders\", { testId, dueDate: dueDate.toISOString() });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/reminders\"] });\n      toast({ title: t(\"reminderSet\"), description: t(\"reminderSetDesc\") });\n      setOpenPopover(null);\n    },\n    onError: () => {\n      toast({ title: t(\"error\"), description: t(\"reminderError\"), variant: \"destructive\" });\n    },\n  });\n\n  const deleteReminderMutation = useMutation({\n    mutationFn: async (reminderId: string) => {\n      return apiRequest(\"DELETE\", `/api/reminders/${reminderId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/reminders\"] });\n      toast({ title: t(\"reminderDeleted\") });\n    },\n  });\n\n  const generateShareText = () => {\n    const testsWithResults = tests.filter(test => test.hasResult);\n    if (testsWithResults.length === 0) {\n      return isArabic \n        ? \"لا توجد نتائج فحوصات لمشاركتها\"\n        : \"No test results to share\";\n    }\n\n    const header = isArabic \n      ? \"تقرير الفحوصات الطبية\\n\" + \"═\".repeat(30) + \"\\n\\n\"\n      : \"Medical Test Results Report\\n\" + \"═\".repeat(30) + \"\\n\\n\";\n\n    const abnormalTests = testsWithResults.filter(t => t.status === \"high\" || t.status === \"low\");\n    const normalTests = testsWithResults.filter(t => t.status === \"normal\");\n\n    let text = header;\n\n    if (abnormalTests.length > 0) {\n      text += isArabic ? \"[!] نتائج غير طبيعية:\\n\" : \"[!] Abnormal Results:\\n\";\n      abnormalTests.forEach(test => {\n        const name = isArabic ? test.nameAr : test.nameEn;\n        const statusText = test.status === \"high\" \n          ? (isArabic ? \"مرتفع\" : \"High\") \n          : (isArabic ? \"منخفض\" : \"Low\");\n        const range = test.normalRangeMin !== null && test.normalRangeMax !== null\n          ? `${test.normalRangeMin}-${test.normalRangeMax} ${test.unit || \"\"}`\n          : \"\";\n        const testDateStr = test.testDate \n          ? ` | ${isArabic ? \"تاريخ الفحص\" : \"Test Date\"}: ${format(new Date(test.testDate), \"yyyy-MM-dd\")}`\n          : \"\";\n        text += `- ${name}: ${test.value} ${test.unit || \"\"} (${statusText})`;\n        if (range) text += ` [${isArabic ? \"الطبيعي\" : \"Normal\"}: ${range}]`;\n        text += testDateStr;\n        text += \"\\n\";\n      });\n      text += \"\\n\";\n    }\n\n    if (normalTests.length > 0) {\n      text += isArabic ? \"[OK] نتائج طبيعية:\\n\" : \"[OK] Normal Results:\\n\";\n      normalTests.forEach(test => {\n        const name = isArabic ? test.nameAr : test.nameEn;\n        const range = test.normalRangeMin !== null && test.normalRangeMax !== null\n          ? `${test.normalRangeMin}-${test.normalRangeMax} ${test.unit || \"\"}`\n          : \"\";\n        const testDateStr = test.testDate \n          ? ` | ${isArabic ? \"تاريخ الفحص\" : \"Test Date\"}: ${format(new Date(test.testDate), \"yyyy-MM-dd\")}`\n          : \"\";\n        text += `- ${name}: ${test.value} ${test.unit || \"\"}`;\n        if (range) text += ` [${isArabic ? \"الطبيعي\" : \"Normal\"}: ${range}]`;\n        text += testDateStr;\n        text += \"\\n\";\n      });\n    }\n\n    const footer = isArabic\n      ? \"\\nالتاريخ: \" + format(new Date(), \"PPP\", { locale: dateLocale })\n      : \"\\nDate: \" + format(new Date(), \"PPP\", { locale: dateLocale });\n    text += footer;\n\n    return text;\n  };\n\n  const handleShare = async () => {\n    const shareText = generateShareText();\n\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: isArabic ? \"تقرير الفحوصات\" : \"Test Results Report\",\n          text: shareText,\n        });\n        toast({ title: t(\"shareSuccess\") });\n      } catch (error) {\n        if ((error as Error).name !== \"AbortError\") {\n          await copyToClipboard(shareText);\n        }\n      }\n    } else {\n      await copyToClipboard(shareText);\n    }\n  };\n\n  const copyToClipboard = async (text: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopied(true);\n      toast({ title: t(\"copiedToClipboard\") });\n      setTimeout(() => setCopied(false), 2000);\n    } catch {\n      toast({ title: t(\"error\"), description: t(\"copyFailed\"), variant: \"destructive\" });\n    }\n  };\n\n  const categories: TestCategory[] = [\n    \"vitamins\", \"minerals\", \"hormones\", \"organ_functions\",\n    \"lipids\", \"immunity\", \"blood\", \"coagulation\", \"special\"\n  ];\n\n  const remindersByTestId = useMemo(() => {\n    const map: Record<string, ReminderWithDef> = {};\n    reminders.forEach(r => {\n      map[r.testId] = r;\n    });\n    return map;\n  }, [reminders]);\n\n  const sortedAndFilteredTests = useMemo(() => {\n    let result = [...tests];\n\n    if (filterCategory !== \"all\") {\n      result = result.filter(test => test.category === filterCategory);\n    }\n\n    if (filterStatus !== \"all\") {\n      result = result.filter(test => test.status === filterStatus);\n    }\n\n    switch (sortBy) {\n      case \"default\":\n        result.sort((a, b) => a.order - b.order);\n        break;\n      case \"importance\":\n        result.sort((a, b) => a.importance - b.importance);\n        break;\n      case \"category\":\n        result.sort((a, b) => a.category.localeCompare(b.category));\n        break;\n      case \"status\":\n        const statusOrder: Record<string, number> = { high: 0, low: 1, normal: 2, pending: 3 };\n        result.sort((a, b) => (statusOrder[a.status] ?? 3) - (statusOrder[b.status] ?? 3));\n        break;\n    }\n\n    return result;\n  }, [tests, sortBy, filterCategory, filterStatus]);\n\n  const getStatusRowClass = (status: string, hasResult: boolean) => {\n    if (!hasResult) return \"bg-muted/30\";\n    if (status === \"low\" || status === \"high\") {\n      return \"bg-red-50 dark:bg-red-950/20\";\n    }\n    if (status === \"normal\") {\n      return \"bg-green-50/50 dark:bg-green-950/10\";\n    }\n    return \"\";\n  };\n\n  const getStatusBadge = (status: string, hasResult: boolean, test: AllTestsData) => {\n    if (!hasResult) {\n      return (\n        <Badge variant=\"outline\" className=\"gap-1 text-muted-foreground\">\n          <Clock className=\"h-3 w-3\" />\n          {t(\"pending\")}\n        </Badge>\n      );\n    }\n    \n    if (status === \"normal\") {\n      return (\n        <Badge className=\"gap-1 bg-green-500 hover:bg-green-600\">\n          <CheckCircle className=\"h-3 w-3\" />\n          {t(\"normal\")}\n        </Badge>\n      );\n    }\n    \n    // Check if slightly high or slightly low (within 20% of boundary)\n    let isSlightly = false;\n    if (test.value !== null && test.normalRangeMin !== null && test.normalRangeMax !== null) {\n      const range = test.normalRangeMax - test.normalRangeMin;\n      const threshold = range * 0.2; // 20% threshold\n      \n      if (status === \"high\" && test.value <= test.normalRangeMax + threshold) {\n        isSlightly = true;\n      } else if (status === \"low\" && test.value >= test.normalRangeMin - threshold) {\n        isSlightly = true;\n      }\n    }\n    \n    const statusText = status === \"high\" \n      ? (isSlightly ? t(\"slightlyHigh\") : t(\"high\"))\n      : (isSlightly ? t(\"slightlyLow\") : t(\"low\"));\n    \n    return (\n      <Badge variant=\"destructive\" className={`gap-1 ${isSlightly ? \"bg-orange-500 hover:bg-orange-600\" : \"\"}`}>\n        <XCircle className=\"h-3 w-3\" />\n        {statusText}\n      </Badge>\n    );\n  };\n\n  const handleSetReminder = (testId: string, date: Date | undefined) => {\n    if (date) {\n      createReminderMutation.mutate({ testId, dueDate: date });\n    }\n  };\n\n  const testsWithResults = tests.filter(t => t.hasResult).length;\n  const abnormalTests = tests.filter(t => t.status === \"high\" || t.status === \"low\").length;\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"p-8\">\n          <div className=\"flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader className=\"pb-3 space-y-3\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <ArrowUpDown className=\"h-5 w-5\" />\n              {t(\"myTests\")}\n            </CardTitle>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {testsWithResults} / 50 {t(\"testsCompleted\")} • {abnormalTests} {t(\"abnormal\")}\n            </p>\n          </div>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleShare}\n            className=\"gap-1\"\n            data-testid=\"button-share-results\"\n          >\n            {copied ? <Check className=\"h-4 w-4\" /> : <Share2 className=\"h-4 w-4\" />}\n            {t(\"share\")}\n          </Button>\n        </div>\n        <div className=\"grid grid-cols-3 gap-2\">\n          <Select value={sortBy} onValueChange={(v) => setSortBy(v as SortOption)}>\n            <SelectTrigger className=\"w-full text-xs\" data-testid=\"select-sort\">\n              <SelectValue placeholder={t(\"sortBy\")} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"default\">{t(\"defaultOrder\")}</SelectItem>\n              <SelectItem value=\"importance\">{t(\"importance\")}</SelectItem>\n              <SelectItem value=\"status\">{t(\"byStatus\")}</SelectItem>\n              <SelectItem value=\"category\">{t(\"byCategory\")}</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Select value={filterCategory} onValueChange={(v) => setFilterCategory(v as FilterCategory)}>\n            <SelectTrigger className=\"w-full text-xs\" data-testid=\"select-category\">\n              <Filter className=\"h-3 w-3 me-1\" />\n              <SelectValue placeholder={t(\"category\")} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">{t(\"allCategories\")}</SelectItem>\n              {categories.map(cat => (\n                <SelectItem key={cat} value={cat}>{t(cat)}</SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          <Select value={filterStatus} onValueChange={(v) => setFilterStatus(v as FilterStatus)}>\n            <SelectTrigger className=\"w-full text-xs\" data-testid=\"select-status\">\n              <SelectValue placeholder={t(\"status\")} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">{t(\"allStatuses\")}</SelectItem>\n              <SelectItem value=\"normal\">{t(\"normal\")}</SelectItem>\n              <SelectItem value=\"low\">{t(\"low\")}</SelectItem>\n              <SelectItem value=\"high\">{t(\"high\")}</SelectItem>\n              <SelectItem value=\"pending\">{t(\"pending\")}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-2\">\n        <CategoryLegend />\n        <div className=\"relative overflow-auto max-h-[65vh]\">\n          <Table className=\"text-sm\">\n            <TableHeader className=\"sticky top-0 z-20\">\n              <TableRow className=\"bg-card border-b-2 border-border\">\n                <TableHead className=\"w-[28px] bg-card p-1 text-center\"></TableHead>\n                <TableHead className=\"bg-card font-bold p-1\">{t(\"testName\")}</TableHead>\n                <TableHead className=\"text-center bg-card font-bold p-1 whitespace-nowrap\">{t(\"yourValue\")}</TableHead>\n                <TableHead className=\"text-center bg-card font-bold p-1\">{t(\"status\")}</TableHead>\n                <TableHead className=\"bg-card font-bold p-1 whitespace-nowrap\">{t(\"testDate\")}</TableHead>\n                <TableHead className=\"text-center bg-card font-bold p-1\">{t(\"reminder\")}</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {sortedAndFilteredTests.map((test, index) => {\n                const existingReminder = remindersByTestId[test.testId];\n                \n                return (\n                  <TableRow \n                    key={test.id} \n                    className={getStatusRowClass(test.status, test.hasResult)}\n                    data-testid={`row-test-${test.testId}`}\n                  >\n                    <TableCell className=\"p-1 text-center\">\n                      <CategoryIcon category={test.category} />\n                    </TableCell>\n                    <TableCell className=\"font-medium p-1\">\n                      <div className=\"flex items-center gap-1\">\n                        <span className=\"text-xs\">{isArabic ? test.nameAr : test.nameEn}</span>\n                        <Popover>\n                          <PopoverTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-4 w-4 p-0\">\n                              <Info className=\"h-3 w-3 text-blue-500\" />\n                            </Button>\n                          </PopoverTrigger>\n                          <PopoverContent side=\"top\" className=\"max-w-[280px] p-3\">\n                            <p className=\"text-sm\">\n                              {isArabic ? test.descriptionAr : test.descriptionEn}\n                            </p>\n                          </PopoverContent>\n                        </Popover>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-center font-mono p-1\">\n                      {test.hasResult ? (\n                        <div className=\"flex flex-col\">\n                          <span className={`text-xs ${test.status !== \"normal\" && test.status !== \"pending\" ? \"font-bold text-red-600 dark:text-red-400\" : \"\"}`}>\n                            {test.value}\n                          </span>\n                          <span className=\"text-[10px] text-muted-foreground\">\n                            ({test.normalRangeMin}-{test.normalRangeMax})\n                          </span>\n                        </div>\n                      ) : (\n                        <span className=\"text-muted-foreground text-xs\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-center p-1\">\n                      {getStatusBadge(test.status, test.hasResult, test)}\n                    </TableCell>\n                    <TableCell className=\"text-muted-foreground p-1 text-xs\">\n                      {test.testDate \n                        ? format(new Date(test.testDate), \"MM/dd/yy\", { locale: dateLocale })\n                        : \"-\"\n                      }\n                    </TableCell>\n                    <TableCell className=\"text-center p-1\">\n                      {existingReminder ? (\n                        <Popover>\n                          <PopoverTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-green-600\">\n                              <Bell className=\"h-4 w-4\" />\n                            </Button>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-auto p-2\" align=\"center\">\n                            <div className=\"flex flex-col gap-2\">\n                              <span className=\"text-sm\">{format(new Date(existingReminder.dueDate), \"PP\", { locale: dateLocale })}</span>\n                              <Button\n                                variant=\"destructive\"\n                                size=\"sm\"\n                                onClick={() => deleteReminderMutation.mutate(existingReminder.id)}\n                                data-testid={`button-delete-reminder-${test.testId}`}\n                              >\n                                <X className=\"h-3 w-3 me-1\" />\n                                {isArabic ? \"حذف\" : \"Delete\"}\n                              </Button>\n                            </div>\n                          </PopoverContent>\n                        </Popover>\n                      ) : (\n                        <Popover \n                          open={openPopover === test.testId} \n                          onOpenChange={(open) => setOpenPopover(open ? test.testId : null)}\n                        >\n                          <PopoverTrigger asChild>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6\"\n                              data-testid={`button-set-reminder-${test.testId}`}\n                            >\n                              <CalendarDays className=\"h-4 w-4 text-muted-foreground\" />\n                            </Button>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-auto p-0\" align=\"center\">\n                            <Calendar\n                              mode=\"single\"\n                              selected={undefined}\n                              onSelect={(date) => handleSetReminder(test.testId, date)}\n                              disabled={(date) => {\n                                const today = new Date();\n                                today.setHours(0, 0, 0, 0);\n                                return date < today;\n                              }}\n                              initialFocus\n                              locale={dateLocale}\n                            />\n                          </PopoverContent>\n                        </Popover>\n                      )}\n                    </TableCell>\n                  </TableRow>\n                );\n              })}\n            </TableBody>\n          </Table>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":20067,"size_tokens":null},"server/replit_integrations/auth/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { authStorage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await authStorage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  // Keep track of registered strategies\n  const registeredStrategies = new Set<string>();\n\n  // Helper function to ensure strategy exists for a domain\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4474,"size_tokens":null},"client/src/context/DietPlanJobContext.tsx":{"content":"import { createContext, useContext, useCallback, useEffect, useRef, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface DietPlanJobContextType {\n  activeJobId: string | null;\n  isGenerating: boolean;\n  completedPlan: any | null;\n  startJob: (jobId: string) => void;\n  clearCompletedPlan: () => void;\n}\n\nconst DietPlanJobContext = createContext<DietPlanJobContextType>({\n  activeJobId: null,\n  isGenerating: false,\n  completedPlan: null,\n  startJob: () => {},\n  clearCompletedPlan: () => {},\n});\n\nexport function useDietPlanJob() {\n  return useContext(DietPlanJobContext);\n}\n\nconst STORAGE_KEY = \"biotrack_diet_job_id\";\n\nexport function DietPlanJobProvider({ children }: { children: React.ReactNode }) {\n  const { i18n } = useTranslation();\n  const { toast } = useToast();\n  const [activeJobId, setActiveJobId] = useState<string | null>(() => {\n    return localStorage.getItem(STORAGE_KEY);\n  });\n  const [completedPlan, setCompletedPlan] = useState<any | null>(null);\n  const pollingRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  const stopPolling = useCallback(() => {\n    if (pollingRef.current) {\n      clearInterval(pollingRef.current);\n      pollingRef.current = null;\n    }\n  }, []);\n\n  const sendNotification = useCallback((title: string, body: string) => {\n    if (\"Notification\" in window && Notification.permission === \"granted\") {\n      try {\n        new Notification(title, { body, icon: \"/favicon.ico\" });\n      } catch (e) {\n        // fallback: ignore if notification fails\n      }\n    }\n  }, []);\n\n  const pollJob = useCallback((jobId: string) => {\n    stopPolling();\n    pollingRef.current = setInterval(async () => {\n      try {\n        const res = await fetch(`/api/diet-plan/job/${jobId}`, { credentials: \"include\" });\n        if (!res.ok) return;\n        const data = await res.json();\n        if (data.status === \"completed\" && data.plan) {\n          stopPolling();\n          setCompletedPlan(data.plan);\n          setActiveJobId(null);\n          localStorage.removeItem(STORAGE_KEY);\n          const isAr = i18n.language === \"ar\";\n          sendNotification(\n            \"BioTrack AI\",\n            isAr ? \"تم إصدار جدولك الغذائي بنجاح!\" : \"Your diet plan is ready!\"\n          );\n          toast({\n            title: isAr ? \"تم إصدار جدولك الغذائي بنجاح!\" : \"Your diet plan is ready!\",\n          });\n        } else if (data.status === \"failed\") {\n          stopPolling();\n          setActiveJobId(null);\n          localStorage.removeItem(STORAGE_KEY);\n          const isAr = i18n.language === \"ar\";\n          const errorMsg = data.error?.includes(\"timed out\")\n            ? (isAr ? \"انتهت المهلة الزمنية. يرجى المحاولة مرة أخرى\" : \"Generation timed out. Please try again\")\n            : (isAr ? \"فشل في تصميم النظام الغذائي. يرجى المحاولة مرة أخرى\" : \"Diet plan generation failed. Please try again\");\n          sendNotification(\"BioTrack AI\", errorMsg);\n          toast({\n            title: errorMsg,\n            variant: \"destructive\",\n          });\n        }\n      } catch (err) {\n        // ignore network errors, keep polling\n      }\n    }, 3000);\n  }, [stopPolling, sendNotification, toast, i18n.language]);\n\n  const startJob = useCallback((jobId: string) => {\n    setActiveJobId(jobId);\n    setCompletedPlan(null);\n    localStorage.setItem(STORAGE_KEY, jobId);\n    if (\"Notification\" in window && Notification.permission === \"default\") {\n      Notification.requestPermission();\n    }\n    pollJob(jobId);\n  }, [pollJob]);\n\n  const clearCompletedPlan = useCallback(() => {\n    setCompletedPlan(null);\n  }, []);\n\n  useEffect(() => {\n    if (activeJobId) {\n      pollJob(activeJobId);\n    }\n    return () => stopPolling();\n  }, []);\n\n  return (\n    <DietPlanJobContext.Provider value={{ activeJobId, isGenerating: !!activeJobId, completedPlan, startJob, clearCompletedPlan }}>\n      {children}\n    </DietPlanJobContext.Provider>\n  );\n}\n","path":null,"size_bytes":4080,"size_tokens":null},"server/replit_integrations/image/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { openai } from \"./client\";\n\nexport function registerImageRoutes(app: Express): void {\n  app.post(\"/api/generate-image\", async (req: Request, res: Response) => {\n    try {\n      const { prompt, size = \"1024x1024\" } = req.body;\n\n      if (!prompt) {\n        return res.status(400).json({ error: \"Prompt is required\" });\n      }\n\n      const response = await openai.images.generate({\n        model: \"gpt-image-1\",\n        prompt,\n        n: 1,\n        size: size as \"1024x1024\" | \"512x512\" | \"256x256\",\n      });\n\n      const imageData = response.data[0];\n      res.json({\n        url: imageData.url,\n        b64_json: imageData.b64_json,\n      });\n    } catch (error) {\n      console.error(\"Error generating image:\", error);\n      res.status(500).json({ error: \"Failed to generate image\" });\n    }\n  });\n}\n\n","path":null,"size_bytes":872,"size_tokens":null},"server/replit_integrations/object_storage/routes.ts":{"content":"import type { Express } from \"express\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./objectStorage\";\n\n/**\n * Register object storage routes for file uploads.\n *\n * This provides example routes for the presigned URL upload flow:\n * 1. POST /api/uploads/request-url - Get a presigned URL for uploading\n * 2. The client then uploads directly to the presigned URL\n *\n * IMPORTANT: These are example routes. Customize based on your use case:\n * - Add authentication middleware for protected uploads\n * - Add file metadata storage (save to database after upload)\n * - Add ACL policies for access control\n */\nexport function registerObjectStorageRoutes(app: Express): void {\n  const objectStorageService = new ObjectStorageService();\n\n  /**\n   * Request a presigned URL for file upload.\n   *\n   * Request body (JSON):\n   * {\n   *   \"name\": \"filename.jpg\",\n   *   \"size\": 12345,\n   *   \"contentType\": \"image/jpeg\"\n   * }\n   *\n   * Response:\n   * {\n   *   \"uploadURL\": \"https://storage.googleapis.com/...\",\n   *   \"objectPath\": \"/objects/uploads/uuid\"\n   * }\n   *\n   * IMPORTANT: The client should NOT send the file to this endpoint.\n   * Send JSON metadata only, then upload the file directly to uploadURL.\n   */\n  app.post(\"/api/uploads/request-url\", async (req, res) => {\n    try {\n      const { name, size, contentType } = req.body;\n\n      if (!name) {\n        return res.status(400).json({\n          error: \"Missing required field: name\",\n        });\n      }\n\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n\n      // Extract object path from the presigned URL for later reference\n      const objectPath = objectStorageService.normalizeObjectEntityPath(uploadURL);\n\n      res.json({\n        uploadURL,\n        objectPath,\n        // Echo back the metadata for client convenience\n        metadata: { name, size, contentType },\n      });\n    } catch (error) {\n      console.error(\"Error generating upload URL:\", error);\n      res.status(500).json({ error: \"Failed to generate upload URL\" });\n    }\n  });\n\n  /**\n   * Serve uploaded objects.\n   *\n   * GET /objects/:objectPath(*)\n   *\n   * This serves files from object storage. For public files, no auth needed.\n   * For protected files, add authentication middleware and ACL checks.\n   */\n  app.get(\"/objects/:objectPath(*)\", async (req, res) => {\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      await objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error serving object:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.status(404).json({ error: \"Object not found\" });\n      }\n      return res.status(500).json({ error: \"Failed to serve object\" });\n    }\n  });\n}\n\n","path":null,"size_bytes":2786,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/LanguageToggle.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Button } from \"@/components/ui/button\";\nimport { Languages } from \"lucide-react\";\n\nexport function LanguageToggle() {\n  const { i18n } = useTranslation();\n\n  const toggleLanguage = () => {\n    const newLang = i18n.language === \"ar\" ? \"en\" : \"ar\";\n    i18n.changeLanguage(newLang);\n    document.documentElement.dir = newLang === \"ar\" ? \"rtl\" : \"ltr\";\n    document.documentElement.lang = newLang;\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleLanguage}\n      data-testid=\"button-language-toggle\"\n      title={i18n.language === \"ar\" ? \"English\" : \"العربية\"}\n    >\n      <Languages className=\"h-5 w-5\" />\n    </Button>\n  );\n}\n","path":null,"size_bytes":730,"size_tokens":null},"client/replit_integrations/audio/index.ts":{"content":"/**\n * Voice chat client utilities for Replit AI Integrations.\n * \n * Usage:\n * 1. Copy audio-playback-worklet.js to your public/ folder\n * 2. Import and use the React hooks in your components\n * \n * Example:\n * ```tsx\n * import { useVoiceRecorder, useVoiceStream } from \"./audio\";\n * \n * function VoiceChat() {\n *   const [transcript, setTranscript] = useState(\"\");\n *   const recorder = useVoiceRecorder();\n *   const stream = useVoiceStream({\n *     onTranscript: (_, full) => setTranscript(full),\n *     onComplete: (text) => console.log(\"Done:\", text),\n *   });\n * \n *   const handleClick = async () => {\n *     if (recorder.state === \"recording\") {\n *       const blob = await recorder.stopRecording();\n *       await stream.streamVoiceResponse(\"/api/voice-conversations/1/messages\", blob);\n *     } else {\n *       await recorder.startRecording();\n *     }\n *   };\n * \n *   return (\n *     <div>\n *       <button onClick={handleClick}>\n *         {recorder.state === \"recording\" ? \"Stop\" : \"Record\"}\n *       </button>\n *       <p>{transcript}</p>\n *     </div>\n *   );\n * }\n * ```\n */\n\nexport { decodePCM16ToFloat32, createAudioPlaybackContext } from \"./audio-utils\";\nexport { useVoiceRecorder, type RecordingState } from \"./useVoiceRecorder\";\nexport { useAudioPlayback, type PlaybackState } from \"./useAudioPlayback\";\nexport { useVoiceStream } from \"./useVoiceStream\";\n\n","path":null,"size_bytes":1379,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const url = queryKey[0] as string;\n    const res = await fetch(url, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1397,"size_tokens":null},"client/src/hooks/use-upload.ts":{"content":"import { useState, useCallback } from \"react\";\nimport type { UppyFile } from \"@uppy/core\";\n\ninterface UploadMetadata {\n  name: string;\n  size: number;\n  contentType: string;\n}\n\ninterface UploadResponse {\n  uploadURL: string;\n  objectPath: string;\n  metadata: UploadMetadata;\n}\n\ninterface UseUploadOptions {\n  onSuccess?: (response: UploadResponse) => void;\n  onError?: (error: Error) => void;\n}\n\n/**\n * React hook for handling file uploads with presigned URLs.\n *\n * This hook implements the two-step presigned URL upload flow:\n * 1. Request a presigned URL from your backend (sends JSON metadata, NOT the file)\n * 2. Upload the file directly to the presigned URL\n *\n * @example\n * ```tsx\n * function FileUploader() {\n *   const { uploadFile, isUploading, error } = useUpload({\n *     onSuccess: (response) => {\n *       console.log(\"Uploaded to:\", response.objectPath);\n *     },\n *   });\n *\n *   const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n *     const file = e.target.files?.[0];\n *     if (file) {\n *       await uploadFile(file);\n *     }\n *   };\n *\n *   return (\n *     <div>\n *       <input type=\"file\" onChange={handleFileChange} disabled={isUploading} />\n *       {isUploading && <p>Uploading...</p>}\n *       {error && <p>Error: {error.message}</p>}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useUpload(options: UseUploadOptions = {}) {\n  const [isUploading, setIsUploading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const [progress, setProgress] = useState(0);\n\n  /**\n   * Request a presigned URL from the backend.\n   * IMPORTANT: Send JSON metadata, NOT the file itself.\n   */\n  const requestUploadUrl = useCallback(\n    async (file: File): Promise<UploadResponse> => {\n      const response = await fetch(\"/api/uploads/request-url\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          name: file.name,\n          size: file.size,\n          contentType: file.type || \"application/octet-stream\",\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || \"Failed to get upload URL\");\n      }\n\n      return response.json();\n    },\n    []\n  );\n\n  /**\n   * Upload a file directly to the presigned URL.\n   */\n  const uploadToPresignedUrl = useCallback(\n    async (file: File, uploadURL: string): Promise<void> => {\n      const response = await fetch(uploadURL, {\n        method: \"PUT\",\n        body: file,\n        headers: {\n          \"Content-Type\": file.type || \"application/octet-stream\",\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to upload file to storage\");\n      }\n    },\n    []\n  );\n\n  /**\n   * Upload a file using the presigned URL flow.\n   *\n   * @param file - The file to upload\n   * @returns The upload response containing the object path\n   */\n  const uploadFile = useCallback(\n    async (file: File): Promise<UploadResponse | null> => {\n      setIsUploading(true);\n      setError(null);\n      setProgress(0);\n\n      try {\n        // Step 1: Request presigned URL (send metadata as JSON)\n        setProgress(10);\n        const uploadResponse = await requestUploadUrl(file);\n\n        // Step 2: Upload file directly to presigned URL\n        setProgress(30);\n        await uploadToPresignedUrl(file, uploadResponse.uploadURL);\n\n        setProgress(100);\n        options.onSuccess?.(uploadResponse);\n        return uploadResponse;\n      } catch (err) {\n        const error = err instanceof Error ? err : new Error(\"Upload failed\");\n        setError(error);\n        options.onError?.(error);\n        return null;\n      } finally {\n        setIsUploading(false);\n      }\n    },\n    [requestUploadUrl, uploadToPresignedUrl, options]\n  );\n\n  /**\n   * Get upload parameters for Uppy's AWS S3 plugin.\n   *\n   * IMPORTANT: This function receives the UppyFile object from Uppy.\n   * Use file.name, file.size, file.type to request per-file presigned URLs.\n   *\n   * Use this with the ObjectUploader component:\n   * ```tsx\n   * <ObjectUploader onGetUploadParameters={getUploadParameters}>\n   *   Upload\n   * </ObjectUploader>\n   * ```\n   */\n  const getUploadParameters = useCallback(\n    async (\n      file: UppyFile<Record<string, unknown>, Record<string, unknown>>\n    ): Promise<{\n      method: \"PUT\";\n      url: string;\n      headers?: Record<string, string>;\n    }> => {\n      // Use the actual file properties to request a per-file presigned URL\n      const response = await fetch(\"/api/uploads/request-url\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          name: file.name,\n          size: file.size,\n          contentType: file.type || \"application/octet-stream\",\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to get upload URL\");\n      }\n\n      const data = await response.json();\n      return {\n        method: \"PUT\",\n        url: data.uploadURL,\n        headers: { \"Content-Type\": file.type || \"application/octet-stream\" },\n      };\n    },\n    []\n  );\n\n  return {\n    uploadFile,\n    getUploadParameters,\n    isUploading,\n    error,\n    progress,\n  };\n}\n\n","path":null,"size_bytes":5309,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"server/replit_integrations/auth/index.ts":{"content":"export { setupAuth, isAuthenticated, getSession } from \"./replitAuth\";\nexport { authStorage, type IAuthStorage } from \"./storage\";\nexport { registerAuthRoutes } from \"./routes\";\n","path":null,"size_bytes":178,"size_tokens":null},"mobile/src/hooks/useAuth.ts":{"content":"import { useState, useEffect } from 'react';\nimport * as SecureStore from 'expo-secure-store';\n\ninterface User {\n  id: number;\n  name: string;\n  email: string;\n}\n\nexport function useAuth() {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const token = await SecureStore.getItemAsync('authToken');\n      if (token) {\n        const userData = await SecureStore.getItemAsync('userData');\n        if (userData) {\n          setUser(JSON.parse(userData));\n          setIsAuthenticated(true);\n        }\n      }\n    } catch (error) {\n      console.error('Auth check failed:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = async (userData: User, token: string) => {\n    try {\n      await SecureStore.setItemAsync('authToken', token);\n      await SecureStore.setItemAsync('userData', JSON.stringify(userData));\n      setUser(userData);\n      setIsAuthenticated(true);\n    } catch (error) {\n      console.error('Login failed:', error);\n      throw error;\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await SecureStore.deleteItemAsync('authToken');\n      await SecureStore.deleteItemAsync('userData');\n      setUser(null);\n      setIsAuthenticated(false);\n    } catch (error) {\n      console.error('Logout failed:', error);\n    }\n  };\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated,\n    login,\n    logout,\n    checkAuth\n  };\n}\n","path":null,"size_bytes":1596,"size_tokens":null},"client/src/components/BottomNav.tsx":{"content":"import { useLocation, Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { Home, Upload, User, Salad } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nconst navItems = [\n  { path: \"/\", icon: Home, labelKey: \"home\" },\n  { path: \"/upload\", icon: Upload, labelKey: \"upload\" },\n  { path: \"/diet\", icon: Salad, labelKey: \"dietPlanNav\" },\n  { path: \"/profile\", icon: User, labelKey: \"profile\" },\n];\n\nexport function BottomNav() {\n  const { t, i18n } = useTranslation();\n  const [location] = useLocation();\n  const isRTL = i18n.language === \"ar\";\n\n  const items = isRTL ? [...navItems].reverse() : navItems;\n\n  return (\n    <nav className=\"fixed bottom-0 left-0 right-0 z-50 border-t bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80\">\n      <div className=\"flex items-center justify-around h-16 max-w-lg mx-auto\">\n        {items.map((item) => {\n          const isActive = location === item.path;\n          const Icon = item.icon;\n\n          return (\n            <Link\n              key={item.path}\n              href={item.path}\n              data-testid={`nav-${item.labelKey}`}\n              className={cn(\n                \"flex flex-col items-center justify-center flex-1 h-full gap-1 transition-colors\",\n                isActive\n                  ? \"text-primary\"\n                  : \"text-muted-foreground\"\n              )}\n            >\n              <Icon className=\"h-5 w-5\" />\n              <span className={cn(\"text-xs\", isActive && \"font-semibold\")}>{t(item.labelKey)}</span>\n            </Link>\n          );\n        })}\n      </div>\n    </nav>\n  );\n}\n","path":null,"size_bytes":1616,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/SubscriptionCard.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Crown, Zap, Star, FileText } from \"lucide-react\";\nimport type { SubscriptionPlan } from \"@shared/schema\";\n\ninterface SubscriptionCardProps {\n  currentPlan: SubscriptionPlan;\n  filesUsed: number;\n  onUpgrade?: () => void;\n}\n\nconst planConfig = {\n  free: {\n    name: \"freePlan\",\n    icon: FileText,\n    limit: 3,\n    color: \"bg-slate-100 text-slate-800 dark:bg-slate-900/30 dark:text-slate-400\",\n    features: [\"3 PDF uploads\", \"Basic analysis\", \"Email reminders\"],\n  },\n  basic: {\n    name: \"basicPlan\",\n    icon: Star,\n    limit: 20,\n    color: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n    features: [\"20 PDF uploads\", \"Detailed analysis\", \"Priority support\"],\n  },\n  premium: {\n    name: \"premiumPlan\",\n    icon: Crown,\n    limit: Infinity,\n    color: \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400\",\n    features: [\"Unlimited uploads\", \"AI recommendations\", \"Phone reminders\", \"Data export\"],\n  },\n};\n\nexport function SubscriptionCard({ currentPlan, filesUsed, onUpgrade }: SubscriptionCardProps) {\n  const { t } = useTranslation();\n  const config = planConfig[currentPlan];\n  const Icon = config.icon;\n  const isUnlimited = config.limit === Infinity;\n  const usagePercent = isUnlimited ? 0 : (filesUsed / config.limit) * 100;\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Zap className=\"h-5 w-5\" />\n            {t(\"subscription\")}\n          </CardTitle>\n          <Badge className={config.color}>\n            <Icon className=\"h-3 w-3 me-1\" />\n            {t(config.name)}\n          </Badge>\n        </div>\n        <CardDescription>\n          {t(\"currentPlan\")}: {t(config.name)}\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <div className=\"flex justify-between text-sm\">\n            <span>{t(\"filesUsed\")}</span>\n            <span className=\"font-medium\">\n              {filesUsed} / {isUnlimited ? t(\"unlimited\") : config.limit}\n            </span>\n          </div>\n          {!isUnlimited && (\n            <Progress \n              value={usagePercent} \n              className={usagePercent > 80 ? \"bg-red-100\" : \"\"}\n            />\n          )}\n        </div>\n\n        <div className=\"border-t pt-4\">\n          <h4 className=\"font-medium mb-2 text-sm\">{t(\"features\")}</h4>\n          <ul className=\"space-y-1\">\n            {config.features.map((feature, i) => (\n              <li key={i} className=\"text-sm text-muted-foreground flex items-center gap-2\">\n                <div className=\"h-1.5 w-1.5 rounded-full bg-primary\" />\n                {feature}\n              </li>\n            ))}\n          </ul>\n        </div>\n\n        {currentPlan !== \"premium\" && (\n          <Button onClick={onUpgrade} className=\"w-full\" data-testid=\"button-upgrade\">\n            <Crown className=\"h-4 w-4 me-2\" />\n            {t(\"upgrade\")}\n          </Button>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":3368,"size_tokens":null},"client/replit_integrations/audio/useVoiceStream.ts":{"content":"/**\n * React hook for handling SSE voice streaming responses.\n * Converts audio blob to base64 and sends as JSON to match server expectations.\n */\nimport { useCallback } from \"react\";\nimport { useAudioPlayback } from \"./useAudioPlayback\";\n\ninterface StreamCallbacks {\n  onUserTranscript?: (text: string) => void;\n  onTranscript?: (text: string, full: string) => void;\n  onComplete?: (transcript: string) => void;\n  onError?: (error: Error) => void;\n}\n\nexport function useVoiceStream(callbacks: StreamCallbacks = {}) {\n  const playback = useAudioPlayback();\n\n  const streamVoiceResponse = useCallback(\n    async (url: string, audioBlob: Blob) => {\n      await playback.init();\n      playback.clear();\n\n      // Convert blob to base64 for JSON body (server expects express.json())\n      const base64Audio = await new Promise<string>((resolve) => {\n        const fileReader = new FileReader();\n        fileReader.onload = () => {\n          const result = fileReader.result as string;\n          resolve(result.split(\",\")[1]); // Remove data URL prefix\n        };\n        fileReader.readAsDataURL(audioBlob);\n      });\n\n      const response = await fetch(url, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ audio: base64Audio }),\n      });\n      if (!response.ok) throw new Error(\"Voice request failed\");\n\n      const streamReader = response.body?.getReader();\n      if (!streamReader) throw new Error(\"No response body\");\n\n      const decoder = new TextDecoder();\n      let buffer = \"\";\n      let fullTranscript = \"\";\n\n      while (true) {\n        const { done, value } = await streamReader.read();\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split(\"\\n\");\n        buffer = lines.pop() || \"\";\n\n        for (const line of lines) {\n          if (!line.startsWith(\"data: \")) continue;\n\n          try {\n            const event = JSON.parse(line.slice(6));\n\n            switch (event.type) {\n              case \"user_transcript\":\n                callbacks.onUserTranscript?.(event.data);\n                break;\n              case \"transcript\":\n                fullTranscript += event.data;\n                callbacks.onTranscript?.(event.data, fullTranscript);\n                break;\n              case \"audio\":\n                playback.pushAudio(event.data);\n                break;\n              case \"done\":\n                playback.signalComplete();\n                callbacks.onComplete?.(fullTranscript);\n                break;\n              case \"error\":\n                throw new Error(event.error);\n            }\n          } catch (e) {\n            if (!(e instanceof SyntaxError)) {\n              callbacks.onError?.(e as Error);\n            }\n          }\n        }\n      }\n    },\n    [playback, callbacks]\n  );\n\n  return { streamVoiceResponse, playbackState: playback.state };\n}\n","path":null,"size_bytes":2914,"size_tokens":null},"client/replit_integrations/audio/useVoiceRecorder.ts":{"content":"/**\n * React hook for voice recording using MediaRecorder API.\n * Records audio in WebM/Opus format for efficient streaming.\n */\nimport { useRef, useCallback, useState } from \"react\";\n\nexport type RecordingState = \"idle\" | \"recording\" | \"stopped\";\n\nexport function useVoiceRecorder() {\n  const [state, setState] = useState<RecordingState>(\"idle\");\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const chunksRef = useRef<Blob[]>([]);\n\n  const startRecording = useCallback(async (): Promise<void> => {\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n    const recorder = new MediaRecorder(stream, {\n      mimeType: \"audio/webm;codecs=opus\",\n    });\n\n    mediaRecorderRef.current = recorder;\n    chunksRef.current = [];\n\n    recorder.ondataavailable = (e) => {\n      if (e.data.size > 0) chunksRef.current.push(e.data);\n    };\n\n    recorder.start(100); // Collect chunks every 100ms\n    setState(\"recording\");\n  }, []);\n\n  const stopRecording = useCallback((): Promise<Blob> => {\n    return new Promise((resolve) => {\n      const recorder = mediaRecorderRef.current;\n      if (!recorder || recorder.state !== \"recording\") {\n        resolve(new Blob());\n        return;\n      }\n\n      recorder.onstop = () => {\n        const blob = new Blob(chunksRef.current, { type: \"audio/webm\" });\n        recorder.stream.getTracks().forEach((t) => t.stop());\n        setState(\"stopped\");\n        resolve(blob);\n      };\n\n      recorder.stop();\n    });\n  }, []);\n\n  return { state, startRecording, stopRecording };\n}\n\n","path":null,"size_bytes":1550,"size_tokens":null},"client/src/components/TestsTable.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { TestStatusBadge } from \"./TestStatusBadge\";\nimport { CategoryIcon, CategoryLegend } from \"./CategoryIcon\";\nimport { format } from \"date-fns\";\nimport { arSA, enUS } from \"date-fns/locale\";\nimport type { TestResultWithDefinition, TestCategory, TestStatus } from \"@shared/schema\";\nimport { ArrowUpDown, Filter, Info, Share2, Check } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface TestsTableProps {\n  tests: TestResultWithDefinition[];\n  isLoading?: boolean;\n}\n\ntype SortOption = \"importance\" | \"newest\" | \"oldest\" | \"status\" | \"category\";\ntype FilterCategory = TestCategory | \"all\";\ntype FilterStatus = TestStatus | \"all\";\n\nexport function TestsTable({ tests, isLoading }: TestsTableProps) {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n  const dateLocale = isArabic ? arSA : enUS;\n  const { toast } = useToast();\n  const [copied, setCopied] = useState(false);\n\n  const [sortBy, setSortBy] = useState<SortOption>(\"importance\");\n  const [filterCategory, setFilterCategory] = useState<FilterCategory>(\"all\");\n  const [filterStatus, setFilterStatus] = useState<FilterStatus>(\"all\");\n\n  const generateShareText = () => {\n    if (tests.length === 0) {\n      return isArabic \n        ? \"لا توجد نتائج فحوصات لمشاركتها\"\n        : \"No test results to share\";\n    }\n\n    const header = isArabic \n      ? \"تقرير الفحوصات الطبية\\n\" + \"═\".repeat(30) + \"\\n\\n\"\n      : \"Medical Test Results Report\\n\" + \"═\".repeat(30) + \"\\n\\n\";\n\n    const abnormalTests = tests.filter(t => t.status === \"high\" || t.status === \"low\");\n    const normalTests = tests.filter(t => t.status === \"normal\");\n\n    let text = header;\n\n    if (abnormalTests.length > 0) {\n      text += isArabic ? \"[!] نتائج غير طبيعية:\\n\" : \"[!] Abnormal Results:\\n\";\n      abnormalTests.forEach(test => {\n        const name = isArabic ? test.testDefinition.nameAr : test.testDefinition.nameEn;\n        const statusText = test.status === \"high\" \n          ? (isArabic ? \"مرتفع\" : \"High\") \n          : (isArabic ? \"منخفض\" : \"Low\");\n        const range = test.testDefinition.normalRangeMin !== null && test.testDefinition.normalRangeMax !== null\n          ? `${test.testDefinition.normalRangeMin}-${test.testDefinition.normalRangeMax} ${test.testDefinition.unit || \"\"}`\n          : \"\";\n        const testDateStr = test.testDate \n          ? ` | ${isArabic ? \"تاريخ الفحص\" : \"Test Date\"}: ${format(new Date(test.testDate), \"yyyy-MM-dd\")}`\n          : \"\";\n        text += `- ${name}: ${test.value} ${test.testDefinition.unit || \"\"} (${statusText})`;\n        if (range) text += ` [${isArabic ? \"الطبيعي\" : \"Normal\"}: ${range}]`;\n        text += testDateStr;\n        text += \"\\n\";\n      });\n      text += \"\\n\";\n    }\n\n    if (normalTests.length > 0) {\n      text += isArabic ? \"[OK] نتائج طبيعية:\\n\" : \"[OK] Normal Results:\\n\";\n      normalTests.forEach(test => {\n        const name = isArabic ? test.testDefinition.nameAr : test.testDefinition.nameEn;\n        const range = test.testDefinition.normalRangeMin !== null && test.testDefinition.normalRangeMax !== null\n          ? `${test.testDefinition.normalRangeMin}-${test.testDefinition.normalRangeMax} ${test.testDefinition.unit || \"\"}`\n          : \"\";\n        const testDateStr = test.testDate \n          ? ` | ${isArabic ? \"تاريخ الفحص\" : \"Test Date\"}: ${format(new Date(test.testDate), \"yyyy-MM-dd\")}`\n          : \"\";\n        text += `- ${name}: ${test.value} ${test.testDefinition.unit || \"\"}`;\n        if (range) text += ` [${isArabic ? \"الطبيعي\" : \"Normal\"}: ${range}]`;\n        text += testDateStr;\n        text += \"\\n\";\n      });\n    }\n\n    const footer = isArabic\n      ? \"\\nالتاريخ: \" + format(new Date(), \"PPP\", { locale: dateLocale })\n      : \"\\nDate: \" + format(new Date(), \"PPP\", { locale: dateLocale });\n    text += footer;\n\n    return text;\n  };\n\n  const handleShare = async () => {\n    const shareText = generateShareText();\n\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: isArabic ? \"تقرير الفحوصات\" : \"Test Results Report\",\n          text: shareText,\n        });\n        toast({ title: t(\"shareSuccess\") });\n      } catch (error) {\n        if ((error as Error).name !== \"AbortError\") {\n          await copyToClipboard(shareText);\n        }\n      }\n    } else {\n      await copyToClipboard(shareText);\n    }\n  };\n\n  const copyToClipboard = async (text: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopied(true);\n      toast({ title: t(\"copiedToClipboard\") });\n      setTimeout(() => setCopied(false), 2000);\n    } catch {\n      toast({ title: t(\"error\"), description: t(\"copyFailed\"), variant: \"destructive\" });\n    }\n  };\n\n  const categories: TestCategory[] = [\n    \"vitamins\", \"minerals\", \"hormones\", \"organ_functions\",\n    \"lipids\", \"immunity\", \"blood\", \"coagulation\", \"special\"\n  ];\n\n  const sortedAndFilteredTests = useMemo(() => {\n    let result = [...tests];\n\n    if (filterCategory !== \"all\") {\n      result = result.filter(test => test.testDefinition.category === filterCategory);\n    }\n\n    if (filterStatus !== \"all\") {\n      result = result.filter(test => test.status === filterStatus);\n    }\n\n    switch (sortBy) {\n      case \"importance\":\n        result.sort((a, b) => a.testDefinition.level - b.testDefinition.level);\n        break;\n      case \"newest\":\n        result.sort((a, b) => new Date(b.testDate).getTime() - new Date(a.testDate).getTime());\n        break;\n      case \"oldest\":\n        result.sort((a, b) => new Date(a.testDate).getTime() - new Date(b.testDate).getTime());\n        break;\n      case \"status\":\n        const statusOrder = { high: 0, low: 1, normal: 2 };\n        result.sort((a, b) => statusOrder[a.status || \"normal\"] - statusOrder[b.status || \"normal\"]);\n        break;\n      case \"category\":\n        result.sort((a, b) => a.testDefinition.category.localeCompare(b.testDefinition.category));\n        break;\n    }\n\n    return result;\n  }, [tests, sortBy, filterCategory, filterStatus]);\n\n  const getStatusRowClass = (status: TestStatus | null) => {\n    if (status === \"low\" || status === \"high\") {\n      return \"bg-red-50 dark:bg-red-950/20\";\n    }\n    return \"\";\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"p-8\">\n          <div className=\"flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader className=\"pb-3 space-y-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <ArrowUpDown className=\"h-5 w-5\" />\n            {t(\"myTests\")}\n          </CardTitle>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleShare}\n            className=\"gap-1\"\n            data-testid=\"button-share-results\"\n          >\n            {copied ? <Check className=\"h-4 w-4\" /> : <Share2 className=\"h-4 w-4\" />}\n            {t(\"share\")}\n          </Button>\n        </div>\n        <div className=\"grid grid-cols-3 gap-2\">\n          <Select value={sortBy} onValueChange={(v) => setSortBy(v as SortOption)}>\n            <SelectTrigger className=\"w-full text-xs\" data-testid=\"select-sort\">\n              <SelectValue placeholder={t(\"sortBy\")} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"importance\">{t(\"importance\")}</SelectItem>\n              <SelectItem value=\"newest\">{t(\"newest\")}</SelectItem>\n              <SelectItem value=\"oldest\">{t(\"oldest\")}</SelectItem>\n              <SelectItem value=\"status\">{t(\"byStatus\")}</SelectItem>\n              <SelectItem value=\"category\">{t(\"byCategory\")}</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Select value={filterCategory} onValueChange={(v) => setFilterCategory(v as FilterCategory)}>\n            <SelectTrigger className=\"w-full text-xs\" data-testid=\"select-category\">\n              <Filter className=\"h-3 w-3 me-1\" />\n              <SelectValue placeholder={t(\"category\")} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">{t(\"allCategories\")}</SelectItem>\n              {categories.map(cat => (\n                <SelectItem key={cat} value={cat}>{t(cat)}</SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          <Select value={filterStatus} onValueChange={(v) => setFilterStatus(v as FilterStatus)}>\n            <SelectTrigger className=\"w-full text-xs\" data-testid=\"select-status\">\n              <SelectValue placeholder={t(\"status\")} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">{t(\"allStatuses\")}</SelectItem>\n              <SelectItem value=\"normal\">{t(\"normal\")}</SelectItem>\n              <SelectItem value=\"low\">{t(\"low\")}</SelectItem>\n              <SelectItem value=\"high\">{t(\"high\")}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-2\">\n        <CategoryLegend />\n        {sortedAndFilteredTests.length === 0 ? (\n          <div className=\"text-center py-12 text-muted-foreground\">\n            {t(\"noData\")}\n          </div>\n        ) : (\n          <div className=\"relative overflow-auto max-h-[55vh]\">\n            <Table className=\"text-sm\">\n              <TableHeader className=\"sticky top-0 z-20\">\n                <TableRow className=\"bg-card border-b-2 border-border\">\n                  <TableHead className=\"w-[28px] bg-card p-1 text-center\"></TableHead>\n                  <TableHead className=\"bg-card font-bold p-1\">{t(\"testName\")}</TableHead>\n                  <TableHead className=\"text-center bg-card font-bold p-1\">{t(\"yourValue\")}</TableHead>\n                  <TableHead className=\"text-center bg-card font-bold p-1\">{t(\"status\")}</TableHead>\n                  <TableHead className=\"bg-card font-bold p-1\">{t(\"testDate\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {sortedAndFilteredTests.map((test) => (\n                  <TableRow \n                    key={test.id} \n                    className={getStatusRowClass(test.status)}\n                    data-testid={`row-test-${test.id}`}\n                  >\n                    <TableCell className=\"p-1 text-center\">\n                      <CategoryIcon category={test.testDefinition.category} />\n                    </TableCell>\n                    <TableCell className=\"font-medium p-1\">\n                      <div className=\"flex items-center gap-1\">\n                        <span className=\"text-xs\">{isArabic ? test.testDefinition.nameAr : test.testDefinition.nameEn}</span>\n                        {(test.testDefinition.descriptionEn || test.testDefinition.descriptionAr) && (\n                          <Popover>\n                            <PopoverTrigger asChild>\n                              <Button variant=\"ghost\" size=\"icon\" className=\"h-4 w-4 p-0\">\n                                <Info className=\"h-3 w-3 text-blue-500\" />\n                              </Button>\n                            </PopoverTrigger>\n                            <PopoverContent side=\"top\" className=\"max-w-[250px] p-3\">\n                              <p className=\"text-sm\">\n                                {isArabic ? test.testDefinition.descriptionAr : test.testDefinition.descriptionEn}\n                              </p>\n                            </PopoverContent>\n                          </Popover>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-center font-mono p-1\">\n                      {test.value !== null ? (\n                        <div className=\"flex flex-col\">\n                          <span className={`text-xs ${test.status !== \"normal\" ? \"font-bold text-red-600 dark:text-red-400\" : \"\"}`}>\n                            {test.value}\n                          </span>\n                          <span className=\"text-[10px] text-muted-foreground\">\n                            ({test.testDefinition.normalRangeMin}-{test.testDefinition.normalRangeMax})\n                          </span>\n                        </div>\n                      ) : (\n                        <span className=\"text-xs\">{test.valueText || \"-\"}</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-center p-1\">\n                      <TestStatusBadge status={test.status || \"normal\"} />\n                    </TableCell>\n                    <TableCell className=\"text-muted-foreground p-1 text-xs\">\n                      {format(new Date(test.testDate), \"MM/dd/yy\", { locale: dateLocale })}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":13705,"size_tokens":null},"client/src/pages/LandingPage.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { MedicalDisclaimer } from \"@/components/MedicalDisclaimer\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { LanguageToggle } from \"@/components/LanguageToggle\";\nimport { \n  Activity, \n  FileText, \n  Bell, \n  Shield, \n  Pill,\n  ChevronRight,\n  LogIn\n} from \"lucide-react\";\n\nexport default function LandingPage() {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n\n  const features = [\n    {\n      icon: FileText,\n      title: isArabic ? \"تحليل PDF بالذكاء الاصطناعي\" : \"AI PDF Analysis\",\n      description: isArabic \n        ? \"ارفع تحاليلك وسيقوم الذكاء الاصطناعي باستخراج النتائج تلقائياً\" \n        : \"Upload your lab results and AI will automatically extract test values\",\n    },\n    {\n      icon: Activity,\n      title: isArabic ? \"50 نوع فحص\" : \"50 Test Types\",\n      description: isArabic \n        ? \"نغطي الفيتامينات والمعادن والهرمونات ووظائف الأعضاء والمزيد\" \n        : \"Covering vitamins, minerals, hormones, organ functions, and more\",\n    },\n    {\n      icon: Bell,\n      title: isArabic ? \"تذكيرات إعادة الفحص\" : \"Recheck Reminders\",\n      description: isArabic \n        ? \"تنبيهات تلقائية لإعادة الفحوصات بناءً على المدة الموصى بها\" \n        : \"Automatic alerts for retesting based on recommended intervals\",\n    },\n    {\n      icon: Shield,\n      title: isArabic ? \"حماية البيانات\" : \"Data Security\",\n      description: isArabic \n        ? \"بياناتك الصحية مشفرة ومحمية بأعلى معايير الأمان\" \n        : \"Your health data is encrypted and protected with highest security standards\",\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background to-muted/20\">\n      <header className=\"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 h-16 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"p-2 rounded-lg bg-primary/10\">\n              <Pill className=\"h-6 w-6 text-primary\" />\n            </div>\n            <span className=\"font-bold text-xl\">{t(\"appName\")}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <LanguageToggle />\n            <ThemeToggle />\n            <Button asChild data-testid=\"button-login\">\n              <a href=\"/api/login\">\n                <LogIn className=\"h-4 w-4 me-2\" />\n                {t(\"login\")}\n              </a>\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto px-4 py-12\">\n        <div className=\"mb-6\">\n          <MedicalDisclaimer />\n        </div>\n\n        <section className=\"text-center py-16 space-y-6\">\n          <h1 className=\"text-4xl md:text-5xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent\">\n            {t(\"appDescription\")}\n          </h1>\n          <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n            {isArabic \n              ? \"حلل نتائج تحاليلك الطبية بسهولة واتبع صحتك مع تذكيرات ذكية\"\n              : \"Easily analyze your medical lab results and track your health with smart reminders\"\n            }\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center pt-4\">\n            <Button size=\"lg\" asChild data-testid=\"button-get-started\">\n              <a href=\"/api/login\">\n                {isArabic ? \"ابدأ الآن\" : \"Get Started\"}\n                <ChevronRight className=\"h-4 w-4 ms-2\" />\n              </a>\n            </Button>\n          </div>\n        </section>\n\n        <section className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 py-12\">\n          {features.map((feature, i) => (\n            <Card key={i} className=\"hover-elevate\">\n              <CardContent className=\"pt-6\">\n                <div className=\"p-3 w-fit rounded-lg bg-primary/10 mb-4\">\n                  <feature.icon className=\"h-6 w-6 text-primary\" />\n                </div>\n                <h3 className=\"font-semibold mb-2\">{feature.title}</h3>\n                <p className=\"text-sm text-muted-foreground\">{feature.description}</p>\n              </CardContent>\n            </Card>\n          ))}\n        </section>\n\n        <section className=\"py-12\">\n          <Card className=\"bg-primary/5 border-primary/20\">\n            <CardContent className=\"py-8 text-center space-y-4\">\n              <h2 className=\"text-2xl font-bold\">\n                {isArabic ? \"ابدأ تتبع صحتك اليوم\" : \"Start Tracking Your Health Today\"}\n              </h2>\n              <p className=\"text-muted-foreground max-w-xl mx-auto\">\n                {isArabic \n                  ? \"سجّل مجاناً وارفع أول ملف PDF لتحاليلك للحصول على تحليل فوري\"\n                  : \"Sign up for free and upload your first lab PDF for instant analysis\"\n                }\n              </p>\n              <Button size=\"lg\" asChild>\n                <a href=\"/api/login\">\n                  {isArabic ? \"سجّل مجاناً\" : \"Sign Up Free\"}\n                </a>\n              </Button>\n            </CardContent>\n          </Card>\n        </section>\n      </main>\n\n      <footer className=\"border-t py-8\">\n        <div className=\"container mx-auto px-4 text-center text-sm text-muted-foreground\">\n          <p>{t(\"medicalDisclaimer\")}</p>\n          <p className=\"mt-4 font-semibold text-foreground\">{t(\"appName\")}</p>\n          <p className=\"text-xs\">{t(\"companyName\")}</p>\n          <p className=\"mt-2\">© 2024 {t(\"appName\")}. All rights reserved.</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":6090,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"server/pdfAnalyzer.ts":{"content":"import OpenAI from \"openai\";\nimport { PDFParse } from \"pdf-parse\";\n\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\ninterface ExtractedTest {\n  testId: string;\n  value: number | null;\n  valueText: string | null;\n  testDate: string | null;\n}\n\nconst testNameMapping: Record<string, string> = {\n  // Vitamins (English)\n  \"vitamin d\": \"vitamin-d\",\n  \"vitamin d3\": \"vitamin-d\",\n  \"25-oh vitamin d\": \"vitamin-d\",\n  \"25-hydroxyvitamin d\": \"vitamin-d\",\n  \"vitamin b12\": \"vitamin-b12\",\n  \"cobalamin\": \"vitamin-b12\",\n  \"folate\": \"folate\",\n  \"folic acid\": \"folate\",\n  \"vitamin b9\": \"folate\",\n  \"iron\": \"iron\",\n  \"serum iron\": \"iron\",\n  \"ferritin\": \"ferritin\",\n  \"vitamin a\": \"vitamin-a\",\n  \"retinol\": \"vitamin-a\",\n  \"vitamin e\": \"vitamin-e\",\n  \"tocopherol\": \"vitamin-e\",\n  \"vitamin k\": \"vitamin-k\",\n  \"vitamin c\": \"vitamin-c\",\n  \"ascorbic acid\": \"vitamin-c\",\n  \n  // Vitamins (Arabic)\n  \"فيتامين د\": \"vitamin-d\",\n  \"فيتامين د3\": \"vitamin-d\",\n  \"فيتامين ب12\": \"vitamin-b12\",\n  \"حمض الفوليك\": \"folate\",\n  \"الحديد\": \"iron\",\n  \"الفيريتين\": \"ferritin\",\n  \"فيتامين أ\": \"vitamin-a\",\n  \"فيتامين هـ\": \"vitamin-e\",\n  \"فيتامين ك\": \"vitamin-k\",\n  \"فيتامين ج\": \"vitamin-c\",\n  \n  // Minerals (English)\n  \"calcium\": \"calcium\",\n  \"magnesium\": \"magnesium\",\n  \"zinc\": \"zinc\",\n  \"sodium\": \"sodium\",\n  \"potassium\": \"potassium\",\n  \"phosphorus\": \"phosphorus\",\n  \"copper\": \"copper\",\n  \"selenium\": \"selenium\",\n  \n  // Minerals (Arabic)\n  \"الكالسيوم\": \"calcium\",\n  \"المغنيسيوم\": \"magnesium\",\n  \"الزنك\": \"zinc\",\n  \"الصوديوم\": \"sodium\",\n  \"البوتاسيوم\": \"potassium\",\n  \"الفوسفور\": \"phosphorus\",\n  \"النحاس\": \"copper\",\n  \"السيلينيوم\": \"selenium\",\n  \n  // Hormones (English)\n  \"tsh\": \"tsh\",\n  \"thyroid stimulating hormone\": \"tsh\",\n  \"t3\": \"t3\",\n  \"triiodothyronine\": \"t3\",\n  \"t4\": \"t4\",\n  \"thyroxine\": \"t4\",\n  \"free t4\": \"free-t4\",\n  \"ft4\": \"free-t4\",\n  \"testosterone\": \"testosterone\",\n  \"cortisol\": \"cortisol\",\n  \"insulin\": \"insulin\",\n  \"estradiol\": \"estradiol\",\n  \"progesterone\": \"progesterone\",\n  \"prolactin\": \"prolactin\",\n  \"dhea\": \"dhea\",\n  \"dhea-s\": \"dhea\",\n  \"growth hormone\": \"growth-hormone\",\n  \"gh\": \"growth-hormone\",\n  \"pth\": \"pth\",\n  \"parathyroid hormone\": \"pth\",\n  \n  // Hormones (Arabic)\n  \"هرمون الغدة الدرقية\": \"tsh\",\n  \"التستوستيرون\": \"testosterone\",\n  \"الكورتيزول\": \"cortisol\",\n  \"الأنسولين\": \"insulin\",\n  \"الاستراديول\": \"estradiol\",\n  \"البروجسترون\": \"progesterone\",\n  \"البرولاكتين\": \"prolactin\",\n  \n  // Organ Functions (English)\n  \"glucose\": \"glucose\",\n  \"fasting glucose\": \"glucose\",\n  \"blood sugar\": \"glucose\",\n  \"fasting blood sugar\": \"glucose\",\n  \"fbs\": \"glucose\",\n  \"random blood sugar\": \"glucose\",\n  \"rbs\": \"glucose\",\n  \"hba1c\": \"hba1c\",\n  \"hemoglobin a1c\": \"hba1c\",\n  \"glycated hemoglobin\": \"hba1c\",\n  \"creatinine\": \"creatinine\",\n  \"bun\": \"bun\",\n  \"blood urea nitrogen\": \"bun\",\n  \"urea\": \"bun\",\n  \"alt\": \"alt\",\n  \"sgpt\": \"alt\",\n  \"alanine aminotransferase\": \"alt\",\n  \"ast\": \"ast\",\n  \"sgot\": \"ast\",\n  \"aspartate aminotransferase\": \"ast\",\n  \"ggt\": \"ggt\",\n  \"gamma gt\": \"ggt\",\n  \"gamma-glutamyl transferase\": \"ggt\",\n  \"alkaline phosphatase\": \"alp\",\n  \"alp\": \"alp\",\n  \"bilirubin\": \"bilirubin\",\n  \"total bilirubin\": \"bilirubin\",\n  \"albumin\": \"albumin\",\n  \"total protein\": \"total-protein\",\n  \"uric acid\": \"uric-acid\",\n  \n  // Organ Functions (Arabic)\n  \"السكر الصائم\": \"glucose\",\n  \"سكر الدم\": \"glucose\",\n  \"الجلوكوز\": \"glucose\",\n  \"السكر التراكمي\": \"hba1c\",\n  \"الكرياتينين\": \"creatinine\",\n  \"اليوريا\": \"bun\",\n  \"إنزيمات الكبد\": \"alt\",\n  \"البيليروبين\": \"bilirubin\",\n  \"الألبومين\": \"albumin\",\n  \"البروتين الكلي\": \"total-protein\",\n  \"حمض اليوريك\": \"uric-acid\",\n  \n  // Lipids (English)\n  \"cholesterol\": \"total-cholesterol\",\n  \"total cholesterol\": \"total-cholesterol\",\n  \"ldl\": \"ldl\",\n  \"ldl cholesterol\": \"ldl\",\n  \"ldl-c\": \"ldl\",\n  \"hdl\": \"hdl\",\n  \"hdl cholesterol\": \"hdl\",\n  \"hdl-c\": \"hdl\",\n  \"triglycerides\": \"triglycerides\",\n  \"tg\": \"triglycerides\",\n  \"vldl\": \"vldl\",\n  \n  // Lipids (Arabic)\n  \"الكوليسترول\": \"total-cholesterol\",\n  \"الكوليسترول الكلي\": \"total-cholesterol\",\n  \"الكوليسترول الضار\": \"ldl\",\n  \"الكوليسترول النافع\": \"hdl\",\n  \"الدهون الثلاثية\": \"triglycerides\",\n  \n  // Blood Tests (English)\n  \"hemoglobin\": \"hemoglobin\",\n  \"hb\": \"hemoglobin\",\n  \"hgb\": \"hemoglobin\",\n  \"hematocrit\": \"hematocrit\",\n  \"hct\": \"hematocrit\",\n  \"rbc\": \"rbc\",\n  \"red blood cells\": \"rbc\",\n  \"red blood cell count\": \"rbc\",\n  \"wbc\": \"wbc\",\n  \"white blood cells\": \"wbc\",\n  \"white blood cell count\": \"wbc\",\n  \"platelets\": \"platelets\",\n  \"plt\": \"platelets\",\n  \"platelet count\": \"platelets\",\n  \"mcv\": \"mcv\",\n  \"mean corpuscular volume\": \"mcv\",\n  \"mch\": \"mch\",\n  \"mean corpuscular hemoglobin\": \"mch\",\n  \"mchc\": \"mchc\",\n  \"rdw\": \"rdw\",\n  \"esr\": \"esr\",\n  \"erythrocyte sedimentation rate\": \"esr\",\n  \n  // Blood Tests (Arabic)\n  \"الهيموجلوبين\": \"hemoglobin\",\n  \"خضاب الدم\": \"hemoglobin\",\n  \"كريات الدم الحمراء\": \"rbc\",\n  \"كريات الدم البيضاء\": \"wbc\",\n  \"الصفائح الدموية\": \"platelets\",\n  \"سرعة الترسيب\": \"esr\",\n  \n  // Immunity (English)\n  \"crp\": \"crp\",\n  \"c-reactive protein\": \"crp\",\n  \"hs-crp\": \"hs-crp\",\n  \"high sensitivity crp\": \"hs-crp\",\n  \n  // Immunity (Arabic)\n  \"بروتين سي التفاعلي\": \"crp\",\n  \n  // Coagulation (English)\n  \"pt\": \"pt\",\n  \"prothrombin time\": \"pt\",\n  \"inr\": \"inr\",\n  \"ptt\": \"ptt\",\n  \"aptt\": \"ptt\",\n  \"partial thromboplastin time\": \"ptt\",\n  \"d-dimer\": \"d-dimer\",\n  \"fibrinogen\": \"fibrinogen\",\n  \n  // Coagulation (Arabic)\n  \"زمن البروثرومبين\": \"pt\",\n  \"الفيبرينوجين\": \"fibrinogen\",\n};\n\nfunction findTestId(testName: string): string | null {\n  const normalized = testName.toLowerCase().trim();\n  \n  if (testNameMapping[normalized]) {\n    return testNameMapping[normalized];\n  }\n  \n  for (const [key, value] of Object.entries(testNameMapping)) {\n    if (normalized.includes(key) || key.includes(normalized)) {\n      return value;\n    }\n  }\n  \n  return null;\n}\n\nexport async function analyzeLabPdf(pdfBuffer: Buffer): Promise<ExtractedTest[]> {\n  try {\n    const parser = new PDFParse({ data: pdfBuffer });\n    const textResult = await parser.getText();\n    const pdfText = textResult.text;\n\n    if (!pdfText || pdfText.trim().length < 50) {\n      console.error(\"PDF text extraction failed or too short - may be a scanned image PDF\");\n      throw new Error(\"SCANNED_PDF\");\n    }\n\n    const alphanumericChars = pdfText.replace(/[^a-zA-Z0-9\\u0600-\\u06FF]/g, \"\").length;\n    const totalChars = pdfText.length;\n    const textDensity = alphanumericChars / totalChars;\n    \n    if (textDensity < 0.1) {\n      console.error(\"Low text density - PDF may be scanned or image-based\");\n      throw new Error(\"SCANNED_PDF\");\n    }\n\n    console.log(\"Extracted PDF text length:\", pdfText.length, \"Density:\", textDensity.toFixed(2));\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: `أنت محلل نتائج تحاليل طبية متخصص. مهمتك استخراج جميع نتائج الفحوصات من التقرير المختبري.\n\nلكل فحص تجده، استخرج:\n- testName: اسم الفحص (بالعربية أو الإنجليزية كما يظهر)\n- value: القيمة الرقمية (رقم)\n- valueText: القيمة النصية إن لم تكن رقمية (مثل \"Positive\", \"Negative\", \"إيجابي\", \"سلبي\")\n- unit: وحدة القياس\n- testDate: تاريخ الفحص إن وجد بصيغة YYYY-MM-DD\n\nأنواع الفحوصات التي يجب البحث عنها:\n1. الفيتامينات: Vitamin D, Vitamin B12, Vitamin B1, Vitamin B6, Folic Acid, Vitamin A, Vitamin E, Vitamin K, Vitamin C\n2. المعادن: Calcium, Magnesium, Iron, Zinc, Phosphorus, Sodium, Potassium, Chloride\n3. الهرمونات: TSH, T3, T4, Free T4, Testosterone, Estrogen, Progesterone, FSH, LH, Cortisol, Insulin, DHEA\n4. وظائف الكبد: ALT, AST, ALP, GGT, Bilirubin, Albumin, Total Protein\n5. وظائف الكلى: Creatinine, BUN, Urea, Uric Acid, GFR\n6. الدهون: Cholesterol, LDL, HDL, Triglycerides\n7. السكر: Glucose, Fasting Glucose, HbA1c\n8. صورة الدم: Hemoglobin, RBC, WBC, Platelets, MCV, MCH, MCHC, RDW, ESR, Hematocrit\n9. التخثر: PT, INR, PTT, D-Dimer, Fibrinogen\n10. المناعة: CRP, hs-CRP\n\nتعليمات مهمة:\n- استخرج القيمة الفعلية فقط، وليس المعدل الطبيعي (Reference Range)\n- القيم تكون عادة في عمود \"Result\" أو \"نتيجة\" أو \"القيمة\"\n- المعدل الطبيعي يكون في عمود \"Reference\" أو \"Normal\" أو \"المعدل الطبيعي\" - لا تستخرجه\n- تعامل مع الأسماء بالعربية والإنجليزية\n- إذا كان الرقم مثل \"5.5\" حوله إلى 5.5\n\nأرجع JSON array فقط. مثال:\n[\n  {\"testName\": \"Vitamin D\", \"value\": 35.5, \"valueText\": null, \"unit\": \"ng/mL\", \"testDate\": \"2026-01-15\"},\n  {\"testName\": \"HbA1c\", \"value\": 5.7, \"valueText\": null, \"unit\": \"%\", \"testDate\": null},\n  {\"testName\": \"فيتامين ب12\", \"value\": 450, \"valueText\": null, \"unit\": \"pg/mL\", \"testDate\": null}\n]\n\nإذا لم تجد أي نتائج، أرجع: []`\n        },\n        {\n          role: \"user\",\n          content: `حلل هذا التقرير المختبري واستخرج جميع نتائج الفحوصات:\\n\\n${pdfText}`\n        }\n      ],\n      max_completion_tokens: 4000,\n      temperature: 0.1,\n    });\n\n    const content = response.choices[0]?.message?.content || \"[]\";\n    console.log(\"AI Response:\", content.substring(0, 500));\n    \n    let parsed: any[];\n    try {\n      const jsonMatch = content.match(/\\[[\\s\\S]*\\]/);\n      parsed = jsonMatch ? JSON.parse(jsonMatch[0]) : [];\n    } catch (parseError) {\n      console.error(\"Failed to parse AI response:\", content);\n      parsed = [];\n    }\n\n    console.log(\"Parsed tests count:\", parsed.length);\n\n    const extractedTests: ExtractedTest[] = [];\n    \n    for (const test of parsed) {\n      const testName = (test.testName || \"\").trim();\n      const testId = findTestId(testName);\n      \n      if (testId) {\n        const numericValue = typeof test.value === \"number\" ? test.value : \n                            typeof test.value === \"string\" ? parseFloat(test.value) : null;\n        \n        extractedTests.push({\n          testId,\n          value: !isNaN(numericValue as number) ? numericValue : null,\n          valueText: test.valueText || null,\n          testDate: test.testDate || null,\n        });\n        console.log(`Matched: ${testName} -> ${testId} = ${numericValue}`);\n      } else {\n        console.log(`No mapping for test: ${testName}`);\n      }\n    }\n\n    console.log(\"Final extracted tests:\", extractedTests.length);\n    return extractedTests;\n  } catch (error) {\n    console.error(\"PDF analysis error:\", error);\n    if (error instanceof Error && error.message === \"SCANNED_PDF\") {\n      throw error;\n    }\n    throw new Error(\"ANALYSIS_FAILED\");\n  }\n}\n","path":null,"size_bytes":11439,"size_tokens":null},"shared/models/chat.ts":{"content":"import { pgTable, serial, integer, text, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { sql } from \"drizzle-orm\";\n\nexport const conversations = pgTable(\"conversations\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  conversationId: integer(\"conversation_id\").notNull().references(() => conversations.id, { onDelete: \"cascade\" }),\n  role: text(\"role\").notNull(),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport const insertConversationSchema = createInsertSchema(conversations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type Conversation = typeof conversations.$inferSelect;\nexport type InsertConversation = z.infer<typeof insertConversationSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n\n","path":null,"size_bytes":1229,"size_tokens":null},"client/src/pages/KnowledgeBase.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Brain,\n  BookOpen,\n  Dumbbell,\n  HeartPulse,\n  Pill,\n  Beaker,\n  Loader2,\n  Trash2,\n  RefreshCw,\n  ChevronDown,\n  ChevronUp,\n  Zap,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface KnowledgeEntry {\n  id: string;\n  domain: string;\n  topic: string;\n  content: string;\n  contentAr: string | null;\n  source: string;\n  sourceUrl: string | null;\n  tags: string[] | null;\n  createdAt: string;\n}\n\ninterface KnowledgeStats {\n  counts: Record<string, number>;\n  lastLearned: Record<string, string | null>;\n  totalEntries: number;\n}\n\nconst DOMAIN_INFO: Record<string, { icon: typeof Brain; labelEn: string; labelAr: string; color: string }> = {\n  nutrition: { icon: HeartPulse, labelEn: \"Clinical Nutrition\", labelAr: \"التغذية العلاجية\", color: \"text-red-500\" },\n  aerobic_training: { icon: Zap, labelEn: \"Aerobic Training\", labelAr: \"التدريب الهوائي\", color: \"text-blue-500\" },\n  resistance_training: { icon: Dumbbell, labelEn: \"Resistance Training\", labelAr: \"تدريب المقاومة\", color: \"text-orange-500\" },\n  vitamins_minerals: { icon: Pill, labelEn: \"Vitamins & Minerals\", labelAr: \"الفيتامينات والمعادن\", color: \"text-green-500\" },\n  hormones: { icon: Beaker, labelEn: \"Hormones\", labelAr: \"الهرمونات\", color: \"text-purple-500\" },\n};\n\nexport default function KnowledgeBase() {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n  const { toast } = useToast();\n  const [selectedDomain, setSelectedDomain] = useState<string | null>(null);\n  const [expandedEntries, setExpandedEntries] = useState<Set<string>>(new Set());\n\n  const statsQuery = useQuery<KnowledgeStats>({\n    queryKey: [\"/api/knowledge/stats\"],\n  });\n\n  const entriesQuery = useQuery<KnowledgeEntry[]>({\n    queryKey: [\"/api/knowledge\", selectedDomain],\n    queryFn: async () => {\n      const url = selectedDomain ? `/api/knowledge?domain=${selectedDomain}` : \"/api/knowledge\";\n      const res = await fetch(url, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch\");\n      return res.json();\n    },\n    enabled: selectedDomain !== null,\n  });\n\n  const learnMutation = useMutation({\n    mutationFn: async (domain?: string) => {\n      const res = await apiRequest(\"POST\", \"/api/knowledge/learn\", domain ? { domain } : {});\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/knowledge\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/knowledge/stats\"] });\n      toast({\n        title: isArabic ? \"تم التعلّم بنجاح\" : \"Learning Complete\",\n        description: data.entriesAdded !== undefined\n          ? (isArabic ? `تم إضافة ${data.entriesAdded} معلومة جديدة` : `Added ${data.entriesAdded} new entries`)\n          : (isArabic ? \"بدأت عملية التعلّم لجميع المجالات\" : \"Learning started for all domains\"),\n      });\n    },\n    onError: () => {\n      toast({\n        title: isArabic ? \"خطأ\" : \"Error\",\n        description: isArabic ? \"فشل في عملية التعلّم\" : \"Learning failed\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/knowledge/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/knowledge\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/knowledge/stats\"] });\n    },\n  });\n\n  const toggleExpand = (id: string) => {\n    setExpandedEntries(prev => {\n      const next = new Set(prev);\n      if (next.has(id)) next.delete(id);\n      else next.add(id);\n      return next;\n    });\n  };\n\n  const formatDate = (dateStr: string | null) => {\n    if (!dateStr) return isArabic ? \"لم يتم بعد\" : \"Not yet\";\n    return new Date(dateStr).toLocaleDateString(isArabic ? \"ar-SA\" : \"en-US\", {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  return (\n    <div className=\"space-y-4 max-w-3xl mx-auto\" data-testid=\"knowledge-base-page\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div className=\"flex items-center gap-2\">\n          <Brain className=\"h-5 w-5 text-primary\" />\n          <h2 className=\"text-lg font-bold\" data-testid=\"text-knowledge-title\">\n            {isArabic ? \"قاعدة المعرفة\" : \"Knowledge Base\"}\n          </h2>\n        </div>\n        <Button\n          onClick={() => learnMutation.mutate(undefined)}\n          disabled={learnMutation.isPending}\n          data-testid=\"button-learn-all\"\n        >\n          {learnMutation.isPending ? (\n            <Loader2 className=\"h-4 w-4 animate-spin\" />\n          ) : (\n            <RefreshCw className=\"h-4 w-4\" />\n          )}\n          <span className=\"ms-2\">{isArabic ? \"تعلّم الآن\" : \"Learn Now\"}</span>\n        </Button>\n      </div>\n\n      <p className=\"text-sm text-muted-foreground\">\n        {isArabic\n          ? \"النظام يبحث تلقائياً كل يوم في المصادر العلمية الموثوقة ويخزّن المعلومات. يستخدم هذه المعرفة عند توليد الخطط الغذائية لتقديم توصيات أدق.\"\n          : \"The system automatically searches trusted scientific sources daily and stores knowledge. It uses this knowledge when generating diet plans for more accurate recommendations.\"}\n      </p>\n\n      {statsQuery.isLoading ? (\n        <div className=\"flex justify-center py-8\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n          {Object.entries(DOMAIN_INFO).map(([domain, info]) => {\n            const Icon = info.icon;\n            const count = statsQuery.data?.counts[domain] || 0;\n            const lastLearned = statsQuery.data?.lastLearned[domain] || null;\n            const isSelected = selectedDomain === domain;\n\n            return (\n              <Card\n                key={domain}\n                className={`cursor-pointer transition-colors ${isSelected ? \"ring-2 ring-primary\" : \"\"}`}\n                onClick={() => setSelectedDomain(isSelected ? null : domain)}\n                data-testid={`card-domain-${domain}`}\n              >\n                <CardContent className=\"p-4 space-y-2\">\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <div className=\"flex items-center gap-2\">\n                      <Icon className={`h-4 w-4 ${info.color}`} />\n                      <span className=\"font-semibold text-sm\">\n                        {isArabic ? info.labelAr : info.labelEn}\n                      </span>\n                    </div>\n                    <Badge variant=\"secondary\" data-testid={`badge-count-${domain}`}>\n                      {count}\n                    </Badge>\n                  </div>\n                  <p className=\"text-[11px] text-muted-foreground\">\n                    {isArabic ? \"آخر تعلّم: \" : \"Last learned: \"}\n                    {formatDate(lastLearned)}\n                  </p>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"w-full\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      learnMutation.mutate(domain);\n                    }}\n                    disabled={learnMutation.isPending}\n                    data-testid={`button-learn-${domain}`}\n                  >\n                    {learnMutation.isPending ? (\n                      <Loader2 className=\"h-3 w-3 animate-spin\" />\n                    ) : (\n                      <RefreshCw className=\"h-3 w-3\" />\n                    )}\n                    <span className=\"ms-1.5 text-xs\">\n                      {isArabic ? \"تعلّم هذا المجال\" : \"Learn this domain\"}\n                    </span>\n                  </Button>\n                </CardContent>\n              </Card>\n            );\n          })}\n\n          <Card data-testid=\"card-total-knowledge\">\n            <CardContent className=\"p-4 flex flex-col items-center justify-center gap-2\">\n              <BookOpen className=\"h-6 w-6 text-primary\" />\n              <span className=\"text-2xl font-bold\" data-testid=\"text-total-entries\">\n                {statsQuery.data?.totalEntries || 0}\n              </span>\n              <span className=\"text-xs text-muted-foreground\">\n                {isArabic ? \"إجمالي المعلومات المخزّنة\" : \"Total stored knowledge\"}\n              </span>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {selectedDomain && (\n        <div className=\"space-y-3\">\n          <h3 className=\"font-semibold text-sm flex items-center gap-2\">\n            {(() => {\n              const info = DOMAIN_INFO[selectedDomain];\n              const Icon = info.icon;\n              return (\n                <>\n                  <Icon className={`h-4 w-4 ${info.color}`} />\n                  {isArabic ? info.labelAr : info.labelEn}\n                  <span className=\"text-muted-foreground\">\n                    ({entriesQuery.data?.length || 0})\n                  </span>\n                </>\n              );\n            })()}\n          </h3>\n\n          {entriesQuery.isLoading ? (\n            <div className=\"flex justify-center py-6\">\n              <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n            </div>\n          ) : entriesQuery.data && entriesQuery.data.length > 0 ? (\n            <div className=\"space-y-2\">\n              {entriesQuery.data.map((entry) => {\n                const isExpanded = expandedEntries.has(entry.id);\n                return (\n                  <Card key={entry.id} data-testid={`knowledge-entry-${entry.id}`}>\n                    <CardContent className=\"p-3 space-y-1.5\">\n                      <div\n                        className=\"flex items-start justify-between gap-2 cursor-pointer\"\n                        onClick={() => toggleExpand(entry.id)}\n                      >\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"font-semibold text-xs\">{entry.topic}</p>\n                          <p className=\"text-[10px] text-muted-foreground mt-0.5\">\n                            {entry.source} | {formatDate(entry.createdAt)}\n                          </p>\n                        </div>\n                        <div className=\"flex items-center gap-1 shrink-0\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              deleteMutation.mutate(entry.id);\n                            }}\n                            data-testid={`button-delete-${entry.id}`}\n                          >\n                            <Trash2 className=\"h-3 w-3 text-destructive\" />\n                          </Button>\n                          {isExpanded ? (\n                            <ChevronUp className=\"h-4 w-4 text-muted-foreground\" />\n                          ) : (\n                            <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                          )}\n                        </div>\n                      </div>\n\n                      {isExpanded && (\n                        <div className=\"space-y-2 pt-1.5 border-t\">\n                          <p className=\"text-xs leading-relaxed\">{entry.content}</p>\n                          {entry.contentAr && isArabic && (\n                            <p className=\"text-xs leading-relaxed text-muted-foreground\">{entry.contentAr}</p>\n                          )}\n                          {entry.sourceUrl && (\n                            <a\n                              href={entry.sourceUrl}\n                              target=\"_blank\"\n                              rel=\"noopener noreferrer\"\n                              className=\"text-[10px] text-primary underline\"\n                            >\n                              {entry.sourceUrl}\n                            </a>\n                          )}\n                          {entry.tags && entry.tags.length > 0 && (\n                            <div className=\"flex flex-wrap gap-1\">\n                              {entry.tags.map((tag, i) => (\n                                <Badge key={i} variant=\"outline\" className=\"text-[9px]\">\n                                  {tag}\n                                </Badge>\n                              ))}\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          ) : (\n            <Card>\n              <CardContent className=\"p-6 text-center\">\n                <BookOpen className=\"h-8 w-8 mx-auto text-muted-foreground mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  {isArabic\n                    ? \"لا توجد معلومات مخزّنة في هذا المجال بعد. اضغط \\\"تعلّم هذا المجال\\\" لبدء البحث.\"\n                    : \"No knowledge stored in this domain yet. Click \\\"Learn this domain\\\" to start.\"}\n                </p>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":14020,"size_tokens":null},"client/src/components/ObjectUploader.tsx":{"content":"import { useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport Uppy from \"@uppy/core\";\nimport type { UppyFile, UploadResult } from \"@uppy/core\";\nimport DashboardModal from \"@uppy/react/dashboard-modal\";\nimport \"@uppy/core/css/style.min.css\";\nimport \"@uppy/dashboard/css/style.min.css\";\nimport AwsS3 from \"@uppy/aws-s3\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  /**\n   * Function to get upload parameters for each file.\n   * IMPORTANT: This receives the file object - use file.name, file.size, file.type\n   * to request per-file presigned URLs from your backend.\n   */\n  onGetUploadParameters: (\n    file: UppyFile<Record<string, unknown>, Record<string, unknown>>\n  ) => Promise<{\n    method: \"PUT\";\n    url: string;\n    headers?: Record<string, string>;\n  }>;\n  onComplete?: (\n    result: UploadResult<Record<string, unknown>, Record<string, unknown>>\n  ) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\n/**\n * A file upload component that renders as a button and provides a modal interface for\n * file management.\n *\n * Features:\n * - Renders as a customizable button that opens a file upload modal\n * - Provides a modal interface for:\n *   - File selection\n *   - File preview\n *   - Upload progress tracking\n *   - Upload status display\n *\n * The component uses Uppy v5 under the hood to handle all file upload functionality.\n * All file management features are automatically handled by the Uppy dashboard modal.\n *\n * @param props - Component props\n * @param props.maxNumberOfFiles - Maximum number of files allowed to be uploaded\n *   (default: 1)\n * @param props.maxFileSize - Maximum file size in bytes (default: 10MB)\n * @param props.onGetUploadParameters - Function to get upload parameters for each file.\n *   Receives the UppyFile object with file.name, file.size, file.type properties.\n *   Use these to request per-file presigned URLs from your backend. Returns method,\n *   url, and optional headers for the upload request.\n * @param props.onComplete - Callback function called when upload is complete. Typically\n *   used to make post-upload API calls to update server state and set object ACL\n *   policies.\n * @param props.buttonClassName - Optional CSS class name for the button\n * @param props.children - Content to be rendered inside the button\n */\nexport function ObjectUploader({\n  maxNumberOfFiles = 1,\n  maxFileSize = 10485760, // 10MB default\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [uppy] = useState(() =>\n    new Uppy({\n      restrictions: {\n        maxNumberOfFiles,\n        maxFileSize,\n      },\n      autoProceed: false,\n    })\n      .use(AwsS3, {\n        shouldUseMultipart: false,\n        getUploadParameters: onGetUploadParameters,\n      })\n      .on(\"complete\", (result) => {\n        onComplete?.(result);\n      })\n  );\n\n  return (\n    <div>\n      <Button onClick={() => setShowModal(true)} className={buttonClassName}>\n        {children}\n      </Button>\n\n      <DashboardModal\n        uppy={uppy}\n        open={showModal}\n        onRequestClose={() => setShowModal(false)}\n        proudlyDisplayPoweredByUppy={false}\n      />\n    </div>\n  );\n}\n\n","path":null,"size_bytes":3327,"size_tokens":null},"client/src/pages/Dashboard.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { DashboardStats } from \"@/components/DashboardStats\";\nimport { TestsTable } from \"@/components/TestsTable\";\nimport { RemindersCard } from \"@/components/RemindersCard\";\nimport { MedicalDisclaimer } from \"@/components/MedicalDisclaimer\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Salad, GitCompareArrows } from \"lucide-react\";\nimport type { TestResultWithDefinition, Reminder, TestDefinition } from \"@shared/schema\";\n\ninterface DashboardStats {\n  totalTests: number;\n  normalTests: number;\n  abnormalTests: number;\n  pendingReminders: number;\n  recentUploads: number;\n}\n\ninterface ReminderWithDefinition extends Reminder {\n  testDefinition: TestDefinition;\n}\n\nexport default function Dashboard() {\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n\n  const { data: tests = [], isLoading: testsLoading } = useQuery<TestResultWithDefinition[]>({\n    queryKey: [\"/api/tests\"],\n  });\n\n  const { data: reminders = [], isLoading: remindersLoading } = useQuery<ReminderWithDefinition[]>({\n    queryKey: [\"/api/reminders\"],\n  });\n\n  const { data: stats } = useQuery<DashboardStats>({\n    queryKey: [\"/api/stats\"],\n  });\n\n  const normalTests = tests.filter(t => t.status === \"normal\").length;\n  const abnormalTests = tests.filter(t => t.status === \"low\" || t.status === \"high\").length;\n\n  return (\n    <div className=\"space-y-6\">\n      <MedicalDisclaimer />\n\n      <DashboardStats\n        totalTests={stats?.totalTests ?? tests.length}\n        normalTests={stats?.normalTests ?? normalTests}\n        abnormalTests={stats?.abnormalTests ?? abnormalTests}\n        pendingReminders={stats?.pendingReminders ?? reminders.length}\n        recentUploads={stats?.recentUploads ?? 0}\n      />\n\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n        <Card className=\"hover-elevate cursor-pointer\" onClick={() => setLocation(\"/diet\")} data-testid=\"card-diet-shortcut\">\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"rounded-md bg-green-100 dark:bg-green-900/30 p-2\">\n              <Salad className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n            </div>\n            <div className=\"min-w-0\">\n              <p className=\"font-semibold text-sm\">{t(\"dietPlan\")}</p>\n              <p className=\"text-xs text-muted-foreground truncate\">{t(\"dietPlanDescription\")}</p>\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"hover-elevate cursor-pointer\" onClick={() => setLocation(\"/compare\")} data-testid=\"card-compare-shortcut\">\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"rounded-md bg-blue-100 dark:bg-blue-900/30 p-2\">\n              <GitCompareArrows className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n            </div>\n            <div className=\"min-w-0\">\n              <p className=\"font-semibold text-sm\">{t(\"compareResults\")}</p>\n              <p className=\"text-xs text-muted-foreground truncate\">{t(\"noComparisonHint\")}</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2\">\n          <TestsTable tests={tests} isLoading={testsLoading} />\n        </div>\n        <div>\n          <RemindersCard \n            reminders={reminders.map((r) => ({\n              id: r.id,\n              testName: r.testDefinition?.nameEn || \"Test\",\n              testNameAr: r.testDefinition?.nameAr || \"فحص\",\n              dueDate: new Date(r.dueDate),\n              sent: r.sent ?? false,\n            }))} \n            isLoading={remindersLoading} \n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3895,"size_tokens":null}},"version":2}